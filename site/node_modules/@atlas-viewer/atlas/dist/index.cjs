"use strict";var dn=Object.create;var Yt=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var un=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var gn=(n,e,t)=>e in n?Yt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var pn=(n,e)=>{for(var t in e)Yt(n,t,{get:e[t],enumerable:!0})},ui=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of un(e))!fn.call(n,r)&&r!==t&&Yt(n,r,{get:()=>e[r],enumerable:!(i=cn(e,r))||i.enumerable});return n};var q=(n,e,t)=>(t=n!=null?dn(mn(n)):{},ui(e||!n||!n.__esModule?Yt(t,"default",{value:n,enumerable:!0}):t,n)),yn=n=>ui(Yt({},"__esModule",{value:!0}),n);var a=(n,e,t)=>(gn(n,typeof e!="symbol"?e+"":e,t),t);var Vn={};pn(Vn,{Atlas:()=>Ke,AtlasAuto:()=>In,AtlasContext:()=>ut,BoundsContext:()=>Ct,Box:()=>rt,BrowserEventManager:()=>Lt,CanvasRenderer:()=>ee,CompositeRenderer:()=>At,CompositeResource:()=>Qt,DebugRenderer:()=>ie,DrawBox:()=>Ln,Geometry:()=>Mt,GridBuilder:()=>Ve,HTMLPortal:()=>ke,ImageService:()=>Wn,ImageTexture:()=>Pt,ModeContext:()=>ct,ModeProvider:()=>En,OverlayRenderer:()=>It,ReactAtlas:()=>$t,RegionHighlight:()=>kn,ResizeWorldItem:()=>ni,Runtime:()=>dt,SingleImage:()=>H,StaticRenderer:()=>de,Text:()=>yt,TileSet:()=>si,TiledImage:()=>tt,WebGLRenderer:()=>ae,World:()=>et,WorldObject:()=>lt,Zone:()=>$e,activateEvents:()=>Xe,applyProps:()=>Ze,bounceOut:()=>Jt,canDrag:()=>Un,createDefaultEventMap:()=>je,defaultConfig:()=>_i,defaultPreset:()=>le,easingFunctions:()=>st,fromImage:()=>bn,getId:()=>oi,getTileFromCanvas:()=>nn,getTileFromImageService:()=>We,getTiles:()=>Bn,getTilesFromManifest:()=>rn,mergeStyles:()=>$n,popmotionController:()=>ne,presets:()=>Qe,staticPreset:()=>Ye,supportedEventAttributes:()=>zt,supportedEventMap:()=>nt,unmountComponentAtNode:()=>Ut,useAfterFrame:()=>qe,useAfterPaint:()=>Nn,useAtlas:()=>ue,useAtlasImage:()=>zn,useBeforeFrame:()=>Hn,useCanvas:()=>Je,useControlledAnnotationList:()=>jn,useFrame:()=>Dt,useMode:()=>re,useResizeWorldItem:()=>ii,useRuntime:()=>$,useWorldEvent:()=>De});module.exports=yn(Vn);var zt=["onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onScroll","onWheel","onClick","onDragStart","onDragEnd","onDragEnter","onDragExit","onDrag","onDragOver","onContextMenu"];function je(){return zt.reduce((n,e)=>(n[e]=[],n),{})}var nt=zt.reduce((n,e)=>(n[e.slice(2).toLowerCase()]=e,n[e]=e,n),{});var X=require("@atlas-viewer/dna");var xt=require("@atlas-viewer/dna");var mi="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var at=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=mi[t[n]&63];return e};var W=class{constructor(){a(this,"__id");a(this,"__revision",0);a(this,"__host");a(this,"__onCreate");a(this,"__parent");a(this,"__owner",{value:void 0});a(this,"__state",{});a(this,"eventHandlers");a(this,"scale",1);a(this,"layers",[]);a(this,"time",[]);a(this,"_crop");a(this,"cropData");a(this,"id");a(this,"addEventListener",(e,t,i)=>{let r=nt[e];if(!this.eventHandlers[r])throw new Error(`Unknown event ${r}`);this.eventHandlers[r].indexOf(t)===-1&&this.eventHandlers[r].push(t)});a(this,"removeEventListener",(e,t)=>{let i=nt[e];if(!this.eventHandlers[i]){console.warn(`Unknown event ${i}`);return}this.eventHandlers[i].indexOf(t)!==-1&&(this.eventHandlers[i]=this.eventHandlers[i].filter(r=>r!==t))});this.id=this.__id=at(),this.eventHandlers=je()}get crop(){return this._crop}set crop(e){this._crop=e}getObjectsAt(e){return[]}getAllPointsAt(e,t,i){return[]}getScheduledUpdates(e,t){return[]}dispatchEvent(e,t){let i=this.eventHandlers[e],r=i?i.length:0,s=!1;if(r)for(let o=0;o<r;o++)try{i[o](t),s=!0}catch(h){console.error(e,h)}return s}get x(){return this.points[1]}get y(){return this.points[2]}get width(){return this.points[3]-this.points[1]}get height(){return this.points[4]-this.points[2]}translate(e,t){(0,xt.mutate)(this.points,(0,xt.translate)(e,t))}atScale(e){(0,xt.mutate)(this.points,(0,xt.scaleAtOrigin)(e,this.x,this.y)),this.scale*=e}transform(e){(0,xt.mutate)(this.points,e)}applyProps(e){this.__revision++}appendChild(e){}removeChild(e){}insertBefore(e,t){}hideInstance(){}};var H=class n extends W{constructor(t){super();a(this,"type","spacial-content");a(this,"id");a(this,"uri");a(this,"display");a(this,"points");a(this,"priority");a(this,"style",{opacity:1});if(!t)this.id="",this.uri="",this.display={x:0,y:0,scale:1,width:0,height:0,points:(0,X.dna)(5)},this.points=(0,X.dna)(5);else{let i=t.scale||1;this.id=t.id||t.uri,this.uri=t.uri,this.points=X.DnaFactory.singleBox(t.width,t.height,t.x,t.y),this.display={x:0,y:0,scale:i,width:t.width/i,height:t.height/i,points:X.DnaFactory.singleBox(t.width/i,t.height/i),rotation:t?.rotation}}}applyProps(t){let i=t.display?t.display.width:t.target.width,r=t.target.width/i;if(this.id=t.id||t.uri,this.uri=t.uri,this.points.set(X.DnaFactory.singleBox(t.target.width,t.target.height,t.target.x,t.target.y)),t.style&&typeof t.style.opacity<"u"&&(this.style.opacity=t.style.opacity),t.crop){this.cropData=t.crop;let s=X.DnaFactory.singleBox(t.crop.width,t.crop.height,t.crop.x,t.crop.y);(0,X.mutate)(s,(0,X.translate)(-t.crop.x,-t.crop.y)),this.crop?this.crop.set(s):this.crop=(0,X.dna)(s)}t.display?(this.display.scale=r,this.display.width=t.display.width,this.display.height=t.display.height,this.display.rotation=t.display.rotation,this.display.points=X.DnaFactory.singleBox(t.display.width,t.display.height)):(this.display.scale=r,this.display.width=t.target.width/r,this.display.height=t.target.height/r,this.display.points=X.DnaFactory.singleBox(t.target.width/r,t.target.height/r))}getAllPointsAt(t,i,r){return[[this,this.crop||this.points,i]]}static fromSvg(t,i,r,s){return n.fromImage("data:image/svg+xml;base64,"+btoa(t),i,r,s)}static fromImage(t,i,r,s){let o=new n;return o.applyProps({uri:t,id:s,display:r,target:i}),o}getImageUrl(){return this.uri}};var St=require("@atlas-viewer/dna");var Pt=class extends W{constructor(t){super();a(this,"type","spacial-content");a(this,"id");a(this,"uri");a(this,"display");a(this,"points");a(this,"getTexture");if(this.getTexture=()=>({source:void 0,hash:-1}),!t)this.id="",this.uri="",this.display={x:0,y:0,scale:1,width:0,height:0,points:(0,St.dna)(5)},this.points=(0,St.dna)(5);else{let i=t.scale||1;this.id=t.id||t.uri,this.uri=t.uri,this.points=St.DnaFactory.singleBox(t.width,t.height),this.display={x:0,y:0,scale:i,width:t.width/i,height:t.height/i,points:i!==1?St.DnaFactory.singleBox(t.width/i,t.height/i):this.points}}}applyProps(t){let i=t.display?t.display.width:t.target.width,r=t.target.width/i;this.id=t.id,this.points.set(St.DnaFactory.singleBox(t.target.width,t.target.height)),this.display.scale=r,this.display.width=t.target.width/r,this.display.height=t.target.height/r,this.getTexture=t.getTexture,this.display.points=r!==1?St.DnaFactory.singleBox(t.target.width/r,t.target.height/r):this.points}getAllPointsAt(t,i,r){return[[this,this.points,i]]}};var V=require("@atlas-viewer/dna");function fi(n,e,t=1){let i=e.length;if(i===0)throw new Error("No resources passed in.");let r=0,s=1/0;for(let o=0;o<i&&!(!e[o]||!e[o].display);o++){let h=Ue(e[o].display.scale,n/(t||1));h<s&&(s=h,r=o)}return r}function Ue(n,e){return Math.abs(n-e)}function Ot(n,e){let t=Ue(n.x,e.x),i=Ue(n.y,e.y);return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))}function gi(n){let e=n.length;return n.indexOf("/info.json")===e-10?n.slice(0,-10):n}function ge(n,e,t){return Math.min(Math.max(n,e),t)}var tt=class n extends W{constructor(t){super();a(this,"id");a(this,"type","spacial-content");a(this,"display");a(this,"tileWidth");a(this,"style",{opacity:1});a(this,"points");a(this,"service");a(this,"format","jpg");a(this,"crop2");a(this,"version3");a(this,"tileUrl");this.tileUrl=gi(t.url),this.id=t.id||`${this.tileUrl}--${t.scaleFactor}`,this.points=t.displayPoints?t.displayPoints:(0,V.transform)(t.points,(0,V.scale)(t.scaleFactor)),this.tileWidth=t.tileWidth,this.version3=t.version3,this.display={x:0,y:0,width:t.width/t.scaleFactor,height:t.height/t.scaleFactor,points:t.points,scale:t.scaleFactor},t.format&&(this.format=t.format)}applyProps(t){if(t.style&&typeof t.style.opacity<"u"&&(this.style.opacity=t.style.opacity),t.service!==this.service&&(this.service=t.service),t.format?this.format=t.format:this.format="jpg",typeof t.version3<"u"&&(this.version3=t.version3),t.crop){this.cropData=t.crop;let i=(0,V.dna)([...this.points]),r=i.length/5,s=t.crop.x||0,o=t.crop.y||0,h=t.crop.x+t.crop.width,l=t.crop.y+t.crop.height;for(let c=0;c<r;c++){let d=c*5;i[d+1]<h&&i[d+3]>s&&i[d+2]<l&&i[d+4]>o?(i[d+1]=ge(i[d+1],s,h),i[d+3]=ge(i[d+3],s,h),i[d+2]=ge(i[d+2],o,l),i[d+4]=ge(i[d+4],o,l)):i[d]=0}(0,V.mutate)(i,(0,V.translate)(-t.crop.x,-t.crop.y)),this.crop?this.crop.set(i):this.crop=i}}static fromTile(t,i,r,s,o,h,l,c){r.height=r.height?r.height:r.width;let d=l?Math.floor(i.width/s):Math.ceil(i.width/s),u=l?Math.floor(i.height/s):Math.ceil(i.height/s),m=Math.ceil(d/r.width),y=Math.ceil(u/r.height),v=V.DnaFactory.grid(m,y),S=V.DnaFactory.grid(m,y),P=o?o["@context"]?Array.isArray(o["@context"])?o["@context"]:[o["@context"]]:[]:[],g=typeof c<"u"?c:P.indexOf("http://iiif.io/api/image/3/context.json")!==-1;for(let C=0;C<y;C++)for(let R=0;R<m;R++){let w=R*r.width,b=C*r.height;S.addPoints(w*s,b*s,R===m-1?i.width:(w+r.width)*s,C===y-1?i.height:(b+r.height)*s),v.addPoints(w,b,R===m-1?d:w+r.width,C===y-1?u:b+r.height)}let f=new n({url:t,scaleFactor:s,points:v.build(),displayPoints:S.build(),width:i.width,height:i.height,tileWidth:r.width,format:h,version3:g});return f.applyProps({service:o}),f}getImageUrl(t){let i=this.points.slice(t*5,t*5+5),r=i[3]-i[1],s=i[4]-i[2],o=Math.ceil(r/this.display.scale),h=Math.ceil(s/this.display.scale),l=`${o>this.tileWidth?this.tileWidth:o},`;return this.version3&&(l+=`${h>this.tileWidth?this.tileWidth:h}`),`${this.tileUrl}/${i[1]},${i[2]},${r},${s}/${l}/0/default.${this.format||"jpg"}`}getAllPointsAt(t,i,r){let s=(0,V.hidePointsOutsideRegion)(this.crop||this.points,t);return[[this,s,i]]}transform(t){(0,V.mutate)(this.points,t)}getScheduledUpdates(t,i){return[]}};var ht=require("@atlas-viewer/dna");var pe=class extends W{constructor(){super(...arguments);a(this,"type","spacial-content")}getAllPointsAt(t,i,r){return[[this,this.points,i]]}};var Qt=class extends pe{constructor(t){super();a(this,"id");a(this,"display");a(this,"points");a(this,"images",[]);a(this,"allImages",[]);a(this,"scaleFactors",[]);a(this,"aggregateBuffer",(0,ht.dna)(9));a(this,"lazyLoader");a(this,"isFullyLoaded",!1);a(this,"maxScaleFactor",0);a(this,"renderOptions");a(this,"_scheduleSortByScales",!1);a(this,"_sortByScales",()=>{this._scheduleSortByScales=!1,this.allImages.sort((i,r)=>r.display.width-i.display.width),this.images=[];let t=.1;for(let i of this.allImages){if(i.display.width<this.renderOptions.minSize&&i.display.height<this.renderOptions.minSize&&!i.priority||i instanceof H&&(i.display.width>this.renderOptions.maxImageSize||i.display.height>this.renderOptions.maxImageSize)&&!i.priority)continue;if(Math.abs(i.display.scale-t)<.25||i.priority){let s=this.images.pop();s&&(s instanceof H||s.priority)?(i.priority&&this.images.push(i),this.images.push(s)):i&&this.images.push(i)}else i&&this.images.push(i);t=i.display.scale}this.images.length===0&&(this.images=[...this.allImages]),this.scaleFactors=this.images.map(i=>i.display.scale),this.maxScaleFactor=Math.max(...this.scaleFactors)});a(this,"loadFullResource",async()=>{if(!this.isFullyLoaded&&this.lazyLoader){this.isFullyLoaded=!0;let t=await this.lazyLoader();this.addImages(t)}});a(this,"fallback",[this.loadFullResource]);this.id=t.id,this.points=ht.DnaFactory.singleBox(t.width,t.height),this.lazyLoader=t.loadFullImages,t.loadFullImages||(this.isFullyLoaded=!0),this.display={x:0,y:0,points:ht.DnaFactory.singleBox(t.width,t.height),height:t.height,width:t.width,scale:1},this.renderOptions={renderSmallestFallback:!0,renderLayers:3,minSize:255,maxImageSize:2048,quality:1.5,...t.renderOptions||{}},this.addImages(t.images)}applyProps(t){typeof t.renderSmallestFallback<"u"&&t.renderSmallestFallback!==this.renderOptions.renderSmallestFallback&&(this.renderOptions.renderSmallestFallback=t.renderSmallestFallback),typeof t.renderLayers<"u"&&t.renderLayers!==this.renderOptions.renderLayers&&(this.renderOptions.renderLayers=t.renderLayers),typeof t.minSize<"u"&&t.minSize!==this.renderOptions.minSize&&(this.renderOptions.minSize=t.minSize),typeof t.maxImageSize<"u"&&t.maxImageSize!==this.renderOptions.maxImageSize&&(this.renderOptions.maxImageSize=t.maxImageSize),typeof t.quality<"u"&&t.quality!==this.renderOptions.quality&&(this.renderOptions.quality=t.quality)}appendChild(t){this.addImages([t])}removeChild(t){this.images.indexOf(t)!==-1&&(this.images=this.images.filter(i=>i!==t),this.sortByScales())}insertBefore(t,i){this.addImages([t])}hideInstance(){}addImages(t){for(let i of t)i.__parent=this,i.__owner=this.__owner;this.allImages.push(...t.filter(Boolean)),this.sortByScales()}sortByScales(){this._scheduleSortByScales=!0}getScheduledUpdates(t,i){return this._scheduleSortByScales?[this._sortByScales]:this.isFullyLoaded?[]:i>1/this.maxScaleFactor?this.fallback:[]}getAllPointsAt(t,i,r){if(this.images.length===0)return[];let s=fi(1/(r||1)/(window.devicePixelRatio||1),this.images,this.renderOptions.quality),o=this.images.length,h=i?(0,ht.compose)(i,(0,ht.translate)(this.x,this.y)):(0,ht.translate)(this.x,this.y);if(s!==this.images.length-1&&this.images[s+1]){let l=[];for(let u=o-1;u>=s;u--)l.push(u);let c=l[0];this.renderOptions.renderLayers&&(l=l.slice(-Math.min(l.length,this.renderOptions.renderLayers))),this.renderOptions.renderSmallestFallback&&l.indexOf(c)===-1&&l.unshift(c);let d=[];for(let u=0;u<l.length;u++)d.push(...this.images[l[u]].getAllPointsAt(t,h,r));return d}return this.images[s].getAllPointsAt(t,h,r)}};var M=require("@atlas-viewer/dna");var T=require("@atlas-viewer/dna");function ye(n,e,t,i,r){let s=Math.PI/180*r,o=Math.cos(s),h=Math.sin(s),l=o*(t-n)+h*(i-e)+n,c=o*(i-e)-h*(t-n)+e;return[l,c]}var lt=class n extends W{constructor(t,i){super();a(this,"id");a(this,"type","world-object");a(this,"scale");a(this,"layers");a(this,"points");a(this,"worldPoints");a(this,"intersectionBuffer",(0,T.dna)(5));a(this,"aggregateBuffer",(0,T.dna)(9));a(this,"invertedBuffer",(0,T.dna)(9));a(this,"rotation",0);a(this,"filteredPointsBuffer");a(this,"_updatedList",[]);a(this,"geometry");let{x:r=0,y:s=0}=i||{};t?(this.id=t.id||"",this.scale=1,this.layers=t.layers,this.points=(0,T.dna)([1,r,s,r+t.width,s+t.height]),this.worldPoints=(0,T.dna)([1,r,s,r+t.width,s+t.height]),this.filteredPointsBuffer=(0,T.dna)(t.layers.length*5)):(this.id="",this.scale=1,this.layers=[],this.points=(0,T.dna)(5),this.worldPoints=(0,T.dna)(5),this.filteredPointsBuffer=(0,T.dna)(5))}static createWithProps(t){let i=new n;return i.applyProps(t),i}applyProps(t){let i=t.x||0,r=t.y||0;this.id=t.id;let s=typeof t.scale<"u"?t.scale:this.scale;this.points[0]=1,this.points[1]=i,this.points[2]=r,this.points[3]=i+t.width,this.points[4]=r+t.height,this.rotation=t.rotation||0,this.worldPoints[3]=this.worldPoints[1]+t.width,this.worldPoints[4]=this.worldPoints[2]+t.height,t.scale&&t.scale!==1&&this.atScale(s),this.scale=s}appendChild(t){t.points[0]===0&&t.points.set(this.points),t.__owner.value=this,this.addLayers([t])}removeChild(t){this.layers=this.layers.filter(i=>i!==t),this.filteredPointsBuffer=(0,T.dna)(this.layers.length*5)}insertBefore(t,i){let r=this.layers.indexOf(i);if(r===-1||this.layers.indexOf(t)!==-1)return;let s=this.layers.slice(0,r),o=this.layers.slice(r);this.layers=[...s,t,...o]}hideInstance(){console.warn("hideInstance: not yet implemented")}getObjectsAt(t,i){if(this.rotation&&(t=this.applyRotation(t)),(0,T.hidePointsOutsideRegion)(this.points,t,this.filteredPointsBuffer)[0]===0)return[];let s=this.layers.length,o=[];for(let h=0;h<s;h++){let l=this.layers[h];if(i&&l.isShape){let d=(0,T.transform)(l.points,(0,T.translate)(this.x,this.y));if(!l.intersects([t[1]-d[1],t[2]-d[2]]))continue}if((0,T.hidePointsOutsideRegion)((0,T.transform)(l.points,(0,T.translate)(this.x,this.y)),t,this.filteredPointsBuffer)[0]!==0&&o.push(l),i){let d=l;o.push(...d.getObjectsAt(t,i))}}return o}applyRotation(t){if(this.rotation){let i={x:t[1],y:t[2]},r={x:t[1],y:t[4]},s={x:t[3],y:t[2]},o={x:t[3],y:t[4]},h=this.points[1]+(this.points[3]-this.points[1])/2,l=this.points[2]+(this.points[4]-this.points[2])/2,[c,d]=ye(h,l,i.x,i.y,this.rotation),[u,m]=ye(h,l,r.x,r.y,this.rotation),[y,v]=ye(h,l,s.x,s.y,this.rotation),[S,P]=ye(h,l,o.x,o.y,this.rotation),g=Math.min(c,u,y,S),f=Math.max(c,u,y,S),C=Math.min(d,m,v,P),R=Math.max(d,m,v,P);return(0,T.dna)([t[0],g,C,f,R])}return t}getAllPointsAt(t,i,r){let s=(0,T.compose)((0,T.translate)(this.x,this.y),(0,T.scale)(this.scale),this.aggregateBuffer);this.rotation&&(t=this.applyRotation(t));let o=(0,T.getIntersection)(t,this.points,this.intersectionBuffer),h=this.layers.length,l=[],c=(0,T.transform)(o,(0,T.compose)((0,T.scale)(1/this.scale),(0,T.translate)(-this.x,-this.y),this.invertedBuffer)),d=i?(0,T.compose)(i,s,this.aggregateBuffer):s,u=r*this.scale;for(let m=0;m<h;m++)l.push(...this.layers[m].getAllPointsAt(c,d,u));return l}addLayers(t){let i=[];for(let r of t)this.layers.indexOf(r)===-1&&(i.push(r),r.points.length===5&&(r.points[1]<this.worldPoints[1]/this.scale||r.points[2]<this.worldPoints[2]/this.scale||r.points[3]>this.worldPoints[3]/this.scale||r.points[4]>this.worldPoints[4]/this.scale)&&(r.crop=r.crop||(0,T.dna)([1,Math.max(this.worldPoints[1]/this.scale,r.points[1]),Math.max(this.worldPoints[2]/this.scale,r.points[2]),Math.min(this.worldPoints[3]/this.scale,r.points[3]),Math.min(this.worldPoints[4]/this.scale,r.points[4])])));this.layers=this.layers.concat(i),this.filteredPointsBuffer=(0,T.dna)(this.layers.length*5)}getScheduledUpdates(t,i){let r=this.layers.length;this._updatedList=[];let s=i*this.scale;for(let o=0;o<r;o++){let h=this.layers[o].getScheduledUpdates(t,s);h&&this._updatedList.push(...h)}return this._updatedList}};var et=class n extends W{constructor(t=0,i=0,r=100,s="left-to-right"){super();a(this,"id","world");a(this,"_width");a(this,"_height");a(this,"aspectRatio");a(this,"viewingDirection");a(this,"aggregateBuffer",(0,M.dna)(9));a(this,"isDirty",!1);a(this,"zones",[]);a(this,"filteredPointsBuffer");a(this,"selectedZone");a(this,"triggerQueue",[]);a(this,"activatedEvents",[]);a(this,"_updatedList",[]);a(this,"translationBuffer",(0,M.dna)(9));a(this,"needsRecalculate",!0);a(this,"emptyPaintables",[]);a(this,"renderOrder",[]);a(this,"points");a(this,"objects",[]);a(this,"subscriptions",[]);a(this,"_propagateEventTargets",[]);a(this,"_alreadyFlushed",[]);this._width=t,this._height=i,this.aspectRatio=Number.isNaN(t/i)?1:t/i,this.viewingDirection=s,this.points=(0,M.dna)(r*5),this.filteredPointsBuffer=(0,M.dna)(r*5)}get x(){return 0}get y(){return 0}get width(){return this._width}get height(){return this._height}static withProps(t){let i=new n;return i.applyProps(t),i}applyProps(t){typeof t.width<"u"&&typeof t.height<"u"&&(t.width!==this._width||t.height!==this._height)&&this.resize(t.width,t.height),t.viewingDirection!==this.viewingDirection&&(this.viewingDirection=t.viewingDirection,this.triggerRepaint())}propagateTouchEvent(t,i,r){let s=[];for(let o of r)if(o.x&&o.y){let h=M.DnaFactory.singleBox(1,1,o.x,o.y);s.push(this.getObjectsAt(h,!0).reverse())}return s.map(o=>this.propagateEvent(t,i,o,{bubbles:!0,cancelable:!0}))}propagatePointerEvent(t,i,r,s,o={}){let h=M.DnaFactory.singleBox(1,1,r,s),l=this.getObjectsAt(h,!0).reverse();return this.propagateEvent(t,i,l,o)}propagateEvent(t,i,r,{bubbles:s=!1,cancelable:o=!1}={}){i.atlasTarget=this,this._propagateEventTargets.length=1,this._propagateEventTargets[0]=this;let h=!1;i.stopPropagation=()=>{h=!0};let l=r.length;for(let u=l-1;u>=0;u--){this._propagateEventTargets.unshift(r[u][0]);let m=r[u][1].length;if(m)for(let y=0;y<m;y++)this._propagateEventTargets.unshift(r[u][1][y])}let c=this._propagateEventTargets.length,d=!1;for(let u=0;u<c&&(i.atlasTarget=this._propagateEventTargets[u],i.atlasWorld=this,d=this._propagateEventTargets[u].dispatchEvent(t,i)||d,!h);u++);return d&&this.triggerRepaint(),this._propagateEventTargets}appendChild(t){let i=this.appendWorldObject(t);this.renderOrder.push(i/5)}removeChild(t){let i=this.objects.indexOf(t);if(i===-1){for(let r of this.objects)if(r&&r.id===t.id){this.removeChild(r);return}return}this.objects[i]=null,this.renderOrder=this.renderOrder.filter(r=>r!==i),this.points[i*5]=0,this.triggerRepaint(),this.needsRecalculate=!0}insertBefore(t,i){let r=this.objects.indexOf(i);if(r===-1)return;let s=this.appendWorldObject(t);this.renderOrder.splice(r-1,0,s/5)}hideInstance(){}asWorldObject(){return null}addZone(t){this.zones.push(t)}selectZone(t){if(typeof t=="string"){let i=this.zones.length;for(let r=0;r<i;r++)if(this.zones[r].id===t){this.selectedZone=r,this.trigger("zone-changed");return}}else this.zones[t]&&(this.selectedZone=t,this.trigger("zone-changed"))}deselectZone(){this.selectedZone=void 0}getActiveZone(){if(this.selectedZone)return this.zones[this.selectedZone]}hasActiveZone(){return typeof this.selectedZone<"u"}checkResizeInternalBuffer(){if((0,M.dnaLength)(this.points)===this.objects.length){let t=this.points,i=(0,M.dna)(this.points.length*2);i.set(t,0),this.points=i}}appendWorldObject(t){this.checkResizeInternalBuffer();let i=this.objects.length*5,r=t.points;return t.points=this.points.subarray(this.objects.length*5,this.objects.length*5+5),t.points[1]=r[1],t.points[2]=r[2],t.points[3]=r[3],t.points[4]=r[4],this.objects.push(t),this.filteredPointsBuffer=(0,M.dna)(this.objects.length*5),this.needsRecalculate=!0,this.triggerRepaint(),i}recalculateWorldSize(){let t=!1;if(this.needsRecalculate){let i=new Int32Array(this.objects.length),r=new Int32Array(this.objects.length),s=this.renderOrder.length;for(let l=0;l<s;l++){let c=this.renderOrder[l];this.objects[c]&&(i[l]=this.points[c*5+3],r[l]=this.points[c*5+4])}let o=Math.max(...i);o!==this._width&&(this._width=o,t=!0);let h=Math.max(...r);h!==this._height&&(this._height=h,t=!0),t&&this.trigger("recalculate-world-size",{width:o,height:h}),this.needsRecalculate=!1}return t}addObjectAt(t,i){i.width&&!i.height?i.height=i.width/t.width*t.height:i.height&&!i.width&&(i.width=i.height/t.height*t.width),(!i||!i.width||!i.height)&&(i.width=t.width,i.height=t.height);let{width:r,x:s,y:o}=i,h=r/t.width;this.checkResizeInternalBuffer(),this.points.set(M.DnaFactory.singleBox(t.width,t.height,0,0),this.objects.length*5);let l=new lt(t);return l.points=this.points.subarray(this.objects.length*5,this.objects.length*5+5),this.objects.push(l),this.scaleWorldObject(this.objects.length-1,h),this.translateWorldObject(this.objects.length-1,s,o),this.filteredPointsBuffer=(0,M.dna)(this.points.length*2),this.triggerRepaint(),this.needsRecalculate=!0,l}scaleWorldObject(t,i){(0,M.mutate)(this.points.subarray(t*5,t*5+5),(0,M.scaleAtOrigin)(i,this.points[t*5+1],this.points[t*5+2]));let r=this.objects[t];r&&(r.atScale(i),this.triggerRepaint())}translateWorldObject(t,i,r){(0,M.mutate)(this.points.subarray(t*5,t*5+5),(0,M.translate)(i,r));let s=this.objects[t];s&&(s.translate(i,r),this.triggerRepaint())}resize(t,i){return this._width=t,this._height=i,this.aspectRatio=t/i,this.triggerRepaint(),this}getObjects(){return this.objects}getPoints(){return this.points}getPointsFromViewer(t,i){let r=M.DnaFactory.singleBox(t.width,t.height,t.x,t.y);return this.getPointsAt(r,i,t.scale)}addLayoutSubscriber(t){return this.subscriptions.push(t),()=>{this.subscriptions.splice(this.subscriptions.indexOf(t),1)}}getScheduledUpdates(t,i){let r=(0,M.hidePointsOutsideRegion)(this.points,t,this.filteredPointsBuffer),s=this.objects.length;this._updatedList=[];for(let o=0;o<s;o++)if(r[o*5]!==0){if(!this.objects[o])continue;this._updatedList.push(...this.objects[o].getScheduledUpdates(t,i))}return this._updatedList}getObjectsAt(t,i=!1){let r=this.getActiveZone(),s=(0,M.hidePointsOutsideRegion)(this.points,t,this.filteredPointsBuffer),o=this.renderOrder.length,h=[];for(let l=0;l<o;l++){let c=this.renderOrder[l];if(s[c*5]!==0){let d=this.objects[c];if(!d||r&&r.objects.indexOf(d)===-1)continue;if(d.type!=="world-object"){h.push([d,[d]]);continue}i?h.push([d,d.getObjectsAt(t,i)]):h.push([d,this.emptyPaintables])}}return h}getPointsAt(t,i,r=1){let s=this.getObjectsAt(t),o=(0,M.compose)((0,M.scale)(r),(0,M.translate)(-t[1],-t[2]),this.translationBuffer),h=i?(0,M.compose)(i,o,this.aggregateBuffer):o,l=s.length,c=[];for(let d=0;d<l;d++)s[d]&&c.push(...s[d][0].getAllPointsAt(t,h,r));return c}flushSubscriptions(){if(this.triggerQueue.length){this._alreadyFlushed=[];let t=this.triggerQueue.length;for(let i=0;i<t;i++){if(this._alreadyFlushed.indexOf(this.triggerQueue[i][0])!==-1)continue;typeof this.triggerQueue[i][1]>"u"&&this._alreadyFlushed.push(this.triggerQueue[i][0]);let r=this.subscriptions.length;for(let s=0;s<r;s++)this.subscriptions[s].apply(null,this.triggerQueue[i])}this.triggerQueue=[]}}trigger(t,i){this.triggerQueue.push([t,i])}triggerEventActivation(){this.trigger("event-activation")}triggerRepaint(){this.trigger("repaint")}gotoRegion(t){this.trigger("goto-region",t)}goHome(t=!1){this.trigger("go-home",{immediate:t})}zoomTo(t,i,r){this.trigger("zoom-to",{point:i,factor:t,stream:r})}zoomIn(t){this.trigger("zoom-to",{point:t,factor:.5})}zoomOut(t){this.trigger("zoom-to",{point:t,factor:2})}constraintBounds(t){this.trigger("constrain-bounds",{immediate:t})}};function bn(n){let{src:e,target:t}=n,i=t?t.width:n.width,r=t?t.height:n.height;return new lt({id:e,height:r,width:i,layers:[H.fromImage(e,{height:r,width:i},{width:n.width,height:n.height})]})}var pi=require("@atlas-viewer/dna");var vn={margin:0},$e=class{constructor(e,t={}){a(this,"id");a(this,"config");a(this,"points");a(this,"objects");this.id=e.map(i=>i.id).join("$$"),this.config={...vn,...t},this.points=(0,pi.dna)(5),this.objects=e,this.recalculateBounds()}recalculateBounds(){this.points.set([1,Math.min(...this.objects.map(e=>e.points[1]))-this.config.margin,Math.min(...this.objects.map(e=>e.points[2]))-this.config.margin,Math.max(...this.objects.map(e=>e.points[3]))+this.config.margin,Math.max(...this.objects.map(e=>e.points[4]))+this.config.margin])}getPointsAt(e,t,i){return[]}};var Ht=require("@atlas-viewer/dna");var be=/([0-9]+(px|em)\s+)+(solid)\s+(.*)/g,ve={},wn=["backgroundColor","opacity","boxShadow","borderColor","borderWidth","borderStyle","outlineColor","outlineWidth","outlineOffset","outlineStyle"],rt=class extends W{constructor(){super();a(this,"id");a(this,"type","spacial-content");a(this,"points");a(this,"hoverEvents",!1);a(this,"activeEvents",!1);a(this,"display",{x:0,y:0,scale:1,width:-1,height:-1,points:(0,Ht.dna)(5)});a(this,"_parsed",{border:{id:null,match:[]},outline:{id:null,match:[]}});a(this,"hovering");a(this,"pressing");a(this,"props",{});a(this,"addHover",()=>{this.hovering=!0,this.__revision++});a(this,"removeHover",()=>{this.hovering=!1,this.pressing=!1,this.__revision++});a(this,"addPress",()=>{this.pressing=!0,this.__revision++});a(this,"removePress",()=>{this.pressing=!1,this.__revision++});this.id=at(12),this.points=(0,Ht.dna)(5)}getAllPointsAt(t,i){return[[this,this.points,i]]}applyProps(t={}){let i=!1;if(t.interactive!==this.props.interactive&&(i=!0,this.props.interactive=t.interactive),t.style){let r=t.border||t.style.border;if(r!==this._parsed.border.id)if(!r)this._parsed.border.id=null,this._parsed.border.match=[];else{let s=ve[r]||be.exec(r)||be.exec(r);s&&(this._parsed.border.id=r,this._parsed.border.match=ve[r]=s)}if(this._parsed.border.id&&(t.style.borderWidth=this._parsed.border.match[1],t.style.borderStyle="solid",t.style.borderColor=this._parsed.border.match[4]),t.style.outline!==this._parsed.outline.id)if(!t.style.outline)this._parsed.outline.id=null,this._parsed.outline.match=[];else{let s=ve[t.style.outline]||be.exec(t.style.outline)||be.exec(t.style.outline);s&&(this._parsed.outline.id=t.style.outline,this._parsed.outline.match=ve[t.style.outline]=s)}this._parsed.outline.id&&(t.style.outlineWidth=this._parsed.outline.match[1],t.style.outlineStyle="solid",t.style.outlineColor=this._parsed.outline.match[4]),this.props.style=t.style,t.backgroundColor&&!this.props.style.backgroundColor&&(this.props.style.backgroundColor=t.backgroundColor,i=!0),t.style.background&&!this.props.style.backgroundColor&&(this.props.style.backgroundColor=t.style.background,i=!0);for(let s of wn)if(this.props.style[s]!==t.style[s]){i=!0;break}t.style[":hover"]!==this.props.hoverStyles&&(this.props.hoverStyles=t.style[":hover"],this.hoverEvents||(this.hoverEvents=!0,this.addEventListener("pointerenter",this.addHover),this.addEventListener("pointerleave",this.removeHover)),i=!0),t.style[":active"]!==this.props.pressStyles&&(this.props.pressStyles=t.style[":active"],this.activeEvents||(this.activeEvents=!0,this.addEventListener("mousedown",this.addPress),this.addEventListener("mouseup",this.removePress)),i=!0)}t.href!==this.props.href&&(this.props.href=t.href,i=!0),t.hrefTarget!==this.props.hrefTarget&&(this.props.hrefTarget=t.hrefTarget,i=!0),t.title!==this.props.title&&(this.props.title=t.title,i=!0),t.className!==this.props.className&&(this.props.className=t.className,t.className&&!this.hoverEvents&&(this.hoverEvents=!0,this.addEventListener("pointerenter",this.addHover),this.addEventListener("pointerleave",this.removeHover)),t.className&&!this.activeEvents&&(this.activeEvents=!0,this.addEventListener("mousedown",this.addPress),this.addEventListener("mouseup",this.removePress)),i=!0),t.relativeSize!==this.props.relativeSize&&(this.props.relativeSize=t.relativeSize,i=!0),t.relativeStyle!==this.props.relativeStyle&&(this.props.relativeStyle=t.relativeStyle,i=!0),t.html!==this.props.html&&(this.props.html=t.html,i=!0),t.target&&(t.target.width!==this.display.width||t.target.height!==this.display.height||t.target.x!==this.points[1]||t.target.y!==this.points[2])&&(i=!0,this.points=Ht.DnaFactory.singleBox(t.target.width,t.target.height,t.target.x,t.target.y),this.display.points=Ht.DnaFactory.singleBox(t.target.width,t.target.height,t.target.x,t.target.y),this.display.width=t.target.width,this.display.height=t.target.height),i&&this.__revision++}};var Kt=require("@atlas-viewer/dna");var yt=class extends W{constructor(){super();a(this,"type","spacial-content");a(this,"id");a(this,"points");a(this,"color","#000");a(this,"backgroundColor");a(this,"hovering");a(this,"pressing");a(this,"text","");a(this,"display",{x:0,y:0,scale:1,width:100,height:100,points:(0,Kt.dna)(5)});a(this,"className");a(this,"html");a(this,"interactive",!1);a(this,"props",{font:"18px Arial, sans-serif",lineHeight:1,textAlign:"left",verticalAlign:"top",paddingX:0,paddingY:0,fitParent:!1,lineBreak:"auto",strokeText:!1,sizeToFill:!1,maxFontSizeToFill:void 0,allowNewLine:!0,justifyLines:!1,renderHDPI:!1,textDecoration:"none",interactive:!1,relativeSize:!1});this.id="",this.points=(0,Kt.dna)(5)}getAllPointsAt(t,i){return[[this,this.points,i]]}applyProps({id:t,target:i,text:r,color:s,backgroundColor:o,fontSize:h=18,interactive:l,fontFamily:c="Arial, sans-serif",...d}){d.font=`${h}px ${c}`,this.interactive=l||!1,typeof r<"u"&&(this.text=r||""),s&&(this.color=s),o&&(this.backgroundColor=o),t&&(this.id=t),i&&(this.points=Kt.DnaFactory.singleBox(i.width,i.height,i.x,i.y),this.display.points=this.points,this.display.width=i.width,this.display.height=i.height),this.props={...this.props,...d},this.__revision++}};var A=require("@atlas-viewer/dna");var Et=require("@atlas-viewer/dna");var F=Math.pow,we=Math.sqrt,qt=Math.sin,yi=Math.cos,te=Math.PI,Se=1.70158,xe=Se*1.525,bi=Se+1,vi=2*te/3,wi=2*te/4.5,Jt=function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},st={linear:n=>n,easeInQuad:function(n){return n*n},easeOutQuad:function(n){return 1-(1-n)*(1-n)},easeInOutQuad:function(n){return n<.5?2*n*n:1-F(-2*n+2,2)/2},easeInCubic:function(n){return n*n*n},easeOutCubic:function(n){return 1-F(1-n,3)},easeInOutCubic:function(n){return n<.5?4*n*n*n:1-F(-2*n+2,3)/2},easeInQuart:function(n){return n*n*n*n},easeOutQuart:function(n){return 1-F(1-n,4)},easeInOutQuart:function(n){return n<.5?8*n*n*n*n:1-F(-2*n+2,4)/2},easeInQuint:function(n){return n*n*n*n*n},easeOutQuint:function(n){return 1-F(1-n,5)},easeInOutQuint:function(n){return n<.5?16*n*n*n*n*n:1-F(-2*n+2,5)/2},easeInSine:function(n){return 1-yi(n*te/2)},easeOutSine:function(n){return qt(n*te/2)},easeInOutSine:function(n){return-(yi(te*n)-1)/2},easeInExpo:function(n){return n===0?0:F(2,10*n-10)},easeOutExpo:function(n){return n===1?1:1-F(2,-10*n)},easeInOutExpo:function(n){return n===0?0:n===1?1:n<.5?F(2,20*n-10)/2:(2-F(2,-20*n+10))/2},easeInCirc:function(n){return 1-we(1-F(n,2))},easeOutCirc:function(n){return we(1-F(n-1,2))},easeInOutCirc:function(n){return n<.5?(1-we(1-F(2*n,2)))/2:(we(1-F(-2*n+2,2))+1)/2},easeInBack:function(n){return bi*n*n*n-Se*n*n},easeOutBack:function(n){return 1+bi*F(n-1,3)+Se*F(n-1,2)},easeInOutBack:function(n){return n<.5?F(2*n,2)*((xe+1)*2*n-xe)/2:(F(2*n-2,2)*((xe+1)*(n*2-2)+xe)+2)/2},easeInElastic:function(n){return n===0?0:n===1?1:-F(2,10*n-10)*qt((n*10-10.75)*vi)},easeOutElastic:function(n){return n===0?0:n===1?1:F(2,-10*n)*qt((n*10-.75)*vi)+1},easeInOutElastic:function(n){return n===0?0:n===1?1:n<.5?-(F(2,20*n-10)*qt((20*n-11.125)*wi))/2:F(2,-20*n+10)*qt((20*n-11.125)*wi)/2+1},easeInBounce:function(n){return 1-Jt(1-n)},easeOutBounce:Jt,easeInOutBounce:function(n){return n<.5?(1-Jt(1-2*n))/2:(1+Jt(2*n-1))/2}};var Pe=class{constructor(e){a(this,"runtime");a(this,"pendingTransition");a(this,"lastZoomTo",null);a(this,"isConstraining",!1);a(this,"lastGoToRegion",null);this.runtime=e,this.pendingTransition={from:(0,Et.dna)(5),to:(0,Et.dna)(5),elapsed_time:0,done:!0,total_time:0,timingFunction:st.easeInOutQuad,constrain:!1}}hasPending(){return!this.pendingTransition.done}getPendingTransition(){return this.pendingTransition}getPendingFrom(){return this.pendingTransition.from}customTransition(e){e(this.pendingTransition)}stopTransition(){this.pendingTransition.from=(0,Et.dna)(this.runtime.target),this.pendingTransition.to=(0,Et.dna)(this.runtime.target),this.pendingTransition.done=!0,this.pendingTransition.elapsed_time=0,this.pendingTransition.total_time=0}runTransition(e,t){if(!this.pendingTransition.done){let i=this.pendingTransition,r=i.total_time===0?0:(i.elapsed_time+t)/i.total_time,s=i.total_time===0?1:r===0?0:i.timingFunction(r);e[1]=i.from[1]+(i.to[1]-i.from[1])*s,e[2]=i.from[2]+(i.to[2]-i.from[2])*s,e[3]=i.from[3]+(i.to[3]-i.from[3])*s,e[4]=i.from[4]+(i.to[4]-i.from[4])*s,this.pendingTransition.elapsed_time+=t,this.pendingTransition.elapsed_time>=this.pendingTransition.total_time&&(this.pendingTransition.done=!0,this.pendingTransition.callback?.(),this.pendingTransition.constrain&&this.constrainBounds({transition:{duration:this.pendingTransition.total_time===0?0:500,easing:st.easeOutExpo}}))}}resumeTransition(){this.lastZoomTo&&this.zoomTo(this.lastZoomTo.factor,this.lastZoomTo.options),this.isConstraining&&this.constrainBounds(),this.lastGoToRegion&&this.goToRegion(this.lastGoToRegion.target,this.lastGoToRegion.options)}zoomTo(e,t={}){let{origin:i,stream:r=!1,transition:s}=t;this.lastZoomTo={factor:e,options:t};let o=this.runtime.getZoomedPosition(e,{origin:i}),h=Math.abs(1-e);this.applyTransition(o,s,{duration:2e3*h,easing:st.easeOutExpo,constrain:!0,callback:()=>{this.lastZoomTo=null}},{stream:!1})}constrainBounds({transition:e,panPadding:t=0}={}){this.isConstraining=!0;let[i,r]=this.runtime.constrainBounds(this.runtime.target,{panPadding:t});i&&(this.applyTransition(r,e,{duration:500,easing:st.easeOutQuart,constrain:!1,callback:()=>{this.isConstraining=!1}}),this.runtime.updateNextFrame())}applyTransition(e,t,i,{stream:r}={}){this.pendingTransition.from=(0,Et.dna)(this.runtime.target),this.pendingTransition.to=e,r||(this.pendingTransition.elapsed_time=0),this.pendingTransition.done=!1,this.pendingTransition.total_time=typeof t?.duration<"u"?t.duration:typeof i?.duration<"u"?i.duration:1e3,this.pendingTransition.constrain=typeof t?.constrain<"u"?t.constrain:typeof i?.constrain<"u"?i.constrain:!1,this.pendingTransition.timingFunction=t?.easing||i?.easing||st.easeInOutSine}goToRegion(e,{transition:t}={}){this.lastGoToRegion={target:e,options:{transition:t}};let i=this.runtime.clampRegion(e);this.applyTransition(Et.DnaFactory.singleBox(i.width,i.height,i.x,i.y),t,{duration:1e3,easing:st.easeOutExpo,constrain:!0,callback:()=>{this.lastGoToRegion=null}}),this.runtime.updateNextFrame()}};var ms=Number.MIN_VALUE+1,dt=class{constructor(e,t,i,r=[],s){a(this,"id",at());a(this,"ready",!1);a(this,"renderer");a(this,"world");a(this,"target");a(this,"homePosition");a(this,"manualHomePosition");a(this,"manualFocalPosition");a(this,"focalPosition");a(this,"transitionManager");a(this,"aggregate");a(this,"transformBuffer",(0,A.dna)(500));a(this,"lastTarget",(0,A.dna)(5));a(this,"zoomBuffer",(0,A.dna)(5));a(this,"logNextRender",!1);a(this,"pendingUpdate",!0);a(this,"isCommitting",!1);a(this,"firstRender",!0);a(this,"lastTime");a(this,"stopId");a(this,"mode","explore");a(this,"controllers",[]);a(this,"controllersRunning",!1);a(this,"controllerStopFunctions",[]);a(this,"maxScaleFactor",1);a(this,"_viewerToWorld",{x:0,y:0});a(this,"_lastGoodScale",1);a(this,"hooks",{useFrame:[],useBeforeFrame:[],useAfterPaint:[],useAfterFrame:[]});a(this,"fpsLimit");a(this,"options");a(this,"hookOptions",{filters:{grayscale:0,contrast:0,brightness:0,saturate:0,sepia:0,invert:0,hueRotate:0,blur:0}});a(this,"_viewport",{x:0,y:0,width:0,height:0});a(this,"setViewport",e=>{let t=Math.round(typeof e.x>"u"?this.target[1]:e.x),i=Math.round(typeof e.y>"u"?this.target[2]:e.y);e.width?this.target[3]=t+e.width:this.target[3]=this.target[3]-this.target[1]+t,e.height?this.target[4]=i+e.height:this.target[4]=this.target[4]-this.target[2]+i,Math.abs(this.target[1]-t)>.01&&(this.target[1]=t),Math.abs(this.target[2]-i)>.01&&(this.target[2]=i),this.pendingUpdate=!0});a(this,"render",e=>{let t=e-this.lastTime;if(this.isCommitting||this.fpsLimit&&t<1e3/this.fpsLimit){this.stopId=window.requestAnimationFrame(this.render);return}this.lastTime=e,this.world.flushSubscriptions(),this.stopId=window.requestAnimationFrame(this.render),this.hook("useFrame",t);let i=this.pendingUpdate,r=this.renderer.pendingUpdate();if(this.transitionManager.hasPending()&&(this.transitionManager.runTransition(this.target,t),this.pendingUpdate=!0,this.updateControllerPosition()),!this.firstRender&&!i&&!r&&this.target[0]===this.lastTarget[0]&&this.target[1]===this.lastTarget[1]&&this.target[2]===this.lastTarget[2]&&this.target[3]===this.lastTarget[3]&&this.target[4]===this.lastTarget[4])return;this.hook("useBeforeFrame",t),this.renderer.beforeFrame(this.world,t,this.target,this.hookOptions);let s=this.getScaleFactor(),o=this.renderer.getPointsAt(this.world,this.target,this.aggregate,s),h=o.length;for(let d=0;d<h;d++){let u=o[d][0],m=o[d][1],y=o[d][2],v=y?(0,A.transform)(m,y,this.transformBuffer):m;this.renderer.prepareLayer(u,u.__parent&&y?(0,A.transform)(u.__parent.crop||u.__parent.points,y):v);let S=v.length/5;for(let P=0;P<S;P++){let g=P*5;v[g]!==0&&(this.renderer.paint(u,P,v[g+1],v[g+2],v[g+3]-v[g+1],v[g+4]-v[g+2]),this.hook("useAfterPaint",u))}this.renderer.finishLayer(u,m)}this.renderer.afterFrame(this.world,t,this.target,this.hookOptions),this.hook("useAfterFrame",t),this.lastTarget[0]=this.target[0],this.lastTarget[1]=this.target[1],this.lastTarget[2]=this.target[2],this.lastTarget[3]=this.target[3],this.lastTarget[4]=this.target[4],this.firstRender=!1,this.pendingUpdate=!1,this.logNextRender=!1,this.renderer.isReady()&&(this.ready=!0,this.world.trigger("ready")),this.world.flushSubscriptions();let l=this.world.getScheduledUpdates(this.target,s),c=l.length;if(c>0)for(let d=0;d<c;d++){let u=l[c-d-1]();u?u.then(()=>{this.pendingUpdate=!0}):this.pendingUpdate=!0}});this.renderer=e,this.world=t,this.options={maxOverZoom:1,maxUnderZoom:1,visibilityRatio:1.5,...s||{}},this.target=A.DnaFactory.projection(i),this.manualHomePosition=!1,this.pendingUpdate=!0,this.homePosition=A.DnaFactory.projection(this.world),this.manualFocalPosition=!1,this.focalPosition=this.target,this.updateFocalPosition(),this.transitionManager=new Pe(this),this.aggregate=(0,A.scale)(1),this.world.addLayoutSubscriber(o=>{o==="repaint"&&(this.pendingUpdate=!0),o==="recalculate-world-size"&&(this.manualHomePosition||(this.setHomePosition(),this.goHome()),this.updateFocalPosition())}),this.lastTime=performance.now(),this.controllers=r,this.render(this.lastTime),this.startControllers()}get x(){return this.target[1]}set x(e){this.target[1]=e}get y(){return this.target[2]}set y(e){this.target[2]=e}get x2(){return this.target[3]}set x2(e){this.target[3]=e}get y2(){return this.target[4]}set y2(e){this.target[4]=e}get width(){return this.target[3]-this.target[1]}set width(e){this.target[3]=this.target[1]+e}get height(){return this.target[4]-this.target[2]}set height(e){this.target[4]=this.target[2]=e}setHomePosition(e){this.homePosition.set(A.DnaFactory.projection(e||this.world)),this.pendingUpdate=!0}startControllers(){if(!this.controllersRunning){for(let e of this.controllers)this.controllerStopFunctions.push(e.start(this));this.controllersRunning=!0}}stopControllers(){if(this.controllersRunning){for(let e of this.controllerStopFunctions)e();this.controllersRunning=!1,this.controllerStopFunctions=[]}}updateControllerPosition(){for(let e of this.controllers)e.updatePosition(this.x,this.y,this.width,this.height)}triggerResize(){this.renderer.triggerResize&&this.renderer.triggerResize(),this.pendingUpdate=!0}addController(e){this.controllers.push(e),this.controllersRunning&&e.start(this),this.pendingUpdate=!0}cover(){return this.goHome({cover:!0})}getRendererScreenPosition(){return this.renderer.getRendererScreenPosition()}updateRendererScreenPosition(){this.pendingUpdate=!0,this.renderer.resize()}setOptions(e){this.options={...this.options,...e}}goHome(e={}){if(this.world.width<=0||this.world.height<=0)return;let t=this.getScaleFactor(),i=e.position?{x:e.position[1],y:e.position[2],width:e.position[3]-e.position[1],height:e.position[4]-e.position[2]}:{x:this.homePosition[1],y:this.homePosition[2],width:this.homePosition[3]-this.homePosition[1],height:this.homePosition[4]-this.homePosition[2]},r=this.width*t,s=this.height*t,o=i.width/r,h=i.height/s,l=r/s;if(e.cover?o>h:o<h){let c=l*i.height,d=(c-i.width)/2;this.target[1]=Math.round(-d+i.x),this.target[2]=Math.round(i.y),this.target[3]=Math.round(c-d+i.x),this.target[4]=Math.round(i.height+i.y)}else{let c=i.width/l,d=(c-i.height)/2;this.target[1]=Math.round(i.x),this.target[2]=Math.round(i.y-d),this.target[3]=Math.round(i.x+i.width),this.target[4]=Math.round(i.y+c-d)}this.constrainBounds(this.target),this.updateControllerPosition()}resize(e,t,i,r){this.transitionManager.hasPending()&&this.transitionManager.stopTransition(),this.updateFocalPosition(e-t,i-r);let s=t/e,o=r/i;this.target[3]=this.target[1]+(this.target[3]-this.target[1])*s,this.target[4]=this.target[2]+(this.target[4]-this.target[2])*o,this.goHome({position:this.focalPosition}),this.renderer.resize(t,r),this.pendingUpdate=!0,this.transitionManager.resumeTransition()}updateFocalPosition(e,t){if(!this.manualFocalPosition){let i=this.width,r=this.height,s=Math.min(i,r),o=0,h=0,l=this.x+o,c=this.y+h;if(i<r){let d=this.height-this.width;this.focalPosition=A.DnaFactory.projection({x:l,y:c+d/2,width:s-o*2,height:s-h*2}),this.pendingUpdate=!0}else{let d=this.width-this.height;this.focalPosition=A.DnaFactory.projection({x:l+d/2,y:c,width:s-o*2,height:s-h*2}),this.pendingUpdate=!0}}}getViewport(){return this._viewport.x=this.target[1],this._viewport.y=this.target[2],this._viewport.width=this.target[3]-this.target[1],this._viewport.height=this.target[4]-this.target[2],this._viewport}constrainBounds(e,{panPadding:t=0,ref:i=!1}={}){let{minX:r,maxX:s,minY:o,maxY:h}=this.getBounds({target:e,padding:t}),l=!1,c=i?e:(0,A.dna)(e),d=Math.round(e[3]-e[1]),u=Math.round(e[4]-e[2]);return r>e[1]&&(l=!0,c[1]=r,c[3]=r+d),o>e[2]&&(l=!0,c[2]=o,c[4]=o+u),s<e[1]&&(l=!0,c[1]=s,c[3]=s+d),h<e[2]&&(l=!0,c[2]=h,c[4]=h+u),[l,c]}getBounds(e){let t=e.target||this.target,i=e.padding,r=this.options.visibilityRatio,s=Math.abs(1-r);if(this.world.hasActiveZone()){let f=this.world.getActiveZone();if(f){let C=t[3]-t[1]<f.points[3]-f.points[1],R=t[4]-t[2]<f.points[4]-f.points[2];return{minX:C?f.points[1]-i:f.points[1]+(f.points[3]-f.points[1])/2-(t[3]-t[1])/2,maxX:R?f.points[2]-i:f.points[2]+(f.points[4]-f.points[2])/2-(t[4]-t[2])/2,minY:C?f.points[3]+i:f.points[1]+(f.points[3]-f.points[1])/2-(t[3]-t[1])/2,maxY:R?f.points[4]+i:f.points[2]+(f.points[4]-f.points[2])/2-(t[4]-t[2])/2}}}let o=t[3]-t[1],h=this.world.width,l=-o*s,c=h-o-l,d=t[4]-t[2],u=this.world.height,m=-d*s,y=u-d-m,v=Math.round(Math.max(l,c)),S=Math.round(Math.min(l,c)),P=Math.round(Math.max(m,y)),g=Math.round(Math.min(m,y));return{minX:S,maxX:v,minY:g,maxY:P}}getScaleFactor(e=!1){let t=this.renderer.getScale(this.target[3]-this.target[1],this.target[4]-this.target[2],e);return t===0?this._lastGoodScale:(this._lastGoodScale=t,t)}getZoomedPosition(e,{origin:t,fromPos:i}){let r=i?{width:i[3]-i[1],height:i[4]-i[2]}:void 0,s=r?this.renderer.getScale(r.width,r.height):this.getScaleFactor(),o=r?r.width:this.width,h=r?r.height:this.height,l=this.getRendererScreenPosition()?.width,c=this.world.width,d=l?l/c:1,u=this.options.maxUnderZoom,m=Math.max(d||1,this.options.maxOverZoom),y=1/e,v=s*y;if(y<1){let g=o*s,f=h*s,C=this.world.width/g,R=this.world.height/f;if(C>R){let w=this.world.width*v,I=~~(o*s)*u;w<I&&(e=this.world.width*s/(o*s*u))}else{let w=this.world.height*v,I=~~(h*s)*u;w<I&&(e=this.world.height*s/(h*s*u))}}else v>m&&(e=s/m);let P=(0,A.transform)(this.target,(0,A.scaleAtOrigin)(e,t?t.x:this.target[1]+(this.target[3]-this.target[1])/2,t?t.y:this.target[2]+(this.target[4]-this.target[2])/2),this.zoomBuffer);return this.constrainBounds(P,{ref:!0,panPadding:100}),P}clampRegion({x:e,y:t,width:i,height:r,padding:s=0}){let o=this.width,h=this.height,l=i/o<r/h,c=e-s,d=t-s,u=i+s*2,m=r+s*2;if(l){let v=m/h*o;return{x:c-(v-u)/2,y:d,width:v,height:m}}let y=u/o*h;return{x:c,y:d-(y-m)/2,width:u,height:y}}viewerToWorld(e,t){let i=this.getScaleFactor();return this._viewerToWorld.x=this.target[1]+e/i,this._viewerToWorld.y=this.target[2]+t/i,this._viewerToWorld}worldToViewer(e,t,i,r){let s=A.DnaFactory.singleBox(i,r,e,t);return(0,A.mutate)(s,(0,A.compose)((0,A.scale)(this.getScaleFactor()),(0,A.translate)(-this.target[1],-this.target[2]))),{x:s[1],y:s[2],width:s[3]-s[1],height:s[4]-s[2],strand:s}}setScale(e,t){(0,A.mutate)(this.target,(0,A.scaleAtOrigin)(e,t?t.x:this.target[1]+(this.target[3]-this.target[1])/2,t?t.y:this.target[2]+(this.target[4]-this.target[2])/2)),this.pendingUpdate=!0}syncTo(e){let t=this.target;return this.target=e.target,this.pendingUpdate=!0,()=>{this.target=t}}stop(){return typeof this.stopId<"u"&&(window.cancelAnimationFrame(this.stopId),this.stopId=void 0),()=>{this.render(performance.now())}}reset(){this.renderer.reset()}selectZone(e){this.world.selectZone(e),this.pendingUpdate=!0}deselectZone(){this.world.deselectZone(),this.pendingUpdate=!0}hook(e,t){let i=this.hooks[e].length;if(i!==0)for(let r=0;r<i;r++)this.hooks[e][r](t)}registerHook(e,t){return this.hooks[e].push(t),()=>{this.hooks[e]=this.hooks[e].filter(i=>i!==t)}}updateNextFrame(){this.pendingUpdate=!0}};var jt=require("@atlas-viewer/dna");var Ee=/([0-9]+(px|em)\s+)+(solid)\s+(.*)/g,Ce={},xn=["backgroundColor","opacity","boxShadow","borderColor","borderWidth","borderStyle","outlineColor","outlineWidth","outlineOffset","outlineStyle"],Mt=class extends W{constructor(){super();a(this,"id");a(this,"type","spacial-content");a(this,"isShape",!0);a(this,"points");a(this,"hoverEvents",!1);a(this,"activeEvents",!1);a(this,"display",{x:0,y:0,scale:1,width:-1,height:-1,points:(0,jt.dna)(5)});a(this,"boundingBox",null);a(this,"_parsed",{border:{id:null,match:[]},outline:{id:null,match:[]}});a(this,"hovering");a(this,"pressing");a(this,"props",{});a(this,"shape",{type:"none"});a(this,"addHover",()=>{this.hovering=!0,this.__revision++});a(this,"removeHover",()=>{this.hovering=!1,this.pressing=!1,this.__revision++});a(this,"addPress",()=>{this.pressing=!0,this.__revision++});a(this,"removePress",()=>{this.pressing=!1,this.__revision++});this.id=at(12),this.points=(0,jt.dna)(5),this.shape={type:"none"}}updateBoundingBox(){if(this.shape.type==="none")return;let t=this.shape.points;if(this.shape.points.length>2){let i=Math.min(...t.map(h=>h[0])),r=Math.min(...t.map(h=>h[1])),s=Math.max(0,...t.map(h=>h[0])),o=Math.max(0,...t.map(h=>h[1]));this.boundingBox={x:i,y:r,width:s-i,height:o-r};return}this.boundingBox=null}intersects(t){if(!t||this.shape.type==="none")return!1;let[i,r]=t,s=this.shape.points,o=this.boundingBox;if(o||(this.updateBoundingBox(),o=this.boundingBox),!o||i<o.x||i>o.x+o.width||r<o.y||r>o.height+o.y)return!1;let h=!1;for(let l=0,c=s.length-1;l<s.length;c=l++)s[l][1]>r!=s[c][1]>r&&i<(s[c][0]-s[l][0])*(r-s[l][1])/(s[c][1]-s[l][1])+s[l][0]&&(h=!h);return h}getAllPointsAt(t,i){return t[3]-t[1]===1&&t[4]-t[2]===1?this.intersects([t[1],t[2]])?[[this,this.points,i]]:[]:[[this,this.points,i]]}applyProps(t={}){let i=!1;if(t.points)if(this.shape.type!=="polygon"||this.shape.points.length!==t.points.length)this.shape={type:"polygon",points:t.points,open:t.open},this.updateBoundingBox();else{let r=!1,s=t.points.length;for(let o=0;o<s;o++)if(t.points[o][0]!==this.shape.points[o][0]||t.points[o][1]!==this.shape.points[o][1]){r=!0;break}r&&(this.shape={type:"polygon",points:t.points,open:t.open},this.updateBoundingBox())}if(t.interactive!==this.props.interactive&&(i=!0,this.props.interactive=t.interactive),(t.open||t.open===!1)&&(i=!0,this.shape.open=t.open),t.style){let r=t.border||t.style.border;if(r!==this._parsed.border.id)if(!r)this._parsed.border.id=null,this._parsed.border.match=[];else{let s=Ce[r]||Ee.exec(r)||Ee.exec(r);s&&(this._parsed.border.id=r,this._parsed.border.match=Ce[r]=s)}if(this._parsed.border.id&&(t.style.borderWidth=this._parsed.border.match[1],t.style.borderStyle="solid",t.style.borderColor=this._parsed.border.match[4]),t.style.outline!==this._parsed.outline.id)if(!t.style.outline)this._parsed.outline.id=null,this._parsed.outline.match=[];else{let s=Ce[t.style.outline]||Ee.exec(t.style.outline)||Ee.exec(t.style.outline);s&&(this._parsed.outline.id=t.style.outline,this._parsed.outline.match=Ce[t.style.outline]=s)}this._parsed.outline.id&&(t.style.outlineWidth=this._parsed.outline.match[1],t.style.outlineStyle="solid",t.style.outlineColor=this._parsed.outline.match[4]),this.props.style=t.style,t.backgroundColor&&!this.props.style.backgroundColor&&(this.props.style.backgroundColor=t.backgroundColor,i=!0),t.style.background&&!this.props.style.backgroundColor&&(this.props.style.backgroundColor=t.style.background,i=!0);for(let s of xn)if(this.props.style[s]!==t.style[s]){i=!0;break}t.style[":hover"]!==this.props.hoverStyles&&(this.props.hoverStyles=t.style[":hover"],this.hoverEvents||(this.hoverEvents=!0,this.addEventListener("pointerenter",this.addHover),this.addEventListener("pointerleave",this.removeHover)),i=!0),t.style[":active"]!==this.props.pressStyles&&(this.props.pressStyles=t.style[":active"],this.activeEvents||(this.activeEvents=!0,this.addEventListener("mousedown",this.addPress),this.addEventListener("mouseup",this.removePress)),i=!0)}t.href!==this.props.href&&(this.props.href=t.href,i=!0),t.hrefTarget!==this.props.hrefTarget&&(this.props.hrefTarget=t.hrefTarget,i=!0),t.title!==this.props.title&&(this.props.title=t.title,i=!0),t.className!==this.props.className&&(this.props.className=t.className,t.className&&!this.hoverEvents&&(this.hoverEvents=!0,this.addEventListener("pointerenter",this.addHover),this.addEventListener("pointerleave",this.removeHover)),t.className&&!this.activeEvents&&(this.activeEvents=!0,this.addEventListener("mousedown",this.addPress),this.addEventListener("mouseup",this.removePress)),i=!0),t.relativeSize!==this.props.relativeSize&&(this.props.relativeSize=t.relativeSize,i=!0),t.relativeStyle!==this.props.relativeStyle&&(this.props.relativeStyle=t.relativeStyle,i=!0),t.html!==this.props.html&&(this.props.html=t.html,i=!0),t.target&&(t.target.width!==this.display.width||t.target.height!==this.display.height||t.target.x!==this.points[1]||t.target.y!==this.points[2])&&(i=!0,this.points=jt.DnaFactory.singleBox(t.target.width,t.target.height,t.target.x,t.target.y),this.display.points=jt.DnaFactory.singleBox(t.target.width,t.target.height,t.target.x,t.target.y),this.display.width=t.target.width,this.display.height=t.target.height),i&&this.__revision++}};var Pi=q(require("lru-cache"),1);var xi=/(-?[0-9]+(px|em)\s+|0\s+)(-?[0-9]+(px|em)\s+|0\s+)(-?[0-9]+(px|em)\s+|0\s+)?(-?[0-9]+(px|em)\s+|0\s+)?(.*)/g,Si={},Sn=typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes("firefox"),Re={};var ee=class{constructor(e,t){a(this,"canvas");a(this,"ctx");a(this,"options");a(this,"imagesPending",0);a(this,"imagesLoaded",0);a(this,"imageIdsLoaded",[]);a(this,"frameIsRendering",!1);a(this,"pendingDrawCall",!1);a(this,"firstMeaningfulPaint",!1);a(this,"parallelTasks",8);a(this,"frameTasks",0);a(this,"loadingQueueOrdered",!0);a(this,"loadingQueue",[]);a(this,"currentTask",Promise.resolve());a(this,"tasksRunning",0);a(this,"stats");a(this,"averageJobTime",64);a(this,"lastKnownScale",1);a(this,"visible",[]);a(this,"previousVisible",[]);a(this,"rendererPosition");a(this,"dpi");a(this,"drawCalls",[]);a(this,"lastPaintedObject");a(this,"hostCache");a(this,"invalidated",[]);a(this,"_worker",()=>{if(this.loadingQueue.length){let e=this.loadingQueue.pop();e&&(this.tasksRunning++,this.frameTasks++,this.currentTask=e.task().then(()=>{this.tasksRunning--}).catch(()=>{this.tasksRunning--}))}});a(this,"_scheduled",0);a(this,"_doWork",()=>{this.loadingQueue.length===0&&this.tasksRunning===0&&this._scheduled&&(clearInterval(this._scheduled),this._scheduled=0);let e=this.parallelTasks||1;!this.firstMeaningfulPaint&&this.loadingQueue.length&&(e=this.loadingQueue.length);for(let t=0;t<=e;t++)this._worker()});this.canvas=e,this.rendererPosition=e.getBoundingClientRect(),this.ctx=e.getContext("2d",{alpha:!0}),this.ctx.imageSmoothingEnabled=!0,this.options=t||{},this.canvas.style.transition="opacity .3s",this.dpi=t?.dpi||1,this.hostCache=t?.lruCache?new Pi.default({maxSize:1024*512*512,dispose:(i,r,s)=>{this.invalidated.push(r),i.width=0,i.height=0},sizeCalculation:(i,r)=>i.width*i.height}):{store:{},get(i){return this.store[i]},set(i,r){this.store[i]=r}}}getCanvasDims(){return{width:this.canvas.width/this.dpi,height:this.canvas.height/this.dpi}}resize(){this.rendererPosition=this.canvas.getBoundingClientRect()}isReady(){return this.firstMeaningfulPaint}afterFrame(e){if(this.clearTransform(),this.lastPaintedObject=void 0,this.frameIsRendering=!1,this.imagesPending=Math.max(0,this.imagesPending-this.imagesLoaded),this.imagesLoaded=0,this.loadingQueueOrdered||(this.loadingQueue=this.loadingQueue.sort((t,i)=>t.network&&t.scale===i.scale?i.distance-t.distance:t.scale<i.scale?-1:1),this.loadingQueueOrdered=!0),this.previousVisible=this.visible,this.pendingDrawCall=!!this.drawCalls.length,this.pendingDrawCall)for(let t=0;t<this.drawCalls.length;t++){let i=this.drawCalls.shift();i&&i()}this.doOffscreenWork(),this.options.debug&&this.stats&&this.stats.end()}doOffscreenWork(){this.frameTasks=0,this.loadingQueue.length&&(this._worker(),this.loadingQueue.length&&(this._scheduled||(this._scheduled=setInterval(this._doWork,0))))}getScale(e,t,i){if(Number.isNaN(e)||Number.isNaN(t))return this.lastKnownScale;let r=this.getCanvasDims(),s=r.width/e,o=r.height/t,h=(s<o?o:s)*(i&&this.dpi||1);return Number.isNaN(h)||(this.lastKnownScale=h),this.lastKnownScale}beforeFrame(e,t,i,r){this.options.debug&&this.stats&&this.stats.begin(),this.frameIsRendering=!0,this.visible=[],this.options.beforeFrame&&this.options.beforeFrame(t);let s=this.getCanvasDims();if(this.ctx.globalAlpha=1,this.ctx.fillStyle=this.canvas.dataset.background??"rgb(0, 0, 0)",this.ctx.fillRect(0,0,s.width,s.height),r.enableFilters&&(r.filters.brightness||r.filters.contrast||r.filters.grayscale||r.filters.invert||r.filters.sepia||r.filters.saturate||r.filters.hueRotate||r.filters.blur)){let o="";r.filters.brightness&&(o+=`brightness(${~~(100+r.filters.brightness*100)}%) `),r.filters.contrast&&(o+=`contrast(${~~(100+r.filters.contrast*100)}%) `),r.filters.grayscale&&(o+=`grayscale(${~~(r.filters.grayscale*100)}%) `),r.filters.invert&&(o+=`invert(${~~(r.filters.invert*100)}%) `),r.filters.sepia&&(o+=`sepia(${~~(r.filters.sepia*100)}%) `),r.filters.saturate&&(o+=`saturate(${~~(100+r.filters.saturate*100)}%) `),r.filters.hueRotate&&(o+=`hue-rotate(${r.filters.hueRotate}deg) `),r.filters.blur&&(o+=`blur(${r.filters.blur}px) `),this.ctx.filter=o}else this.ctx.filter="none"}applyTransform(e,t,i,r,s){let o=e.__owner.value;if(o&&o.rotation){this.ctx.save();let h=t+r/2,l=i+s/2;this.ctx.translate(h,l),this.ctx.rotate(o.rotation*Math.PI/180),this.ctx.translate(-h,-l),this.lastPaintedObject=o}}clearTransform(){this.lastPaintedObject&&(this.lastPaintedObject.rotation&&this.ctx.restore(),this.lastPaintedObject=void 0)}paint(e,t,i,r,s,o){let h=this.ctx.globalAlpha;if(e instanceof H||e instanceof tt){if(e.display.rotation){this.ctx.save();let d=i+s/2,u=r+o/2;e.crop&&(d-=e.crop[t*5+1],u-=e.crop[t*5+2]),this.ctx.translate(d,u),this.ctx.rotate(e.display.rotation*Math.PI/180),this.ctx.translate(-d,-u)}if(this.visible.push(e),typeof e.style&&e.style.opacity!=="undefined"){if(!e.style.opacity)return;this.ctx.globalAlpha=e.style.opacity}try{let d=e.__host.canvas,u=this.getCanvasDims();if((d.indices.indexOf(t)===-1||this.invalidated.indexOf(d.canvases[t])!==-1)&&this.schedulePaintToCanvas(d,e,t,Ot({x:i+s/2,y:r+s/2},{x:u.width/2,y:u.height/2})),!this.firstMeaningfulPaint)return;let m=this.hostCache.get(d.canvases[t]);if(m)if(e.crop&&e.cropData){if(e.crop[t*5]){let y=[e.crop[t*5+1]/e.display.scale-e.display.points[t*5+1],e.crop[t*5+2]/e.display.scale-e.display.points[t*5+2],1+(e.crop[t*5+3]-e.crop[t*5+1])/e.display.scale,1+(e.crop[t*5+4]-e.crop[t*5+2])/e.display.scale];y[0]+=e.cropData.x/e.display.scale,y[1]+=e.cropData.y/e.display.scale;let v=e.x*this.lastKnownScale,S=e.y*this.lastKnownScale,P=[i+v,r+S,s,o];P[0]+=v,P[1]+=S,this.ctx.drawImage(m,y[0],y[1],y[2],y[3],P[0],P[1],P[2]+1,P[3]+1)}}else Sn?this.ctx.drawImage(m,0,0,e.display.points[t*5+3]-e.display.points[t*5+1],e.display.points[t*5+4]-e.display.points[t*5+2],i,r,s+1,o+1):this.ctx.drawImage(m,0,0,e.display.points[t*5+3]-e.display.points[t*5+1],e.display.points[t*5+4]-e.display.points[t*5+2],i,r,s+Number.MIN_VALUE+.5,o+Number.MIN_VALUE+.5)}catch{}e.display.rotation&&this.ctx.restore()}let l=e instanceof rt&&this.options.box,c=e instanceof Mt&&this.options.polygon;if((l||c)&&!e.props.className&&!e.props.html&&!e.props.href){if(this.visible.push(e),e.props.style){let d=Object.assign({},e.props.style||{},e.hovering?e.props.hoverStyles:{},e.pressing?e.props.pressStyles:{}),u=e.props.relativeStyle?1:s/e.width;typeof d.opacity<"u"&&(this.ctx.globalAlpha=d.opacity);let m=0;typeof d.borderWidth<"u"&&(m=parseInt(d.borderWidth,10)*u);let y=0;typeof d.outlineWidth<"u"&&(y=parseInt(d.outlineWidth,10)*u);let v=0;if(typeof d.outlineOffset<"u"&&(v=parseInt(d.outlineOffset,10)*u),d.borderColor&&(this.ctx.strokeStyle=d.borderColor),d.boxShadow){let S=d.boxShadow.split(/,(?![^(]*\))/);for(let P of S){let g=Si[P]||xi.exec(P)||xi.exec(P);Si[P]=g,g&&(this.ctx.save(),this.ctx.shadowOffsetX=parseInt(g[1])*this.dpi*u,this.ctx.shadowOffsetY=parseInt(g[3])*this.dpi*u,this.ctx.shadowBlur=parseInt(g[5])*this.dpi*u,this.ctx.shadowColor=g[9],this.ctx.fillStyle="rgba(0,0,0,1)",this.ctx.fillRect(i+m,r+m,s,o),this.ctx.restore())}}if(this.ctx.fillStyle=d.backgroundColor||"transparent",this.ctx.lineWidth=m,c){let S=e.shape,P=S.points||[],g=P.length;this.ctx.beginPath();for(let f=0;f<g;f++)this.ctx.lineTo(i+P[f][0]*this.lastKnownScale,r+P[f][1]*this.lastKnownScale);S.open||this.ctx.closePath(),m&&this.ctx.stroke(),S.open||this.ctx.fill()}else m&&this.ctx.strokeRect(i+m/2,r+m/2,s+m,o+m),this.ctx.fillRect(i+m,r+m,s,o);y&&(d.outlineColor&&(this.ctx.strokeStyle=d.outlineColor),this.ctx.lineWidth=y,this.ctx.strokeRect(i-y/2-v,r-y/2-v,s+m*2+y+v*2,o+m*2+y+v*2))}this.ctx.globalAlpha=h}}loadImage(e,t,i,r=!1){if(Re[e]&&Re[e].naturalWidth>0){t(Re[e]);return}try{let s=!1;r||setTimeout(()=>{s||this.loadImage(e,t,i,!0)},3e3);let o=document.createElement("img");o.decoding="auto",o.onload=function(){s=!0,t(o),Re[e]=o,o.onload=null},this.options.crossOrigin&&(o.crossOrigin="anonymous"),o.src=e,o.complete&&o.onload({}),o.width}catch(s){console.log("image error",s),i(s)}}schedulePaintToCanvas(e,t,i,r){this.imagesPending++,e.indices.push(i);let s=`${t.id}--${t.display.scale}-${i}`,o=this.invalidated.indexOf(s);o!==-1&&this.invalidated.splice(o,1),e.canvases[i]=s,t.__host.canvas.loading=!0,this.loadingQueueOrdered=!1,this.loadingQueue.push({id:s,scale:t.display.scale,network:!0,distance:r,task:()=>new Promise(h=>{if(this.visible.indexOf(t)===-1){this.imagesPending--,e.indices.splice(e.indices.indexOf(i),1),h();return}let l=t.getImageUrl(i);this.loadImage(l,c=>{this.loadingQueue.push({id:s,scale:t.display.scale,distance:r,task:()=>new Promise(d=>{this.imageIdsLoaded.includes(s)||(this.imagesLoaded++,this.imageIdsLoaded.push(s)),e.loaded.push(i),e.loaded.length===e.indices.length&&(e.loading=!1);let u=t.display.points.slice(i*5,i*5+5),m=document.createElement("canvas"),y=m.getContext("2d");m.width=u[3]-u[1],m.height=u[4]-u[2],this.hostCache.set(e.canvases[i],m),this.drawCalls.push(()=>{y.drawImage(c,0,0,u[3]-u[1],u[4]-u[2]),d()})})}),h()},c=>{this.imagesPending--,e.indices.splice(e.indices.indexOf(i),1),h()})})})}afterPaintLayer(e,t){}prepareLayer(e,t){if(e.__owner.value)if(e.cropData){let i=this.lastKnownScale*(1/e.display.scale);this.applyTransform(e,t[1],t[2],t[3]-t[1],t[4]-t[2])}else this.applyTransform(e,t[1],t[2],t[3]-t[1],t[4]-t[2]);(!e.__host||!e.__host.canvas)&&(e instanceof H||e instanceof tt)&&this.createImageHost(e)}finishLayer(){this.lastPaintedObject&&this.clearTransform()}createImageHost(e){e.__host=e.__host?e.__host:{},e.__host.canvas={canvas:void 0,canvases:[],indices:[],loaded:[],loading:!1}}getPointsAt(e,t,i,r){return e.getPointsAt(t,i,r)}getViewportBounds(e,t,i){let r=e.getActiveZone();if(r){let s=t[3]-t[1]<r.points[3]-r.points[1],o=t[4]-t[2]<r.points[4]-r.points[2];return{x1:s?r.points[1]-i:r.points[1]+(r.points[3]-r.points[1])/2-(t[3]-t[1])/2,y1:o?r.points[2]-i:r.points[2]+(r.points[4]-r.points[2])/2-(t[4]-t[2])/2,x2:s?r.points[3]+i:r.points[1]+(r.points[3]-r.points[1])/2-(t[3]-t[1])/2,y2:o?r.points[4]+i:r.points[2]+(r.points[4]-r.points[2])/2-(t[4]-t[2])/2}}return null}pendingUpdate(){let e=!this.pendingDrawCall&&this.drawCalls.length===0&&this.imagesPending===0&&this.loadingQueue.length===0&&this.tasksRunning===0;return!e&&this.visible.length===0&&setTimeout(()=>{this.canvas.style.opacity="1",this.firstMeaningfulPaint=!0},500),!this.firstMeaningfulPaint&&e&&this.visible.length?(this.canvas.style.opacity="1",this.firstMeaningfulPaint=e,!0):this.options.debug?!0:!e}getRendererScreenPosition(){return this.rendererPosition}reset(){this.loadingQueue=[],this.drawCalls=[]}};var At=class{constructor(e){a(this,"renderers",[]);a(this,"length");for(let t of e)t&&this.renderers.push(t);this.length=this.renderers.length}afterFrame(e,t,i,r){for(let s=0;s<this.length;s++)this.renderers[s].afterFrame(e,t,i,r)}afterPaintLayer(e,t){for(let i=0;i<this.length;i++)this.renderers[i].afterPaintLayer(e,t)}beforeFrame(e,t,i,r){for(let s=0;s<this.length;s++)this.renderers[s].beforeFrame(e,t,i,r)}triggerResize(){for(let e=0;e<this.length;e++){let t=this.renderers[e];t.triggerResize&&t.triggerResize()}}getPointsAt(e,t,i,r){return this.renderers[0].getPointsAt(e,t,i,r)}getScale(e,t){return this.renderers[0].getScale(e,t)}getViewportBounds(e,t,i){return this.renderers[0].getViewportBounds(e,t,i)}getRendererScreenPosition(){return this.renderers[0].getRendererScreenPosition()}isReady(){for(let e=0;e<this.length;e++)if(!this.renderers[e].isReady())return!1;return!0}paint(e,t,i,r,s,o){for(let h=0;h<this.length;h++)this.renderers[h].paint(e,t,i,r,s,o)}pendingUpdate(){for(let e=0;e<this.length;e++)if(this.renderers[e].pendingUpdate())return!0;return!1}prepareLayer(e,t){for(let i=0;i<this.length;i++)this.renderers[i].prepareLayer(e,t)}finishLayer(e,t){for(let i=0;i<this.length;i++)this.renderers[i].finishLayer(e,t)}resize(e,t){for(let i=0;i<this.length;i++)this.renderers[i].resize(e,t)}reset(){for(let e=0;e<this.length;e++)this.renderers[e].reset()}};var Te=require("@atlas-viewer/dna");var ie=class{constructor(e){a(this,"canvas");a(this,"context");a(this,"heightRatio",1);a(this,"widthRatio",1);a(this,"target",new Float32Array(5));a(this,"initialWidth");a(this,"initialHeight");a(this,"bounds");a(this,"aggregate");a(this,"delta",0);a(this,"renderNextFrame",!0);this.canvas=e,this.initialWidth=e.width,this.initialHeight=e.height,this.context=e.getContext("2d"),this.context.globalAlpha=.5,this.aggregate=(0,Te.scale)(1)}isReady(){return!0}resize(){this.initialWidth=this.canvas.width,this.initialHeight=this.canvas.height,this.renderNextFrame=!0}afterFrame(e,t,i){if(this.renderNextFrame){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);let r=this.initialWidth/e.width,s=this.initialHeight/e.height,o=this.widthRatio>this.heightRatio?r:s;if(this.target=i,this.bounds){let h=e.getPointsAt(this.bounds,this.aggregate,o);for(let[l,c]of h)if(l instanceof H&&l.__host.canvas){let d=c.length/5;for(let u=0;u<d;u++)if(l.__host.canvas.canvases[u]){let y={x1:c[u+1]*o,y1:c[u+2]*o,width:(c[u+3]-c[u+1])*o,height:(c[u+4]-c[u+2])*o}}}}e.getPoints().forEach((h,l,c)=>{if(l%5===0&&h){let d={x1:c[l+1]*o,y1:c[l+2]*o,x2:c[l+3]*o,y2:c[l+4]*o,width:(c[l+3]-c[l+1])*o,height:(c[l+4]-c[l+2])*o};this.context.strokeStyle="red",this.context.strokeRect(d.x1,d.y1,d.width,d.height)}}),i&&(this.context.strokeStyle="red",this.context.lineWidth=window.devicePixelRatio||1,this.context.strokeRect(i[1]*o,i[2]*o,(i[3]-i[1])*o,(i[4]-i[2])*o))}}getActiveZone(e){return null}getPointsAt(e,t,i,r){return e.getPointsAt(t,i,r)}getScale(e,t){return 1}beforeFrame(e,t){this.bounds=Te.DnaFactory.singleBox(e.width,e.height)}drawImage(){}afterPaintLayer(e,t){}paint(e,t,i,r,s,o){this.renderNextFrame=!0}prepareLayer(e){}pendingUpdate(){return!1}hasActiveZone(){return!1}getViewportBounds(e,t,i){return null}getRendererScreenPosition(){return this.canvas.getBoundingClientRect()}finishLayer(){}reset(){}};var Ve=class{constructor(){a(this,"autoWidth",!1);a(this,"autoHeight",!0);a(this,"width");a(this,"height");a(this,"world");a(this,"content",[]);a(this,"viewingDirection","left-to-right");a(this,"rows");a(this,"columns",4);a(this,"spacing",20);a(this,"reversed",!1);a(this,"padding",20);this.world=et.withProps({width:0,height:0,viewingDirection:"left-to-right"}),this.width=0,this.height=0}setViewingDirection(e){this.viewingDirection=e}addContent(e){this.content.push(...e.map(t=>this.world.addObjectAt(t,{width:0,height:0,x:0,y:0})))}setWidth(e){this.width=e}setHeight(e){this.height=e}setSpacing(e){this.spacing=e}setPadding(e){this.padding=e}setRows(e){this.autoWidth=!0,this.rows=e}setColumns(e){this.autoHeight=!0,this.columns=e}recalculate(){if(this.height===0&&this.width===0||this.rows===0||this.columns===0)return;if(this.autoHeight&&!this.width)throw new Error("Cannot set auto height without setting a width");if(this.autoWidth&&!this.height)throw new Error("Cannot set auto width without setting a height");(this.viewingDirection==="left-to-right"||this.viewingDirection==="top-to-bottom")&&this.reversed&&(this.reversed=!1,this.content.reverse()),(this.viewingDirection==="right-to-left"||this.viewingDirection==="bottom-to-top")&&!this.reversed&&(this.reversed=!0,this.content.reverse());let e=this.content.length,t=()=>{if(this.autoWidth&&this.rows){let h=e>this.rows?this.rows:e;return{columns:Math.ceil(e/h),rows:h}}if(this.autoHeight&&this.columns){let h=e>this.columns?this.columns:e;return{columns:h,rows:Math.ceil(e/h)}}throw new Error("Something went wrong.")},{columns:i,rows:r}=t(),s=this.autoWidth?-1:this.width-this.padding*2,o=this.autoWidth?-1:(s-this.spacing*(i-1))/i;if(this.autoHeight&&!this.autoWidth){let h=0,l=this.padding;for(let c=0;c<r&&h!==e;c++){let d=0,u=[];for(let m=0;m<i;m++){let y=this.reversed?e-h:h;if(h===e)break;let v=this.content[y],S=v.width,P=v.width/v.height,g=o/P;u.push([h,o,g,o/S]),g>d&&(d=g),h++}for(let m=0;m<i&&u[m];m++){let y=this.world.getPoints(),v=u[m][0],S=u[m][1],P=u[m][2],g=u[m][3],f=this.padding+m*(this.spacing+S),C=l+(d-P)/2,R=this.reversed?e-v:v,w=y[R*5+1],b=y[R*5+2];this.world.scaleWorldObject(v,g),(w!==f||b!==C)&&this.world.translateWorldObject(R,f-w,C-b)}l+=d+this.spacing}this.height=l+this.padding,this.world.resize(this.width,this.height);return}this.autoWidth&&this.autoHeight,!this.autoWidth&&this.autoHeight}getWorld(){return this.world}};var Ti=q(require("normalize-wheel"),1);var Q=require("@atlas-viewer/dna");function Ei(n){return{x:n[1],y:n[2],width:n[3]-n[1],height:n[4]-n[2]}}var Ci="pan",Ri="scroll",Pn="gesture",_i={zoomOutFactor:.8,zoomInFactor:1.25,maxZoomFactor:1,minZoomFactor:.05,zoomDuration:300,zoomWheelConstant:20,zoomClamp:.6,panBounceStiffness:120,panBounceDamping:15,panTimeConstant:240,panPower:.1,nudgeDistance:100,panPadding:0,devicePixelRatio:1,enableWheel:!0,enableClickToZoom:!0,ignoreSingleFingerTouch:!1,enablePanOnWait:!1,requireMetaKeyForWheelZoom:!1,panOnWaitDelay:40,onPanInSketchMode:()=>{},parentElement:null},ne=(n={})=>({start:function(e){let{zoomWheelConstant:t,enableWheel:i,enableClickToZoom:r,ignoreSingleFingerTouch:s,enablePanOnWait:o,panOnWaitDelay:h,parentElement:l,requireMetaKeyForWheelZoom:c}={..._i,...n},d={pointerStart:{x:0,y:0},isPressing:!1,mousemoveBuffer:(0,Q.dna)(5),multiTouch:{distance:0}};e.world.activatedEvents.push("onMouseUp","onMouseDown","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","onContextMenu");function u(){S=0,g="",C(),C(void 0,"notice"),P=0}function m(){e.world.constraintBounds(),u()}function y(x){if(x.which>1){d.isPressing=!1;return}e.mode==="explore"&&(x.preventDefault(),d.pointerStart.x=x.atlas.x,d.pointerStart.y=x.atlas.y,e.transitionManager.stopTransition(),d.isPressing=!0)}function v(){u(),d.isPressing&&(e.mode==="explore"&&e.world.constraintBounds(),d.isPressing=!1)}let S=0,P=0,g="";function f(x){if(e.mode==="explore"){if(x.atlasTouches.length===1&&(P=performance.now(),s==!1&&x.preventDefault(),d.pointerStart.x=x.atlasTouches[0].x,d.pointerStart.y=x.atlasTouches[0].y),x.atlasTouches.length===2){g=Pn,x.preventDefault();let _=x.atlasTouches[0].x,L=x.atlasTouches[1].x;d.pointerStart.x=(_+L)/2;let Tt=x.atlasTouches[0].y,k=x.atlasTouches[1].y;d.pointerStart.y=(Tt+k)/2,S=Ot({x:x.touches[0].clientX,y:x.touches[0].clientY},{x:x.touches[1].clientX,y:x.touches[1].clientY})}e.transitionManager.stopTransition(),d.isPressing=!0}}function C(x,_="intent"){l&&(l.dataset[_]=x)}function R(x){let _=null,L=null,Tt=!1,k=0;if(d.isPressing&&x.touches.length===2){let ot=x.touches[0].clientX,vt=x.touches[1].clientX;_=(ot+vt)/2;let Wt=x.touches[0].clientY,Nt=x.touches[1].clientY;L=(Wt+Nt)/2,k=Ot({x:x.touches[0].clientX,y:x.touches[0].clientY},{x:x.touches[1].clientX,y:x.touches[1].clientY}),Tt=!0}if(C(g),d.isPressing&&x.touches.length===1){if(o&&(performance.now()-P<h&&g==""&&(g=Ri),g==""&&(g=Ci)),C(g),g==""&&s==!0||g==Ri){C("require-two-finger","notice");return}let ot=x.touches[0];_=ot.clientX,L=ot.clientY}if(_!==null&&L!==null){let ot=e.getRendererScreenPosition();if(ot){let{x:vt,y:Wt}=e.viewerToWorld(_-ot.x,L-ot.y),Nt=k&&S?k/S:1;e.transitionManager.customTransition(p=>{p.from=(0,Q.dna)(e.target),p.to=(0,Q.transform)(p.from,(0,Q.compose)((0,Q.translate)(d.pointerStart.x-vt,d.pointerStart.y-Wt),(0,Q.scaleAtOrigin)(1/Nt,vt,Wt)),d.mousemoveBuffer),p.elapsed_time=0,p.total_time=0,p.timingFunction=st.easeInOutExpo,p.done=!1})}S=k}g==Ci&&x.preventDefault()}function w(x){if(d.isPressing){let _=e.getRendererScreenPosition();if(_){let{x:L,y:Tt}=e.viewerToWorld(x.clientX-_.x,x.clientY-_.y);e.transitionManager.customTransition(k=>{k.from=(0,Q.dna)(e.target),k.to=(0,Q.transform)(k.from,(0,Q.translate)(d.pointerStart.x-L,d.pointerStart.y-Tt),d.mousemoveBuffer),k.elapsed_time=0,k.total_time=0,k.timingFunction=st.easeInOutExpo,k.done=!1})}}}function b(x){e.mode==="explore"&&e.world.zoomIn(x.atlas)}function I(x){let L=1+(0,Ti.default)(x).spinY/t;e.world.zoomTo(L,x.atlas,!0)}function G(x){return c&&x.metaKey==!1?(C("meta-required","notice"),x.stopPropagation(),!1):!0}e.world.addEventListener("mouseup",m),e.world.addEventListener("touchend",m),e.world.addEventListener("touchstart",f),e.world.addEventListener("mousedown",y),window.addEventListener("touchend",v),window.addEventListener("mouseup",v),window.addEventListener("mousemove",w),l&&l.addEventListener("touchmove",R),r&&(e.world.activatedEvents.push("onClick"),e.world.addEventListener("click",b)),i&&(e.world.activatedEvents.push("onWheel"),c&&l?.addEventListener("wheel",G,{passive:!0,capture:!0}),e.world.addEventListener("wheel",I));let K=e.world.addLayoutSubscriber((x,_)=>{if(x==="zone-changed"&&e.transitionManager.constrainBounds({transition:{duration:0}}),x==="zoom-to"&&_&&e.transitionManager.zoomTo(_.factor,{origin:_.point,stream:_.stream}),x==="go-home"){let L=_.immediate?{duration:0}:void 0;e.transitionManager.goToRegion(Ei(e.homePosition),{transition:L})}if(x==="goto-region"&&_){let L=_.immediate?{duration:0}:{};e.transitionManager.goToRegion(_,{transition:L})}x==="constrain-bounds"&&e.transitionManager.constrainBounds({transition:_?.immediate?{duration:0}:void 0})});return()=>{e.world.removeEventListener("mouseup",m),e.world.removeEventListener("touchend",m),e.world.removeEventListener("touchstart",f),e.world.removeEventListener("mousedown",y),window.removeEventListener("touchend",v),window.removeEventListener("mouseup",v),e.world.removeEventListener("mousemove",w),l&&(l.removeEventListener("touchmove",w),l.removeEventListener("wheel",G,{passive:!0,capture:!0})),r&&e.world.removeEventListener("click",b),i&&e.world.removeEventListener("wheel",I),K()}},updatePosition(){}});var B=require("react");var _e=q(require("react"),1),Oi=require("react/jsx-runtime"),ct=_e.default.createContext("explore");ct.displayName="Mode";var re=()=>(0,_e.useContext)(ct);function En(n){return(0,Oi.jsx)(ct.Provider,{value:n.mode,children:n.children})}var ji=q(require("react-use-measure"),1);var Ge=q(require("react"),1),ut=Ge.default.createContext(null);ut.displayName="Atlas";var Ct=Ge.default.createContext(null);Ct.displayName="Bounds";var mt=q(require("react"),1);var Ii=q(require("react-reconciler"),1);var se,Cn=typeof performance=="object"&&typeof performance.now=="function";if(Cn){let n=performance;se=()=>n.now()}else{let n=Date,e=n.now();se=()=>n.now()-e}var Li=require("react");var Rn=16;function Mi(n,e){n&&n.appendChild&&e&&n.appendChild(e)}function ki(n,e){n&&n.removeChild&&e&&n.removeChild(e)}function Tn(n,e){return ki(n.world,e)}function _n(n,e,t){return Di(n.world,e,t)}function Di(n,e,t){n&&n instanceof dt&&(n=n.world),n&&n.insertBefore&&n.insertBefore(e,t)}function Ze(n,e,t){if(t&&(n.applyProps&&n.applyProps(t),n instanceof W))for(let i of zt){let r=i.slice(2).toLowerCase();t[i]!==e[i]&&(e[i]&&n.removeEventListener(r,e[i]),n.addEventListener(r,t[i]))}}function Xe(n,e){let t=Object.keys(e),i=!1;for(let r of t)if(zt.indexOf(r)!==-1){let s=nt[r];if(s){if(n.activatedEvents.indexOf(s)!==-1)continue;i=!0,n.activatedEvents.push(s)}}i&&n.triggerEventActivation()}var Oe=new Map,Ai={};function On(n,{args:e=[],...t},i,r,s){if(!(i instanceof dt)&&s){let l=c=>c.return?l(c.return):c.stateNode&&c.stateNode.containerInfo;i=l(s)}let o,h=i.world;switch(n){case"world":o=et.withProps({width:t.width,height:t.height,viewingDirection:"left-to-right"}),o.activatedEvents=h.activatedEvents,o.eventHandlers=h.eventHandlers,o.subscriptions=h.subscriptions,o.triggerEventActivation(),h=o;break;case"box":o=new rt;break;case"shape":o=new Mt;break;case"worldObject":case"world-object":o=new lt;break;case"worldImage":case"world-image":o=new H;break;case"texture":o=new Pt;break;case"compositeImage":case"composite-image":o=new Qt({id:t.id,width:t.width,height:t.height,images:[],renderOptions:t.renderOptions});break;case"tiledImage":case"tiled-image":o=tt.fromTile(t.uri,t.display,t.tile,t.scaleFactor,void 0,t.format,t.useFloorCalc,t.version3);break;case"paragraph":o=new yt,o.text=t.children;break;default:return}return Xe(h,t),Ze(o,{},t),o}function Mn(n,e){if(e instanceof et)n.world=e;else if(e instanceof lt)n.world.appendChild(e);else if(e)throw new Error("Invalid root")}var oe=(0,Ii.default)({unstable_now:se,now:se,createInstance:On,removeChild:ki,appendChild:Mi,appendInitialChild:Mi,insertBefore:Di,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:typeof setTimeout<"u"?setTimeout:void 0,cancelTimeout:typeof clearTimeout<"u"?clearTimeout:void 0,setTimeout:typeof setTimeout<"u"?setTimeout:void 0,clearTimeout:typeof clearTimeout<"u"?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:Mn,removeChildFromContainer:Tn,createTextInstance(){},insertInContainerBefore:_n,prepareUpdate(n,e,t,i,r){return Xe(r.world,i),i},commitUpdate(n,e,t,i,r,s){n.applyProps&&e&&Ze(n,i,e)},finalizeInitialChildren(n){return n?.__handlers},getChildHostContext(){return Ai},getRootHostContext(){return Ai},prepareForCommit(n){return n.isCommitting=!0,null},preparePortalMount(){},hideInstance(n){n&&n.points&&(n.points[0]=0)},unhideInstance(n,e){n&&n.points&&(n.points[0]=1)},getPublicInstance(n){return n},hideTextInstance(){throw new Error("Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.")},resetAfterCommit(n){n.isCommitting=!1,n.pendingUpdate=!0,n.world&&n.world.needsRecalculate&&(n.world.recalculateWorldSize(),n.world.triggerRepaint())},shouldSetTextContent(){return!1},clearContainer(){return!1},supportsHydration:!1,supportsPersistence:!1,detachDeletedInstance(n){},afterActiveInstanceBlur(){},beforeActiveInstanceBlur(){},getCurrentEventPriority(){return console.log("getCurrentEventPriority"),Rn},getInstanceFromNode(n){throw console.log("getInstanceFromNode",n),new Error("Not implemented")},getInstanceFromScope(n){throw console.log("getInstanceFromScope",n),new Error("Not implemented")},prepareScopeUpdate(n,e){throw console.log("prepareScopeUpdate",n,e),new Error("Not implemented")},logRecoverableError(){},requestPostPaintCallback(){}});oe.injectIntoDevTools({bundleType:0,version:Li.version,rendererPackageName:"@atlas-viewer/atlas"});function Ut(n,e){let t=Oe.get(n);t&&oe.updateContainer(null,t,null,()=>{Oe.delete(n),e&&e(n)})}var $t={render(n,e){let t=Oe.get(e);if(t)oe.updateContainer(n,t,null);else{let i=oe.createContainer(e,0,null,!1,null,"",()=>{},null);oe.updateContainer(n,i,null),Oe.set(e,i)}},unmountComponentAtNode(n,e){Ut(n,e)}};var Me=q(require("react"),1),J=typeof window<"u"&&(window.document?.createElement||window.navigator?.product==="ReactNative")?Me.useLayoutEffect:Me.useEffect;var Vt=require("react/jsx-runtime"),Fi=mt.default.memo(({children:n,setIsReady:e,onCreated:t,bounds:i,preset:r,mode:s="explore"})=>{let o=(0,mt.useCallback)(function(l){let c=(0,mt.useRef)(!1),d=()=>{e(!0)};return(0,mt.useEffect)(()=>{if(r&&!c.current){r.runtime.goHome();let u=t&&t(r);return void(u&&u.then?u.then(d):d())}return()=>{}},[]),(0,mt.useEffect)(()=>{c.current=!0},[]),l.children},[r]);return J(()=>{if(r){let h=r.runtime;s!==h.mode&&(h.mode=s),$t.render((0,Vt.jsx)(mt.default.StrictMode,{children:(0,Vt.jsx)(o,{children:(0,Vt.jsx)(Ct.Provider,{value:i,children:(0,Vt.jsx)(ct.Provider,{value:s,children:(0,Vt.jsx)(ut.Provider,{value:r,children:n})})})})}),h)}},[r,s,n]),J(()=>{if(r){let h=r.runtime;return()=>{$t.unmountComponentAtNode(h)}}return()=>{}},[r]),null});var ae=class{constructor(e,t){a(this,"canvas");a(this,"gl");a(this,"program");a(this,"fragmentShader");a(this,"vertexShader");a(this,"rectBuffer");a(this,"fragmentShaderSource",`
    precision mediump float;

    uniform sampler2D u_image;
    varying vec2 v_texCoord;

    void main() {
        gl_FragColor = texture2D(u_image, v_texCoord);
    }
  `);a(this,"vertexShaderSource",`
    attribute vec2 a_position;
    uniform vec2 u_resolution;
    varying vec4 v_color;
    uniform sampler2D u_texture;

    attribute vec2 a_texCoord;
    varying vec2 v_texCoord;

    void main() {

        // convert the position from pixels to 0.0 to 1.0
        vec2 zeroToOne = a_position / u_resolution;

        // convert from 0->1 to 0->2
        vec2 zeroToTwo = zeroToOne * 2.0;

        // convert from 0->2 to -1->+1 (clip space)
        vec2 clipSpace = zeroToTwo - 1.0;

        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        
        v_texCoord = a_texCoord;
    }
  `);a(this,"attributes");a(this,"uniforms");a(this,"buffers");a(this,"rendererPosition");a(this,"dpi");a(this,"lastResize",0);a(this,"lastKnownScale",1);this.canvas=e,this.rendererPosition=e.getBoundingClientRect(),this.gl=e.getContext("webgl2"),this.fragmentShader=this.createShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderSource),this.vertexShader=this.createShader(this.gl.VERTEX_SHADER,this.vertexShaderSource),this.program=this.createProgram(this.vertexShader,this.fragmentShader),this.dpi=t?.dpi||1,this.attributes={position:this.gl.getAttribLocation(this.program,"a_position"),texCoord:this.gl.getAttribLocation(this.program,"a_texCoord")},this.uniforms={resolution:this.gl.getUniformLocation(this.program,"u_resolution"),texture:this.gl.getUniformLocation(this.program,"u_texture")},this.buffers={position:this.createArrayBuffer(),texCoord:this.createArrayBuffer(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]))},this.rectBuffer=new Float32Array(12),this.resize(),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this.attributes.position)}resize(){this.resizeCanvasToDisplaySize(),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.rendererPosition=this.canvas.getBoundingClientRect()}isReady(){return!0}beforeFrame(e,t,i){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.vertexAttribPointer(this.attributes.position,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.uniforms.resolution,this.gl.canvas.width,this.gl.canvas.height),this.lastResize>1e3&&(this.lastResize=0,this.resizeCanvasToDisplaySize()),this.lastResize+=t}prepareLayer(e){(!e.__host||!e.__host.webgl)&&((e instanceof H||e instanceof tt)&&this.createImageHost(e),e instanceof Pt&&this.createTextureHost(e))}createTextureHost(e){e.__host=e.__host?e.__host:{};let t=this.gl,i=this.gl.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);let r;if(e instanceof Pt){let s=e.getTexture();s.source&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s.source),r=s}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),e.__host.webgl={height:e.height,width:e.width,texture:i,lastImage:r}}createImageHost(e){let t=[...new Array(e.points.length/5)];e.__host=e.__host?e.__host:{},e.__host.webgl={height:e.height,width:e.width,textures:t,loading:[],loaded:[],lastLevelRendered:-1,onLoad:(i,r)=>{let s=this.gl,o=this.gl.createTexture();s.bindTexture(s.TEXTURE_2D,o),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_2D,null),e.__host.webgl.textures[i]=o,e.__host.webgl.loaded.push(i)}}}paint(e,t,i,r,s,o){if(e.type==="spacial-content"&&e.__host&&e.__host.webgl){if(e.getTexture){let l=e?.getTexture();if(l&&e.__host.webgl.lastImage!==l.hash&&l.source&&!e.__host.webgl.error)try{let d=this.gl.RGBA,u=this.gl.RGBA,m=this.gl.UNSIGNED_BYTE;this.gl.bindTexture(this.gl.TEXTURE_2D,e.__host.webgl.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,d,u,m,l.source),e.__host.webgl.lastImage=l.hash}catch(c){e.__host.webgl.error=c}}if(e.__host.webgl.loading&&e.__host.webgl.loading.indexOf(t)===-1&&e.getImageUrl){e.__host.webgl.loading.push(t);let l=document.createElement("img");l.decoding="async",l.crossOrigin="anonymous",l.src=e.getImageUrl(t),l.onload=()=>(l.onload=null,e.__host.webgl.onLoad(t,l))}let h=e.__host.webgl.texture?e.__host.webgl.texture:e.__host.webgl.textures[t];h&&(this.gl.enableVertexAttribArray(this.attributes.texCoord),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffers.texCoord),this.gl.enableVertexAttribArray(this.attributes.texCoord),this.gl.vertexAttribPointer(this.attributes.texCoord,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffers.position),this.gl.enableVertexAttribArray(this.attributes.position),this.gl.vertexAttribPointer(this.attributes.position,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,h),this.gl.uniform1i(this.uniforms.texture,0),this.setRectangle(i,r,s,o),this.gl.drawArrays(this.gl.TRIANGLES,0,6))}}afterPaintLayer(e,t){}pendingUpdate(){return!0}getPointsAt(e,t,i,r){return e.getPointsAt(t,i,r)}afterFrame(){}getScale(e,t,i){if(Number.isNaN(e)||Number.isNaN(t))return this.lastKnownScale;let r=this.getCanvasDims(),s=r.width/e,o=r.height/t,h=(s<o?o:s)*(i&&this.dpi||1);return Number.isNaN(h)||(this.lastKnownScale=h),this.lastKnownScale}getCanvasDims(){return{width:this.canvas.width/this.dpi,height:this.canvas.height/this.dpi}}getViewportBounds(e,t,i){return null}createShader(e,t){let i=this.gl.createShader(e);if(i){if(this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;let s=this.gl.getShaderInfoLog(i);if(this.gl.deleteShader(i),s)throw new Error(s)}throw new Error("Invalid shader")}createProgram(e,t){let i=this.gl.createProgram();if(i){if(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS))return i;let s=this.gl.getProgramInfoLog(i);if(this.gl.deleteProgram(i),s)throw new Error(s)}throw new Error("Invalid program")}resizeCanvasToDisplaySize(){let e=this.gl.canvas,t=e.clientWidth,i=e.clientHeight,r=e.width!==t||e.height!==i;return r&&(e.width=t,e.height=i),r}createArrayBuffer(e){let t=this.gl.createBuffer();if(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),e&&this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),!t)throw new Error("Cannot create buffer");return t}setRectangle(e,t,i,r){this.gl.bufferData(this.gl.ARRAY_BUFFER,this.getRectangle(e,t,i,r),this.gl.STATIC_DRAW)}getRectangle(e,t,i,r){let s=e,o=e+i,h=t,l=t+r;return this.rectBuffer.set([s,h,o,h,s,l,s,l,o,h,o,l]),this.rectBuffer}getRendererScreenPosition(){return this.rendererPosition}finishLayer(){}reset(){}};function he(n,e){let t=e?n:JSON.stringify(n),i=5381,r=t.length;for(;r;)i=i*33^t.charCodeAt(--r);let o=(i>>>0).toString(16);return o.length%2?"0"+o:o}var Gt=class{constructor(e){a(this,"$element");a(this,"stylesheetClasses");a(this,"activeStylesheetClasses");a(this,"sheetsDidUpdate");a(this,"sheetPrefix");a(this,"stylesheetEntries");this.sheetPrefix=e?.sheetPrefix||"a-",this.$element=document.createElement("style"),this.stylesheetClasses=[],this.activeStylesheetClasses=[],this.sheetsDidUpdate=!1,this.stylesheetEntries={}}getElement(){return this.$element}addStylesheet(e){let t=e.replace(/\s\s+/g," ").replace(/: /g,":").replace(/; /g,";").trim(),i=this.sheetPrefix+he(t,!0);return this.stylesheetClasses.indexOf(i)!==-1||(this.stylesheetClasses.push(i),this.activeStylesheetClasses.push(i),this.stylesheetEntries[i]=t,this.sheetsDidUpdate=!0),i}removeStylesheet(e){let t=this.sheetPrefix+he(e,!0);this.stylesheetClasses.indexOf(t)&&(this.stylesheetClasses=this.stylesheetClasses.filter(i=>i!==t)),this.sheetsDidUpdate=!0}clearClasses(){this.activeStylesheetClasses=[]}didUpdateActive(){if(this.activeStylesheetClasses.length){for(let e of this.activeStylesheetClasses)if(this.stylesheetClasses.indexOf(e)===-1)return!0;for(let e of this.stylesheetClasses)if(this.activeStylesheetClasses.indexOf(e)===-1)return!0}return!1}updateSheet(){(this.sheetsDidUpdate||this.didUpdateActive())&&(this.$element.innerText=this.activeStylesheetClasses.map(e=>`.${e}{${this.stylesheetEntries[e]}}`).join(""),this.sheetsDidUpdate=!1,this.stylesheetClasses=[...this.activeStylesheetClasses])}};var It=class{constructor(e,t){a(this,"htmlContainer");a(this,"visible",[]);a(this,"previousVisible",[]);a(this,"htmlIds",[]);a(this,"firstMeaningfulPaint",!1);a(this,"rendererPosition");a(this,"stylesheet");a(this,"options");a(this,"paintTx",1);a(this,"zIndex",0);a(this,"classes");this.htmlContainer=e,this.htmlContainer.innerHTML="",this.rendererPosition=this.htmlContainer.getBoundingClientRect(),this.options={triggerResize:()=>{},box:!1,text:!1,sheetPrefix:"",inlineStyles:!1,background:"",...t||{}},this.stylesheet=new Gt({sheetPrefix:this.options.sheetPrefix}),this.options.inlineStyles||this.htmlContainer.appendChild(this.stylesheet.getElement()),this.options.background&&this.htmlContainer.classList.add(this.stylesheet.addStylesheet(`
        background: ${this.options.background};
      `)),this.classes={hostClassName:this.stylesheet.addStylesheet(`
        position: absolute;
        transform-origin: 0px 0px;
      `),interactive:this.stylesheet.addStylesheet("pointer-events: all"),nonInteractive:this.stylesheet.addStylesheet("pointer-events: none")},this.stylesheet.updateSheet()}createHtmlHost(e){if(this.htmlContainer&&(this.options.box||e.props.className||e.props.html||e.props.href)){let t=document.createElement(e.props.href?"a":"div");if(e.props.href){t.style.display="block",t.href=e.props.href;let i=e.props.hrefTarget||"_blank";t.target=i,i!=="_self"&&(t.rel="noopener noreferrer")}t.title=e.props.title||"",this.options.inlineStyles?(t.style.display="block",t.style.position="absolute",t.style.overflow="hidden",t.style.transformOrigin="0px 0px"):t.classList.add(this.classes.hostClassName),e.__host={element:t,revision:null,relative:!1},this.updateHtmlHost(e,e.width,e.height),e.__onCreate&&e.__onCreate()}}triggerResize(){this.options.triggerResize()}updateHtmlHost(e,t,i){if(e.__revision!==e.__host.revision){let r=e.__host.element,s=[this.classes.hostClassName];if(e.props.interactive?this.options.inlineStyles?r.style.pointerEvents="all":s.push(this.classes.interactive):this.options.inlineStyles?r.style.pointerEvents="none":s.push(this.classes.nonInteractive),e.props.href){r.style.display="block",r.href=e.props.href;let l=e.props.hrefTarget||"_blank";r.target=l,l!=="_self"?r.rel="noopener noreferrer":r.rel=""}else r.href&&r.removeAttribute("href");if(e.props.title&&(r.title=e.props.title||""),e.props.className&&(s.push(e.props.className),e.hovering&&s.push(`${e.props.className}--hover`),e.pressing&&s.push(`${e.props.className}--active`)),e.props.relativeStyle?(r.style.width=`${t||e.width}px`,r.style.height=`${i||e.height}px`):(r.style.width=`${e.width}px`,r.style.height=`${e.height}px`),e.props.style){Object.assign(r.style,e.props.style||{},e.hovering?e.props.hoverStyles||{}:{},e.pressing?e.props.pressStyles||{}:{});return}if(this.options.text&&e instanceof yt){e.text&&(r.innerText=e.text),e.backgroundColor&&(r.style.backgroundColor=e.backgroundColor),e.color&&(r.style.color=e.color),e.props.font&&(r.style.font=e.props.font),e.props.textAlign&&(r.style.textAlign=e.props.textAlign),e.__host.revision=e.__revision;let l=s.join(" ");r.className=l,r.part=l}e instanceof rt&&(this.options.box||e.props.className||e.props.html)&&(e.props.backgroundColor&&(r.style.backgroundColor=e.props.backgroundColor),e.props.border!==r.style.border&&(r.style.border=e.props.border));let h=s.join(" ");r.className=h,r.part=h}}afterFrame(e,t,i){this.stylesheet.updateSheet();for(let r of this.previousVisible)this.visible.indexOf(r)===-1&&this.htmlContainer&&r.__id&&this.htmlIds.indexOf(r.__id)!==-1&&this.htmlContainer.removeChild(r.__host.element);this.previousVisible=this.visible}afterPaintLayer(e,t){}beforeFrame(e,t,i){this.stylesheet.clearClasses(),this.paintTx++,this.zIndex=0,this.visible=[]}getPointsAt(e,t,i,r){return e.getPointsAt(t,i,r)}getScale(e,t){let i=this.rendererPosition.width/e,r=this.rendererPosition.height/t;return i<r?r:i}getViewportBounds(e,t,i){return null}isReady(){return!1}paint(e,t,i,r,s,o){if(this.zIndex++,(this.options.text&&e instanceof yt||e instanceof rt&&(this.options.box||e.props.className||e.props.html))&&e.__host.tx!==this.paintTx&&(this.visible.push(e),e.__host.tx=this.paintTx,this.htmlContainer)){this.updateHtmlHost(e,s,o);let h=s/e.width,l=e.__host.element;l.style.zIndex=`${this.zIndex}`,e.props.relativeStyle?l.style.transform=`translate(${Math.round(i)}px, ${Math.round(r)}px)`:l.style.transform=`translate(${Math.round(i)}px, ${Math.round(r)}px) scale(${h})`,this.previousVisible.indexOf(e)===-1&&this.htmlContainer.appendChild(l),this.htmlIds.indexOf(e.__id)===-1&&this.htmlIds.push(e.__id)}}pendingUpdate(){return!1}prepareLayer(e){e.__host||(e instanceof yt||e instanceof rt)&&this.createHtmlHost(e)}resize(e,t){typeof e<"u"&&typeof t<"u"&&(this.htmlContainer.style.width=`${e}px`,this.htmlContainer.style.height=`${t}px`),this.rendererPosition=this.htmlContainer.getBoundingClientRect()}getRendererScreenPosition(){return this.rendererPosition}finishLayer(){}reset(){}};var Zt=class Zt{constructor(e,t,i){a(this,"element");a(this,"runtime");a(this,"unsubscribe");a(this,"activatedEvents",[]);a(this,"eventHandlers",[]);a(this,"bounds");a(this,"listening");a(this,"pointerMoveEvent");a(this,"pointerEventState",{isClicking:!1,isDragging:!1,isPressed:!1,mousedOver:[],itemsBeingDragged:[],mouseDownStart:{x:0,y:0},lastTouches:[]});a(this,"options");a(this,"_realPointerMove",e=>{this.pointerMoveEvent=e});a(this,"onWheelEvent",e=>{e.preventDefault(),this.onPointerEvent(e)});a(this,"onContextMenu",e=>{e.preventDefault();let t="onContextMenu";if(this.runtime.world.activatedEvents.indexOf(t)!==-1){let{x:i,y:r}=this.runtime.viewerToWorld(e.clientX-this.bounds.left,e.clientY-this.bounds.top);this.assignToEvent(e,i,r),this.runtime.world.propagatePointerEvent(t,e,i,r)}});a(this,"onTouchEvent",e=>{let t=nt[e.type],i=[],r=e.touches.length;for(let s=0;s<r;s++){let o=e.touches.item(s);if(!o)continue;let{x:h,y:l}=this.runtime.viewerToWorld(o.clientX-this.bounds.left,o.clientY-this.bounds.top),c={id:o.identifier,x:h,y:l};i.push(c)}i.length&&this.assignToEvent(e,i[0].x,i[0].y),t!=="onTouchEnd"?(this.pointerEventState.lastTouches=i,e.atlasTouches=i,this.runtime.world.propagateTouchEvent(t,e,i)):(e.atlasTouches=[],this.runtime.world.propagateTouchEvent(t,e,this.pointerEventState.lastTouches),this.pointerEventState.lastTouches=[])});a(this,"onPointerEvent",e=>{if(e.button===2)return;let t=nt[e.type];if(t&&this.runtime.world.activatedEvents.indexOf(t)!==-1){let{x:i,y:r}=this.runtime.viewerToWorld(e.clientX-this.bounds.left,e.clientY-this.bounds.top);this.assignToEvent(e,i,r),this.runtime.world.propagatePointerEvent(t,e,i,r)}});a(this,"onPointerDown",e=>{e.button!==2&&(this.pointerEventState.isPressed=!0,this.pointerEventState.isClicking=!0,this.pointerEventState.mouseDownStart.x=e.clientX,this.pointerEventState.mouseDownStart.y=e.clientY,setTimeout(()=>{this.runtime&&(this.pointerEventState.isClicking=!1)},250),setTimeout(()=>{if(this.runtime&&this.pointerEventState.isPressed&&!this.pointerEventState.isDragging){let t=this.runtime.viewerToWorld(this.pointerEventState.mouseDownStart.x-this.bounds.left,this.pointerEventState.mouseDownStart.y-this.bounds.top);this.pointerEventState.isDragging=!0,this.pointerEventState.itemsBeingDragged=this.runtime.world.propagatePointerEvent("onDragStart",e,t.x,t.y)}},800),this.onPointerEvent(e))});a(this,"onPointerUp",e=>{if(e.button!==2){if(this.pointerEventState.isClicking){let{x:t,y:i}=this.runtime.viewerToWorld(e.clientX-this.bounds.left,e.clientY-this.bounds.top);this.assignToEvent(e,t,i),this.runtime.world.propagatePointerEvent("onClick",e,t,i)}if(this.pointerEventState.isDragging){for(let t of this.pointerEventState.itemsBeingDragged)t.dispatchEvent("onDragEnd",e);this.pointerEventState.isDragging=!1}this.pointerEventState.isClicking=!1,this.pointerEventState.isPressed=!1,this.pointerEventState.itemsBeingDragged=[],this.onPointerEvent(e)}});a(this,"onPointerMove",e=>{this.pointerMoveEvent=void 0;let{x:t,y:i}=this.runtime.viewerToWorld(e.clientX-this.bounds.left,e.clientY-this.bounds.top);if(Number.isNaN(t)||Number.isNaN(i))return;this.assignToEvent(e,t,i),this.runtime.world.propagatePointerEvent("onPointerMove",e,t,i);let r=this.runtime.world.propagatePointerEvent("onMouseMove",e,t,i),s=[],o=[];for(let h of r)s.push(h.id),o.push(h),this.pointerEventState.mousedOver.indexOf(h)===-1&&(h.dispatchEvent("onMouseEnter",e),h.dispatchEvent("onPointerEnter",e),h.dispatchEvent("onMouseOver",e),h.dispatchEvent("onPointerOver",e));for(let h of this.pointerEventState.mousedOver)s.indexOf(h.id)===-1&&(h.dispatchEvent("onMouseLeave",e),h.dispatchEvent("onPointerLeave",e),h.dispatchEvent("onMouseOut",e),h.dispatchEvent("onPointerOut",e));if(this.pointerEventState.isDragging)for(let h of this.pointerEventState.itemsBeingDragged)h.dispatchEvent("onDrag",e);if(this.pointerEventState.isPressed&&!this.pointerEventState.isDragging&&Ot(this.pointerEventState.mouseDownStart,{x:e.clientX,y:e.clientY})>50){let h=this.runtime.viewerToWorld(this.pointerEventState.mouseDownStart.x-this.bounds.left,this.pointerEventState.mouseDownStart.y-this.bounds.top);this.pointerEventState.isDragging=!0,this.pointerEventState.itemsBeingDragged=this.runtime.world.propagatePointerEvent("onDragStart",{...e,atlas:{x:h.x,y:h.y}},h.x,h.y)}this.pointerEventState.mousedOver=o});this.element=e,this.runtime=t,this.unsubscribe=t.world.addLayoutSubscriber(this.layoutSubscriber.bind(this)),this.bounds=e.getBoundingClientRect(),this.listening=!1,this.options={simulationRate:0,...i||{}};let r=0;t.registerHook("useFrame",s=>{r+=s,r>this.options.simulationRate&&this.pointerMoveEvent&&(r=0,t.updateNextFrame())}),t.registerHook("useBeforeFrame",()=>{this.pointerMoveEvent&&this.onPointerMove(this.pointerMoveEvent)}),this.activateEvents()}updateBounds(){this.bounds=this.element.getBoundingClientRect(),this.runtime.updateRendererScreenPosition()}layoutSubscriber(e){e==="event-activation"&&this.listening==!1&&this.activateEvents()}assignToEvent(e,t,i){Zt.eventPool.atlas.x=t,Zt.eventPool.atlas.y=i,e.atlas=Zt.eventPool.atlas}activateEvents(){this.listening=!0,this.element.addEventListener("pointermove",this._realPointerMove),this.element.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointerdown",this.onPointerDown),this.element.addEventListener("mousedown",this.onPointerEvent),this.element.addEventListener("mouseup",this.onPointerEvent),this.element.addEventListener("pointercancel",this.onPointerEvent),this.element.addEventListener("wheel",this.onWheelEvent),this.element.addEventListener("contextmenu",this.onContextMenu),this.element.addEventListener("touchstart",this.onTouchEvent),this.element.addEventListener("touchcancel",this.onTouchEvent),this.element.addEventListener("touchend",this.onTouchEvent),this.element.addEventListener("touchmove",this.onTouchEvent)}normalizeEventName(e){return e.startsWith("on")?e.slice(2).toLowerCase():e.toLowerCase()}stop(){this.listening=!1,this.element.removeEventListener("pointermove",this._realPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp),this.element.removeEventListener("pointerdown",this.onPointerDown),this.element.removeEventListener("mousedown",this.onPointerEvent),this.element.removeEventListener("mouseup",this.onPointerEvent),this.element.removeEventListener("pointercancel",this.onPointerEvent),this.element.removeEventListener("wheel",this.onWheelEvent),this.element.removeEventListener("touchstart",this.onTouchEvent),this.element.removeEventListener("touchcancel",this.onTouchEvent),this.element.removeEventListener("touchend",this.onTouchEvent),this.element.removeEventListener("touchmove",this.onTouchEvent),this.unsubscribe();for(let[e,t]of this.eventHandlers)this.element.removeEventListener(this.normalizeEventName(e),t)}};a(Zt,"eventPool",{atlas:{x:0,y:0}});var Lt=Zt;function le({interactive:n=!0,viewport:e,forceRefresh:t,canvasElement:i,overlayElement:r,controllerConfig:s,unstable_webglRenderer:o,dpi:h,debug:l,canvasBox:c=!0,polygon:d=!0,navigatorElement:u,runtimeOptions:m}){if(!i)throw new Error("Invalid container");i.style.userSelect="none";let y=n?ne({minZoomFactor:.5,maxZoomFactor:3,enableClickToZoom:!1,parentElement:i,...s||{}}):void 0,v=new At([o?new ae(i,{dpi:h}):new ee(i,{dpi:h,debug:l,box:c,polygon:d}),r?new It(r,{box:o||!c,text:!0,triggerResize:t}):void 0,u?new ie(u):void 0]),S=new dt(v,new et(1024,1024),e,y?[y]:[],m),P=new Lt(i,S);return{name:"default-preset",em:P,runtime:S,renderer:v,controller:y,canvas:i,navigator:u,unmount(){Ut(S),S.stopControllers(),S.stop(),S.reset(),P&&P.stop()}}}var Rt=1+Number.MIN_VALUE,de=class{constructor(e,t){a(this,"container");a(this,"width");a(this,"height");a(this,"pending",!0);a(this,"options");a(this,"stylesheet");a(this,"zIndex",0);a(this,"lastKnownScale",1);a(this,"rendererPosition");a(this,"currentlyVisible",[]);a(this,"previouslyVisible",[]);this.container=e,this.rendererPosition=e.getBoundingClientRect();let{width:i,height:r}=this.rendererPosition;this.width=i,this.height=r,this.options={addPart:!1,setDraggableFalse:!1,imageClass:"",widthStylesheet:!1,sheetPrefix:"position-",background:"#000",...t||{}},this.stylesheet=new Gt({sheetPrefix:this.options.sheetPrefix}),this.container.classList.add(this.stylesheet.addStylesheet(`
        background: ${this.options.background};
      `)),this.options.widthStylesheet&&this.container.appendChild(this.stylesheet.getElement())}isReady(){return!0}resize(){this.rendererPosition=this.container.getBoundingClientRect(),this.width=this.rendererPosition.width,this.height=this.rendererPosition.height}getRendererScreenPosition(){return this.rendererPosition}afterFrame(e,t,i){this.stylesheet.updateSheet();for(let r of this.previouslyVisible)this.currentlyVisible.indexOf(r)===-1&&this.container.removeChild(r);for(let r of this.currentlyVisible)this.previouslyVisible.indexOf(r)===-1&&this.container.appendChild(r);this.previouslyVisible=this.currentlyVisible,this.currentlyVisible=[]}afterPaintLayer(e,t){}beforeFrame(e,t,i){this.stylesheet.clearClasses(),this.zIndex=0}getPointsAt(e,t,i,r){return e.getPointsAt(t,i,r)}getScale(e,t){if(Number.isNaN(e)||Number.isNaN(t))return this.lastKnownScale;let i=this.width/e,r=this.height/t,s=i<r?r:i;return Number.isNaN(s)||(this.lastKnownScale=s),this.lastKnownScale}getViewportBounds(e,t,i){return null}createImage(){let e=document.createElement("img");return this.options.imageClass?(e.className=this.options.imageClass,this.options.addPart&&e.setAttribute("part",this.options.imageClass)):(e.style.position="absolute",e.style.pointerEvents="none",e.style.userSelect="none"),this.options.setDraggableFalse&&e.setAttribute("draggable","false"),e}paint(e,t,i,r,s,o){if(this.pending=!1,this.zIndex++,e instanceof H){if(!e.__host){let l=this.createImage();l.src=e.uri,e.__host=l,this.container.appendChild(e.__host)}let h=e.__host;this.currentlyVisible.push(h),h.style.zIndex=`${this.zIndex}`,h.style.opacity=`${e.style.opacity}`,this.options.widthStylesheet?h.className=this.options.imageClass+" "+this.stylesheet.addStylesheet(`width:${(s+Rt).toFixed(2)}px;height:${(o+Rt).toFixed(2)}px;`):(h.style.width=`${s+Rt}px`,h.style.height=`${o+Rt}px`),h.style.transform=`translate(${i}px, ${r}px)`}if(e instanceof tt){if(e.__host||(e.__host={images:[]}),!e.__host.images[t]){let l=e.getImageUrl(t),c=this.createImage();c.src=l,e.__host.images[t]=c,this.container.appendChild(c)}let h=e.__host.images[t];h.style.zIndex=`${this.zIndex}`,h.style.opacity=`${e.style.opacity}`,this.currentlyVisible.push(h),this.options.widthStylesheet?h.className=this.options.imageClass+" "+this.stylesheet.addStylesheet(`width:${(s+Rt).toFixed(2)}px;height:${(o+Rt).toFixed(2)}px;`):(h.style.width=`${s+Rt}px`,h.style.height=`${o+Rt}px`),h.style.transform=`translate(${i}px, ${r}px)`}}pendingUpdate(){return this.pending}prepareLayer(e){}finishLayer(e){}reset(){}};function Ye({interactive:n,viewport:e,forceRefresh:t,containerElement:i,overlayElement:r,controllerConfig:s}){if(!i)throw new Error("Invalid container");i.style.userSelect="none";let o=n?ne({minZoomFactor:.5,maxZoomFactor:3,enableClickToZoom:!1,parentElement:i,...s||{}}):void 0,h=new de(i,{addPart:!1,setDraggableFalse:!1,imageClass:"atlas-static-image"}),l=r?new At([h,new It(r,{box:!0,text:!0,triggerResize:t})]):h,c=new dt(l,new et(1024,1024),e,o?[o]:[]),d=new Lt(i,c);return{name:"static-preset",em:d,runtime:c,renderer:l,controller:o,container:i,overlay:r,unmount(){Ut(c),c.stopControllers(),c.stop(),d&&d.stop()}}}var Qe={"default-preset":le,"static-preset":Ye};var it=require("react"),An={};function Ae(n,e){let t=(0,it.useRef)(),i=(0,it.useRef)(),r=(0,it.useRef)(),s=(0,it.useRef)(),o=(0,it.useRef)({width:e.width,height:e.height,didUpdate:!0}),[h="default-preset",l=An]=Array.isArray(n)?n||[]:[n],[c,d]=(0,it.useState)(null);(0,it.useLayoutEffect)(()=>{let m=i.current,y=s.current,v=t.current,S=r.current,g=(Qe[h]||le)({containerElement:y,canvasElement:m,overlayElement:v,navigatorElement:S,viewport:o.current,dpi:window.devicePixelRatio||1,forceRefresh:e.forceRefresh,unstable_webglRenderer:e.unstable_webglRenderer,...l||{}});return d(g),()=>{g&&(g.unmount(),m&&(m.height=0,m.width=0),v&&(v.innerHTML=""),S&&(S.height=0,S.width=0))}},[h,l]);let u=(0,it.useMemo)(()=>({canvas:i,overlay:t,container:s,navigator:r}),[]);return[h,c,o,u]}var Bi=require("react");function Wi(n){return(0,Bi.useMemo)(()=>he(n),n)}var Ni=q(require("react"),1),zi=require("react/jsx-runtime"),kt=Ni.default.forwardRef((n,e)=>(0,zi.jsx)("div",{...n,ref:e,part:n.className}));var Y=require("react/jsx-runtime"),Hi=["brightness","contrast","grayscale","hueRotate","invert","saturate","sepia","blur"],Ke=({htmlChildren:n,renderPreset:e,onCreated:t,mode:i="explore",resetWorldOnChange:r=!0,unstable_webglRenderer:s=!1,unstable_noReconciler:o=!1,hideInlineStyle:h=!1,controllerConfig:l,children:c,overlayStyle:d,containerStyle:u,enableNavigator:m,className:y,containerProps:v={},homePosition:S,homeOnResize:P,homeCover:g,background:f,runtimeOptions:C,debug:R,filters:w,...b})=>{let[I,G]=(0,B.useState)(i),[K,x]=(0,B.useState)(!1),_=(0,B.useRef)(!1),L=(0,B.useMemo)(()=>(typeof e=="string"&&(e=[e,{}]),R?e?[e[0],{debug:R,...e[1]||{}}]:["default-preset",{debug:R}]:e||"default-preset"),[e,R]),[Tt,k,ot]=(0,ji.default)({scroll:!0}),vt=(0,B.useRef)(),Wt=E=>{vt.current=E,Tt(E)},[Nt,p,N,fe]=Ae(L,{width:b.width,height:b.height,forceRefresh:ot,unstable_webglRenderer:s}),[an,hi]=(0,B.useState)("");(0,B.useEffect)(()=>{G(i)},[i]),(0,B.useEffect)(()=>{p&&p.em&&p.em.updateBounds()},[p,k]),(0,B.useEffect)(()=>{p?.runtime.setOptions(C||{})},[C]),(0,B.useEffect)(()=>{p&&p.runtime&&(p.runtime.mode=I),K&&p&&(p.ready=!0)},[p,K,I]),(0,B.useEffect)(()=>{p&&(g||(p.runtime.manualHomePosition=!!S,p.runtime.setHomePosition(S)))},[p,g,S]),(0,B.useEffect)(()=>{if(p){let E=p.runtime;E.resize(N.current.width,b.width,N.current.height,b.height),N.current.width=b.width,N.current.height=b.height,E.updateNextFrame(),N.current.didUpdate=!0}},[p,b.width,b.height]),(0,B.useEffect)(()=>{if(w&&p){let E=p.runtime,O=!1;E.hookOptions.enableFilters=!0;for(let D of Hi)w[D]?w[D]!==p.runtime.hookOptions.filters[D]&&(E.hookOptions.filters[D]=w[D],O=!0):E.hookOptions.filters[D]&&(E.hookOptions.filters[D]=0,O=!0);O&&E.updateNextFrame()}else if(p){let E=p.runtime;for(let O of Hi)E.hookOptions.filters[O]=0;E.hookOptions.enableFilters=!1,E.updateNextFrame()}},[p,w]),J(()=>{if(p&&(p.overlay&&(p.overlay.style.width=`${k.width}px`,p.overlay.style.height=`${k.height}px`),p.container&&(p.container.style.width=`${k.width}px`,p.container.style.height=`${k.height}px`),g)){let E=p.runtime.world.width,O=p.runtime.world.height,D=E/O,Z=N.current.width,Xt=N.current.height,wt=Z/Xt;if(D>wt){wt=Xt/Z,p.runtime.manualHomePosition=!0;let _t=(E-O/wt)/2;g==="start"&&(_t=0),g==="end"&&(_t=E-O/wt),p.runtime.setHomePosition({x:_t,y:0,width:O/wt,height:O})}else{let _t=(O-E/wt)/2;g==="start"&&(_t=0),g==="end"&&(_t=O-E/wt),p.runtime.manualHomePosition=!0,p.runtime.setHomePosition({x:0,y:_t,width:E,height:E/wt})}P&&p.runtime.goHome({})}},[p,k.height,k.width,g]),J(()=>{let E=()=>{if(p){let O=p.runtime;N.current.width!==b.width&&N.current.height!==b.height&&(O.resize(N.current.width,b.width,N.current.height,b.height),N.current.width=b.width,N.current.height=b.height,O.updateNextFrame(),N.current.didUpdate=!0)}};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[p,b.height,b.width]);let li={width:120},di=()=>{if(p&&p.navigator){let E=p.runtime.world.height,O=p.runtime.world.width,D=window.devicePixelRatio||1,Z=li.width,Xt=li.width/O*E;p.navigator.width=Z*D,p.navigator.height=Xt*D,p.navigator.style.width=Z+"px",p.navigator.style.height=Xt+"px"}};J(()=>{if(p){di();let E=p.runtime;return E.world.addLayoutSubscriber(O=>{O==="recalculate-world-size"&&(di(),E.resize(N.current.width,b.width,N.current.height,b.height))})}return()=>{}},[p,b.width,b.height]);let hn=(0,B.useCallback)(function(O){let D=()=>{x(!0)};return(0,B.useEffect)(()=>{if(p){p.runtime.goHome();let Z=t&&t(p);return void(Z&&Z.then?Z.then(D):D())}else throw new Error("Invalid configuration - no runtime found")},[]),O.children},[p]);(0,B.useEffect)(()=>{if(p){let E=p.runtime;if(r)return E.world.addLayoutSubscriber(O=>{O==="recalculate-world-size"&&E.goHome()})}return()=>{}},[p,r]),(0,B.useEffect)(()=>p?p.runtime.registerHook("useBeforeFrame",()=>{if(N.current.didUpdate&&p.canvas){let O=window.devicePixelRatio||1,D=N.current.width,Z=N.current.height;p.canvas.width=D*O,p.canvas.height=Z*O,p.canvas.style.width=D+"px",p.canvas.style.height=Z+"px",p.canvas.getContext("2d")?.scale(O,O),p&&p.em&&p.em.updateBounds(),N.current.didUpdate=!1}}):()=>{},[p,r]),(0,B.useEffect)(()=>{let E=()=>{p&&(G("sketch"),hi("mode-sketch")),window.removeEventListener("keyup",E)},O=D=>{if(D.code==="Space"&&p&&p.runtime.mode==="sketch"){let Z=D.target?.tagName?.toLowerCase();if(Z==="input"||Z==="textarea"||D.target?.isContentEditable)return;D.preventDefault(),G("explore"),hi("mode-explore"),window.addEventListener("keyup",E)}};return window.addEventListener("keydown",O),()=>{window.removeEventListener("keydown",O),window.removeEventListener("keyup",E)}},[p]),_.current=!0;let{height:Gn,width:Zn,...ln}=b,He=Wi([b.width,b.height]),ci=!0;return L&&Array.isArray(L)&&L.length>1&&L[1].interactive===!1&&(ci=!1),f=f??"#000",vt.current&&(f=getComputedStyle(vt.current).getPropertyValue("--atlas-background")||f),(0,Y.jsxs)(kt,{ref:Wt,className:["atlas",h?"":`atlas-width-${He}`,an,y,`atlas-${Nt}`].filter(Boolean).join(" ").trim(),style:{...u,...h?{}:{width:b.width,height:b.height}},children:[Nt==="static-preset"?(0,Y.jsx)(kt,{className:"atlas-static-container",ref:fe.container,tabIndex:0,...v}):(0,Y.jsx)("canvas",{className:"atlas-canvas",part:"atlas-canvas",tabIndex:0,...ln,...v,ref:fe.canvas,"data-background":f}),(0,Y.jsx)(kt,{className:["atlas-overlay",ci?"atlas-overlay--interactive":""].filter(Boolean).join(" ").trim(),style:{...d||{}},ref:fe.overlay,children:o?(0,Y.jsx)(hn,{children:(0,Y.jsx)(Ct.Provider,{value:k,children:(0,Y.jsx)(ct.Provider,{value:I,children:(0,Y.jsx)(ut.Provider,{value:p,children:c})})})}):(0,Y.jsx)(Fi,{bounds:k,preset:p,mode:I,setIsReady:x,onCreated:t,children:c})}),m?(0,Y.jsx)(kt,{className:"atlas-navigator",children:(0,Y.jsx)("canvas",{className:"atlas-navigator-canvas",part:"atlas-navigator-canvas",ref:fe.navigator})}):null,h?(0,Y.jsx)("style",{children:`.atlas-width-${He} { width: ${b.width}px; height: ${b.height}px; }`}):(0,Y.jsx)("style",{children:`
        .atlas { position: relative; display: flex; background: ${f}; z-index: var(--atlas-z-index, 10); -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .atlas-width-${He} { width: ${b.width}px; height: ${b.height}px; }
        .atlas-canvas { flex: 1 1 0px; }
        .atlas-canvas:focus, .atlas-static-container:focus { outline: none }
        .atlas-canvas:focus-visible, .atlas-canvas-container:focus-visible { outline: var(--atlas-focus, 2px solid darkorange) }
        .atlas-static-preset { touch-action: inherit; }
        .atlas-static-container { position: relative; overflow: hidden; flex: 1 1 0px; }
        .atlas-overlay { position: absolute; top: 0; left: 0; none; overflow: hidden; }
        /** setting the pointer events to none means that Atlas will own the touch and mousewheel events **/
        .atlas-overlay--interactive { pointer-events: none; }
        .atlas-static-image { position: absolute; user-select: none; transform-origin: 0px 0px; }
        .atlas-navigator { position: absolute; top: var(--atlas-navigator-top, 10px); right: var(--atlas-navigator-bottom, 10px); left: var(--atlas-navigator-left); bottom: var(--atlas-navigator-bottom); opacity: .8 }
        .atlas-navigator-canvas { width: 100%; }
      `}),n]})};var Ie=require("react"),$i=q(require("react-use-measure"),1);function Ui(n){return Number(n)==n?`${n}px`:n}var ce=require("react/jsx-runtime"),In=({resizeHash:n,aspectRatio:e,containerProps:t={},...i})=>{let[r,s,o]=(0,$i.default)(),{height:h,width:l,...c}=i;(0,Ie.useEffect)(()=>{o()},[l,h,n,o]);let d=(0,Ie.useMemo)(()=>e?{width:s.width,height:s.width*(1/e)}:s,[s,e]);return(0,ce.jsxs)(kt,{ref:r,className:"atlas-container",...t,children:[d.width?(0,ce.jsx)(Ke,{width:d.width||100,height:d.height||100,...c,children:i.children}):null,i.hideInlineStyle?null:(0,ce.jsx)("style",{children:`
          .atlas-container { 
            display: var(--atlas-container-display, block);
            flex: var(--atlas-container-flex, none);
            width: var(--atlas-container-width, ${l?`${l}px`:"100%"});
            height: var(--atlas-container-height, ${Ui(h||(e?d.height:512))})  
          }
      `}),i.htmlChildren]})};var ft=require("react");var Vi=require("react");var ue=()=>(0,Vi.useContext)(ut);var $=()=>{let n=ue();return n?n.runtime:void 0};var Gi=require("react"),qe=(n,e=[])=>{let t=$();(0,Gi.useEffect)(()=>t?t.registerHook("useAfterFrame",n):()=>{},e)};var Zi=require("react"),Dt=(n,e=[])=>{let t=$();(0,Zi.useEffect)(()=>t?t.registerHook("useFrame",n):()=>{},e)};var Je=()=>{let n=ue();return n&&n.canvas?n.canvas:void 0};var Xi=require("react");function Le(){return(0,Xi.useContext)(Ct)}var Ln=({onCreate:n})=>{let e=(0,ft.useRef)({x:0,y:0}),t=Je(),i=Le(),r=$(),[s,o]=(0,ft.useState)(),[h,l]=(0,ft.useState)(),c=re();return Dt(()=>{r&&s&&!h&&(r.pendingUpdate=!0)},[s,h]),qe(()=>{if(s&&t&&r){let d=t.getContext("2d");if(d){let{x:u,y:m,width:y,height:v}=r.worldToViewer(s.x,s.y,(h?h.x:e.current.x)-s.x,(h?h.y:e.current.y)-s.y);d.lineWidth=h?3:1,d.strokeStyle="#fff",d.strokeRect(u,m,y,v),d.lineWidth=h?3:1,d.strokeStyle="#000",d.strokeRect(u+1,m+1,y-2,v-2)}}},[s,h]),(0,ft.useEffect)(()=>{let d=u=>{if(i&&r){let{x:m,y}=r.viewerToWorld(u.clientX-i.left,u.clientY-i.top);e.current.x=~~m,e.current.y=~~y}};return t?(t.addEventListener("mousemove",d),()=>t.removeEventListener("mousemove",d)):()=>{}},[i,t,r]),(0,ft.useEffect)(()=>{let d=u=>{c==="sketch"&&(o({x:Math.round(e.current.x),y:Math.round(e.current.y)}),l(void 0))};return t?(t.addEventListener("mousedown",d),()=>t.removeEventListener("mousedown",d)):()=>{}},[t,c]),(0,ft.useEffect)(()=>{let d=u=>{s&&!h&&l({x:Math.round(e.current.x),y:Math.round(e.current.y)})};return t?(t.addEventListener("mouseup",d),()=>t.removeEventListener("mouseup",d)):()=>{}},[t,s,h]),(0,ft.useEffect)(()=>{s&&h&&n({x:Math.min(s.x,h.x),y:Math.min(s.y,h.y),width:Math.abs(h.x-s.x),height:Math.abs(h.y-s.y)})},[s,n,h]),null};var gt=q(require("react"),1);var Yi=require("react");async function Qi(n,e,t){if(Yi.version.startsWith("18.")){let i=await import("react-dom/client"),r=i.default?i.default.createRoot:i.createRoot;t.current||(t.current=r(n)),t.current.render(e)}else if(typeof ReactDOM<"u"){let{render:i,unmountComponentAtNode:r}=ReactDOM;i(e,n),t.current={unmount(){r(n)}}}else{let i=await import("react-dom"),r=i.default?i.default.render:i.render,s=i.default?i.default.unmountComponentAtNode:i.unmountComponentAtNode;r(e,n),t.current={unmount(){s(n)}}}}var ti=require("react/jsx-runtime"),ke=gt.default.forwardRef(({children:n,...e},t)=>{let i=(0,gt.useRef)(),r=$(),s=(0,gt.useRef)(0),o=(0,gt.useRef)(),h=(0,gt.useRef)();return Dt(()=>{if(e.relative){let l=i.current;if(l&&r){let c=r.getScaleFactor();s.current!==c&&(s.current=c,l.style.transformOrigin="0 0",l.style.transform=`scale(${1/s.current})`,l.style.width=`${s.current*100}%`,l.style.height=`${s.current*100}%`,i.current&&o.current?.__owner.value?.rotation&&(l.style.transform=`scale(${1/s.current}) translate(50%, 50%) rotate(${o.current?.__owner.value?.rotation||0}deg)  translate(-50%, -50%)`))}}},[e.relative]),(0,gt.useLayoutEffect)(()=>{let l=o.current;t&&l&&(typeof t=="function"?t(l):t.current=l);async function c(){if(l&&l.__host){let d=e.relative?(0,ti.jsx)("div",{ref:i,children:n}):n;await Qi(l.__host.element,d,h)}}l&&l.__host?c():l&&(l.__onCreate=c)},[t,n,o,e.relative]),(0,gt.useLayoutEffect)(()=>()=>{h.current&&setTimeout(()=>{h.current.unmount()},0)},[]),(0,ti.jsx)("box",{html:!0,...e,ref:o})});ke.displayName="HTMLPortal";var Ji=require("react");var pt=require("react");var j=require("react");var Ki=require("react");var De=(n,e,t=[])=>{let i=$(),r=i?i.world:void 0;(0,Ki.useEffect)(()=>{if(i){let s=e,o=nt[n];i.world.activatedEvents.push(o);let h=o.slice(2).toLowerCase();return i.world.addEventListener(h,s),()=>{i.world.removeEventListener(h,s)}}return()=>{}},[r,n,...t])};function ei(n,e){if(n===0)return[0,1];if(e===0)return[1,0];let t=Math.abs(n)/Math.abs(e);return[t,1-t]}var Fe=require("react");function qi(){let n=(0,Fe.useRef)({ctrl:!1,shift:!1,alt:!1});return(0,Fe.useLayoutEffect)(()=>{function e(i){i.key==="Shift"&&(n.current.shift=!0),i.key==="Control"&&(n.current.ctrl=!0),i.key==="Alt"&&(n.current.alt=!0)}function t(i){i.key==="Shift"&&(n.current.shift=!1),i.key==="Control"&&(n.current.ctrl=!1),i.key==="Alt"&&(n.current.alt=!1)}return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),n}var ii=(n,e)=>{let t=re(),i=$(),r=Le(),s=(0,j.useRef)(),o=(0,j.useRef)(null),h=(0,j.useRef)(),[l,c]=(0,j.useState)(!1),d=(0,j.useRef)(!1),u=(0,j.useRef)({north:0,south:0,east:0,west:0}),m=qi(),y=(0,j.useCallback)(f=>C=>{if(d.current=!0,c(!0),r&&i){let{top:R,left:w}=r,b=i.viewerToWorld(C.pageX-w,C.pageY-R);h.current={x:b.x,y:b.y},s.current=f}},[r,i]),v=(0,j.useMemo)(()=>n.width/n.height,[n.width,n.height]),S=(0,j.useCallback)(f=>{if(!Math.abs(f.north-f.south+(f.east-f.west)))return;let R=-f.west+f.east,w=-f.north+f.south,b=n.width+R,I=n.height+w;if(b/I>=v){let K=I*v,x=b-K,[_,L]=ei(f.east,f.west);f.west=f.west+x*L,f.east=f.east-x*_}else{let K=b/v,x=I-K,[_,L]=ei(f.north,f.south);f.north=f.north+x*_,f.south=f.south-x*L}},[n.width,n.height,v]);Dt(()=>{h&&i&&i.updateNextFrame()}),(0,j.useEffect)(()=>{i&&i.updateNextFrame()},[i,l]);let P=(0,j.useCallback)(f=>{if(!i||!r||i.mode!=="sketch")return;let{top:C,left:R}=r,w=i.viewerToWorld(f.pageX-R,f.pageY-C),b=o.current,I=!n.maintainAspectRatio&&m.current.alt,G=!I&&m.current.shift&&s.current?.indexOf("-")!==-1;if((s.current==="translate"||s.current==="east"||s.current==="north-east"||s.current==="south-east")&&(u.current.east=w.x-(h.current?h.current.x:0),I&&(u.current.west=-u.current.east)),(s.current==="translate"||s.current==="west"||s.current==="north-west"||s.current==="south-west")&&(u.current.west=w.x-(h.current?h.current.x:0),I&&(u.current.east=-u.current.west)),(s.current==="translate"||s.current==="north"||s.current==="north-east"||s.current==="north-west")&&(u.current.north=w.y-(h.current?h.current.y:0),I&&(u.current.south=-u.current.north)),(s.current==="translate"||s.current==="south"||s.current==="south-west"||s.current==="south-east")&&(u.current.south=w.y-(h.current?h.current.y:0),I&&(u.current.north=-u.current.south)),(n.maintainAspectRatio||G)&&S(u.current),b){let K=u.current.west,x=u.current.north,_=n.width+u.current.east,L=n.height+u.current.south;b.points[1]=Math.min(K,_),b.points[2]=Math.min(x,L),b.points[3]=Math.max(K,_),b.points[4]=Math.max(x,L),i.updateNextFrame()}},[i,n.width,n.height,n.maintainAspectRatio,r]);De("mousemove",P,[n.width,n.height,r]),De("pointermove",P,[n.width,n.height,r]);let g=(0,j.useRef)();return(0,j.useEffect)(()=>{g.current=()=>{if(d.current){let f=u.current.west,C=u.current.north,R=n.width+u.current.east,w=n.height+u.current.south,b=Math.min(f,R),I=Math.min(C,w),G=Math.max(f,R),K=Math.max(C,w),x={x:(n.x||0)+b,y:(n.y||0)+I,width:G-b||1,height:K-I||1};n.maintainAspectRatio,e(x),s.current=void 0,h.current=void 0,u.current.east=0,u.current.west=0,u.current.north=0,u.current.south=0,d.current=!1,c(!1)}}},[e,n.height,n.width,n.x,n.y]),(0,j.useEffect)(()=>{let f=()=>{g.current&&g.current()};return window.addEventListener("pointerup",f),window.addEventListener("touchend",f),()=>{window.removeEventListener("pointerup",f),window.removeEventListener("touchend",f)}},[]),{portalRef:o,mode:t,mouseEvent:y,onPointerMoveCallback:P,isEditing:l}};var z=require("react/jsx-runtime");function ni({handleSize:n,resizable:e,onSave:t,children:i,maintainAspectRatio:r,disableCardinalControls:s,...o}){let h=typeof n>"u"?r?10:8:n,{portalRef:l,mode:c,mouseEvent:d,isEditing:u}=ii({x:o.x||0,y:o.y||0,width:o.width,height:o.height,maintainAspectRatio:r},t),m=(0,pt.useMemo)(()=>d("translate"),[d]),y=(0,pt.useMemo)(()=>d("east"),[d]),v=(0,pt.useMemo)(()=>d("west"),[d]),S=(0,pt.useMemo)(()=>d("south"),[d]),P=(0,pt.useMemo)(()=>d("north"),[d]),g=(0,pt.useMemo)(()=>d("south-east"),[d]),f=(0,pt.useMemo)(()=>d("south-west"),[d]),C=(0,pt.useMemo)(()=>d("north-east"),[d]),R=(0,pt.useMemo)(()=>d("north-west"),[d]),w=c==="sketch",b={zIndex:999,boxShadow:"0px 2px 3px 0 rgba(0,0,0,0.2)",border:"1px solid rgba(155,155,155,.7)",borderRadius:r||s?"50%":2,position:"absolute",background:"#fff",pointerEvents:u?"none":w?"initial":"none"};return(0,z.jsx)(z.Fragment,{children:(0,z.jsxs)("world-object",{...o,children:[i,w&&e?(0,z.jsx)(ke,{ref:l,target:{x:0,y:0,height:o.height,width:o.width},relative:!0,interactive:!1,children:w&&e?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{onMouseDown:m,onTouchStart:m,style:{display:"block",width:"100%",height:"100%",position:"relative",border:"1px solid rgba(155,155,155, .7)",boxSizing:"border-box",pointerEvents:u?"none":w?"initial":"none"}}),r?null:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{title:"east",onTouchStart:y,onMouseDown:y,style:{...b,cursor:"e-resize",height:h*2,width:h,right:0,top:"50%",opacity:s?0:1,transform:`translate(${h/2}px, -${h}px)`}}),(0,z.jsx)("div",{title:"west",onMouseDown:v,style:{...b,cursor:"w-resize",position:"absolute",height:h*2,width:h,left:0,top:"50%",opacity:s?0:1,transform:`translate(-${h/2}px, -${h}px)`}}),(0,z.jsx)("div",{title:"north",onMouseDown:P,style:{...b,cursor:"n-resize",position:"absolute",height:h,width:h*2,left:"50%",top:0,opacity:s?0:1,transform:`translate(-${h}px, -${h/2}px)`}}),(0,z.jsx)("div",{title:"south",onMouseDown:S,style:{...b,cursor:"s-resize",position:"absolute",height:h,width:h*2,left:"50%",bottom:0,opacity:s?0:1,transform:`translate(-${h}px, ${h/2}px)`}})]}),(0,z.jsx)("div",{title:"north-east",onMouseDown:C,style:{...b,cursor:"ne-resize",position:"absolute",height:h,width:h,right:0,top:0,transform:`translate(${h/2}px, -${h/2}px)`}}),(0,z.jsx)("div",{title:"south-east",onMouseDown:g,style:{...b,cursor:"se-resize",position:"absolute",height:h,width:h,bottom:0,right:0,transform:`translate(${h/2}px, ${h/2}px)`}}),(0,z.jsx)("div",{title:"south-west",onMouseDown:f,style:{...b,cursor:"sw-resize",position:"absolute",height:h,width:h,bottom:0,left:0,transform:`translate(-${h/2}px, ${h/2}px)`}}),(0,z.jsx)("div",{title:"north-west",onMouseDown:R,style:{...b,cursor:"nw-resize",position:"absolute",height:h,width:h,top:0,left:0,transform:`translate(-${h/2}px, -${h/2}px)`}})]}):null}):null]})})}var ri=require("react/jsx-runtime");function kn({interactive:n,region:e,onClick:t,onSave:i,maintainAspectRatio:r,disableCardinalControls:s,isEditing:o,rotation:h,style:l={backgroundColor:"rgba(0,0,0,.5)"}}){let c=(0,Ji.useCallback)(d=>{i({id:e.id,x:e.x,y:e.y,height:e.height,width:e.width,...d})},[i,e.id,e.x,e.y,e.height,e.width]);return(0,ri.jsx)(ni,{x:e.x,y:e.y,rotation:h,width:e.width,height:e.height,resizable:o,onSave:c,maintainAspectRatio:r,disableCardinalControls:s,children:(0,ri.jsx)("box",{interactive:n,onContextMenu:d=>{d.preventDefault(),console.log("menu!")},onClick:d=>{d.preventDefault(),d.stopPropagation(),t(e)},target:{x:0,y:0,width:e.width,height:e.height},style:l})})}var Be=require("react"),Ft=require("react/jsx-runtime"),si=n=>{let e=n.width/(n.crop?.width||n.tiles.width),t=n.tiles.imageService.sizes||[],i=n.enableThumbnail,r=n.enableSizes,s=(0,Be.useMemo)(()=>{let l=n.tiles.imageService.id||n.tiles.imageService["@id"];return l&&l.endsWith("/info.json")?l.slice(0,-1*10):l},[n.tiles.imageService.id]),o=(0,Be.useMemo)(()=>{let l=n.tiles.imageService.tiles||[];if(!l.length){let c=n.width,d=[1],u=1;for(;Math.pow(2,u)<c;)u=u*2,d.push(u);return[]}return l},[n.tiles.imageService]),h=(0,Be.useMemo)(()=>{let l=n.tiles.imageService;return(l?l["@context"]?Array.isArray(l["@context"])?l["@context"]:[l["@context"]]:[]:[]).indexOf("http://iiif.io/api/image/3/context.json")!==-1},[n.tiles.imageService.id]);return(0,Ft.jsx)("world-object",{rotation:n.rotation,scale:e,height:n.crop?.height||n.tiles.height,width:n.crop?.width||n.tiles.width,x:n.x,y:n.y,onClick:n.onClick,children:(0,Ft.jsxs)("composite-image",{id:n.tiles.imageService.id,width:n.crop?.width||n.tiles.width,height:n.crop?.height||n.tiles.height,crop:n.crop,renderOptions:n.renderOptions,children:[i&&n.tiles.thumbnail?(0,Ft.jsx)("world-image",{priority:!0,uri:n.tiles.thumbnail.id,target:{width:n.tiles.width,height:n.tiles.height},display:{width:n.tiles.thumbnail.width,height:n.tiles.thumbnail.height},crop:n.crop}):null,r&&t.map((l,c)=>(0,Ft.jsx)("world-image",{uri:`${s}/full/${l.width},${l.height}/0/default.jpg`,target:{width:n.tiles.width,height:n.tiles.height},display:{width:l.width,height:l.height},crop:n.crop},c)),o.map(l=>(l.scaleFactors||[]).map(c=>(0,Ft.jsx)("tiled-image",{uri:n.tiles.imageService.id,display:{width:n.tiles.width,height:n.tiles.height},tile:l,scaleFactor:c,crop:n.crop,version3:h},`${n.tiles.imageService.id}-tile-${c}`)))]},n.tiles.imageService.id)},n.tiles.imageService.id)};var Ne=require("react");function oi(n){return n.id||n["@id"]}var tn=require("@atlas-viewer/iiif-image-api"),en=require("@iiif/helpers/thumbnail");function Dn(){return typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}}function Fn(){let n=Dn();if(typeof n.IIIF_VAULT<"u")return n.IIIF_VAULT;if(typeof n.IIIFVault>"u")throw new Error("Vault not found");return n.IIIF_VAULT=new n.IIIFVault.Vault,n.IIIF_VAULT}var Bt={};function me(){return Bt.helper||(Bt.vault=Fn(),Bt.loader=new tn.ImageServiceLoader,Bt.helper=(0,en.createThumbnailHelper)(Bt.vault,{imageServiceLoader:Bt.loader})),Bt}async function We(n,e,t){let{loader:i}=me(),r=await i.loadService({id:n,width:e,height:t});return{id:oi(r),width:e,height:t,imageService:r,thumbnail:void 0}}async function nn(n,e=512){let{vault:t,loader:i,helper:r}=me(),s=[];for(let o of n.items)for(let h of t.get(o).items){let c=t.get(t.get(h).body[0]).service[0],d=await We(c.id,n.width,n.height),{best:u}=await r.getBestThumbnailAtSize(t,i,n,{maxHeight:e,maxWidth:e},!0);u&&(d.thumbnail=u),s.push(d)}return s}async function rn(n){let{vault:e}=me(),t=[];for(let i of n.items){let r=e.get(i);t.push(...await nn(r))}return t}async function Bn(n){try{let{vault:e}=me(),t=await e.loadManifest(n);return t?rn(t):[]}catch(e){return console.log("ERR",e),[]}}var ai=require("react/jsx-runtime"),Wn=n=>{let[e,t]=(0,Ne.useState)();return(0,Ne.useEffect)(()=>{We(n.id,n.width,n.height).then(i=>{t(i)})},[n.height,n.id,n.width]),(0,ai.jsx)("world-object",{x:n.x||0,y:n.y||0,width:n.width,height:n.height,scale:n.scale,children:e?(0,ai.jsx)(si,{tiles:e,x:n.x,y:n.y,width:n.crop?.width||n.width,height:n.crop?.height||n.height,rotation:n.rotation,crop:n.crop,enableSizes:n.enableSizes,enableThumbnail:n.enableThumbnail,renderOptions:n.renderOptions,children:n.children}):null})};var sn=require("react"),Nn=(n,e=[])=>{let t=$();(0,sn.useEffect)(()=>t?t.registerHook("useAfterPaint",n):()=>{},e)};var U=require("react");var ze=require("react/jsx-runtime"),zn=(n,{onCreated:e,resetWorldOnChange:t=!0,mode:i="explore",cover:r,containerRef:s,...o})=>{let[h,l]=(0,U.useState)(!1),[c,d]=(0,U.useState)(void 0),[u,m]=(0,U.useState)(void 0),y=(0,U.useRef)(),v=(0,U.useRef)(),S=(0,U.useMemo)(()=>({width:o.width,height:o.height}),[o.width,o.height]),[P,g,f,C]=Ae(void 0,{width:o.width,height:o.height});J(()=>{let w=document.createElement("canvas");w.height=S.height,w.width=S.width,y.current=w},[]),J(()=>{let w=y.current;w&&(w.height=S.height,w.width=S.width)},[S.width,S.height]),(0,U.useEffect)(()=>g?g.runtime.registerHook("useAfterFrame",()=>{if(y.current)try{d(y.current.toDataURL())}catch(b){b instanceof Error&&m(b.message)}}):()=>{},[]),(0,U.useEffect)(()=>g?g.runtime.world.addLayoutSubscriber(b=>{b==="ready"&&l(!0)}):()=>{},[]),(0,U.useEffect)(()=>{g&&g.em&&g.em.updateBounds()},[S]),(0,U.useEffect)(()=>{g&&(g.runtime.mode=i)},[i]),(0,U.useEffect)(()=>{if(g){let w=g.runtime;w.resize(f.current.width,o.width,f.current.height,o.height),r?w.cover():w.goHome(),f.current.width=o.width,f.current.height=o.height,w.updateNextFrame()}},[o.width,o.height]),J(()=>{let w=v.current;w&&(w.style.width=`${S.width}px`,w.style.height=`${S.height}px`,w.style.pointerEvents="none",w.style.overflow="hidden")},[S.height,S.width]),J(()=>{let w=()=>{if(g&&g.runtime){let b=g.runtime;b.resize(f.current.width,o.width,f.current.height,o.height),f.current.width=o.width,f.current.height=o.height,b.updateNextFrame()}};return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[g,o.height,o.width]);let R=(0,U.useCallback)(function(b){let I=()=>{g&&(g.ready=!0)};return(0,U.useEffect)(()=>{if(g){let G=e&&e(g);return void(G&&G.then?G.then(I):I())}return()=>{}},[]),b.children},[g]);return(0,U.useEffect)(()=>{if(g&&g.runtime){let w=g.runtime;if(t)return w.world.addLayoutSubscriber(b=>{b==="recalculate-world-size"&&w.goHome({cover:r})})}return()=>{}},[g,r,t]),J(()=>{g&&$t.render((0,ze.jsx)(R,{children:(0,ze.jsx)(ct.Provider,{value:i,children:(0,ze.jsx)(ut.Provider,{value:g,children:n})})}),g.runtime)},[g,i,n]),{loading:!c&&h,uri:c,imageError:u}};var on=require("react"),Hn=(n,e=[])=>{let t=$();(0,on.useEffect)(()=>t?t.registerHook("useBeforeFrame",n):()=>{},e)};var bt=require("react");var jn=(n=[])=>{let[e,t]=(0,bt.useState)(n),[i,r]=(0,bt.useState)(!1),[s,o]=(0,bt.useState)(),h=(0,bt.useCallback)(()=>{r(!0),o(void 0)},[]),l=(0,bt.useCallback)(m=>{r(!0),o(m)},[]),c=m=>{t(y=>y.map(v=>v.id===m.id?m:v))},d=(0,bt.useCallback)(m=>{let y=at();t(v=>[...v,{id:y,...m}]),r(!1),o(void 0)},[]),u=(0,bt.useCallback)(()=>{r(!1),o(void 0)},[]);return{isEditing:i,onDeselect:u,selectedAnnotation:s,onCreateNewAnnotation:d,annotations:e,onUpdateAnnotation:c,setIsEditing:r,setSelectedAnnotation:o,editAnnotation:l,addNewAnnotation:h}};function Un(n){return n.current==="sketch"}function $n(n,e){return n?e?{...n,...e||{},":hover":n[":hover"]?Object.assign(n[":hover"]||{},e[":hover"]||{}):e[":hover"],":active":n[":active"]?Object.assign(n[":active"]||{},e[":active"]||{}):e[":hover"]}:n:e}
