"use strict";var Va=Object.create;var Yt=Object.defineProperty;var La=Object.getOwnPropertyDescriptor;var za=Object.getOwnPropertyNames;var Oa=Object.getPrototypeOf,Ha=Object.prototype.hasOwnProperty;var Ba=(e,t)=>{for(var n in t)Yt(e,n,{get:t[n],enumerable:!0})},_t=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of za(t))!Ha.call(e,o)&&o!==n&&Yt(e,o,{get:()=>t[o],enumerable:!(r=La(t,o))||r.enumerable});return e},g=(e,t,n)=>(_t(e,t,"default"),n&&_t(n,t,"default")),Q=(e,t,n)=>(n=e!=null?Va(Oa(e)):{},_t(t||!e||!e.__esModule?Yt(n,"default",{value:e,enumerable:!0}):n,e)),Da=e=>_t(Yt({},"__esModule",{value:!0}),e);var p={};Ba(p,{AnnotationContext:()=>Ls,AnnotationPageContext:()=>zs,AnnotationStyleProvider:()=>Ms,Auth:()=>tr,AuthProvider:()=>Jn,AuthRContext:()=>Ne,AuthReactContext:()=>No,AuthReactContextActions:()=>Vo,CanvasAnnotations:()=>vs,CanvasContext:()=>re,CanvasPanel:()=>F,CanvasStrategyProvider:()=>Mr,CanvasWorldObject:()=>Er,CollectionContext:()=>Os,CombinedMetadata:()=>Ss,ComplexTimelineProvider:()=>Hr,ContextBridge:()=>sr,ControlsReactContext:()=>Lt,CreateCustomShape:()=>uo,CustomContextBridge:()=>Yo,CustomContextBridgeProvider:()=>Za,EventsProvider:()=>Xa,Image:()=>ga,ImageService:()=>Ns,ImageServiceLoaderContext:()=>Ji,InnerViewerProvider:()=>Fo,LanguageProvider:()=>cs,LanguageString:()=>Hi,LocaleString:()=>te,ManifestContext:()=>$n,ManifestMetadata:()=>Cs,MediaPlayerProvider:()=>Ht,Metadata:()=>$t,PolygonSelector:()=>Es,RangeContext:()=>Wn,ReactEventContext:()=>Ve,ReactVaultContext:()=>ve,Render3DModelStrategy:()=>Ur,RenderAccompanyingCanvas:()=>Qr,RenderAnnotationStrategy:()=>_r,RenderAudioStrategy:()=>jr,RenderComplexTimelineStrategy:()=>Dr,RenderEmptyStrategy:()=>Nr,RenderImageStrategy:()=>$r,RenderSvgEditorControls:()=>Ts,RenderTextualContentStrategy:()=>Fr,RenderVideoStrategy:()=>Xr,RenderYouTubeStrategy:()=>Zr,ResourceProvider:()=>W,ResourceReactContext:()=>mt,SelectorControllerProvider:()=>Is,SequenceThumbnails:()=>Ps,SimpleViewerProvider:()=>rr,SimpleViewerReactContext:()=>Je,SingleCanvasThumbnail:()=>to,StrategyReactContext:()=>Vt,ThumbnailFallbackImage:()=>We,TranslationProvider:()=>ss,TransliterationProvider:()=>ls,VaultProvider:()=>we,ViewerPresetContext:()=>oe,VirtualAnnotationProvider:()=>mr,VisibleCanvasReactContext:()=>Me,authDetailsForResource:()=>Gn,createAuthStateStore:()=>jn,createProbe:()=>Qn,defaultEmitter:()=>Wo,emptyActions:()=>vr,emptyStrategy:()=>Sr,findAllCanvasesInRange:()=>Qt,findFirstCanvasFromRange:()=>Io,findManifestSelectedRange:()=>qa,findSelectedRange:()=>Un,flattenAnnotationPageIds:()=>xr,formatTime:()=>hn,get3dStrategy:()=>Rr,getComplexTimelineStrategy:()=>Ar,getDefaultAnnotationStyles:()=>io,getImageStrategy:()=>Mt,getManifestSequence:()=>Gt,getParsedTargetSelector:()=>Pt,getRenderingStrategy:()=>Ir,getTextualContentStrategy:()=>Et,getVideoStrategy:()=>Nt,getVisibleCanvasesFromCanvasId:()=>$a,hasAuth:()=>Wa,makeAccessServiceRequest:()=>Yn,makeAccessTokenRequest:()=>Xt,parseSpecificResource:()=>Ja,svgThemes:()=>Ra,unknownResponse:()=>At,unsupportedStrategy:()=>E,useAnnotation:()=>bt,useAnnotationPage:()=>hr,useAnnotationPageManager:()=>It,useAnnotationStyles:()=>so,useAnnotationsAtTime:()=>Hs,useAuthActions:()=>Lo,useAuthService:()=>zo,useAuthStore:()=>Xe,useAuthToken:()=>_a,useAuthTokens:()=>Xn,useCanvas:()=>P,useCanvasChoices:()=>Bs,useCanvasClock:()=>Ds,useCanvasSequence:()=>_n,useCanvasStartTime:()=>Bt,useCanvasSubset:()=>Fs,useClosestLanguage:()=>Di,useCollection:()=>qs,useComplexTimeline:()=>ds,useContextBridge:()=>ar,useCreateLocaleString:()=>us,useCurrentAuth:()=>Ua,useCustomContextBridge:()=>ir,useDispatch:()=>cr,useEventEmitter:()=>St,useEventListener:()=>$s,useExistingVault:()=>ke,useExternalCollection:()=>Ws,useExternalManifest:()=>qn,useExternalResource:()=>ft,useIIIFLanguage:()=>yn,useImage:()=>Nn,useImageService:()=>po,useImageServiceLoader:()=>Ot,useImageTile:()=>Us,useIsAuthEnabled:()=>er,useLoadImageService:()=>kt,useLocaleString:()=>Fi,useManifest:()=>z,useMediaActions:()=>ps,useMediaElements:()=>gs,useMediaState:()=>fs,usePaintables:()=>br,usePaintingAnnotations:()=>Oe,usePolygonHelper:()=>co,useRange:()=>pt,useRenderControls:()=>_,useRenderingStrategy:()=>wr,useResourceContext:()=>$,useResourceEvents:()=>Ct,useResources:()=>Cr,useSearchService:()=>nr,useSelectorController:()=>oo,useSelectorEmitter:()=>ws,useSelectorEvents:()=>ro,useSelectorHelper:()=>ks,useSimpleMediaPlayer:()=>Be,useSimpleViewer:()=>vt,useStrategy:()=>V,useStyleHelper:()=>_s,useStyles:()=>ze,useSvgEditor:()=>lo,useThumbnail:()=>he,useTranslations:()=>Lr,useTransliteration:()=>Vr,useVault:()=>T,useVaultEffect:()=>qr,useVaultSelector:()=>w,useViewerPreset:()=>xt,useVirtualAnnotationPage:()=>lr,useVirtualAnnotationPageContext:()=>ur,useVisibleCanvases:()=>Ee});module.exports=Da(p);var Ye=require("react");var U=Q(require("react"),1),on=require("@atlas-viewer/atlas"),Jo=require("react-error-boundary");var ee=require("react");var je=Q(require("react"),1),yo=require("react/jsx-runtime"),Fa={collection:void 0,manifest:void 0,range:void 0,canvas:void 0,annotation:void 0,annotationPage:void 0},mt=je.default.createContext(Fa),$=()=>(0,je.useContext)(mt);function W({value:e,children:t}){let n=$(),r=(0,je.useMemo)(()=>({...n,...e}),[e,n]);return(0,yo.jsx)(mt.Provider,{value:r,children:t})}var Kt=Q(require("react"),1),dt=require("@iiif/helpers/vault");var Fn=require("react/jsx-runtime"),ve=Kt.default.createContext({vault:null,setVaultInstance:e=>{}});function we({vault:e,vaultOptions:t,useGlobal:n,resources:r,children:o}){let[a,i]=(0,Kt.useState)(()=>e||(n?(0,dt.globalVault)(t):t?new dt.Vault(t):new dt.Vault));return(0,Fn.jsx)(ve.Provider,{value:{vault:a,setVaultInstance:i},children:(0,Fn.jsx)(W,{value:r||{},children:o})})}var Do=require("react"),Jt=require("react");var vo=require("@iiif/helpers/vault"),So=require("react");function ke(e){let t=(0,So.useContext)(ve);return e||(t&&t.vault?t.vault:(0,vo.globalVault)())}var Se=require("react");function ft(e,{noCache:t=!1}={}){let n=typeof e=="string"?e:e.id,r=ke(),[o,a]=(0,Se.useState)(n),[i,s]=(0,Se.useState)(void 0),u=(0,Se.useMemo)(()=>r.get(n,{skipSelfReturn:!0})||void 0,[n,r]),[c,l]=(0,Se.useState)(u);return(0,Se.useEffect)(()=>{(async()=>{try{let d=u&&!t?u:await r.load(n),h=d?d.id||d["@id"]:null;d&&o!==h&&a(h),l(d)}catch(d){s(d)}})()},[n,t]),{isLoaded:!!c,id:o,requestId:n,error:i,resource:c,cached:!!(c&&c===u)}}function qn(e,t){let{id:n,isLoaded:r,error:o,resource:a,requestId:i,cached:s}=ft(e,t);return{id:n,isLoaded:r,error:o,manifest:a,requestId:i,cached:s}}var xo=require("react/jsx-runtime");function $n({manifest:e,children:t}){return(0,xo.jsx)(W,{value:{manifest:e},children:t})}var Co=require("react/jsx-runtime");function re({canvas:e,children:t}){return(0,Co.jsx)(W,{value:{canvas:e},children:t})}var Ro=require("react"),Po=Q(require("react"),1);var bo=require("react"),T=()=>{let{vault:e}=(0,bo.useContext)(ve);if(e===null)throw new Error("Vault not found. Ensure you have your provider set up correctly.");return e};var jt=require("react");function w(e,t=[]){let n=T(),[r,o]=(0,jt.useState)(()=>e(n.getState(),n));return(0,jt.useEffect)(()=>n.subscribe(a=>e(a,n),a=>{o(a)},!1),t),r}var Me=Po.default.createContext([]);function Ee(){let e=(0,Ro.useContext)(Me);return w(t=>e.map(n=>t.iiif.entities.Canvas[n]).filter(Boolean),[e])}var Ao=require("react");function z(e={},t=[]){let{id:n,selector:r}=e,o=$(),a=T(),i=n||o.manifest,s=w(u=>i?u.iiif.entities.Manifest[i]:void 0,[i]);return(0,Ao.useMemo)(()=>{if(s)return r?r(s):s},[s,r,...t])}var To=require("react/jsx-runtime");function Wn({range:e,children:t}){return(0,To.jsx)(W,{value:{range:e},children:t})}function Io(e,t){for(let n of t.items){if(n.type==="Canvas")return n;if(n.type==="SpecificResource")return n.source;if(n.type==="Range"){let r=Io(e,e.get(n));if(r)return r}}return null}function Qt(e,t){let n=[];for(let r of t.items)if(r.type==="SpecificResource"&&r.source?.type==="Canvas"&&(r.source.id.indexOf("#")!==-1?n.push({id:r.source.id.split("#")[0],type:"Canvas"}):n.push(r.source)),r.type==="Range"&&n.push(...Qt(e,e.get(r))),r.type==="SpecificResource"){let o=typeof r.source=="string"?r.source:r.source.id;n.push({id:o,type:"Canvas"})}return n}function qa(e,t,n){for(let r of t.structures){let o=Un(e,e.get(r),n);if(o)return o}return null}function Un(e,t,n){for(let r of t.items){let o=r?.source?.id?.split("#")[0];if(r.type==="SpecificResource"&&r.source===n||r.type==="SpecificResource"&&r.source?.type==="Canvas"&&n===o)return t;if(r.type==="Range"){let a=Un(e,e.get(r),n);if(a)return a}}return null}function $a(e,t,n,r=!1){let o=t.behavior,a=n?e.get(n):null;if(!a)return[];let i=a.behavior,s=r?!1:o.includes("paged"),u=s?!1:o.includes("continuous"),c=s||u?!1:o.includes("individuals"),l=i.includes("facing-pages"),d=i.includes("non-paged");if(l||d||c||r)return[{id:a.id,type:"Canvas"}];let[h,S]=Gt(e,t);if(u)return h;let v=h.findIndex(f=>f.id===n);if(v===-1)return[];for(let f of S)if(f.includes(v))return f.map(x=>h[x]);return[{id:a.id,type:"Canvas"}]}function Gt(e,t,{disablePaging:n,skipNonPaged:r}={}){let o=t.behavior,a=o.includes("paged"),i=a?!1:o.includes("continuous"),s=a||i?!1:o.includes("individuals"),u=t.type==="Manifest"?t.items:Qt(e,t);if(i)return[u,[u.map((v,f)=>f)]];if(s||!a||n)return[u,u.map((v,f)=>[f])];let c=[],l=[],d=()=>{l.length&&(c.push([...l]),l=[])},h=0,S=!1;for(let v=0;v<u.length;v++){let f=e.get(u[v]);if(f.behavior.includes("non-paged")){v===h&&h++,r||(d(),c.push([v]),d());continue}if(v===h||f.behavior.includes("facing-pages")){l.length&&(S=!0),d(),c.push([v]),d();continue}if(l.push(v),S){d(),S=!1;continue}l.length>1&&d()}return l.length&&d(),[u,c]}var ae=require("react");var wo=require("react");function pt(e={},t=[]){let{id:n,selector:r}=e,o=$(),a=n||o.range,i=w(s=>a?s.iiif.entities.Range[a]:void 0,[a]);return(0,wo.useMemo)(()=>{if(i)return r?r(i):i},[i,r,...t])}function _n({startCanvas:e,disablePaging:t}){let n=T(),r=z(),o=pt(),[a,i]=(0,ae.useState)(void 0),s=o||r;if(!s)throw new Error("Nothing selected");let[u,c]=(0,ae.useMemo)(()=>Gt(n,s,{disablePaging:t}),[n,s,t]),l=(0,ae.useRef)(c);if(l.current!==c){let x=l.current[a][0],y=c.findIndex(C=>C.includes(x));l.current=c,i(y)}let d=(0,ae.useCallback)(f=>{let x=c.findIndex(y=>y.includes(f));i(x===-1?0:x)},[u,c]),h=(0,ae.useCallback)(f=>{let x=u.findIndex(y=>y.id===f);x!==-1?d(x):i(0)},[u,c]),S=(0,ae.useCallback)(()=>{i(f=>f>=c.length-1?f:f+1)},[c]),v=(0,ae.useCallback)(()=>{i(f=>f<=0?0:f-1)},[c]);return typeof a>"u"&&(e?h(e):i(0)),{visibleItems:c[a]?.map(f=>u[f].id)||[],cursor:a,items:u,sequence:c,hasPrevious:a>0,hasNext:a<c.length-1,setSequenceIndex:i,setCanvasIndex:d,setCanvasId:h,next:S,previous:v}}var ce=require("react"),Ge=require("zustand");var Kn=require("zustand/vanilla");function Wa(e){let t=e.service||e.services||[];for(let n of t)if(n.type==="AuthProbeService2")return!0;return!1}function se(e,t,n){let r=t.findIndex(i=>i.service.id===e);if(r===-1)return t;let o=[...t],a=n(o[r]);return a===o[r]?t:(o[r]=a,o)}var jn=()=>(0,Kn.createStore)((e,t)=>({currentAuth:-1,authItems:[],login:()=>{let n=t().authItems[t().currentAuth];if(!n||n.isPending||n.isLoggedIn)return;if(n.type!=="active")throw new Error("Cannot login to non-active service");let r=n.service.service.find(o=>o.type==="AuthAccessTokenService2");if(!r)throw new Error("Token service not found");e(()=>({authItems:se(n.id,t().authItems,o=>({...o,isPending:!0}))})),Yn(n.service).then(()=>{Xt(r).then(o=>{let a=o.expiresIn,i=Date.now()+a*1e3;e(()=>({authItems:se(n.id,t().authItems,s=>({...s,isLoggedIn:!0,isPending:!1,session:{token:o.accessToken,expires:i}}))}))}).catch(o=>{e(()=>({authItems:se(n.id,t().authItems,a=>({...a,isLoggedIn:!1,isPending:!1,error:o.message}))}))})})},logout:()=>{let n=t().authItems[t().currentAuth];if(!n||n.isPending||!n.isLoggedIn)return;if(n.type!=="active")throw new Error("Cannot logout of non-active service");let r=n.service.service.find(i=>i.type==="AuthLogoutService2");if(!r)return;let o=`${r.id}?origin=${ko()}`,a=window.open(o);e(()=>({authItems:se(n.id,t().authItems,i=>({...i,isLoggedIn:!1,session:null,isPending:!1}))}))},nextAuth:()=>{let n=t().authItems.length,r=t().currentAuth+1;r>=n||e(()=>({currentAuth:r}))},previousAuth:()=>{let n=t().currentAuth-1;n<0||e(()=>({currentAuth:n}))},setAuth:n=>{n!==-1&&(n<0||n>=t().authItems.length)||e(()=>({currentAuth:n}))},addService:(n,r)=>{if(!n.service)return;let o=n.service.find(s=>s.type==="AuthAccessTokenService2"),a=n;if(t().authItems.find(s=>s.service.id===n.id)){e(()=>({authItems:se(n.id,t().authItems,s=>({...s,instances:s.instances+1}))}));return}if(e(()=>({currentAuth:a.profile==="active"?0:t().currentAuth,authItems:[{id:n.id,type:n.profile,service:n,probeId:r,canAuthenticate:!0,instances:1,isPending:!1,isLoggedIn:!1,session:null},...t().authItems]})),n.profile==="external"){if(!o)throw new Error("Token service not found");Xt(o).then(s=>{e(()=>({authItems:se(n.id,t().authItems,u=>({...u,isLoggedIn:!0,isPending:!1,session:{token:s.accessToken,expires:s.expiresIn}}))}))}).catch(s=>{e(()=>({authItems:se(n.id,t().authItems,u=>({...u,isLoggedIn:!1,isPending:!1,canAuthenticate:!1,error:s.message}))}))})}if(n.profile==="kiosk"){if(!o)throw new Error("Token service not found");e(()=>({authItems:se(n.id,t().authItems,s=>({...s,isPending:!0}))})),Yn(a).then(()=>{Xt(o).then(s=>{e(()=>({authItems:se(n.id,t().authItems,u=>({...u,isLoggedIn:!0,isPending:!1,session:{token:s.accessToken,expires:s.expiresIn}}))}))}).catch(s=>{e(()=>({authItems:se(n.id,t().authItems,u=>({...u,isLoggedIn:!1,isPending:!1,error:s.message}))}))})})}n.profile},removeService:(n,r)=>{let o=t().currentAuth===t().authItems.findIndex(i=>i.service.id===n.id),a=t().currentAuth;if(o){let i=t().authItems.find(u=>u.service.id===n.id);i&&i.instances>1||(a=t().authItems.findIndex(c=>c.service.id!==n.id&&c.instances>0))}e(()=>({authItems:se(n.id,t().authItems,i=>({...i,instances:i.instances-1})),currentAuth:a}))}})),Qn=(e,t)=>(0,Kn.createStore)((n,r)=>({service:e,status:e?"unknown":"success",shouldRedirect:!1,redirectResource:null,shouldSubstitute:!1,substituteResource:null,error:null,errorHeading:null,errorNote:null,shouldDisplayResource:!1,token:t||null,async probe(){if(!r().service)return;let o=r().service?.id;if(!o){n({status:"error",error:"Service ID not found",errorHeading:{en:["Service ID not found"]}});return}n({status:"probing"});let a=r().token;try{let i=await fetch(o,{headers:a?{Authorization:`Bearer ${r().token}`,Accept:"application/json"}:{Accept:"application/json"}}).then(s=>s.json());if(i.status===200)n({status:"success",shouldDisplayResource:!0,error:null,errorHeading:null,errorNote:null,shouldSubstitute:!1,shouldRedirect:!1});else if(i.status<400&&i.status>=300){if(!i.location)throw new Error("Redirect location not found");n({status:"error",shouldDisplayResource:!1,shouldRedirect:!0,redirectResource:i.location||null})}else if(i.status===401)n({status:"error",shouldDisplayResource:!1,shouldRedirect:!1,shouldSubstitute:!!i.substitute,substituteResource:i.substitute||null,error:"Unauthorized",errorHeading:i.heading||{en:["Unauthorized"]},errorNote:i.note||null});else throw new Error("Unknown error")}catch(i){n({status:"error",error:i.message,errorHeading:{en:["Unknown error"]}})}},setToken(o){n({token:o})}}));function Gn(e){let t=e.service||e.services||[],n={hasAuth:!1,services:{}};for(let r of t)if(r.type==="AuthProbeService2"){n.services.probe=r,n.hasAuth=!0;let o=r.service.filter(a=>a.type==="AuthAccessService2");o[0]&&(n.services.access=o[0])}return n}async function Xt(e,{strict:t=!0}={}){return new Promise((n,r)=>{let o=Math.random().toString(36).substring(7),a=`${e.id}?messageId=${o}&origin=${window.location.origin}`,i=c=>{let l=c.data;if(l.messageId===o){if(t&&l.type!=="AuthAccessToken2"){s(),r("Invalid response, expected type=AuthAccessToken2");return}if(!l.accessToken){s(),r("Invalid response, expected accessToken");return}s(),n(l)}},s=()=>window.removeEventListener("message",i),u=document.createElement("iframe");u.src=a,u.style.display="none",document.body.appendChild(u),window.addEventListener("message",i)})}function ko(e){let t=window.location;if(e){let n=document.createElement("a");return n.href=e,n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")}return t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}async function Yn(e){let t=`${e.id}?origin=${ko()}`,n=window.open(t);if(!n)throw new Error("Failed to open window");return new Promise((r,o)=>{let a=setInterval(()=>{n.closed&&(clearInterval(a),r())},500)})}var Qe=require("react");var Mo=require("zustand");function Eo(e){let t=(0,Qe.useMemo)(()=>Gn(e),[e]),n=Xn(t.services.access?.id),r=(0,Qe.useMemo)(()=>Qn(t.services.probe,n),[t.services.probe]),o=(0,Mo.useStore)(r);return(0,Qe.useEffect)(()=>{o.status==="unknown"&&!n&&o.probe()},[t.services.probe,o.status]),(0,Qe.useEffect)(()=>{n&&(o.setToken(n),o.probe())},[n]),[e,o,t.hasAuth]}var gt=require("react/jsx-runtime"),Ne=(0,ce.createContext)(null),No=(0,ce.createContext)(null);No.displayName="CurrentAuth";var Vo=(0,ce.createContext)(null);Vo.displayName="AuthActions";function Jn({children:e}){let t=(0,ce.useMemo)(()=>jn(),[]);return(0,gt.jsx)(Ne.Provider,{value:t,children:e})}function er(){return!!(0,ce.useContext)(Ne)}function Xe(){let e=(0,ce.useContext)(Ne);if(!e)throw new Error("useAuthActions must be used within a AuthProvider");return e}function Lo(){let e=Xe();return(0,Ge.useStore)(e,n=>({login:n.login,logout:n.logout,nextAuth:n.nextAuth,previousAuth:n.previousAuth,setAuth:n.setAuth,addService:n.addService,removeService:n.removeService}))}function Ua(){let e=Xe();return(0,Ge.useStore)(e,t=>t)}function zo(e){let t=Xe();return(0,Ge.useStore)(t,r=>r.authItems.find(o=>o.service.id===e))}function Xn(e){let t=Xe();return(0,Ge.useStore)(t,r=>r.authItems.find(o=>o.id===e)?.session?.token)}function _a(e){let t=Xe();return(0,Ge.useStore)(t,r=>{let o=r.authItems.find(a=>a.service.id===e);return!o||!o.isLoggedIn||!o.session?null:o.session?.token||null})}function Ya(e){let t=Lo(),n=zo(e.service.id);return(0,ce.useEffect)(()=>(t?.addService(e.service,e.probeId),()=>{t?.removeService(e.service,e.probeId)}),[e.service]),n?(n.error||!n.isLoggedIn,e.children):null}function Zn(){return null}function tr(e){let[t,n,r]=Eo(e.resource),o=e.fallbackComponent||Zn,a=e.loadingComponent||Zn,i=e.errorComponent||Zn,s=n.service,u=null;if(!r||!s)return e.children(t);let c=s.service.filter(l=>l.type==="AuthAccessService2");n.status==="error"&&(u=(0,gt.jsx)(i,{resource:e.resource,error:n.error||"",heading:n.errorHeading,note:n.errorNote,extra:e.extra})),(n.status==="unknown"||n.status==="probing")&&(u=(0,gt.jsx)(a,{})),n.status==="success"&&(u=e.children(t));for(let l of c)u=(0,gt.jsx)(Ya,{service:l,probeId:s.id,children:u},l.id);return u}var ht=require("react");var Oo=require("zustand/vanilla"),Ka=e=>e.id||e["@id"];function ja(e){return(Array.isArray(e.service)?e.service:[e.service]).find(n=>n.profile==="http://iiif.io/api/search/0/autocomplete"||n.profile==="http://iiif.io/api/search/1/autocomplete"||n.profile==="AutoCompleteService1")}var Ho=e=>{let t;typeof e=="string"?t={"@context":"http://iiif.io/api/search/1/context.json",profile:"http://iiif.io/api/search/1/search","@id":e,id:e,service:[]}:t=e;let n=t?Ka(t):void 0,r=null;return(0,Oo.createStore)((o,a)=>({service:t,resources:[],lastQuery:{},loading:!1,error:!1,highlight:null,hasSearch:!!t,hasAutocomplete:t?!!ja(t):!1,errorMessage:"",search(i,s={}){if(!n)throw new Error("No search service found.");r&&!r.signal.aborted&&r.abort(),r=new AbortController;let u=new URLSearchParams;i.q&&u.set("q",i.q),i.motivation&&u.set("motivation",i.motivation),i.date&&u.set("date",i.date),i.user&&u.set("user",i.user),o({loading:!0}),fetch(`${n}?${u.toString()}`,{signal:r.signal,headers:{"Content-Type":"application/json",Accept:"application/json",...s.headers||{}}}).then(async c=>{if(!r?.signal.aborted)if(c.ok){let l=await c.json();o({resources:l.resources,error:!1,errorMessage:""})}else o({resources:[],error:!0,errorMessage:c.statusText})})},clearSearch(){o({resources:[],error:!1,errorMessage:""})},highlightResult(i){let s=a().resources.find(u=>u["@id"]===i);o({highlight:s})},nextResult(){let i=a().resources,s=a().highlight;if(!s){o({highlight:i[0]||null});return}let u=i.findIndex(c=>c["@id"]===s["@id"]);if(u===-1){o({highlight:i[0]||null});return}o({highlight:i[u+1]||i[0]||null})},previousResult(){let i=a().resources,s=a().highlight;if(!s){o({highlight:i[i.length-1]||null});return}let u=i.findIndex(c=>c["@id"]===s["@id"]);if(u===-1){o({highlight:i[i.length-1]||null});return}if(u===0){o({highlight:i[i.length-1]||null});return}o({highlight:i[u-1]||i[i.length-1]||null})}}))};var Qa=require("zustand");function nr(){let e=z();return e?e.service.find(t=>t.profile==="SearchService1"||t.profile==="http://iiif.io/api/search/1/search"):void 0}var Zt=require("react/jsx-runtime"),Ze=(0,ht.createContext)(null);Ze.displayName="Search";function Bo(e){let t=nr();return e.store?(0,Zt.jsx)(Ze.Provider,{value:e.store,children:e.children}):(0,Zt.jsx)(Ga,{service:t,children:e.children})}function Ga({service:e,children:t}){let n=(0,ht.useMemo)(()=>Ho(e),[e]);return(0,Zt.jsx)(Ze.Provider,{value:n,children:t})}var G=require("react/jsx-runtime"),yt=()=>{},Je=(0,Jt.createContext)({setCurrentCanvasId:yt,setCurrentCanvasIndex:yt,nextCanvas:yt,previousCanvas:yt,items:[],sequence:[],setSequenceIndex:yt,currentSequenceIndex:0,hasNext:!1,hasPrevious:!1});function Fo(e){let t=z(),{cursor:n,visibleItems:r,next:o,sequence:a,items:i,setCanvasIndex:s,setCanvasId:u,previous:c,setSequenceIndex:l,hasNext:d,hasPrevious:h}=_n({startCanvas:e.startCanvas,disablePaging:e.pagingEnabled===!1}),S=(0,Jt.useMemo)(()=>({sequence:a,items:i,setCurrentCanvasId:u,nextCanvas:o,previousCanvas:c,totalCanvases:i.length,setCurrentCanvasIndex:s,setSequenceIndex:l,currentSequenceIndex:n,hasNext:d,hasPrevious:h}),[a,i,u,o,c,i,s,l,n]);return t?r.length===0?null:(0,G.jsx)(Je.Provider,{value:S,children:(0,G.jsx)(Me.Provider,{value:r,children:(0,G.jsx)(re,{canvas:r[0],children:e.children})})}):(console.warn("The manifest passed to the provider is not a valid IIIF manifest."),(0,G.jsx)("div",{children:"Sorry, something went wrong."}))}function rr(e){let t=ke(e.vault),n=qn(e.manifest);if(!n)return console.warn("The manifest passed to the provider is not a valid IIIF manifest."),(0,G.jsx)("div",{children:"Sorry, something went wrong."});if(n.error)return(0,G.jsx)("div",{children:n.error.toString()});if(!n.isLoaded)return(0,G.jsx)("div",{children:"Loading..."});let r=(0,G.jsx)(Fo,{...e,children:e.children});return(0,G.jsx)(we,{vault:t,children:(0,G.jsx)($n,{manifest:n.id,children:(0,G.jsx)(Jn,{children:(0,G.jsx)(Bo,{children:e.rangeId?(0,G.jsx)(Wn,{range:e.rangeId,children:r}):r})})})})}function vt(){return(0,Do.useContext)(Je)}var qo=Q(require("react"),1),en=require("react"),$o=Q(require("mitt"),1),Uo=require("react/jsx-runtime"),Wo=(0,$o.default)(),Ve=(0,en.createContext)({emitter:Wo});Ve.displayName="Events";function St(){return qo.default.useContext(Ve).emitter}function Xa({emitter:e,children:t}){return(0,Uo.jsx)(Ve.Provider,{value:(0,en.useMemo)(()=>({emitter:e}),[e]),children:t})}var _o=Q(require("react"),1),me=require("react/jsx-runtime"),or=_o.default.createContext({});function ir(){let e=(0,ee.useContext)(or),t=Object.keys(e),n={};for(let r of t)e[r].Provider&&(n[r]={value:(0,ee.useContext)(e[r]),Provider:e[r].Provider});return n}function Yo(e){let t=Object.keys(e),n=e.children;for(let r of t){if(r==="children")continue;let{value:o,Provider:a}=e[r];n=(0,me.jsx)(a,{value:o,children:n})}return n}function Za(e){let t=(0,ee.useContext)(or),n=(0,ee.useMemo)(()=>({...t,...e.providers}),[e.providers]);return(0,me.jsx)(or.Provider,{value:n,children:e.children})}function ar(){return{VaultContext:(0,ee.useContext)(ve),ResourceContext:(0,ee.useContext)(mt),SimpleViewerReactContext:(0,ee.useContext)(Je),VisibleCanvasReactContext:(0,ee.useContext)(Me),AuthRContext:(0,ee.useContext)(Ne),SearchReactContext:(0,ee.useContext)(Ze),ReactEventContext:(0,ee.useContext)(Ve)}}function sr(e){return(0,me.jsx)(we,{vault:e.bridge.VaultContext.vault||void 0,resources:e.bridge.ResourceContext,children:(0,me.jsx)(Me.Provider,{value:e.bridge.VisibleCanvasReactContext,children:(0,me.jsx)(Je.Provider,{value:e.bridge.SimpleViewerReactContext,children:(0,me.jsx)(Ve.Provider,{value:e.bridge.ReactEventContext,children:(0,me.jsx)(Ne.Provider,{value:e.bridge.AuthRContext,children:(0,me.jsx)(Ze.Provider,{value:e.bridge.SearchReactContext,children:e.custom?(0,me.jsx)(Yo,{...e.custom,children:e.children}):e.children})})})})})})}var et=require("react");var fe=require("react");var tn=require("@iiif/helpers/vault/actions");var Ko=require("react");function cr(){let t=T().getStore();return(0,Ko.useMemo)(()=>n=>t.dispatch(n),[t])}function jo(e){return typeof e!="string"&&e&&e.bindToVault}function lr(){let e=T(),t=(0,fe.useRef)([]),n=cr(),r=(0,fe.useMemo)(()=>`vault://annotation-page/${new Date().getTime()}/${Math.round(Math.random()*1e9).toString(16)}`,[]);(0,fe.useLayoutEffect)(()=>{let s={id:r,type:"AnnotationPage",behavior:[],label:null,thumbnail:[],summary:null,requiredStatement:null,metadata:[],rights:null,provider:[],items:[],seeAlso:[],homepage:[],rendering:[],service:[]};n(tn.entityActions.importEntities({entities:{AnnotationPage:{[s.id]:s}}}))},[r]);let o=w(s=>r&&s.iiif.entities.AnnotationPage[r]||null,[r]),a=(0,fe.useCallback)((s,u)=>{if(r){if(jo(s)){let d=s;d.__vault||d.bindToVault(e),s=typeof d.source=="string"?d.source:d.source.id,t.current[s]=d}else typeof s!="string"&&(s=s.id);let c=e.get({id:r,type:"AnnotationPage"}),l=e.get({id:s,type:"Annotation"});c&&l&&(c.items.find(d=>d.id===l.id)||n(tn.entityActions.addReference({id:r,type:"AnnotationPage",key:"items",reference:{id:s,type:"Annotation"},index:u})))}},[r]),i=(0,fe.useCallback)(s=>{r&&(jo(s)?s=typeof s.source=="string"?s.source:s.source.id:typeof s!="string"&&(s=s.id),t.current[s]&&t.current[s].beforeRemove(),e.get({id:r,type:"AnnotationPage"})&&n(tn.entityActions.removeReference({id:r,type:"AnnotationPage",key:"items",reference:{id:s,type:"Annotation"}})))},[r]);return[o,{addAnnotation:a,removeAnnotation:i}]}var Go=require("react/jsx-runtime"),Qo=(0,et.createContext)(null);function ur(){let e=(0,et.useContext)(Qo);return[e.fullPage,{addAnnotation:e.addAnnotation,removeAnnotation:e.removeAnnotation}]}function mr({children:e}){let[t,{addAnnotation:n,removeAnnotation:r}]=lr();return(0,Go.jsx)(Qo.Provider,{value:(0,et.useMemo)(()=>({fullPage:t,addAnnotation:n,removeAnnotation:r}),[t]),children:e})}var tt=require("react/jsx-runtime");function nn({width:e,style:t,height:n,error:r,resetErrorBoundary:o}){return(0,tt.jsxs)("div",{style:{width:e,height:n,minHeight:500,...t||{},background:"#f9f9f9"},children:[(0,tt.jsx)("h3",{children:"Error occurred"}),(0,tt.jsx)("p",{children:r.message}),(0,tt.jsx)("button",{type:"button",onClick:o,children:"Reset"})]})}var rn=require("react"),oe=(0,rn.createContext)(null);function xt(){return(0,rn.useContext)(oe)}var Le=require("react"),dr=(0,Le.createContext)(()=>{}),fr=(0,Le.createContext)(()=>{});function D(e,t,n,r,o=[]){let a=(0,Le.useContext)(e==="portal"?fr:dr);(0,Le.useEffect)(()=>(e!=="none"&&a(t,n,r),()=>{a(t,null)}),[t,e,a,...o])}var nt=require("react");var Xo=require("react");function P(e={},t=[]){let{id:n,selector:r}=e,o=$(),a=n||o.canvas,i=w(s=>a?s.iiif.entities.Canvas[a]:void 0,[a]);return(0,Xo.useMemo)(()=>{if(i)return r?r(i):i},[i,r,...t])}var pr=(0,nt.createContext)(()=>{});function Zo(e){let t=P(),n=(0,nt.useContext)(pr);(0,nt.useEffect)(()=>t&&t.id?(n(t.id,e),()=>n(t.id,-1)):()=>{},[t,e])}var O=require("react/jsx-runtime");function an({children:e,errorFallback:t,outerContainerProps:n={},worldScale:r,...o}){let[a,i]=(0,U.useState)(),s=ir(),u=ar(),c=t||nn,[l,d]=(0,U.useState)({}),h=Object.entries(l),[S,v]=(0,U.useState)({}),f=Object.entries(S),[x,y]=(0,U.useState)({}),C=(0,U.useMemo)(()=>r||Math.max(...Object.values(x)),[x]),m=(0,U.useMemo)(()=>({maxOverZoom:C||1,...o.runtimeOptions||{}}),[C,o.runtimeOptions]),b=(0,U.useCallback)((I,R)=>{y(B=>{if(R===-1){let{[I]:Ke,...k}=B;return k}return{...B,[I]:R}})},[]),A=(0,U.useCallback)((I,R,B)=>{d(({[I]:Ke,...k})=>R?{...k,[I]:{element:R,props:B}}:k)},[]),M=(0,U.useCallback)((I,R,B)=>{v(({[I]:Ke,...k})=>R?{...k,[I]:{element:R,props:B}}:k)},[]);return(0,O.jsxs)(Jo.ErrorBoundary,{resetKeys:[],fallbackRender:I=>(0,O.jsx)(c,{...o,...I}),children:[(0,O.jsx)(on.AtlasAuto,{...o,containerProps:{style:{position:"relative"},...o.containerProps||{}},htmlChildren:(0,O.jsx)(O.Fragment,{children:h.map(([I,{element:R,props:B}])=>(0,O.jsx)(U.default.Fragment,{children:(0,O.jsx)(R,{...B||{}})},I))}),onCreated:I=>{i(I),o.onCreated&&o.onCreated(I)},runtimeOptions:m,children:(0,O.jsx)(oe.Provider,{value:a,children:(0,O.jsx)(pr.Provider,{value:b,children:(0,O.jsx)(dr.Provider,{value:A,children:(0,O.jsx)(fr.Provider,{value:M,children:(0,O.jsx)(sr,{bridge:u,custom:s,children:(0,O.jsx)(on.ModeContext.Provider,{value:o.mode||"explore",children:(0,O.jsx)(mr,{children:e})})})})})})})}),(0,O.jsx)("div",{children:f.map(([I,{element:R,props:B}])=>(0,O.jsx)(U.default.Fragment,{children:(0,O.jsx)(R,{...B||{}})},I))})]})}var sn=require("@atlas-viewer/atlas");var gr=require("react"),ei=require("@iiif/helpers/events");function Ct(e,t){let n=T(),r=(0,gr.useMemo)(()=>(0,ei.createEventsHelper)(n),[n]),o=w(()=>e&&e.id?n.getResourceMeta(e.id,"eventManager"):null,[e]);return(0,gr.useMemo)(()=>e?r.getListenersAsProps(e,t):{},[o,e,n,t])}var ti=require("react"),ni=require("@iiif/helpers/styles");function ze(e,t){let n=T(),r=(0,ti.useMemo)(()=>(0,ni.createStylesHelper)(n),[n]);return w(()=>{if(!e)return null;let o=r.getAppliedStyles(e.id);return o?t?o[t]:o:void 0},[e,t])}var ii=require("react");var ri=require("react");var oi=require("@iiif/helpers/annotation-targets");function bt(e={},t=[]){let{id:n,selector:r}=e,o=$(),a=T(),i=n||o.annotation,s=w(c=>i?c.iiif.entities.Annotation[i]:void 0,[i]),u=w(c=>s&&s.body?s.body.map(l=>l?l.type==="SpecificResource"?{...l,source:a.get(l)}:l?c.iiif.entities[l.type][l.id]:null:null).filter(Boolean):[],[s]);return(0,ri.useMemo)(()=>{if(!s)return;let c={...s,body:u,target:(0,oi.expandTarget)(s.target,{typeMap:a.getState().iiif.mapping})};return r?r(c):c},[s,r,u,...t])}var ai=require("react/jsx-runtime"),cn=({id:e,style:t,className:n,interactive:r})=>{let o=bt({id:e}),a=ze(o,"atlas"),i=ze(o,"html"),s=Ct(o,["atlas"]),u=P(),c=(0,ii.useMemo)(()=>(0,sn.mergeStyles)(t,a),[t,a]);return u&&o&&o.target&&o.target.selector&&o.target.selector.type==="BoxSelector"&&o.target.source&&(o.target.source.id===u.id||o.target.source===u.id)?(0,ai.jsx)(sn.RegionHighlight,{id:o.id,isEditing:!0,region:o.target.selector.spatial,style:c,className:i?.className||n,interactive:!!(i?.href||r),href:i?.href||null,title:i?.title||null,hrefTarget:i?.target||null,onClick:()=>{},...s}):null};var ci=require("react");var si=require("react");function hr(e={},t=[]){let{id:n,selector:r}=e,o=$(),a=n||o.annotationPage,i=w(s=>a?s.iiif.entities.AnnotationPage[a]:void 0,[a]);return(0,si.useMemo)(()=>{if(i)return r?r(i):i},[i,...t])}var yr=require("react/jsx-runtime"),Rt=({className:e,page:t})=>{let n=hr({id:t.id})||t,r=ze(n,"atlas"),o=ze(n,"html");return w(a=>n.id?a.iiif.entities.AnnotationPage[n.id]:null,[]),(0,yr.jsx)(ci.Fragment,{children:n.items?.map(a=>(0,yr.jsx)(cn,{id:a.id,style:r,className:o?.className||e},a.id))})};var xe=require("react");var ot=require("react");var li=require("@iiif/helpers");function Ja(e){return e.type==="SpecificResource"?[e.source,{selector:e.selector}]:[e,{selector:null}]}function Pt(e,t){let{selector:n,source:r}=(0,li.expandTarget)(t);if(r.id!==e.id)return[null,r];let o={type:"BoxSelector",spatial:{x:0,y:0,width:Number(e.width),height:Number(e.height)}};return[n?n.type==="TemporalSelector"?{type:"TemporalBoxSelector",temporal:n.temporal,spatial:o.spatial}:n:null,r]}var vr={makeChoice:()=>{}},At={type:"unknown"},E=e=>({type:"unknown",reason:e,annotations:{pages:[]}}),Sr=(e,t)=>({type:"empty",width:e,height:t,annotations:{pages:[]},image:null,images:[]});var Tt=require("react");function es(e,t){let n=e?.iiif?.meta[t];return n?n.annotationPageManager:null}function ui(e,t){return w(n=>{let r=[];if(!e)return r;let o=Object.keys(n.iiif.entities.AnnotationPage);for(let a of o)if(!t||t.indexOf(a)!==-1){let i=es(n,a);i&&i.views&&i.views[e]&&r.push(a)}return r},[e,t])}function xr({canvas:e,manifest:t,all:n,canvases:r}){let o=[];if(t)for(let a of t.annotations)o.indexOf(a.id)===-1&&o.push(a.id);if(n){if(r&&r.length)for(let a of r)for(let i of a.annotations)o.indexOf(i.id)===-1&&o.push(i.id)}else if(e)for(let a of e.annotations)o.indexOf(a.id)===-1&&o.push(a.id);return o}function ts(e,t){let n=e?.iiif?.meta[t];return n?n.annotationPageManager:null}function It(e,t={}){let n=T(),r=z(),o=P(),a=Ee(),i=(0,Tt.useMemo)(()=>xr({all:t.all,manifest:r,canvas:o,canvases:a}),[t.all,o,a,r]),s=ui(e,t.all?void 0:i),u=(0,Tt.useCallback)(l=>{e&&n.setMetaValue([l,"annotationPageManager","views"],d=>d&&!d[e]?d:{...d||{},[e]:!1})},[e,n]),c=(0,Tt.useCallback)((l,d={})=>{if(!e)return;let h=n.getState(),S=[];if(d?.deselectOthers){let v=Object.keys(h.iiif.entities.AnnotationPage);for(let f of v){let x=ts(h,f);x&&x.views&&x.views[e]&&S.push(f)}}for(let v of S)u(v);n.setMetaValue([l,"annotationPageManager","views"],v=>v&&v[e]?v:{...v||{},[e]:!0})},[e,u,n]);return{availablePageIds:i,enabledPageIds:s,setPageEnabled:c,setPageDisabled:u}}function Cr(e,t){return w((n,r)=>r.get(e.map(o=>({id:o,type:t}))),[e,t])}var hi=Q(require("mitt"),1),yi=require("react"),vi=require("zustand");var ln=Q(require("react"),1),mi=require("@iiif/helpers/image-service"),wt=require("zustand"),di=ln.default.createContext(mi.imageServices.store);di.displayName="ImageServicesHelper";function un(){return(0,ln.useContext)(di)}function fi(e){let t=un();return(0,wt.useStore)(t,({loaded:n})=>n[e])}function rt(){let e=un();return(0,wt.useStore)(e,({loadServiceSync:t})=>t)}function pi(){let e=un();return(0,wt.useStore)(e,({loaded:t})=>t)}function gi(){let e=un();return(0,wt.useStore)(e,({loadService:t})=>t)}var ns=(0,vi.createStore)((e,t)=>({loaded:{},setLoaded:(n,r="done")=>{e(o=>({loaded:{...o.loaded,[n]:r}}))}})),rs=(0,hi.default)();rs.on("loaded",e=>{ns.getState().setLoaded(e.imageServiceId)});function kt(){let e=rt(),t=pi();return[(0,yi.useCallback)((r,{height:o,width:a})=>r&&e(r,{height:o,width:a},!0),[e]),t]}var He=require("react");function Oe(e={}){let t=bt(),n=P(e.canvasId?{id:e.canvasId}:void 0);return w((r,o)=>{if(!n)return[];if(t&&e.enableSingleAnnotation)return[t];let a=o.get(n.items),i=[];for(let s of a)i.push(...o.get(s.items));return i},[n])}var Si=require("@iiif/helpers/painting-annotations");function br(e,t=[]){let n=T(),r=(0,He.useMemo)(()=>(0,Si.createPaintingAnnotationsHelper)(n),[]),o=Oe({enableSingleAnnotation:e?.enableSingleAnnotation}),[a,i]=(0,He.useState)(e?.defaultChoices||[]),s=(0,He.useMemo)(()=>r.getPaintables(o,a),[n,o,a,...t]),c={makeChoice:(0,He.useCallback)((l,{deselectOthers:d=!0,deselect:h=!1}={})=>{s.choice&&i(S=>{if(h){let f=S.filter(x=>x!==l);if(f.length===0){let x=s.items[0].resource.id;return x?[x]:[]}return f}if(d)return[l];let v=[...S];if(v.length===0&&s.items.length){let f=s.items[0].resource.id;f&&v.push(f)}return S.indexOf(l)!==-1?S:[...S,l]})},[s.choice])};return[s,c]}var os=["model/gltf-binary"];function Rr(e,t){let n=t.items[0],r=n.resource;return r.format?os.indexOf(r.format)===-1?E(`3D format: ${r.format} is unsupported`):{type:"3d-model",model:r,annotationId:n.annotationId,annotation:n.annotation}:E("Unknown format")}function xi(e,t){let n=t.items,r=n[0];if(n.length===0||!r)return E("No audio");if(!e.duration)return E("No duration on canvas");if(n.length>1)return E("Only one audio source supported");let o=r.resource;return o?"format"in o?{type:"media",media:{annotationId:r.annotationId,annotation:r.annotation,duration:e.duration,url:o.id,type:"Sound",target:{type:"TemporalSelector",temporal:{startTime:0,endTime:e.duration}},format:o.format,selector:{type:"TemporalSelector",temporal:{startTime:0,endTime:e.duration}}},annotations:{pages:[]}}:E("Audio does not have format"):E("Unknown audio")}var Ci=require("@iiif/parser/image-3");var Pr=require("@iiif/helpers/annotation-targets");function Mt(e,t,n){let r=[];for(let o of t.items){let a=o.resource&&o.resource.type==="SpecificResource"?o.resource.source:o.resource;if(!a.id)return E("No resource Identifier");let i;if(a.service){let f=(0,Ci.getImageServices)(a);f[0]&&(i=n(f[0],e))}let s={type:"BoxSelector",spatial:{x:0,y:0,width:Number(e.width),height:Number(e.height)}},[u,c]=Pt(e,o.target),l=e.id?.split("?")[0]||"";if(!(c.id===e.id||decodeURIComponent(c.id||"")===(e.id||"")||c.id===l||decodeURIComponent(c.id||"")===l))continue;let d=o.resource.width&&o.resource.height?{type:"BoxSelector",spatial:{x:0,y:0,width:o.resource.width,height:o.resource.height}}:void 0,h=o.resource.type==="SpecificResource"?(0,Pr.expandTarget)(o.resource):null;if(o.selector){let f=(0,Pr.expandTarget)({type:"SpecificResource",source:o.resource,selector:o.selector});f&&(h=f)}let S=h&&h.selector&&(h.selector.type==="BoxSelector"||h.selector.type==="TemporalBoxSelector")?{type:"BoxSelector",spatial:{x:h.selector.spatial.x,y:h.selector.spatial.y,width:h.selector.spatial.width,height:h.selector.spatial.height}}:void 0;i&&!i.id&&(i.id=i["@id"]);let v={id:a.id,type:"Image",annotationId:o.annotationId,annotation:o.annotation,width:Number(u||S?a.width:e.width),height:Number(u||S?a.height:e.height),service:i,sizes:i&&i.sizes?i.sizes:a.width&&a.height?[{width:a.width,height:a.height}]:[],target:u&&u.type!=="PointSelector"?u:s,selector:S||{type:"BoxSelector",spatial:{x:0,y:0,width:Number(e.width),height:Number(e.height)}}};r.push(v)}return{type:"images",image:r[0],images:r,choice:t.choice}}function bi(e,t={},n){let r=e.language||n||"none";switch(e.type){case"TextualBody":{typeof e.value<"u"&&(t[r]=[e.value]);break}case"List":case"Composite":case"Choice":e.items&&e.items.forEach(o=>bi(o,t,r))}return t}function Et(e,t){let n=[];return t.items.forEach(r=>{if(r.resource){let[o]=Pt(e,r.target);n.push({type:"Text",annotationId:r.annotationId,annotation:r.annotation,text:bi(r.resource),target:o})}}),{type:"textual-content",items:n}}var mn=require("@iiif/helpers"),is=/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/|shorts\/)|(?:(?:watch)?\?vi?=|&vi?=))([^#&?]*).*/;function Nt(e,t,n){let r=t.items.filter(S=>S.type==="video"),o=r[0],a=!1;if(e.duration||(a=!0),r.length>1||!o)return E("Only one video source supported");let i=r[0]?.resource,s=!!(i.service||[]).find(S=>(S.profile||"").includes("youtube.com"));if(!s&&a)return E("Video does not have duration");if(!i)return E("Unknown video");if((!i.format||i.format==="text/html")&&!s)return E("Video does not have format");let u=[],c=n.get(e.annotations||[]);for(let S of c){let v=n.get(S.items||[]);for(let f of v)if((f.motivation?Array.isArray(f.motivation||"")?f.motivation:[f.motivation]:[]).includes("supplementing")){let y=n.get(f.body||[]);for(let C of y){let m=C;if(m.type==="Choice")for(let b of m.items){let A=n.get(b);A.format==="text/vtt"&&u.push({id:A.id,type:"Text",format:"text/vtt",label:A.label,language:A.language})}else m.format==="text/vtt"&&u.push({id:m.id,type:"Text",format:"text/vtt",label:m.label,language:m.language})}}}let l={annotationId:o.annotationId,annotation:o.annotation,duration:e.duration,url:i.id,type:"Video",target:{type:"TemporalSelector",temporal:{startTime:0,endTime:e.duration}},format:i.format,selector:{type:"TemporalSelector",temporal:{startTime:0,endTime:e.duration}}},d=(0,mn.expandTarget)(o.target);d.selector&&d.selector.type==="TemporalBoxSelector"&&(l.target=d.selector);let{selector:h}=(0,mn.parseSelector)(o.selector);if(h===null){let S=l.target.temporal.startTime,f=(l.target.temporal.endTime||e.duration)-S;l.selector={type:"TemporalSelector",temporal:{startTime:0,endTime:f}}}else h.type==="TemporalSelector"&&(l.selector=h);if(s){l.type="VideoYouTube";let S=i.id.match(is);if(!S[1])return E("Video is not known youtube video");l.youTubeId=S[1]}return{type:"media",media:l,annotations:{pages:[]},captions:u}}function Ar(e,t,n,r){let o={type:"complex-timeline",items:[],keyframes:[],duration:e.duration||0},a={type:"complex-choice",items:[]};function i(c){c.choice&&(c.choice.type==="complex-choice"?a.items.push(...c.choice.items):a.items.push(c.choice))}for(let c of t.items){if(c.type==="image"){let l=Mt(e,{choice:null,allChoices:null,types:["image"],items:[c]},n);if(l.type==="images"){i(l),o.items.push(l.image);let d={id:l.image.annotationId,type:"enter",resourceType:"image",time:l.image.target?.temporal?.startTime||0};o.keyframes.push(d);let h={id:l.image.annotationId,type:"exit",resourceType:"image",time:l.image.target?.temporal?.endTime||e.duration||0};o.keyframes.push(h)}}if(c.type==="textualbody"){let l=Et(e,{choice:null,allChoices:null,types:["textualbody"],items:[c]});if(l.type==="textual-content"){i(l);let d=l.items[0];o.items.push(d);let h=d.target,S={id:d.annotationId,type:"enter",resourceType:"text",time:h.temporal?.startTime||0};o.keyframes.push(S);let v={id:d.annotationId,type:"exit",resourceType:"text",time:h.temporal?.endTime||e.duration||0};o.keyframes.push(v)}}if(c.type==="video"){let l=Nt(e,{choice:null,allChoices:null,types:["video"],items:[c]},r);if(l.type==="media"){i(l);let d=l.media;o.items.push(d);let h={id:d.annotationId,type:"enter",resourceType:"video",time:d.target?.temporal?.startTime||0};o.keyframes.push(h);let S={id:d.annotationId,type:"exit",resourceType:"video",time:d.target?.temporal?.endTime||e.duration||0};o.keyframes.push(S)}}}o.keyframes.sort((c,l)=>c.time-l.time);let s=[],u=[];for(let c of o.keyframes){if(c.resourceType==="image"||c.resourceType==="text"){u.push(c);continue}if(c.type==="enter"){s.length===0&&(c.isPrime=!0),s.push(c),u.push(c);continue}if(c.type==="exit"&&(u.push(c),s=s.filter(l=>l.id!==c.id),s.length!==0)){let l=s[0],d={id:l.id,type:"change",isPrime:!0,resourceType:l.resourceType,time:c.time};u.push(d)}}return o.keyframes=u,a.items.length&&(o.choice=a),o}var dn={},Tr={get(e){return e},setMetaValue([e,t,n],r){let o=Tr.getResourceMeta(e,t),a=o?o[n]:void 0,i=typeof r=="function"?r(a):r;dn[e]={...dn[e]||{},[t]:{...(dn[e]||{})[t]||{},[n]:i}}},getResourceMeta:(e,t)=>{let n=dn[e];if(n)return t?n[t]:n},async load(e){let t=typeof e=="string"?e:e.id;return fetch(t).then(n=>n.json())},requestStatus(e){}};function Ir({canvas:e,paintables:t,supports:n,loadImageService:r,vault:o=Tr}){if(!e)return At;if(t.types.length===0)return n.indexOf("empty")!==-1?Sr(e.width,e.height):At;if(t.types.length!==1)if(t.types.length===2&&t.types.indexOf("text")!==-1)t.types=t.types.filter(i=>i!=="text");else return n.indexOf("complex-timeline")===-1?E("Complex timeline not supported"):Ar(e,t,r,o);let a=t.types[0];return a==="image"?n.indexOf("images")===-1?E("Image not supported"):Mt(e,t,r):a==="Model"||a==="model"?n.indexOf("3d-model")===-1?E("3D not supported"):Rr(e,t):a==="textualbody"?n.indexOf("textual-content")===-1?E("Textual content not supported"):Et(e,t):a==="sound"||a==="audio"?n.indexOf("media")===-1?E("Media not supported"):xi(e,t):a==="video"?n.indexOf("media")===-1?E("Media not supported"):Nt(e,t,o):At}function wr(e){let t=z(),n=P(),r=T(),o=St(),a=e?.emitter||o,[i,s]=kt(),{enabledPageIds:u}=It(e?.annotationPageManagerId||t?.id||n?.id,{all:!1}),c=Cr(u,"AnnotationPage"),l=e?.strategies||["empty","images","media","textual-content","complex-timeline"],[d,h]=br(e,[s]);(0,ot.useEffect)(()=>{let v=f=>{h.makeChoice(f.choiceId,{deselectOthers:f.deselectOthers,deselect:f.deselect})};return a.on("make-choice",v),()=>{a.off("make-choice",v)}},[]);let S=(0,ot.useMemo)(()=>Ir({canvas:n,paintables:d,supports:l,loadImageService:i,vault:r}),[n,d,r,h.makeChoice]);return(0,ot.useEffect)(()=>{let v=d.allChoices,f={canvasId:n?.id,manifestId:t?.id};v&&a.emit("choice-change",{choice:v,partOf:f})},[n?.id,d.allChoices]),(0,ot.useMemo)(()=>S.type==="unknown"?[S,vr]:[{...S,annotations:{pages:c}},h],[S,c])}var fn=require("react"),Vt=(0,fn.createContext)(null);Vt.displayName="Strategy";function V(){let e=(0,fn.useContext)(Vt);if(!e)throw new Error("useStrategy must be used within a StrategyProvider");return e}var Ri=require("@iiif/helpers");var pn=require("react"),Lt=(0,pn.createContext)(null);Lt.displayName="Controls";function _(){let e=(0,pn.useContext)(Lt);if(!e)throw new Error("useStrategy must be used within a StrategyProvider");return e}var kr=require("react/jsx-runtime");function Mr({strategies:e,registerActions:t,defaultChoices:n,onChoiceChange:r,mediaControlsDeps:o,renderMediaControls:a,renderViewerControls:i,viewControlsDeps:s,renderComplexTimelineControls:u,complexTimelineControlsDeps:c,throwOnUnknown:l,children:d}){let h=P(),S=T(),v=(0,xe.useMemo)(()=>(0,Ri.createStylesHelper)(S),[S]),[f,x]=wr({strategies:e||["images"],defaultChoices:n?.map(({id:b})=>b)}),y="choice"in f?f.choice:void 0;if((0,xe.useEffect)(()=>{t&&t(x)},[f.annotations]),(0,xe.useEffect)(()=>{r&&r(y)},[y]),(0,xe.useEffect)(()=>{if(n)for(let b of n)typeof b.opacity<"u"&&v.applyStyles({id:b.id},"atlas",{opacity:b.opacity})},[n]),f.type==="unknown"&&l)throw new Error(f.reason||"Unknown strategy");let C=(0,xe.useMemo)(()=>({renderMediaControls:a,mediaControlsDeps:o||[],renderViewerControls:i,viewControlsDeps:s||[],renderComplexTimelineControls:u,complexTimelineControlsDeps:c||[]}),[o,a,i,s,u,c]),m=(0,xe.useMemo)(()=>({strategy:f,actions:x,choices:"choice"in f?f.choice:[]}),[f,h]);return(0,kr.jsx)(Lt.Provider,{value:C,children:(0,kr.jsx)(Vt.Provider,{value:m,children:d})})}var Pi=require("react");var Ai=require("react/jsx-runtime");function Er({x:e=0,y:t=0,keepCanvasScale:n,children:r}){let{strategy:o}=V(),a=P(),i=Ct(a,["deep-zoom"]),s=(0,Pi.useMemo)(()=>n?1:Math.max(1,...o.type==="images"?o.images.map(c=>(c.width||0)/c.target?.spatial.width):[]),[n,o]);Zo(s);let u=o.type==="images"?o.images.length:0;return a?(0,Ai.jsx)("world-object",{height:a.height,width:a.width,x:e,y:t,...i,children:r},`${a.id}/${o.type}/${u}`):null}var Ti=require("react/jsx-runtime");function gn({style:e}){let t=P();return!t||!t.height||!t.width?null:(0,Ti.jsx)("box",{interactive:!1,target:{x:0,y:0,width:Number(t.width),height:Number(t.height)},style:e})}var Ii=require("react/jsx-runtime");function Nr({backgroundStyle:e,alwaysShowBackground:t}){let{strategy:n}=V();return n.type!=="empty"&&!t?null:(0,Ii.jsx)(gn,{style:e})}var Cn=require("react");var Mi=Q(require("mitt"),1);var L=require("react");function wi(e){return{isMuted:!1,playRequested:!1,isPlaying:!1,isFinished:!1,volume:100,duration:e}}function as(e,t){switch(t.type){case"RESET":return t.state;case"FINISHED":return{...e,isFinished:!0,isPlaying:!1,playRequested:!1};case"PLAY_PAUSE":return{...e,isFinished:!1,isPlaying:!e.isPlaying};case"PLAY_REQUESTED":return{...e,isFinished:!1,playRequested:!0};case"PAUSE":return{...e,isPlaying:!1};case"PLAY":return{...e,isFinished:!1,playRequested:!1,isPlaying:!0};case"MUTE":return{...e,isMuted:!0};case"SET_VOLUME":return{...e,volume:t.volume,isMuted:t.volume===0};case"TOGGLE_MUTE":return{...e,isMuted:!e.isMuted};case"UNMUTE":return{...e,isMuted:!1}}return e}function hn(e){let t=Math.round(e);return`${Math.floor(t/60)}:${`${t%60}`.padStart(2,"0")}`}function Be(e){let[t,n]=(0,L.useReducer)(as,wi(e.duration));(0,L.useEffect)(()=>{n({type:"RESET",state:wi(e.duration)})},[e.duration]);let r=(0,L.useRef)(null),o=(0,L.useRef)(null),a=(0,L.useRef)(null),i=(0,L.useRef)(!1),s=(0,L.useCallback)(()=>{o.current&&r.current&&(o.current.innerHTML=hn(r.current.currentTime),a.current&&(a.current.style.width=`${r.current.currentTime/e.duration*100}%`),i.current!==r.current.muted&&(i.current=r.current.muted,n(r.current.muted?{type:"MUTE"}:{type:"UNMUTE"})))},[e.duration]),u=(0,L.useCallback)(()=>{r.current&&(n({type:"PLAY_REQUESTED"}),r.current.play().then(()=>{n({type:"PLAY"})}),s())},[s]),c=(0,L.useCallback)(()=>{r.current&&(r.current.duration>0&&r.current.paused?u():l())},[s]),l=(0,L.useCallback)(()=>{r.current&&(r.current.pause(),n({type:"PAUSE"}),s())},[s]),d=(0,L.useCallback)(()=>{r.current&&(r.current.muted=!r.current.muted,n(r.current.muted?{type:"MUTE"}:{type:"UNMUTE"}))},[]),h=(0,L.useCallback)(()=>{r.current&&(r.current.muted=!0,n({type:"MUTE"}))},[]),S=(0,L.useCallback)(()=>{r.current&&(r.current.muted=!1,n({type:"UNMUTE"}))},[]),v=(0,L.useCallback)(y=>{r.current&&(r.current.muted=!1,r.current.volume=y/100,n({type:"SET_VOLUME",volume:y}))},[]),f=(0,L.useCallback)(y=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(y*e.duration,e.duration)),s())},[]),x=(0,L.useCallback)(y=>{if(r.current){let C=typeof y=="function"?y(r.current.currentTime):y;r.current.currentTime=Math.max(0,Math.min(C,e.duration)),s()}},[]);return(0,L.useEffect)(()=>{let y=setInterval(()=>{s()},350);return()=>clearInterval(y)},[s,e.duration]),(0,L.useEffect)(()=>{let y=()=>{n({type:"FINISHED"})},C=r.current;return C?.addEventListener("ended",y),()=>C?.removeEventListener("ended",y)},[]),[{element:r,currentTime:o,progress:a},t,{play:u,pause:l,playPause:c,mute:h,unmute:S,toggleMute:d,setVolume:v,setDurationPercent:f,setTime:x}]}var Ei=require("zustand/vanilla");function ki({currentKeyFrameIndex:e,keyframes:t,targetTime:n,currentTime:r}){if(r<=n){let o=t.findIndex(s=>s.time>n);if(o===-1)return[e,[]];let a={},i=t.slice(e,o);for(let s of i)s.type==="enter"&&(a[s.id]=s),s.type==="exit"&&(a[s.id]?delete a[s.id]:a[s.id]=s);return[o,Object.values(a)]}return[e,[]]}function Ni({complexTimeline:e,startTime:t=0}){let n=(0,Mi.default)(),r={},o={progress:null,currentTime:null},a=0,i=null,s=0,u=null;function c(){let C=x.getState().visibleElements,m=r,b=[],A=Object.keys(m);for(let M of A){let I=m[M],R=C[M];I&&R&&b.push(I)}return b}function l(){return Object.keys(r).map(C=>r[C])}function d(y){o.currentTime&&(o.currentTime.innerHTML=hn(y),o.progress&&(o.progress.style.width=`${y/e.duration*100}%`))}let h=()=>{let y=x.getState(),C=y.currentPrime;if(!C)return;let m=r,b=y.visibleElements,A=Object.keys(m);for(let M of A){let I=m[M],R=b[M];if(I&&M!==C.id&&R){let B=s-R.time*1e3;Math.abs(s-R.time*1e3-I.currentTime*1e3)>300&&(I.currentTime=B/1e3)}}},S=(y=0)=>{let C=y-a,m=x.getState();if(m.isPlaying){let b=m.currentPrime;if(b){let R=r[b.id];R&&(R.paused?s+=C:s=(b.time+R.currentTime)*1e3)}else s+=C;let A=s/1e3;if(A>m.duration){x.getState().setTime(0),x.setState({isPlaying:!1}),v(),d(0);return}d(A);let[M,I]=ki({currentTime:A,currentKeyFrameIndex:m.nextKeyframeIndex,keyframes:m.complexTimeline.keyframes,targetTime:A});I.length&&m.applyKeyframes(M,I)}a=y,i=requestAnimationFrame(S)},v=()=>{i&&cancelAnimationFrame(i)},f=(y,C)=>{},x=(0,Ei.createStore)((y,C)=>({complexTimeline:e,elements:{},visibleElements:{},isBuffering:!1,bufferMap:{},isMuted:!1,playRequested:!1,isPlaying:!1,isFinished:!1,isReady:!1,volume:100,duration:e.duration,clockStartRequests:0,clockStartTime:0,primeTime:0,currentPrime:null,clockRunning:!1,nextKeyframeIndex:0,startClock:()=>{C().clockRunning||(S(),u=setInterval(h,500)),y({clockRunning:!0,clockStartRequests:C().clockStartRequests+1})},applyKeyframes(m,b){let A=C(),M={...A.visibleElements},I=A.currentPrime;for(let R of b)R.type==="enter"&&(M[R.id]=R,n.emit("complex-timeline.enter",{id:R.id})),R.type==="exit"&&(M[R.id]=null,n.emit("complex-timeline.exit",{id:R.id})),R.isPrime&&(I=R);y({nextKeyframeIndex:m,visibleElements:M,currentPrime:I})},stopClock:()=>{let m=C().clockStartRequests;if(m!==0){if(m===1){v(),u&&clearInterval(u),y({clockRunning:!1,clockStartRequests:0});return}y({clockStartRequests:m-1})}},setElement:(m,b)=>{r[m]=b;let A=Object.keys(r),M=C().complexTimeline;f(b,m),M.items.filter(R=>R.type!=="Image"&&R.type!=="Text").every(R=>A.includes(R.annotationId))&&!C().isReady&&(n.emit("complex-timeline.ready",{complexTimeline:M}),y({isReady:!0}))},removeElement:m=>{delete r[m]},mute(){for(let m of l())m.muted=!0;y({isMuted:!0})},unmute(){for(let m of l())m.muted=!1;y({isMuted:!1})},play(){if(!C().isPlaying){for(let b of c())b.play();y({isPlaying:!0})}},pause(){if(C().isPlaying){for(let b of c())b.pause();y({isPlaying:!1})}},playPause(){let m=C();m.isPlaying?m.pause():m.play()},setDurationPercent(m){let A=C().duration*m;C().setTime(A)},setTime(m){let b=C(),A=s/1e3,M=typeof m=="function"?m(A):m,I=b.nextKeyframeIndex;if(A>M){y({visibleElements:{},currentPrime:null});let ut=Object.keys(b.visibleElements);for(let Ut of ut)n.emit("complex-timeline.exit",{id:Ut});A=0,I=0}let[R,B]=ki({currentTime:A,currentKeyFrameIndex:I,keyframes:b.complexTimeline.keyframes,targetTime:M});b.applyKeyframes(R,B),s=M*1e3;let k=x.getState().visibleElements,ne=r,go=Object.keys(k);for(let ut of go){let Ut=k[ut];if(Ut){let ho=ne[ut];ho&&(ho.currentTime=(s-Ut.time*1e3)/1e3)}}d(M)},setVolume(m){for(let b of l())b.volume=Math.min(1,Math.max(0,m/100));y({volume:m})},toggleMute(){let m=C();m.isMuted?(m.unmute(),y({isMuted:!1})):(m.mute(),y({isMuted:!0}))},clearProgressElement(){o.progress=null},setProgressElement(m){o.progress=m},setCurrentTimeElement(m){o.currentTime=m},clearCurrentTimeElement(){o.currentTime=null}}));return n.on("complex-timeline.enter",y=>{let C=x.getState(),m=y.id,b=r[m];b&&C.isPlaying&&b.play()}),n.on("complex-timeline.exit",y=>{let C=x.getState(),m=y.id,b=r[m];b&&(b.currentTime=0,b.pause())}),x.getState().setTime(t),{store:x,emitter:n}}var ji=require("@atlas-viewer/atlas");var zt=require("react");var $i=require("@atlas-viewer/atlas"),Wi=require("@iiif/parser/image-3");var ue=Q(require("react"),1),le=require("react/jsx-runtime"),Li=ue.default.createContext("en"),zi=ue.default.createContext({}),Oi=ue.default.createContext(null);function ss(e){return(0,le.jsx)(zi.Provider,{value:e.translations,children:e.children})}function cs(e){return(0,le.jsx)(Li.Provider,{value:e.language,children:e.children})}function ls(e){return(0,le.jsx)(Oi.Provider,{value:e.convert,children:e.children})}function Vr(){return ue.default.useContext(Oi)}function yn(){return ue.default.useContext(Li)}function Lr(){return ue.default.useContext(zi)}function Vi(e){return e.indexOf("-")!==-1?e.slice(0,e.indexOf("-")):e}function Hi({as:e,language:t,children:n,viewingDirection:r,...o}){let a=yn();return(0,ue.useMemo)(()=>Vi(a)===Vi(t),[a,t])?e?(0,le.jsx)(e,{...o,children:n}):(0,le.jsx)("span",{...o,children:n}):e?(0,le.jsx)(e,{...o,lang:t,dir:r,children:n}):(0,le.jsx)("span",{...o,lang:t,dir:r,children:n})}function Bi(e,t,n){if(t.length===0)return;if(t.length===1)return t[0];if(t.indexOf(e)!==-1)return e;let r=e.indexOf("-")!==-1?e.slice(0,e.indexOf("-")):null;if(r&&t.indexOf(r)!==-1)return r;for(let o of n)if(t.indexOf(o)!==-1)return o;return t.indexOf("none")!==-1?"none":t.indexOf("@none")!==-1?"@none":t[0]}var Di=(e,t=[])=>{let n=yn();return(0,ue.useMemo)(()=>{let r=e();return Bi(n,r,[])},[n,...t])};function De(e,t,n,r){return t?n?n(e[t]||t,r||"none"):e[t]||t:""}function Fi(e,t,n=`
`,r={}){let o=Vr(),a=Di(()=>Object.keys(e||{}),[e]);return[(0,ue.useMemo)(()=>{if(!e)return De(r,t,o)||"";if(typeof e=="string")return De(r,e,o);let i=a?e[a]:void 0;return i?typeof i=="string"?i:i.map(s=>De(r,s,o,a)).join(n):""},[a,t,e]),a]}function us(){let e=yn(),t=Lr(),n=Vr();return function(o,a="",i=`
`,s=t){let u=Object.keys(o||{}),c=Bi(e,u,[]);if(!o)return De(s,a,n)||"";if(typeof o=="string")return De(s,o,n);let l=c?o[c]:void 0;return l?typeof l=="string"?De(s,l,n,c):l.map(d=>De(s,d,n,c)).join(typeof i<"u"?i:`
`):""}}function te({as:e,defaultText:t,enableDangerouslySetInnerHTML:n,children:r,separator:o,...a}){let i=Lr(),[s,u]=Fi(r,t,o,i);return u?(0,le.jsx)(Hi,{...a,as:e,language:u,title:n?void 0:s,dangerouslySetInnerHTML:n?{__html:s}:void 0,children:n?void 0:s}):e?(0,le.jsx)(e,{...a,children:s}):(0,le.jsx)("span",{...a,title:n?void 0:s,dangerouslySetInnerHTML:n?{__html:s}:void 0,children:n?void 0:s})}var qi=require("@iiif/parser/image-3"),vn=require("react"),Fe=require("react/jsx-runtime"),zr=e=>{let t=e.format||"jpg",n=e.width/(e.crop?.width||e.tiles.width),r=e.tiles.imageService.sizes||[],o=e.enableThumbnail,a=e.enableSizes,i=(0,vn.useMemo)(()=>{let c=e.tiles.imageService.id||e.tiles.imageService["@id"];return c?.endsWith("/info.json")?c.slice(0,-1*10):c},[e.tiles.imageService.id,e.tiles.imageService["@id"]]),s=(0,vn.useMemo)(()=>{let c=e.tiles.imageService.tiles||[];if(!c.length){let l=e.width,d=[1],h=1;for(;Math.pow(2,h)<l;)h=h*2,d.push(h);return(e.tiles.imageService.maxArea||e.tiles.imageService.maxWidth||e.tiles.imageService.maxHeight)&&(0,qi.isImageServiceLevel)(2,e.tiles.imageService)?[{width:256,height:256,scaleFactors:d}]:[]}return c},[e.tiles.imageService,e.width]),u=(0,vn.useMemo)(()=>{let c=e.tiles.imageService;return(c?c["@context"]?Array.isArray(c["@context"])?c["@context"]:[c["@context"]]:[]:[]).indexOf("http://iiif.io/api/image/3/context.json")!==-1},[e.tiles.imageService.id,e.tiles.imageService]);return(0,Fe.jsx)("world-object",{rotation:e.rotation,scale:n,height:e.crop?.height||e.tiles.height,width:e.crop?.width||e.tiles.width,x:e.x,y:e.y,onClick:e.onClick,children:(0,Fe.jsxs)("composite-image",{id:e.tiles.imageService.id,width:e.crop?.width||e.tiles.width,height:e.crop?.height||e.tiles.height,crop:e.crop,renderOptions:e.renderOptions,children:[o&&e.tiles.thumbnail?(0,Fe.jsx)("world-image",{priority:!0,uri:e.tiles.thumbnail.id,target:{width:e.tiles.width,height:e.tiles.height},display:{width:e.tiles.thumbnail.width,height:e.tiles.thumbnail.height},crop:e.crop}):null,a&&r.map((c,l)=>(0,Fe.jsx)("world-image",{uri:`${i}/full/${c.width},${u?c.height:""}/0/default.${t}`,target:{width:e.tiles.width,height:e.tiles.height},display:{width:c.width,height:c.height},crop:e.crop},l)),s.map(c=>(c.scaleFactors||[]).map(l=>(0,Fe.jsx)("tiled-image",{uri:e.tiles.imageService.id,display:{width:e.tiles.width,height:e.tiles.height},format:t,tile:c,scaleFactor:l,crop:e.crop,version3:u},`${e.tiles.imageService.id}-tile-${l}`)))]},e.tiles.imageService.id)},e.tiles.imageService.id)};var ie=require("react/jsx-runtime");function ms({resource:e,heading:t,note:n,extra:r}){return r?(0,ie.jsx)($i.HTMLPortal,{target:{x:0,y:0,width:r.target?.spatial.width,height:r.target?.spatial.height},backgroundColor:"#333",relative:!0,children:(0,ie.jsx)("div",{style:{display:"flex",alignContent:"center",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",background:"#444",color:"#BBB"},children:(0,ie.jsxs)("div",{children:[(0,ie.jsx)(te,{children:t||"Not authorised"}),n&&(0,ie.jsx)("p",{children:(0,ie.jsx)(te,{children:n})}),(0,ie.jsx)("p",{children:e.id||e["@id"]||"unknown"})]})})}):null}function Ui({image:e,thumbnail:t,crop:n,enableSizes:r,enableThumbnail:o,renderOptions:a}){let i=er(),s=(0,Wi.getId)(e.service),u=fi(s),c=rt(),l=u?.service;c(e.service,e);let d=l&&u?.status==="done",h=(l?.preferredFormats||[])[0],S=t&&t.type==="fixed"&&t.id&&!t.id.includes("/full/full/")&&!t.id.includes("/max/")?t:void 0;if(d===!1)return null;if(!i){let v=e.service,f=v.width||e.width||0,x=v.height||e.height||0;return(0,ie.jsx)(zr,{enableThumbnail:o,renderOptions:a,tiles:{id:v.id||v["@id"]||"unknown",height:x,width:f,imageService:v,thumbnail:S},enableSizes:r,x:0,y:0,format:h,width:e.target?.spatial.width,height:e.target?.spatial.height,crop:n})}return(0,ie.jsx)(tr,{resource:e.service,errorComponent:ms,extra:e,children:v=>{let f=v.width||e.width||0,x=v.height||e.height||0;return(0,ie.jsx)(zr,{enableThumbnail:o,renderOptions:a,tiles:{id:v.id||v["@id"]||"unknown",height:x,width:f,imageService:v,thumbnail:S},format:h,enableSizes:r,x:0,y:0,width:e.target?.spatial.width,height:e.target?.spatial.height,crop:n})}},e.id)}var qe=require("react/jsx-runtime");function Ce({id:e,image:t,thumbnail:n,isStatic:r,x:o=0,y:a=0,children:i,selector:s,onClick:u,enableSizes:c}){let l=(0,zt.useMemo)(()=>{if(!(!s||s.spatial.x===0&&s.spatial.y===0))return s.spatial},[s]);return(0,qe.jsx)("world-object",{x:o+t.target.spatial.x,y:a+t.target.spatial.y,width:t.target.spatial.width,height:t.target.spatial.height,onClick:u,children:t.service?(0,qe.jsxs)(zt.Fragment,{children:[(0,qe.jsx)(Ui,{image:t,thumbnail:n,crop:l,enableSizes:c}),i]},"service"):(0,qe.jsxs)(zt.Fragment,{children:[(0,qe.jsx)("world-image",{onClick:u,uri:t.id,target:{x:0,y:0,width:t.target.spatial.width,height:t.target.spatial.height},display:t.width&&t.height?{width:t.width,height:t.height}:void 0,crop:l}),i]},"no-service")},e+(t.service?"server":"no-service"))}var Br=require("zustand");var Sn=require("react"),_i=require("zustand"),Yi=require("react/jsx-runtime"),Or=(0,Sn.createContext)(null);Or.displayName="ComplexTimeline";function Hr({children:e,store:t}){return(0,Yi.jsx)(Or.Provider,{value:t,children:e})}function ds(e){let t=(0,Sn.useContext)(Or);if(!t)throw new Error("useComplexTimeline must be used within a ComplexTimelineProvider");return(0,_i.useStore)(t,e)}var Ki=require("@atlas-viewer/atlas");var pe=require("react/jsx-runtime");function xn({strategy:e,onClickPaintingAnnotation:t}){return(0,pe.jsx)(pe.Fragment,{children:e.items.map((n,r)=>(0,pe.jsx)(pe.Fragment,{children:(0,pe.jsx)(Ki.HTMLPortal,{onClick:t?o=>{o.stopPropagation(),t(n.annotationId,n,o)}:void 0,target:n.target?.spatial||void 0,children:(0,pe.jsx)("div",{"data-textual-content":!0,children:(0,pe.jsx)(te,{enableDangerouslySetInnerHTML:!0,children:n.text})})},r)}))})}var ge=require("react/jsx-runtime");function Qi({strategy:e,children:t}){let{store:n}=(0,Cn.useMemo)(()=>Ni({complexTimeline:e}),[e]),r=(0,Br.useStore)(n,i=>i.isReady),o=(0,Br.useStore)(n,i=>i.visibleElements);function a(i){return s=>{s&&n.getState().setElement(i,s)}}return(0,Cn.useLayoutEffect)(()=>{if(r){let{startClock:i,stopClock:s}=n.getState();return i(),()=>{s()}}},[e,r]),D("portal","custom-controls",Hr,{store:n,children:t},[r]),(0,ge.jsxs)(ge.Fragment,{children:[e.items.map(i=>i.type!=="Image"||!o[i.annotationId]?null:(0,ge.jsx)(Ce,{image:i,id:i.annotationId},i.id)),e.items.map((i,s)=>i.type!=="Text"||!o[i.annotationId]?null:(0,ge.jsx)(xn,{strategy:{type:"textual-content",items:[i]}},s)),e.items.map((i,s)=>i.type!=="Video"||!i.target.spatial?null:(0,ge.jsx)(ji.HTMLPortal,{target:i.target.spatial,children:(0,ge.jsx)("video",{ref:a(i.annotationId),src:i.url,style:{height:"100%",width:"100%",opacity:o[i.annotationId]?1:0}})},s))]})}var Gi=require("react/jsx-runtime");function Dr(){let{strategy:e}=V(),{renderComplexTimelineControls:t}=_();return e.type!=="complex-timeline"?null:(0,Gi.jsx)(Qi,{strategy:e,children:t?t(e):null})}var it=require("react/jsx-runtime");function Fr({onClickPaintingAnnotation:e,children:t}){let{strategy:n}=V(),{renderViewerControls:r,viewControlsDeps:o}=_(),a=xt(),i=P();return D(a&&n.type==="textual-content"&&r?"overlay":"none",`canvas-portal-controls-${i?.id}`,oe.Provider,r?{value:a||null,children:r(n)}:{},[i,a,n,...o||[]]),n.type!=="textual-content"?null:(0,it.jsxs)(it.Fragment,{children:[(0,it.jsx)(xn,{strategy:n,onClickPaintingAnnotation:e}),t]})}var be=require("react");var Xi=require("react"),qr=(e,t=[])=>{let n=T();(0,Xi.useEffect)(()=>{e(n)},[n,...t])};var bn=Q(require("react"),1),Zi=require("@iiif/helpers/image-service"),Ji=bn.default.createContext(new Zi.ImageServiceLoader);function Ot(){return(0,bn.useContext)(Ji)}var ea=require("@iiif/helpers/thumbnail");function he(e,t,{canvasId:n,manifestId:r}={}){let o=T(),a=Ot(),i=(0,be.useMemo)(()=>(0,ea.createThumbnailHelper)(o,{imageServiceLoader:a}),[o,a]),[s,u]=(0,be.useState)(),c=z(r?{id:r}:void 0),l=P(n?{id:n}:void 0),d=l||c,h=(0,be.useRef)(!1);if((0,be.useEffect)(()=>(h.current=!1,()=>{h.current=!0}),[]),!d)throw new Error("Must be called under a manifest or canvas context.");return qr(S=>{i.getBestThumbnailAtSize(d,e,t).then(v=>{v.best&&!h.current&&u(v.best)})},[d]),s}var at=require("react/jsx-runtime");function $r({isStatic:e=!1,enableSizes:t=!1,onClickPaintingAnnotation:n,children:r}){let{strategy:o}=V(),{renderViewerControls:a,viewControlsDeps:i}=_(),s=P(),u=xt(),c=he({maxWidth:256,maxHeight:256});return D(u&&o.type==="images"&&a?"overlay":"none",`canvas-portal-controls-${s?.id}`,oe.Provider,a?{value:u||null,children:a(o)}:{},[s,u,o,...i||[]]),o.type!=="images"?null:(0,at.jsxs)(at.Fragment,{children:[o.images.map((l,d)=>(0,at.jsx)(Ce,{isStatic:e,image:l,id:l.id,thumbnail:d===0?c:void 0,selector:l.selector,enableSizes:t,onClick:n?h=>{n(l.annotationId,l,h)}:void 0},l.id+d)),r]})}var Re=require("react/jsx-runtime");function Wr({model:e}){return(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)("style",{children:`
            .model-container {
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: #000;
              z-index: 13;
              display: flex;
              justify-content: center;
              pointer-events: visible;
            }
          `}),(0,Re.jsx)("div",{className:"model-container",children:(0,Re.jsx)("model-viewer",{"interaction-prompt":"none",style:{width:"100%",height:"100%"},"camera-controls":"","ar-status":"not-presenting",src:e.id})})]})}function Rn({model:e,name:t}){return D("overlay",`model-${t}`,Wr,{model:e},[e]),null}var ta=require("react/jsx-runtime");function Ur(){let{strategy:e}=V();return e.type!=="3d-model"?null:(0,ta.jsx)(Rn,{model:e.model})}var $e=require("react/jsx-runtime");function _r({children:e}){let{strategy:t}=V(),[n]=ur();return t.type!=="images"?null:(0,$e.jsxs)($e.Fragment,{children:[n?(0,$e.jsx)(Rt,{page:n}):null,t.annotations&&t.annotations.pages?t.annotations.pages.map(r=>(0,$e.jsx)(Rt,{page:r},r.id)):null,e]})}var Pe=require("react"),Pn=require("react/jsx-runtime"),na=(0,Pe.createContext)(null),ra=(0,Pe.createContext)(null),oa=(0,Pe.createContext)(null);function fs(){let e=(0,Pe.useContext)(na);if(!e)throw new Error("Ctx not found");return e}function ps(){let e=(0,Pe.useContext)(ra);if(!e)throw new Error("Ctx not found");return e}function gs(){let e=(0,Pe.useContext)(oa);if(!e)throw new Error("Ctx not found");return e}function Ht({actions:e,state:t,children:n,currentTime:r,progress:o,element:a}){return(0,Pn.jsx)(oa.Provider,{value:{currentTime:r,progress:o,element:a},children:(0,Pn.jsx)(ra.Provider,{value:e,children:(0,Pn.jsx)(na.Provider,{value:t,children:n})})})}var ia=require("react");var aa=require("@iiif/helpers");function Bt(){let e=z(),t=P();return(0,ia.useMemo)(()=>{if(!e||!t||!e.start)return null;let n=(0,aa.expandTarget)(e.start);return!n||n.source.id!==t.id||!n||!n.selector||n.selector.type!=="TemporalSelector"?null:n.selector.temporal},[e,t])}var Tn=require("react/jsx-runtime");function Yr({media:e,startTime:t,children:n}){let[{element:r,currentTime:o,progress:a},i,s]=Be({duration:e.duration}),u=t?`${e.url}#t=${t}`:e.url;return(0,Tn.jsxs)(Ht,{state:i,actions:s,currentTime:o,progress:a,element:r,children:[(0,Tn.jsx)("audio",{ref:r,src:u}),n]},e.url)}function An({media:e,mediaControlsDeps:t,audioCopmonent:n=Yr,children:r}){let o=Bt();return D("portal","audio",n,{media:e,startTime:o?o.startTime:null,children:r},[e,o,...t||[]]),null}var Kr=require("react/jsx-runtime");function We({x:e=0,y:t=0}){let n=P(),r=he({maxWidth:256,maxHeight:256});return!n||!r||r.type!=="fixed"?null:(0,Kr.jsx)("world-object",{height:n.height,width:n.width,x:e,y:t,children:(0,Kr.jsx)("world-image",{uri:r.id,target:{x:0,y:0,width:n.width,height:n.height},display:r.width&&r.height?{width:r.width,height:r.height}:void 0,crop:void 0})})}var Ue=require("react/jsx-runtime");function jr({as:e}){let{strategy:t}=V(),{renderMediaControls:n,mediaControlsDeps:r}=_();return t.type!=="media"||t.media.type!=="Sound"?null:(0,Ue.jsx)(Ue.Fragment,{children:(0,Ue.jsxs)(An,{media:t.media,mediaControlsDeps:r,audioCopmonent:e,children:[(0,Ue.jsx)(We,{}),n?n(t):null]},t.media.url)})}var ye=require("react/jsx-runtime");function Qr(){let{strategy:e}=V(),{renderViewerControls:t,viewControlsDeps:n}=_(),r=P(),o=r?.accompanyingCanvas,a=r?.placeholderCanvas;return(0,ye.jsxs)(ye.Fragment,{children:[e.type==="media"&&e.media.type==="Sound"&&o?(0,ye.jsx)(re,{canvas:o.id,children:(0,ye.jsx)(_e,{renderViewerControls:t,viewControlsDeps:n})}):null,e.type==="media"&&e.media.type==="Sound"&&a&&!o?(0,ye.jsx)(re,{canvas:a.id,children:(0,ye.jsx)(_e,{renderViewerControls:t,viewControlsDeps:n})}):null]})}var Dt=require("react/jsx-runtime");function Gr({element:e,media:t,startTime:n,playPause:r,poster:o}){let a="div",i=n?`${t.url}#t=${n}`:t.url;return(0,Dt.jsxs)(a,{className:"video-container",part:"video-container",onClick:r,children:[(0,Dt.jsx)("style",{children:`
            .video-container {
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: #000;
              z-index: 13;
              display: flex;
              justify-content: center;
              pointer-events: visible;
            }
          `}),(0,Dt.jsx)("video",{poster:o,ref:e,src:i,style:{width:"100%",objectFit:"contain"}})]})}function In({media:e,mediaControlsDeps:t,children:n,videoComponent:r=Gr,captions:o}){let a=P(),i=Bt(),s=a&&a.placeholderCanvas&&a.placeholderCanvas.id||void 0,u=he({},!1,{canvasId:s}),[{element:c,currentTime:l,progress:d},h,S]=Be({duration:e.duration});return D("overlay","video-element",r,{element:c,media:e,playPause:S.playPause,poster:u?.id,canvas:a,startTime:i?i.startTime:null,captions:o},[u]),D("portal","custom-controls",Ht,{state:h,actions:S,currentTime:l,progress:d,element:c,children:n},[l,h,e,...t||[]]),null}var wn=require("react/jsx-runtime");function Xr({as:e}){let{strategy:t}=V(),{renderMediaControls:n,mediaControlsDeps:r}=_();return t.type!=="media"||t.media.type!=="Video"?null:(0,wn.jsxs)(In,{captions:t.captions,media:t.media,mediaControlsDeps:r,videoComponent:e,children:[(0,wn.jsx)(We,{}),n?n(t):null]},t.media.url)}var sa=require("react"),Ft=require("react/jsx-runtime");function hs({element:e,media:t,playPause:n}){let r=(0,sa.useRef)(null);return t.youTubeId?(0,Ft.jsxs)("div",{className:"video-container",part:"video-container",onClick:n,children:[(0,Ft.jsx)("style",{children:`
            .video-container {
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: #000;
              z-index: 13;
              display: flex;
              justify-content: center;
              pointer-events: visible;
            }
            .video-yt {
              border: none;
              width: 100%;
              object-fit: contain;
            }
          `}),(0,Ft.jsx)("iframe",{className:"video-yt",ref:r,src:`https://www.youtube.com/embed/${t.youTubeId}?enablejsapi=1&origin=${window.location.host}`,referrerPolicy:"no-referrer",sandbox:"allow-scripts allow-same-origin allow-presentation"})]}):null}function ca({media:e,mediaControlsDeps:t,children:n}){let[{element:r,currentTime:o,progress:a},i,s]=Be({duration:e.duration});return D("overlay","video-element",hs,{element:r,media:e,playPause:s.playPause}),null}var kn=require("react/jsx-runtime");function Zr(){let{strategy:e}=V(),{renderMediaControls:t,mediaControlsDeps:n}=_();return e.type!=="media"||e.media.type!=="VideoYouTube"?null:(0,kn.jsxs)(ca,{media:e.media,mediaControlsDeps:n,children:[(0,kn.jsx)(We,{}),t?t(e):null]})}var X=require("react/jsx-runtime");function _e({x:e,y:t,onChoiceChange:n,registerActions:r,defaultChoices:o,isStatic:a,renderViewerControls:i,renderMediaControls:s,renderComplexTimelineControls:u,complexTimelineControlsDeps:c,viewControlsDeps:l,mediaControlsDeps:d,strategies:h,throwOnUnknown:S,backgroundStyle:v,alwaysShowBackground:f,keepCanvasScale:x=!1,enableSizes:y=!1,enableYouTube:C=!0,onClickPaintingAnnotation:m,components:b={},children:A}){return(0,X.jsxs)(Mr,{throwOnUnknown:S,onChoiceChange:n,registerActions:r,strategies:h,defaultChoices:o,mediaControlsDeps:d,renderMediaControls:s,renderViewerControls:i,renderComplexTimelineControls:u,complexTimelineControlsDeps:c,viewControlsDeps:l,children:[(0,X.jsxs)(Er,{keepCanvasScale:x,x:e,y:t,children:[(0,X.jsx)(Nr,{alwaysShowBackground:f,backgroundStyle:v}),(0,X.jsx)(Dr,{}),(0,X.jsx)(Fr,{}),(0,X.jsx)($r,{isStatic:a,enableSizes:y,onClickPaintingAnnotation:m}),(0,X.jsx)(_r,{}),(0,X.jsx)(Ur,{}),(0,X.jsx)(jr,{as:b.Audio}),(0,X.jsx)(Xr,{as:b.Video}),C?(0,X.jsx)(Zr,{}):null,A]}),(0,X.jsx)(Qr,{})]})}var Jr=require("react/jsx-runtime");function la(e){let t=P();return!t||!t.placeholderCanvas?null:(0,Jr.jsx)(re,{canvas:t.placeholderCanvas.id,children:(0,Jr.jsx)(_e,{renderViewerControls:e.renderViewerControls})})}var Y=require("react/jsx-runtime"),ys=(0,Ye.forwardRef)(function(t,n){let r=z(),o=Ee(),a=vt(),{ViewerControls:i,MediaControls:s,ComplexTimelineControls:u}=t.components||{};if((0,Ye.useImperativeHandle)(n,()=>a,[a]),!r)return(0,Y.jsx)("div",{});let c=0,l=r.viewingDirection==="top-to-bottom",d=r.viewingDirection==="bottom-to-top",h=r.viewingDirection==="left-to-right",S=r.viewingDirection==="right-to-left",f=r.behavior.includes("continuous")?0:t.spacing||0,x=d||S,y=(0,Ye.useMemo)(()=>x?[...o].reverse():o,[o,x]);return(0,Y.jsxs)(Y.Fragment,{children:[t.header,(0,Y.jsx)(F.Viewer,{height:t.height,mode:t.mode,renderPreset:t.renderPreset,runtimeOptions:t.runtimeOptions,children:y.map((C,m)=>{let b=0,A=0;return l?(b=c,c+=C.width+f):(A=c,c+=C.height+f),(0,Y.jsx)(re,{canvas:C.id,children:(0,Y.jsx)(F.RenderCanvas,{strategies:["3d-model","media","images","empty","textual-content","complex-timeline"],renderViewerControls:m===0&&i?()=>(0,Y.jsx)(i,{}):void 0,renderMediaControls:m===0&&s?()=>(0,Y.jsx)(s,{}):void 0,renderComplexTimelineControls:m===0&&u?()=>(0,Y.jsx)(u,{}):void 0,x:b,y:A,...t.canvasProps||{},children:t.annotations},C.id)},C.id)})},t.reuseAtlas?"":a.currentSequenceIndex),t.children]})}),F=(0,Ye.forwardRef)(function({children:t,height:n,annotations:r,canvasProps:o,spacing:a,header:i,components:s,mode:u,reuseAtlas:c,renderPreset:l,runtimeOptions:d,...h},S){let v=ke();return(0,Y.jsx)(we,{vault:v,children:(0,Y.jsx)(rr,{...h,children:(0,Y.jsx)(ys,{ref:S,height:n,components:s,spacing:a,canvasProps:o,annotations:r,header:i,mode:u,reuseAtlas:c,renderPreset:l,runtimeOptions:d,children:t})})})});F.RenderImage=Ce;F.RenderCanvas=_e;F.RenderAnnotationPage=Rt;F.RenderAnnotation=cn;F.Viewer=an;F.CanvasBackground=gn;F.Audio=An;F.Video=In;F.Model=Rn;F.AudioHTML=Yr;F.VideoHTML=Gr;F.ModelHTML=Wr;F.PlaceholderCanvas=la;var ua=require("@atlas-viewer/atlas");var Mn=require("react"),qt=require("react/jsx-runtime"),vs=(0,Mn.forwardRef)(function({canvasId:t},n){let r=(0,ua.useCanvas)(),o=It(t||r?.id),a=T();return(0,Mn.useImperativeHandle)(n,()=>o,[t,r]),!r||o.enabledPageIds.length===0?null:(0,qt.jsx)(qt.Fragment,{children:o.enabledPageIds.map(i=>(0,qt.jsx)(F.RenderAnnotationPage,{page:a.get(i)},i))})});var da=require("react");var ma=require("react");var H=require("react/jsx-runtime");function $t({metadata:e=[],config:t,labelWidth:n=16,showEmptyMessage:r=!0,allowHtml:o,emptyFallback:a,classes:i={},emptyMessage:s="No metadata available",emptyValueFallback:u="No value",emptyLabelFallback:c="",separator:l,tableFooter:d,tableHeader:h}){let S=(0,ma.useMemo)(()=>{let f=(t||[]).reduce((y,C)=>[...y,...C.keys],[]),x={};for(let y of e){let C=y&&y.label?Object.values(y.label):[];for(let m of C)if(m&&m.length&&(f.indexOf(`metadata.${m[0]}`)!==-1||f.length===0)&&y){let b=`metadata.${m[0]}`;x[b]=x[b]?x[b]:[],x[b].push(y);break}}return x},[t,e]);return Object.keys(S).length===0&&r?(0,H.jsx)(H.Fragment,{children:a})||(0,H.jsx)("div",{className:i.empty,children:s}):t&&t.length?(0,H.jsxs)("table",{className:i.container,children:[h,(0,H.jsx)("tbody",{children:t.map((f,x)=>{let y=[];for(let C of f.keys)for(let m of S[C]||[])y.push((0,H.jsx)(te,{enableDangerouslySetInnerHTML:o,defaultText:u,separator:l,children:m.value},x+"__"+C));return y.length===0?null:(0,H.jsxs)("tr",{className:i.row,children:[(0,H.jsx)("td",{className:i.label,style:n?{minWidth:n}:{},children:(0,H.jsx)(te,{enableDangerouslySetInnerHTML:o,separator:l,defaultText:c,children:f.label})}),(0,H.jsx)("td",{className:i.value,children:y})]},x)})}),d]}):(0,H.jsxs)("table",{className:i.container,children:[h,(0,H.jsx)("tbody",{children:e&&e.length?e.map((f,x)=>f?(0,H.jsxs)("tr",{className:i.row,children:[(0,H.jsx)("td",{className:i.label,style:n?{minWidth:n}:{},children:(0,H.jsx)(te,{enableDangerouslySetInnerHTML:o,defaultText:u,separator:l,children:f.label})}),(0,H.jsx)("td",{className:i.value,children:(0,H.jsx)(te,{enableDangerouslySetInnerHTML:o,defaultText:u,separator:l,children:f.value})})]},x):null):null}),d]})}var fa=require("react/jsx-runtime");function Ss(e){let t=z(),n=P(),r=pt(),o=(0,da.useMemo)(()=>{let a=t?.metadata||[],i=n?.metadata||[],s=r?.metadata||[];return[...a,...i,...s]},[t,n,r]);return(0,fa.jsx)($t,{metadata:o,...e})}var Vn=require("react");var En=require("@iiif/parser/image-3"),pa=require("react");function Nn(e,t={},n=[]){return(0,pa.useMemo)(()=>{if(!e)return null;let r=t.quality;e&&e.extraQualities&&t.quality&&(e.extraQualities.includes(t.quality)||(r="default"));let o=(0,En.createImageServiceRequest)(e);return(0,En.imageServiceRequestToString)({identifier:o.identifier,server:o.server,scheme:o.scheme,type:"image",size:{max:!t.size?.width&&!t.size?.height,confined:!1,upscaled:!1,...t.size||{}},format:t.format||"jpg",region:t.region||{full:!0},rotation:t?.rotation?Number.isInteger(t.rotation)?{angle:t.rotation}:t.rotation:{angle:0},quality:r||"default",prefix:o.prefix,originalPath:o.originalPath})},[...n])}var Wt=require("react/jsx-runtime");function xs(e){let t=typeof e.src=="string"?e.src:e.src.id,n=Ot(),[r,o]=(0,Vn.useState)(!1),a;if(t){let s=n.loadServiceSync({id:t});s&&(a=s)}!a&&!r&&n.loadService({id:t}).then(()=>{o(!0)});let i=Nn(a,{size:e.size,selector:e.region,rotation:e.rotation,format:e.format,region:e.region,quality:e.quality},[r,e.src,e.size,e.region,e.rotation,e.format,e.region,e.quality]);return(0,Vn.useEffect)(()=>()=>{o(!1)},[t]),i?(0,Wt.jsx)("img",{src:i,alt:e.alt,className:e.className,style:e.style}):(0,Wt.jsx)(ga,{...e,fetchImageService:!1})}function ga(e){if(e.fetchImageService)return(0,Wt.jsx)(xs,{...e});let t=typeof e.src=="string"?{id:e.src,profile:"level0"}:e.src,n=Nn(t,{size:e.size,selector:e.region,rotation:e.rotation,format:e.format,region:e.region,quality:e.quality},[e.src,e.size,e.region,e.rotation,e.format,e.region,e.quality]);return n?(0,Wt.jsx)("img",{src:n,alt:e.alt,className:e.className,style:e.style}):null}var ha=require("react/jsx-runtime");function Cs(e){let t=z();return(0,ha.jsx)($t,{metadata:t?.metadata||[],...e})}var Ln=require("react");var eo=Q(require("react-lazy-load-image-component"),1);var ya=require("@iiif/helpers/i18n"),Z=require("react/jsx-runtime"),{LazyLoadComponent:bs}=eo||eo.default;function to(e){let{size:t,visible:n,classes:r,canvasId:o,figure:a}=e,i=t?.width||128,s=t?.height||t?.width||128,u=(0,Z.jsx)(Rs,{...e}),c=(0,Z.jsx)(bs,{threshold:300,style:{height:s,width:i},visibleByDefault:n,children:o?(0,Z.jsx)(re,{canvas:o,children:u}):u});return a?(0,Z.jsx)("figure",{className:r?.figure,children:c}):c}function Rs({fallback:e,size:t,classes:n,showLabel:r,alt:o,dereference:a=!1}){let i=P(),s=t?.width||128,u=t?.height||t?.width||128,c=o||(0,ya.getValue)(i?.label)||"",l=he({width:s,height:u,allowUnsafe:!0},a);return!l||l.type!=="fixed"?(0,Z.jsx)(Z.Fragment,{children:e}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{className:n?.imageWrapper,children:(0,Z.jsx)("img",{className:n?.img,src:l.id,alt:c})}),r?(0,Z.jsx)(te,{as:"figcaption",className:n?.label,children:i?.label}):null]})}var st=require("react/jsx-runtime");function Ps({scrollBehaviour:e,dereference:t,flat:n,size:r,classes:o={},showLabel:a,figure:i,fallback:s}){let u=(0,Ln.useRef)(null),{items:c,sequence:l,currentSequenceIndex:d,setSequenceIndex:h}=vt(),S={row:o.selected?.row||o.row,item:o.selected?.item||o.item,figure:o.selected?.figure||o.figure,img:o.selected?.img||o.img,label:o.selected?.label||o.label,imageWrapper:o.selected?.imageWrapper||o.imageWrapper};(0,Ln.useLayoutEffect)(()=>{if(!u.current)return;let f=u.current.querySelector("[data-selected=true]");f&&f.scrollIntoView({behavior:e||"instant",block:"nearest",inline:"center"})},[d]);let v=[];for(let f of l){let x=[],y=l[d]===f;for(let C of f){let m=c[C];x.push((0,st.jsx)("div",{className:y?S.item:o.item,children:(0,st.jsx)(to,{classes:y?S:o,canvasId:m.id,size:r,dereference:t,showLabel:a,figure:i,placeholder:(0,st.jsx)("div",{style:{height:128,width:128}}),fallback:s})},C))}if(n){v.push(x);continue}v.push((0,st.jsx)("div",{onClick:C=>{h(l.indexOf(f))},"data-selected":y,className:y?S.row:o.row,children:x},f.join("-")))}return(0,st.jsx)("div",{ref:u,className:o.container,children:v})}var K=require("react/jsx-runtime"),As={draw:!0,polygon:!0,line:!0,lineBox:!0,square:!0,triangle:!0,hexagon:!0,circle:!0,delete:!0};function Ts({helper:e,showShapes:t,state:n,enabled:r=As,classNames:o={},icons:a={}}){return(0,K.jsxs)(K.Fragment,{children:[t?(0,K.jsxs)(K.Fragment,{children:[r.draw&&(0,K.jsx)("button",{className:o.button,onClick:()=>{e.stamps.clear(),e.draw.enable()},"data-active":!n.lineMode&&!n.selectedStamp&&t&&n.drawMode,children:a.DrawIcon||"Draw"}),r.polygon&&(0,K.jsx)("button",{className:o.button,"data-active":!n.lineMode&&!n.selectedStamp&&t&&!n.drawMode,onClick:()=>{e.stamps.clear(),e.draw.disable(),e.modes.disableLineBoxMode(),e.modes.disableLineMode()},children:a.PolygonIcon||"Polygon"}),r.line&&(0,K.jsx)("button",{className:o.button,"data-active":n.lineMode&&!n.lineBoxMode,onClick:()=>{e.modes.enableLineMode()},children:a.LineIcon||"Line"}),r.lineBox&&(0,K.jsx)("button",{className:o.button,"data-active":n.lineBoxMode,onClick:()=>{e.modes.enableLineBoxMode()},children:a.LineBoxIcon||"LineBox"}),r.square&&(0,K.jsx)("button",{className:o.button,"data-active":n.selectedStamp?.id==="square",onClick:()=>{e.stamps.square()},children:a.SquareIcon||"Square"}),r.triangle&&(0,K.jsx)("button",{className:o.button,"data-active":n.selectedStamp?.id==="triangle",onClick:()=>{e.stamps.triangle()},children:a.TriangleIcon||"Triangle"}),r.hexagon&&(0,K.jsx)("button",{className:o.button,"data-active":n.selectedStamp?.id==="hexagon",onClick:()=>{e.stamps.hexagon()},children:a.HexagonIcon||"Hexagon"})]}):null,n.showBoundingBox&&r.delete&&(0,K.jsx)("button",{className:o.button,onClick:()=>e.key.down("Backspace"),children:a.DeleteForeverIcon||"Delete"})]})}var q=require("react"),no=Q(require("mitt"),1),va=require("react/jsx-runtime"),zn=(0,q.createContext)((0,no.default)());zn.displayName="SelectorHelper";function Is({children:e}){return(0,va.jsx)(zn.Provider,{value:(0,q.useMemo)(()=>(0,no.default)(),[]),children:e})}function ws(){return(0,q.useContext)(zn)}function ro(e){let t=oo(),[n,r]=(0,q.useState)(!1);(0,q.useEffect)(()=>t.withSelector(e).on("highlight",()=>{r(!0)}),[t,e]),(0,q.useEffect)(()=>t.withSelector(e).on("clear-highlight",()=>{r(!1)}),[t,e]);let o=(0,q.useCallback)(i=>{t.emit("click",{selectorId:e,event:i})},[e,t]),a=(0,q.useCallback)(i=>{t.emit("hover",{selectorId:e,event:i})},[e,t]);return{controller:t,onClick:o,onHover:a,isHighlighted:n}}function oo(){let e=(0,q.useContext)(zn);return(0,q.useMemo)(()=>({withSelector(t){return{on(n,r){let o=a=>{a&&a.selectorId===t&&r(a)};return e.on(n,o),()=>{e.off(n,o)}},emit(n,r){e.emit(n,{...r,selectorId:t})}}},on(t,n){return e.on(t,n),()=>{e.off(t,n)}},emit(t,n){e.emit(t,n)}}),[e])}function ks(){let e=oo();return(0,q.useMemo)(()=>({withSelector(t){return{highlight(){e.emit("highlight",{selectorId:t})},clearHighlight(){e.emit("clear-highlight",{selectorId:t})},zoomTo(){e.emit("zoom-to",{selectorId:t})},addEventListener(n,r){return e.emit("event-listener",{selectorId:t,name:n,callback:r}),()=>{e.emit("remove-event-listener",{selectorId:t,name:n,callback:r})}},getImagePreview(){return new Promise((n,r)=>{e.emit("image-preview-request",{selectorId:t,resolve:n,reject:r})})},on(n,r){return e.withSelector(t).on(n,r)}}},highlight(t){e.emit("highlight",{selectorId:t})},clearHighlight(t){e.emit("clear-highlight",{selectorId:t})},zoomTo(t){e.emit("zoom-to",{selectorId:t})},addEventListener(t,n,r){return e.emit("event-listener",{selectorId:t,name:n,callback:r}),()=>{e.emit("remove-event-listener",{selectorId:t,name:n,callback:r})}},getImagePreview(t){return new Promise((n,r)=>{e.emit("image-preview-request",{selectorId:t,resolve:n,reject:r})})},on(t,n){return e.on(t,n)}}),[e])}var ct=require("react"),Sa=require("react/jsx-runtime");function io(){return{default:{backgroundColor:"rgba(0,0,0,0)",borderWidth:"2px",borderColor:"rgba(252,0,98, .5)"},highlighted:{backgroundColor:"rgba(75, 103, 225, 0.4)",borderWidth:"1px",borderColor:"rgba(75,103,225,0.99)"},hidden:{borderWidth:"0px",borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(0,0,0,0)",hidden:!0}}}var ao=(0,ct.createContext)(io());ao.displayName="AnnotationStyle";function so(){return(0,ct.useContext)(ao)}function Ms({theme:e,children:t}){let n=(0,ct.useMemo)(()=>e||io(),[e]);return(0,Sa.jsx)(ao.Provider,{value:n,children:t})}var Hn=require("@atlas-viewer/atlas");var j=require("react");var lt=require("react"),xa=require("polygon-editor");function co(e,t,n){let[r,o]=(0,lt.useState)({}),a=(0,lt.useMemo)(()=>(0,xa.createHelper)(e,n),[]);return(0,lt.useEffect)(()=>(a.clock.start(t,o),()=>{a.clock.stop()}),[]),{state:r,helper:a}}var Ca=require("polygon-editor"),N=require("react/jsx-runtime"),Ae=(0,Ca.createSvgHelpers)();function lo(e,t){let{image:n,currentShape:r,onChange:o,hideShapeLines:a}=e,i=(0,j.useRef)(),s=(0,j.useRef)(),u=(0,j.useRef)(),c=(0,j.useRef)(),l=(0,j.useRef)(),d=(0,j.useRef)(),h=(0,j.useRef)(),S=(0,j.useRef)(),[v,f]=(0,j.useState)(null),[x,y]=(0,j.useState)(!1),{helper:C,state:m}=co(r,(k,ne)=>{Ae.updateTransitionBoundingBox(s.current,k,ne),Ae.updateBoundingBoxPolygon(i.current,k,ne),Ae.updateTransitionShape(d.current,k,ne),Ae.updateClosestLinePointTransform(c.current,k,ne),Ae.updateSelectBox(u.current,k,ne),Ae.updatePointLine(h.current,k,ne),Ae.updateDrawPreview(l.current,k,ne,3),Ae.updateLineBox(S.current,k),f(k.transitionDirection),y(k.transitionRotate)},o);(0,j.useEffect)(()=>{C.setShape(r||null)},t),(0,j.useEffect)(()=>{let k=()=>{C.modifiers.reset()};return document.addEventListener("mouseleave",k),()=>{document.removeEventListener("mouseleave",k)}},[]);let b=(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("marker",{id:"dot",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5",children:(0,N.jsx)("circle",{cx:"5",cy:"5",r:"4",className:"marker"})}),(0,N.jsx)("marker",{id:"selected",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5",children:(0,N.jsx)("circle",{cx:"5",cy:"5",r:"4",fill:"#FAFF00"})}),(0,N.jsx)("marker",{id:"resizer",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5",children:(0,N.jsx)("rect",{width:"10",height:"10",stroke:"#FF0DCB",fill:"#fff",strokeWidth:2})})]}),A=r?r.open?"polyline":"polygon":null,M=!m.showBoundingBox&&m.closestPoint!==null&&m.actionIntentType==="select-point",I=m.actionIntentType==="add-open-point",R=m.transitionIntentType==="split-line",B=m.transitioning&&m.selectedStamp&&m.transitionIntentType==="stamp-shape",Ke=r&&A?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(A,{fill:!m.transitioning&&m.showBoundingBox?"rgba(255, 0, 0, .5)":"none",strokeWidth:B?0:2,stroke:a?"transparent":"#000",points:r.points.map(k=>k.join(",")).join(" "),vectorEffect:"non-scaling-stroke",markerStart:m.showBoundingBox?void 0:"url(#dot)",markerMid:m.showBoundingBox?void 0:"url(#dot)",markerEnd:m.showBoundingBox?void 0:"url(#dot)",style:{pointerEvents:"none"}}),m.lineBoxMode&&m.actionIntentType==="close-line-box"?(0,N.jsx)("polygon",{fill:"rgba(255, 0, 0, .4)",ref:S,stroke:"#000",strokeWidth:2,vectorEffect:"non-scaling-stroke"}):null,m.transitionIntentType==="draw-shape"&&m.transitioning?(0,N.jsx)("polyline",{ref:l,fill:"none",stroke:"rgba(255, 0, 0, .5)",strokeWidth:2,vectorEffect:"non-scaling-stroke"}):null,!m.showBoundingBox&&m.selectedPoints&&m.selectedPoints.length?(0,N.jsx)("polyline",{strokeWidth:2,vectorEffect:"non-scaling-stroke",stroke:"transparent",markerStart:"url(#selected)",markerMid:"url(#selected)",markerEnd:"url(#selected)",fill:"transparent",points:r.points.filter((k,ne)=>m.selectedPoints?.includes(ne)).map(k=>k.join(",")).join(" ")}):null,M&&m.closestPoint!==null&&r.points[m.closestPoint]?(0,N.jsx)("polyline",{strokeWidth:2,vectorEffect:"non-scaling-stroke",stroke:"transparent",markerStart:"url(#selected)",markerMid:"url(#selected)",markerEnd:"url(#selected)",fill:"transparent",points:`${r.points[m.closestPoint][0]},${r.points[m.closestPoint][1]}`}):null,!m.transitioning&&(m.actionIntentType==="add-open-point"||m.actionIntentType==="close-shape"||m.actionIntentType==="close-shape-line")?(0,N.jsx)("polyline",{stroke:"#000",ref:h,strokeWidth:m.actionIntentType==="close-shape"?2:1,vectorEffect:"non-scaling-stroke"}):null,m.hasClosestLine&&(!m.transitionIntentType||m.transitionIntentType==="split-line")?(0,N.jsx)("g",{ref:c,children:(0,N.jsx)("polyline",{style:{opacity:.5},markerStart:"url(#dot)",points:"0,0 10,10",vectorEffect:"non-scaling-stroke",fill:"transparent",strokeWidth:2})}):null,m.transitioning?(0,N.jsx)(A,{ref:d,fill:r.open?"none":"rgba(255, 0, 0, .5)",stroke:"rgba(255, 0, 0, .5)",strokeWidth:r.open?2:0}):null,m.transitioning&&m.transitionIntentType==="select-multiple-points"?(0,N.jsx)("rect",{ref:u,fill:"rgba(255, 255, 255, .3)",strokeWidth:1,stroke:"rgba(0,0,0,.2)",vectorEffect:"non-scaling-stroke"}):null,m.showBoundingBox?null:(0,N.jsx)("g",{name:"controls",children:!1}),m.showBoundingBox&&!B?(0,N.jsx)("polygon",{ref:i,strokeWidth:2,stroke:"#FF0DCB",fill:"none",markerStart:"url(#resizer)",markerMid:"url(#resizer)",markerEnd:"url(#resizer)",vectorEffect:"non-scaling-stroke"}):null]}):null;return{helper:C,state:m,isAddingPoint:I,isSplitting:R,isStamping:B,isHoveringPoint:M,transitionDirection:v,transitionRotate:x,defs:b,editor:Ke}}var On=require("react"),ba=require("react-dom"),J=require("react/jsx-runtime"),Ra=[{name:"Default",outer:{borderWidth:4,borderColor:"rgba(255, 255, 255, .4)"},inner:{borderWidth:2,borderColor:"#000"}},{name:"High contrast",outer:{borderWidth:3,borderColor:"#fff"},inner:{borderWidth:1,borderColor:"#000"}},{name:"Lightsaber",outer:{borderWidth:"4",borderColor:"rgba(56,68,255,0.64)"},inner:{borderWidth:"2",borderColor:"#fff"}},{name:"Bright",outer:{borderWidth:"6",borderColor:"#25d527"},inner:{borderWidth:"3",borderColor:"#a916ff"}},{name:"pink",outer:{borderWidth:"4",borderColor:"#ff00ff"},inner:{borderWidth:"2",borderColor:"#ffffff"}},{name:"fine (dark)",outer:{borderWidth:"1",borderColor:"#000000"},inner:{}},{name:"fine (light)",outer:{borderWidth:"1",borderColor:"#FFF"},inner:{}}];function uo(e){let t=e.theme||Ra[0],n=(0,Hn.useAtlas)(),{image:r}=e,{helper:o,defs:a,editor:i,state:s,transitionDirection:u,isSplitting:c,transitionRotate:l,isHoveringPoint:d,isAddingPoint:h,isStamping:S}=lo({currentShape:e.shape||null,onChange:e.updateShape,image:e.image,hideShapeLines:!0},[]),v=m=>{o.pointer([[~~m.atlas.x,~~m.atlas.y]])};(0,On.useEffect)(()=>{let m=b=>{o.key.up(b.key)};return document.addEventListener("keyup",m),()=>{document.removeEventListener("keyup",m)}},[]),(0,On.useEffect)(()=>{let m=b=>{o.key.down(b.key)};return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[]),(0,On.useEffect)(()=>{let m=[];return u&&m.push(`atlas-cursor-${u}`),s.actionIntentType==="cut-line"&&s.modifiers?.Shift&&m.push("atlas-cursor-cut"),(d||s.transitionIntentType==="move-shape"||s.transitionIntentType==="move-point")&&m.push("atlas-cursor-move"),h&&m.push("atlas-cursor-crosshair"),c&&m.push("atlas-cursor-copy"),l&&m.push("atlas-cursor-rotate"),s.transitionIntentType==="draw-shape"&&m.push("atlas-cursor-draw"),n?.canvas&&n.canvas.classList.add(...m),()=>{n?.canvas&&n.canvas.classList.remove(...m)}},[n?.canvas,h,d,c,s.modifiers?.Shift,s.actionIntentType,s.transitionIntentType,u,l]);let f=e.shape&&e.shape?.points.length===0,x=e.renderControls?e.renderControls(o,s,f):null,y=document.getElementById(e.controlsHtmlId||"atlas-controls"),C="shape";return(0,J.jsx)(J.Fragment,{children:(0,J.jsxs)("world-object",{height:r.height,width:r.width,onMouseMove:v,onMouseDown:o.pointerDown,onMouseUp:o.pointerUp,onMouseLeave:o.blur,children:[e.shape?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(C,{open:e.shape.open,points:e.shape.points,relativeStyle:!0,style:S?{}:t.outer}),(0,J.jsx)(C,{open:e.shape.open,points:e.shape.points,relativeStyle:!0,style:S?{}:t.inner})]}):null,(0,J.jsxs)(Hn.HTMLPortal,{relative:!0,interactive:!1,children:[(0,J.jsx)("div",{style:{position:"absolute",top:0,right:0,left:0,bottom:0},children:(0,J.jsxs)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${r.width} ${r.height}`,tabIndex:-1,children:[(0,J.jsx)("defs",{children:a}),i]})}),y?(0,ba.createPortal)(x,y,"controls"):null]})]})})}var mo=require("react/jsx-runtime");function Es(e){let t=P(),n=e.annotationBucket,r=e.readOnly,o=e.id,{onClick:a,isHighlighted:i}=ro(e.id),s=so(),u=i?s.highlighted:s[n||"hidden"]||s.hidden;if(!t)return null;if(r){let c="shape",l=e.polygon,d=l.open;return l?(0,mo.jsx)(c,{id:`shape-${o}`,points:l.points,open:d,onClick:a,relativeStyle:!0,target:{x:0,y:0,width:t.width,height:t.height},style:u}):null}return(0,mo.jsx)(uo,{image:t,shape:e.polygon||{id:e.id,open:!0,points:[]},updateShape:e.updatePolygon,theme:e.theme,controlsHtmlId:e.controlsHtmlId,renderControls:e.renderControls})}var Bn=require("react"),Pa=require("react-error-boundary");var Te=require("react/jsx-runtime");function Ns({src:e,errorFallback:t,interactive:n,skipSizes:r,children:o,renderViewerControls:a,viewControlsDeps:i,fluid:s,x:u,y:c,...l}){let[d,h]=(0,Bn.useState)(),S=t||nn,[v,f]=kt(),x=(0,Bn.useMemo)(()=>{let C=f[e]?.status,m=v({id:e},{});return m?.height&&m.width&&C!=="loading"?{id:e,width:m.width,height:m.height,service:m,type:"Image",selector:{type:"BoxSelector",spatial:{x:0,y:0,width:m.width,height:m.height}},target:{type:"BoxSelector",spatial:{x:0,y:0,width:m.width,height:m.height}}}:null},[v,e,f]);if(D(d&&a?"overlay":"none",`canvas-portal-controls-${e}`,oe.Provider,a&&x?{value:d||null,children:a({image:x,images:[x],type:"images"})}:{},[e,x,d,...i||[]]),!x||!x.height||!x.width)return null;let y=s?void 0:l.homePosition?l.homePosition.width/l.homePosition.height:x.width/x.height;return(0,Te.jsx)(Pa.ErrorBoundary,{resetKeys:[],fallbackRender:C=>(0,Te.jsx)(S,{...l,...C}),children:(0,Te.jsx)(an,{...l,aspectRatio:y,containerProps:{style:{position:"relative"},...l.containerProps||{}},onCreated:C=>{h(C),l.onCreated&&l.onCreated(C)},children:(0,Te.jsxs)(oe.Provider,{value:d,children:[(0,Te.jsx)(Ce,{image:x,id:x.id,isStatic:!n,x:u,y:c},x.id),(0,Te.jsx)(Vs,{viewerPreset:d,renderViewerControls:a,image:x,src:e,viewControlsDeps:i}),o]})})})}function Vs({viewerPreset:e,renderViewerControls:t,image:n,src:r,viewControlsDeps:o}){return D(e&&t?"overlay":"none",`canvas-portal-controls-${r}`,oe.Provider,t&&n?{value:e||null,children:t({image:n,images:[n],type:"images"})}:{},[r,e,...o||[]]),null}var Aa=require("react/jsx-runtime");function Ls({annotation:e,children:t}){return(0,Aa.jsx)(W,{value:{annotation:e},children:t})}var Ta=require("react/jsx-runtime");function zs({annotationPage:e,children:t}){return(0,Ta.jsx)(W,{value:{annotationPage:e},children:t})}var Ia=require("react/jsx-runtime");function Os({collection:e,children:t}){return(0,Ia.jsx)(W,{value:{collection:e},children:t})}function Hs(e,t={}){return Oe(t)}var wa=require("@atlas-viewer/atlas"),Ie=require("react");function Bs({canvasId:e}={}){let t=(0,wa.useCanvas)(),n=Ee(),r=(0,Ie.useMemo)(()=>e?[e]:t?[t.id]:n.map(c=>c.id),[e,t,n]),[o,a]=(0,Ie.useState)({}),i=St();(0,Ie.useEffect)(()=>{let c=l=>{let d=l.partOf.canvasId;d&&a(h=>({...h,[d]:l.choice}))};return i.on("choice-change",c),()=>{i.off("choice-change",c)}},[]);let s=(0,Ie.useMemo)(()=>{let c=[];for(let l of r){let d=o[l];d&&c.push({canvasId:l,choice:d})}return c},[r,o]),u=(0,Ie.useMemo)(()=>({makeChoice:(c,l)=>{i.emit("make-choice",{choiceId:c,...l})}}),[i]);return{choices:s,actions:u}}function Ds(e,t=!1){}function Fs(e){let n=$().manifest,r=e?e.map(o=>typeof o=="string"?o:o?.id):[];return w(o=>{let a=n?o.iiif.entities.Manifest[n]:void 0,i=a?.items||[];if(typeof e>"u")return i;let s=[];for(let u of a?.items||[])r.indexOf(u.id)!==-1&&s.push(u);return s},[r.join("/")])}var ka=require("react");function qs(e,t=[]){let{id:n,selector:r}=e,o=$(),a=n||o.collection,i=w(s=>a?s.iiif.entities.Collection[a]:void 0,[a]);return(0,ka.useMemo)(()=>{if(i)return r?r(i):i},[i,r,...t])}var Dn=require("react"),Ma=require("@iiif/helpers/events");function $s(e,t,n,r,o=[]){let a=T(),i=(0,Dn.useMemo)(()=>(0,Ma.createEventsHelper)(a),[a]);(0,Dn.useEffect)(()=>{let s=e;return s?(i.addEventListener(s,t,n,r),()=>{i.removeEventListener(s,t,n)}):()=>{}},[i,e,t,...o])}function Ws(e,t){let{id:n,isLoaded:r,error:o,resource:a,requestId:i,cached:s}=ft(e,t);return{id:n,isLoaded:r,error:o,manifest:a,requestId:i,cached:s}}var fo=require("@iiif/parser/image-3");var de=require("react");function po({cacheKey:e}={}){let t=P(),n=Oe(),r=T(),o=rt(),a=gi(),[i,s]=(0,de.useState)(void 0),[u,c]=(0,de.useState)(!1),[l,d]=(0,de.useState)("idle"),[h,S]=(0,de.useState)(void 0),v=t?t.id:"undefined",f=(0,de.useMemo)(()=>{try{if(t&&n.length){let y=n[0],C=r.get(y.body[0]),b=(0,fo.getImageServices)(C)[0];return b&&o(b,{width:b.width||t.width,height:b.height||t.height},!0)||void 0}}catch(y){console.error(y)}},[v,e,t]),x=l==="success"&&i?i:f;return(0,de.useEffect)(()=>{(async()=>{try{if(t&&n.length){let y=n[0],C=r.get(y.body[0]),b=(0,fo.getImageServices)(C)[0];if(!b)return;c(!0),d("loading");try{let A=await a(b,{width:b.width||t.width,height:b.height||t.height})||void 0;s(A),d("success"),c(!1)}catch(A){d("error"),S(A)}}}catch(y){d("error"),S(y)}})()},[v,e]),(0,de.useMemo)(()=>({data:x,isFetching:u,status:l,error:h}),[x,u,l,h])}function Us(){let e=po();return{isLoading:e.isFetching,tile:e.data?{id:e.data.id||e.data["@id"],width:e.data.width,height:e.data.height,imageService:e.data,thumbnail:void 0}:null}}var Ea=require("@iiif/helpers/styles"),Na=require("react");function _s(){let e=T();return(0,Na.useMemo)(()=>(0,Ea.createStylesHelper)(e),[e])}g(p,require("@iiif/helpers/annotation-targets"),module.exports);
