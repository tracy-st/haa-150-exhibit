const e=require(`./chunk-DEHCWMz8.cjs`),t=require(`./vanilla-Bv6fw5Yf.cjs`),n=require(`./batch-actions-X7z9ogvf.cjs`),r=require(`./meta-actions-BmpamiE1.cjs`),i=require(`./get-default-entities-BWd2QOCg.cjs`),a=e.__toESM(require(`@iiif/parser`)),o=(e,t)=>(n,r,i)=>(i.dispatch=t=>(n(n=>e(n,t),!1,t),t),i.dispatchFromDevtools=!0,{dispatch:(...e)=>i.dispatch(...e),...t}),s=o,c=new Map,l=e=>{let t=c.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},u=(e,t,n)=>{if(e===void 0)return{type:`untracked`,connection:t.connect(n)};let r=c.get(n.name);if(r)return{type:`tracked`,store:e,...r};let i={connection:t.connect(n),stores:{}};return c.set(n.name,i),{type:`tracked`,store:e,...i}},d=(e,t={})=>(n,r,i)=>{let{enabled:a,anonymousActionType:o,store:s,...c}=t,d;try{d=(a??({}.env?{}.env.MODE:void 0)!==`production`)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return({}.env?{}.env.MODE:void 0)!==`production`&&a&&console.warn(`[zustand devtools middleware] Please install/enable Redux devtools extension`),e(n,r,i);let{connection:f,...m}=u(s,d,c),h=!0;i.setState=(e,t,a)=>{let u=n(e,t);if(!h)return u;let d=a===void 0?{type:o||`anonymous`}:typeof a==`string`?{type:a}:a;return s===void 0?(f?.send(d,r()),u):(f?.send({...d,type:`${s}/${d.type}`},{...l(c.name),[s]:i.getState()}),u)};let g=(...e)=>{let t=h;h=!1,n(...e),h=t},_=e(i.setState,r,i);if(m.type===`untracked`?f?.init(_):(m.stores[m.store]=i,f?.init(Object.fromEntries(Object.entries(m.stores).map(([e,t])=>[e,e===m.store?_:t.getState()])))),i.dispatchFromDevtools&&typeof i.dispatch==`function`){let e=!1,t=i.dispatch;i.dispatch=(...n)=>{({}.env?{}.env.MODE:void 0)!==`production`&&n[0].type===`__setState`&&!e&&(console.warn(`[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.`),e=!0),t(...n)}}return f.subscribe(e=>{var t;switch(e.type){case`ACTION`:if(typeof e.payload!=`string`){console.error(`[zustand devtools middleware] Unsupported action format`);return}return p(e.payload,e=>{if(e.type===`__setState`){if(s===void 0){g(e.state);return}Object.keys(e.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[s];if(t==null)return;JSON.stringify(i.getState())!==JSON.stringify(t)&&g(t);return}i.dispatchFromDevtools&&typeof i.dispatch==`function`&&i.dispatch(e)});case`DISPATCH`:switch(e.payload.type){case`RESET`:return g(_),s===void 0?f?.init(i.getState()):f?.init(l(c.name));case`COMMIT`:if(s===void 0){f?.init(i.getState());return}return f?.init(l(c.name));case`ROLLBACK`:return p(e.state,e=>{if(s===void 0){g(e),f?.init(i.getState());return}g(e[s]),f?.init(l(c.name))});case`JUMP_TO_STATE`:case`JUMP_TO_ACTION`:return p(e.state,e=>{if(s===void 0){g(e);return}JSON.stringify(i.getState())!==JSON.stringify(e[s])&&g(e[s])});case`IMPORT_STATE`:{let{nextLiftedState:n}=e.payload,r=(t=n.computedStates.slice(-1)[0])?.state;if(!r)return;g(s===void 0?r:r[s]),f?.send(null,n);return}case`PAUSE_RECORDING`:return h=!h}return}}),_},f=d,p=(e,t)=>{let n;try{n=JSON.parse(e)}catch(e){console.error(`[zustand devtools middleware] Could not parse the received json`,e)}n!==void 0&&t(n)},m=e=>(t,n,r)=>{let i=r.subscribe;r.subscribe=(e,t,n)=>{let a=e;if(t){let i=n?.equalityFn||Object.is,o=e(r.getState());a=n=>{let r=e(n);if(!i(o,r)){let e=o;t(o=r,e)}},n?.fireImmediately&&t(o,o)}return i(a)};let a=e(t,n,r);return a},h=m,g=(e={},t)=>{switch(t.type){case n.ADD_MAPPING:return{...e,[t.payload.id]:t.payload.type};case n.ADD_MAPPINGS:return{...e,...t.payload.mapping};default:return e}};function _(e,t,n,r){return!(!e[n]||!e[n][t]||!e[n][t][r]||!Array.isArray(e[n][t][r]))}function v(e,t){let n={},r=[];for(let[i,a]of Object.entries(e||{})){r.push(i);let e=(t||{})[i];if(!e||e.length===0){n[i]=a;continue}n[i]=e}for(let[e,i]of Object.entries(t||{})){if(r.indexOf(e)!==-1)continue;n[e]=i}return n}function y(e){return e.payload||{}}function b(e,t,n){if(!e[t]||!Array.isArray(e[t]))return null;let r=n.index===void 0?e[t].findIndex(e=>e?(0,a.toRef)(e)?.id===n.id:!1):n.index;return r===-1?null:{entity:e[t][r],index:r}}function x(e,t){if(!(!t?.id||!t?.type))return e[t.type]?.[t.id]}function S(e,t){return e===void 0?t:e}const C=(e=i.getDefaultEntities(),t)=>{let r=(n,r)=>({...e,[y(t).type]:{...e[y(t).type],[y(t).id]:{...n,...r}}});switch(t.type){case n.MODIFY_ENTITY_FIELD:{if(!e[y(t).type]||!e[y(t).type][y(t).id])return e;let n=e[y(t).type][y(t).id];return typeof n==`string`?e:r(n,{[y(t).key]:y(t).value})}case n.REORDER_ENTITY_FIELD:{if(!_(e,y(t).id,y(t).type,y(t).key))return e;let n=e[y(t).type][y(t).id];if(typeof n==`string`)return e;let i=Array.from(n[y(t).key]),[a]=i.splice(y(t).startIndex,1);return i.splice(y(t).endIndex,0,a),r(n,{[y(t).key]:i})}case n.MOVE_ENTITIES:{let n=y(t).subjects,r=y(t).from,i=y(t).to||r,a=x(e,r),o=i?.key||r.key;if(!_(e,r.id,r.type,r.key)||!_(e,i.id,i.type,i.key))return e;let s=[],c=[];if(n.type===`slice`){let e=n.startIndex,t=n.length;s=Array.from(a[r.key]),c=s.splice(e,t)}else{let e=Array.from(a[r.key]);for(let t of n.items){let n=b(a,r.key,t);n&&(c.push(n.entity),e[n.index]=null),s=e.filter(e=>e!==null)}}let l={...a,[r.key]:s},u={...e,[r.type]:{...e[r.type],[r.id]:l}},d=x(u,i);if(!d)return e;let f=i?.index===void 0?d[o].length:i.index,p=Array.from(d[i.key]);p.splice(f,0,...c);let m={...d,[o]:p},h={...u,[i.type]:{...u[i.type],[i.id]:m}};return h}case n.MOVE_ENTITY:return C(e,{type:n.MOVE_ENTITIES,payload:{subjects:{type:`list`,items:[y(t).subject]},from:y(t).from,to:y(t).to}});case n.IMPORT_ENTITIES:{let n=Object.keys(y(t).entities),r={...e};for(let i of n){let n=y(t).entities[i],a={...e[i]||{}},o=!1,s=Object.keys(n||{})||[];if(n&&s){for(let t of s)o=!0,a[t]=e[i][t]?v(e[i][t],n[t]):n[t];o&&(r[i]=a)}}return r}case n.ADD_REFERENCE:{if(!_(e,y(t).id,y(t).type,y(t).key))return e;let n=e[y(t).type][y(t).id],i=Array.from(n[y(t).key]);return i.splice(S(y(t).index,i.length+1),0,y(t).reference),r(n,{[y(t).key]:i})}case n.UPDATE_REFERENCE:case n.REMOVE_REFERENCE:{if(!_(e,y(t).id,y(t).type,y(t).key))return e;let i=e[y(t).type][y(t).id],a=Array.from(i[y(t).key]),o=S(y(t).index,a.findIndex(e=>e&&e.id===y(t).reference.id));return o===-1||a[o]?.id!==y(t).reference.id?e:(t.type===n.UPDATE_REFERENCE?a.splice(o,1,y(t).reference):a.splice(o,1),r(i,{[y(t).key]:a}))}case n.ADD_METADATA:{let n=e[y(t).type][y(t).id];if(!n)return e;let i=Array.from(n.metadata||[]),a=y(t);return i.splice(S(t.payload.beforeIndex,i.length+1),0,{label:a.label,value:a.label}),r(n,{metadata:i})}case n.REORDER_METADATA:{let n=e[y(t).type][y(t).id];if(typeof n==`string`||!n)return e;let i=Array.from(n.metadata||[]),[a]=i.splice(y(t).startIndex,1);return i.splice(y(t).endIndex,0,a),r(n,{metadata:i})}case n.UPDATE_METADATA:case n.REMOVE_METADATA:{let i=e[y(t).type][y(t).id],a=Array.from(i.metadata||[]),o=y(t).atIndex;return o===void 0||o===-1||!a[o]?e:(t.type===n.UPDATE_METADATA?a.splice(o,1,{label:y(t).label,value:y(t).value}):a.splice(o,1),r(i,{metadata:a}))}default:return e}},w=(e={},t)=>{switch(t.type){case n.REQUEST_RESOURCE:case n.REQUEST_OFFLINE_RESOURCE:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:n.RESOURCE_LOADING,uriMismatch:!1,resourceUri:t.payload.id}};case n.REQUEST_MISMATCH:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case n.REQUEST_ERROR:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:n.RESOURCE_ERROR,error:t.payload.message}};case n.REQUEST_COMPLETE:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:n.RESOURCE_READY,error:void 0}}}return e},T=(e={},t)=>{let{id:n,updateValue:i,value:a,meta:o,key:s}=t&&t.payload||{};switch(t.type){case r.SET_META_VALUE:return{...e,[n]:{...e[n]||{},[o]:{...e[n]&&e[n][o]||{},[s]:a}}};case r.SET_META_VALUE_DYNAMIC:return{...e,[n]:{...e[n]||{},[o]:{...e[n]&&e[n][o]||{},[s]:e[n]&&e[n][o]?i(e[n][o][s]):i(void 0)}}};case r.UNSET_META_VALUE:return e[n]&&e[n][o]&&e[n][o][s]?{...e,[n]:{...e[n]||{},[o]:{...e[n]&&e[n][o]||{},[s]:void 0}}}:e;default:return e}};function E(e={}){let t=Object.keys(e);return function(n={},r){let i=!1,a={};for(let o=0;o<t.length;o++){let s=t[o];a[s]=e[s](n[s],r),i||=a[s]!==n[s]}return i?a:n}}function D(e){return(t,r)=>r&&r.type===n.BATCH_ACTIONS?r.payload.actions.reduce(e,t):r&&r.type===n.BATCH_IMPORT?{...t,iiif:{...t.iiif,...r.payload.state}}:e(t,r)}const O=E({mapping:g,entities:C,requests:w,meta:T});function k(){return{iiif:{entities:i.getDefaultEntities(),meta:{},mapping:{},requests:{}}}}function A(e={}){let{enableDevtools:n=!1,iiifStoreName:r=`iiif`,defaultState:i=k(),customReducers:a={}}=e,o=D(E({[r]:O,...a})),c=!!(typeof window<`u`&&window.__REDUX_DEVTOOLS_EXTENSION__),l=!c||process.env.NODE_ENV===`test`?(e,t)=>e:f;return t.createStore(h(l(s(o,i),{enabled:n})))}Object.defineProperty(exports,`createStore`,{enumerable:!0,get:function(){return A}}),Object.defineProperty(exports,`reducers`,{enumerable:!0,get:function(){return O}});