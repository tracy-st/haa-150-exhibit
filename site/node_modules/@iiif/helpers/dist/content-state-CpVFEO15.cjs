const e=require(`./expand-target-CjBhcgOE.cjs`);function t(e,n=!1){if(typeof e==`string`){if(e.startsWith(`{`))try{let n=JSON.parse(e);return t(n)}catch{return[!1,{reason:`Invalid JSON`}]}return[!0]}if(Array.isArray(e)){for(let n of e){let[e,r]=t(n);if(!e&&r)return[e,r]}return[!0]}return e.type===`Annotation`?[!0]:n&&e.type===`Canvas`&&!e.partOf?[!1,{reason:`Canvas without partOf cannot be loaded`}]:[!0]}function n(e){return i(typeof e==`string`?e:JSON.stringify(e))}function r(e,t){if(e=e.trim(),e[0]===`{`)return t?Promise.resolve(JSON.parse(e)):JSON.parse(e);if(e.startsWith(`http`)){if(!t)throw Error(`Cannot fetch remote fetch with async=false in parseContentState`);return fetch(e).then(e=>e.json())}return r(a(e),t)}function i(e){let t=encodeURIComponent(e),n=typeof btoa>`u`?Buffer.from(t,`utf-8`).toString(`base64`):btoa(t),r=n.replace(/\+/g,`-`).replace(/\//g,`_`);return r.replace(/=/g,``)}function a(e){let t=o(e),n=t.replace(/-/g,`+`).replace(/_/g,`/`),r=typeof atob>`u`?Buffer.from(n,`base64`).toString(`utf-8`):atob(n);return decodeURIComponent(r).trim()}function o(e){let t=e.length%4;if(t===1)throw Error(`InvalidLengthError: Input base64url string is the wrong length to determine padding`);return e+(t?`====`.slice(0,4-t):``)}function s(t){if(!t)throw Error(`Content state is empty`);Array.isArray(t)||(t=[t]);let n=`vault://virtual-annotation/`+new Date().getTime(),r=[`contentState`],i=[];for(let a of t){if(typeof a==`string`)throw Error(`Content state is a [String] type and cannot be inferred`);if(a.type===`Annotation`){if(n=a.id,Array.isArray(a.motivation))for(let e of a.motivation)r.indexOf(e)===-1&&r.push(e);if(Array.isArray(a.target))for(let t of a.target){let n=e.expandTarget(t);i.push(n)}else{let t=e.expandTarget(a.target);i.push(t)}continue}let t=e.expandTarget(a);i.push(t)}return{id:n,type:`Annotation`,motivation:[`contentState`,...t.motivation||[]],target:i,extensions:{}}}Object.defineProperty(exports,`decodeContentState`,{enumerable:!0,get:function(){return a}}),Object.defineProperty(exports,`encodeContentState`,{enumerable:!0,get:function(){return i}}),Object.defineProperty(exports,`normaliseContentState`,{enumerable:!0,get:function(){return s}}),Object.defineProperty(exports,`parseContentState`,{enumerable:!0,get:function(){return r}}),Object.defineProperty(exports,`serialiseContentState`,{enumerable:!0,get:function(){return n}}),Object.defineProperty(exports,`validateContentState`,{enumerable:!0,get:function(){return t}});