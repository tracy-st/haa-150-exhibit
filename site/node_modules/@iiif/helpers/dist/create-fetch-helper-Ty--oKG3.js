import{RESOURCE_ERROR as e,RESOURCE_LOADING as t,RESOURCE_READY as n,addMapping as r,addMappings as i,batchActions as a,importEntities as o,requestComplete as s,requestError as c,requestMismatch as l,requestResource as u}from"./batch-actions-BILnVnlf.js";import{HAS_PART as d,PART_OF as f,frameResource as p,normalize as m}from"@iiif/parser";const h=(e,t)=>{let{entities:n,resource:a,mapping:u}=m(t);if(a.id===void 0)return[c({id:e,message:`ID is not defined in resource.`})];let d=[o({entities:n}),i({mapping:u})];return a.id!==e&&(d.push(r({id:e,type:a.type})),d.push(l({requestId:e,actualId:a.id}))),d.push(s({id:e})),d},g=Number.isNaN||function(e){return typeof e==`number`&&e!==e};function _(e,t){return!!(e===t||g(e)&&g(t))}function v(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!_(e[n],t[n]))return!1;return!0}function y(e,t,n){let r=e.iiif.requests[t],i=e.iiif.mapping[t];if(!i||!e.iiif.entities[i][r.resourceUri])return;let a=e.iiif.entities[i][r.resourceUri];if(a&&a[d]){let e=a[d].find(e=>n?e[f]===n.id:e[f]===a.id);return p(a,e)}return a}function b(e){return e&&typeof e.then==`function`}function x(r,i,{waitTimeout:o=30}={}){return(s,l,d)=>{let f=r.getStore(),p=f.getState(),m=p.iiif.requests[s];if(m){if(m.loadingState===n){let e=y(p,s);if(e)return e}switch(m.loadingState){case e:break;case t:return(async()=>{let t,r=!1;try{let i=await Promise.race([new Promise((i,a)=>{r||(t=f.subscribe(()=>{let t=f.getState();if(t.iiif.requests[s].loadingState===e){a();return}if(t.iiif.requests[s].loadingState===n){let e=y(t,s);e?i(e):a()}}))}),new Promise((e,t)=>setTimeout(()=>{r=!0,t()},o*60*1e3))]);if(t&&t(),i)return i}catch{t&&t()}})()}}r.dispatch(u({id:s}));let g=e=>{if(!e)return;!e.id&&!e[`@id`]&&(e[`@type`]&&(e[`@id`]=s),e.id=s);let t=h(s,e);return r.dispatch(a({actions:t})),y(f.getState(),s)};try{let e=i(s,l);return b(e)?(async()=>{try{let t=await e;return d&&(t=d(t)),g(t)}catch(e){throw r.dispatch(c({id:s,message:e.toString()})),e}})():g(d?d(e):e)}catch(e){throw r.dispatch(c({id:s,message:e.toString()})),e}}}export{h as actionListFromResource,v as areInputsEqual,x as createFetchHelper,y as resolveIfExists};
//# sourceMappingURL=create-fetch-helper-Ty--oKG3.js.map