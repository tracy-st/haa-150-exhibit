import{createStore as e}from"./vanilla-CQtPfF5u.js";import{ADD_MAPPING as t,ADD_MAPPINGS as n,ADD_METADATA as r,ADD_REFERENCE as i,BATCH_ACTIONS as a,BATCH_IMPORT as o,IMPORT_ENTITIES as s,MODIFY_ENTITY_FIELD as c,MOVE_ENTITIES as l,MOVE_ENTITY as u,REMOVE_METADATA as d,REMOVE_REFERENCE as f,REORDER_ENTITY_FIELD as p,REORDER_METADATA as m,REQUEST_COMPLETE as h,REQUEST_ERROR as g,REQUEST_MISMATCH as _,REQUEST_OFFLINE_RESOURCE as v,REQUEST_RESOURCE as y,RESOURCE_ERROR as b,RESOURCE_LOADING as x,RESOURCE_READY as S,UPDATE_METADATA as C,UPDATE_REFERENCE as w}from"./batch-actions-BILnVnlf.js";import{SET_META_VALUE as T,SET_META_VALUE_DYNAMIC as E,UNSET_META_VALUE as D}from"./meta-actions-D2Y8oeA0.js";import{getDefaultEntities as O}from"./get-default-entities-CMS8y0ZA.js";import{toRef as k}from"@iiif/parser";const A=(e,t)=>(n,r,i)=>(i.dispatch=t=>(n(n=>e(n,t),!1,t),t),i.dispatchFromDevtools=!0,{dispatch:(...e)=>i.dispatch(...e),...t}),j=A,M=new Map,N=e=>{let t=M.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},P=(e,t,n)=>{if(e===void 0)return{type:`untracked`,connection:t.connect(n)};let r=M.get(n.name);if(r)return{type:`tracked`,store:e,...r};let i={connection:t.connect(n),stores:{}};return M.set(n.name,i),{type:`tracked`,store:e,...i}},F=(e,t={})=>(n,r,i)=>{let{enabled:a,anonymousActionType:o,store:s,...c}=t,l;try{l=(a??(import.meta.env?import.meta.env.MODE:void 0)!==`production`)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!l)return(import.meta.env?import.meta.env.MODE:void 0)!==`production`&&a&&console.warn(`[zustand devtools middleware] Please install/enable Redux devtools extension`),e(n,r,i);let{connection:u,...d}=P(s,l,c),f=!0;i.setState=(e,t,a)=>{let l=n(e,t);if(!f)return l;let d=a===void 0?{type:o||`anonymous`}:typeof a==`string`?{type:a}:a;return s===void 0?(u?.send(d,r()),l):(u?.send({...d,type:`${s}/${d.type}`},{...N(c.name),[s]:i.getState()}),l)};let p=(...e)=>{let t=f;f=!1,n(...e),f=t},m=e(i.setState,r,i);if(d.type===`untracked`?u?.init(m):(d.stores[d.store]=i,u?.init(Object.fromEntries(Object.entries(d.stores).map(([e,t])=>[e,e===d.store?m:t.getState()])))),i.dispatchFromDevtools&&typeof i.dispatch==`function`){let e=!1,t=i.dispatch;i.dispatch=(...n)=>{(import.meta.env?import.meta.env.MODE:void 0)!==`production`&&n[0].type===`__setState`&&!e&&(console.warn(`[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.`),e=!0),t(...n)}}return u.subscribe(e=>{var t;switch(e.type){case`ACTION`:if(typeof e.payload!=`string`){console.error(`[zustand devtools middleware] Unsupported action format`);return}return L(e.payload,e=>{if(e.type===`__setState`){if(s===void 0){p(e.state);return}Object.keys(e.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[s];if(t==null)return;JSON.stringify(i.getState())!==JSON.stringify(t)&&p(t);return}i.dispatchFromDevtools&&typeof i.dispatch==`function`&&i.dispatch(e)});case`DISPATCH`:switch(e.payload.type){case`RESET`:return p(m),s===void 0?u?.init(i.getState()):u?.init(N(c.name));case`COMMIT`:if(s===void 0){u?.init(i.getState());return}return u?.init(N(c.name));case`ROLLBACK`:return L(e.state,e=>{if(s===void 0){p(e),u?.init(i.getState());return}p(e[s]),u?.init(N(c.name))});case`JUMP_TO_STATE`:case`JUMP_TO_ACTION`:return L(e.state,e=>{if(s===void 0){p(e);return}JSON.stringify(i.getState())!==JSON.stringify(e[s])&&p(e[s])});case`IMPORT_STATE`:{let{nextLiftedState:n}=e.payload,r=(t=n.computedStates.slice(-1)[0])?.state;if(!r)return;p(s===void 0?r:r[s]),u?.send(null,n);return}case`PAUSE_RECORDING`:return f=!f}return}}),m},I=F,L=(e,t)=>{let n;try{n=JSON.parse(e)}catch(e){console.error(`[zustand devtools middleware] Could not parse the received json`,e)}n!==void 0&&t(n)},R=e=>(t,n,r)=>{let i=r.subscribe;r.subscribe=(e,t,n)=>{let a=e;if(t){let i=n?.equalityFn||Object.is,o=e(r.getState());a=n=>{let r=e(n);if(!i(o,r)){let e=o;t(o=r,e)}},n?.fireImmediately&&t(o,o)}return i(a)};let a=e(t,n,r);return a},z=R,B=(e={},r)=>{switch(r.type){case t:return{...e,[r.payload.id]:r.payload.type};case n:return{...e,...r.payload.mapping};default:return e}};function V(e,t,n,r){return!(!e[n]||!e[n][t]||!e[n][t][r]||!Array.isArray(e[n][t][r]))}function H(e,t){let n={},r=[];for(let[i,a]of Object.entries(e||{})){r.push(i);let e=(t||{})[i];if(!e||e.length===0){n[i]=a;continue}n[i]=e}for(let[e,i]of Object.entries(t||{})){if(r.indexOf(e)!==-1)continue;n[e]=i}return n}function U(e){return e.payload||{}}function W(e,t,n){if(!e[t]||!Array.isArray(e[t]))return null;let r=n.index===void 0?e[t].findIndex(e=>e?k(e)?.id===n.id:!1):n.index;return r===-1?null:{entity:e[t][r],index:r}}function G(e,t){if(!(!t?.id||!t?.type))return e[t.type]?.[t.id]}function K(e,t){return e===void 0?t:e}const q=(e=O(),t)=>{let n=(n,r)=>({...e,[U(t).type]:{...e[U(t).type],[U(t).id]:{...n,...r}}});switch(t.type){case c:{if(!e[U(t).type]||!e[U(t).type][U(t).id])return e;let r=e[U(t).type][U(t).id];return typeof r==`string`?e:n(r,{[U(t).key]:U(t).value})}case p:{if(!V(e,U(t).id,U(t).type,U(t).key))return e;let r=e[U(t).type][U(t).id];if(typeof r==`string`)return e;let i=Array.from(r[U(t).key]),[a]=i.splice(U(t).startIndex,1);return i.splice(U(t).endIndex,0,a),n(r,{[U(t).key]:i})}case l:{let n=U(t).subjects,r=U(t).from,i=U(t).to||r,a=G(e,r),o=i?.key||r.key;if(!V(e,r.id,r.type,r.key)||!V(e,i.id,i.type,i.key))return e;let s=[],c=[];if(n.type===`slice`){let e=n.startIndex,t=n.length;s=Array.from(a[r.key]),c=s.splice(e,t)}else{let e=Array.from(a[r.key]);for(let t of n.items){let n=W(a,r.key,t);n&&(c.push(n.entity),e[n.index]=null),s=e.filter(e=>e!==null)}}let l={...a,[r.key]:s},u={...e,[r.type]:{...e[r.type],[r.id]:l}},d=G(u,i);if(!d)return e;let f=i?.index===void 0?d[o].length:i.index,p=Array.from(d[i.key]);p.splice(f,0,...c);let m={...d,[o]:p},h={...u,[i.type]:{...u[i.type],[i.id]:m}};return h}case u:return q(e,{type:l,payload:{subjects:{type:`list`,items:[U(t).subject]},from:U(t).from,to:U(t).to}});case s:{let n=Object.keys(U(t).entities),r={...e};for(let i of n){let n=U(t).entities[i],a={...e[i]||{}},o=!1,s=Object.keys(n||{})||[];if(n&&s){for(let t of s)o=!0,a[t]=e[i][t]?H(e[i][t],n[t]):n[t];o&&(r[i]=a)}}return r}case i:{if(!V(e,U(t).id,U(t).type,U(t).key))return e;let r=e[U(t).type][U(t).id],i=Array.from(r[U(t).key]);return i.splice(K(U(t).index,i.length+1),0,U(t).reference),n(r,{[U(t).key]:i})}case w:case f:{if(!V(e,U(t).id,U(t).type,U(t).key))return e;let r=e[U(t).type][U(t).id],i=Array.from(r[U(t).key]),a=K(U(t).index,i.findIndex(e=>e&&e.id===U(t).reference.id));return a===-1||i[a]?.id!==U(t).reference.id?e:(t.type===w?i.splice(a,1,U(t).reference):i.splice(a,1),n(r,{[U(t).key]:i}))}case r:{let r=e[U(t).type][U(t).id];if(!r)return e;let i=Array.from(r.metadata||[]),a=U(t);return i.splice(K(t.payload.beforeIndex,i.length+1),0,{label:a.label,value:a.label}),n(r,{metadata:i})}case m:{let r=e[U(t).type][U(t).id];if(typeof r==`string`||!r)return e;let i=Array.from(r.metadata||[]),[a]=i.splice(U(t).startIndex,1);return i.splice(U(t).endIndex,0,a),n(r,{metadata:i})}case C:case d:{let r=e[U(t).type][U(t).id],i=Array.from(r.metadata||[]),a=U(t).atIndex;return a===void 0||a===-1||!i[a]?e:(t.type===C?i.splice(a,1,{label:U(t).label,value:U(t).value}):i.splice(a,1),n(r,{metadata:i}))}default:return e}},J=(e={},t)=>{switch(t.type){case y:case v:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:x,uriMismatch:!1,resourceUri:t.payload.id}};case _:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case g:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:b,error:t.payload.message}};case h:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:S,error:void 0}}}return e},Y=(e={},t)=>{let{id:n,updateValue:r,value:i,meta:a,key:o}=t&&t.payload||{};switch(t.type){case T:return{...e,[n]:{...e[n]||{},[a]:{...e[n]&&e[n][a]||{},[o]:i}}};case E:return{...e,[n]:{...e[n]||{},[a]:{...e[n]&&e[n][a]||{},[o]:e[n]&&e[n][a]?r(e[n][a][o]):r(void 0)}}};case D:return e[n]&&e[n][a]&&e[n][a][o]?{...e,[n]:{...e[n]||{},[a]:{...e[n]&&e[n][a]||{},[o]:void 0}}}:e;default:return e}};function X(e={}){let t=Object.keys(e);return function(n={},r){let i=!1,a={};for(let o=0;o<t.length;o++){let s=t[o];a[s]=e[s](n[s],r),i||=a[s]!==n[s]}return i?a:n}}function Z(e){return(t,n)=>n&&n.type===a?n.payload.actions.reduce(e,t):n&&n.type===o?{...t,iiif:{...t.iiif,...n.payload.state}}:e(t,n)}const Q=X({mapping:B,entities:q,requests:J,meta:Y});function $(){return{iiif:{entities:O(),meta:{},mapping:{},requests:{}}}}function ee(t={}){let{enableDevtools:n=!1,iiifStoreName:r=`iiif`,defaultState:i=$(),customReducers:a={}}=t,o=Z(X({[r]:Q,...a})),s=!!(typeof window<`u`&&window.__REDUX_DEVTOOLS_EXTENSION__),c=s?I:(e,t)=>e;return e(z(c(j(o,i),{enabled:n})))}export{ee as createStore,Q as reducers};
//# sourceMappingURL=store-B7swNE6p.js.map