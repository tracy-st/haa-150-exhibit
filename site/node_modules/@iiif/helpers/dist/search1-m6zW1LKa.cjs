const e=require(`./vanilla-Bv6fw5Yf.cjs`),t=e=>e.id||e[`@id`];function n(e){return!e||!e.service?null:e?e.service.find(e=>e.profile===`SearchService1`||e.profile===`http://iiif.io/api/search/1/search`):null}function r(e){if(!e||!e.service)return;let t=Array.isArray(e.service)?e.service:[e.service];return t.find(e=>e.profile===`http://iiif.io/api/search/0/autocomplete`||e.profile===`http://iiif.io/api/search/1/autocomplete`||e.profile===`AutoCompleteService1`)}const i=(n,i)=>{let o=i?.fetcher||a,s=n?r(n):void 0,c=s?t(s):void 0,l=null;return e.createStore((e,n)=>({results:[],lastQuery:{},hasAutocomplete:!!s,endpoint:c,loading:!1,error:!1,errorMessage:``,ignored:[],setSearchService(n){let i=r(n);i&&e({endpoint:t(i),hasAutocomplete:!0,results:[],loading:!1,lastQuery:null,error:!1,errorMessage:``})},clearSearch(){e({results:[],loading:!1,lastQuery:null})},async search(t,r={}){let i=n().endpoint;if(n().hasAutocomplete===!1)return;l&&!l.signal.aborted&&l.abort(),l=new AbortController;let a=new URLSearchParams;a.set(`q`,t),r.motivation&&a.set(`motivation`,r.motivation),r.date&&a.set(`date`,r.date),r.user&&a.set(`user`,r.user);let s=!0;if((!t||t.length<3)&&!r.motivation&&!r.date&&!r.user&&(s=!1),e({loading:s,lastQuery:{q:t,motivation:r.motivation,date:r.date,user:r.user}}),s)return o(`${i}?${a.toString()}`,{signal:l.signal,headers:{"Content-Type":`application/json`,Accept:`application/json`,...r.headers||{}}}).then(async([t,n])=>{l?.signal.aborted||e(t?{loading:!1,ignored:t.ignored||[],results:t.terms,error:!1,errorMessage:``}:{results:[],error:!0,errorMessage:n||void 0})})}}))};function a(e,{signal:t,headers:n}){return fetch(e,{signal:t,headers:{"Content-Type":`application/json`,Accept:`application/json`,...n||{}}}).then(async e=>e.ok?[await e.json(),null]:[null,e.statusText])}const o=(n,i)=>{let o=i?.fetcher||a,s;s=typeof n==`string`?{"@context":`http://iiif.io/api/search/1/context.json`,profile:`http://iiif.io/api/search/1/search`,"@id":n,id:n,service:[]}:n;let c=null;return e.createStore((e,n)=>({endpoint:s?t(s):void 0,service:s,resources:[],hits:[],lastQuery:{},loading:!1,error:!1,highlight:{results:null,hit:null},hitIndex:-1,hasSearch:!!s,hasAutocomplete:s?!!r(s):!1,errorMessage:``,async search(t,r={}){let i=n().endpoint;if(!i)throw Error(`No search service found.`);c&&!c.signal.aborted&&c.abort(),c=new AbortController;let a=new URLSearchParams;t.q&&a.set(`q`,t.q),t.motivation&&a.set(`motivation`,t.motivation),t.date&&a.set(`date`,t.date),t.user&&a.set(`user`,t.user),e({lastQuery:t,loading:!0});let s=await o(`${i}?${a.toString()}`,{signal:c.signal,headers:r.headers}).then(([t,n])=>{c?.signal.aborted||e(t?{resources:(t.resources||[]).map(e=>(e.search&&!e.url&&(e.url=e.search),e)),hits:t.hits||(t.resources||[]).map(e=>({"@type":`search:Hit`,after:``,annotations:[e[`@id`]],before:``,match:e.resource.chars})),error:!1,errorMessage:``,loading:!1}:{loading:!1,resources:[],error:!0,errorMessage:n||void 0})});return s},setSearchService(n){e({service:n,endpoint:n?t(n):void 0,hasSearch:!!n,hasAutocomplete:n?!!r(n):!1,loading:!1,resources:[],error:!1,errorMessage:``,highlight:{results:null,hit:null}})},clearSearch(){e({resources:[],error:!1,errorMessage:``})},highlightHit(t){let r=n(),i=r.hits[t];if(!i)return;let a=r.resources.filter(e=>i.annotations.includes(e[`@id`]));e({hitIndex:t,highlight:{results:a,hit:i}})},nextHit(){let e=n(),t=e.hitIndex+1;t>=e.hits.length||e.highlightHit(t)},previousHit(){let e=n(),t=e.hitIndex-1;t<0||e.highlightHit(t)}}))};Object.defineProperty(exports,`createSearch1AutocompleteStore`,{enumerable:!0,get:function(){return i}}),Object.defineProperty(exports,`createSearch1Store`,{enumerable:!0,get:function(){return o}}),Object.defineProperty(exports,`findAutocompleteService`,{enumerable:!0,get:function(){return r}}),Object.defineProperty(exports,`findSearch1Service`,{enumerable:!0,get:function(){return n}});