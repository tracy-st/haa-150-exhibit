import{compatVault as e}from"./compat-167ipRuK.js";import{ImageServiceLoader as t,getFixedSizeFromImage as n}from"./image-service-BvY9CGnV.js";const r=new t,i=new Map;function a(t,{vault:n=e,dereference:r=!1,...a}={}){let s=i.get(n);return s||(s=o(n),i.set(n,s)),s.getBestThumbnailAtSize(t,a,r)}function o(t=e,i={}){let a=i.imageServiceLoader||r;async function o(e,r,i=!1,s=[],c){let l=()=>a.getThumbnailFromResource(void 0,r,i,s);if(!e)return await a.getThumbnailFromResource(void 0,r,i,s);if(typeof e==`string`){let t=n(e);return t&&s.push(t),await a.getThumbnailFromResource(void 0,r,i,s)}let u=t.get(e,{skipSelfReturn:!1});if(typeof u==`string`)return{best:n(u),fallback:[],log:[]};if(!u)return await l();let d=async e=>{if(e&&e.thumbnail&&e.thumbnail.length){let n=t.get(e.thumbnail[0]),r=await a.getImageCandidates(n,i);r&&r.length&&s.push(...r)}};switch(await d(u),u.type){case`Annotation`:{let e=Array.isArray(u.body)?u.body:[u.body],n=t.get(e[0]);return c&&!n.width&&(n.width=c.width,n.height=c.height),await a.getThumbnailFromResource(n,r,i,s)}case`Canvas`:{let e=u;return o(e.items[0],r,i,s,{width:e.width,height:e.height})}case`AnnotationPage`:{let e=u;return o(e.items[0],r,i,s,c)}case`Choice`:{let e=u;return!e.items||e.items[0]?await l():o(e.items[0],r,i,s,c)}case`Collection`:{let e=u,t=e.items[0];return t?o(t,r,i,s,c):await l()}case`Manifest`:{let e=u,t=e.items[0];return t?o(t,r,i,s,c):await l()}case`SpecificResource`:case`Image`:case`Dataset`:case`Sound`:case`Text`:case`TextualBody`:case`Video`:return c&&!u.width&&(u.width=c.width,u.height=c.height),a.getThumbnailFromResource(u,r,i,s)}return await l()}return{getBestThumbnailAtSize:o}}export{o as createThumbnailHelper,a as getThumbnail,r as imageServiceLoader};
//# sourceMappingURL=thumbnail-B4K88W9F.js.map