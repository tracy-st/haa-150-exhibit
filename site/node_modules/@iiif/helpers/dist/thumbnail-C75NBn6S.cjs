const e=require(`./compat-DSoLY7GO.cjs`),t=require(`./image-service-BGIyIN7p.cjs`),n=new t.ImageServiceLoader,r=new Map;function i(t,{vault:n=e.compatVault,dereference:i=!1,...o}={}){let s=r.get(n);return s||(s=a(n),r.set(n,s)),s.getBestThumbnailAtSize(t,o,i)}function a(r=e.compatVault,i={}){let a=i.imageServiceLoader||n;async function o(e,n,i=!1,s=[],c){let l=()=>a.getThumbnailFromResource(void 0,n,i,s);if(!e)return await a.getThumbnailFromResource(void 0,n,i,s);if(typeof e==`string`){let r=t.getFixedSizeFromImage(e);return r&&s.push(r),await a.getThumbnailFromResource(void 0,n,i,s)}let u=r.get(e,{skipSelfReturn:!1});if(typeof u==`string`)return{best:t.getFixedSizeFromImage(u),fallback:[],log:[]};if(!u)return await l();let d=async e=>{if(e&&e.thumbnail&&e.thumbnail.length){let t=r.get(e.thumbnail[0]),n=await a.getImageCandidates(t,i);n&&n.length&&s.push(...n)}};switch(await d(u),u.type){case`Annotation`:{let e=Array.isArray(u.body)?u.body:[u.body],t=r.get(e[0]);return c&&!t.width&&(t.width=c.width,t.height=c.height),await a.getThumbnailFromResource(t,n,i,s)}case`Canvas`:{let e=u;return o(e.items[0],n,i,s,{width:e.width,height:e.height})}case`AnnotationPage`:{let e=u;return o(e.items[0],n,i,s,c)}case`Choice`:{let e=u;return!e.items||e.items[0]?await l():o(e.items[0],n,i,s,c)}case`Collection`:{let e=u,t=e.items[0];return t?o(t,n,i,s,c):await l()}case`Manifest`:{let e=u,t=e.items[0];return t?o(t,n,i,s,c):await l()}case`SpecificResource`:case`Image`:case`Dataset`:case`Sound`:case`Text`:case`TextualBody`:case`Video`:return c&&!u.width&&(u.width=c.width,u.height=c.height),a.getThumbnailFromResource(u,n,i,s)}return await l()}return{getBestThumbnailAtSize:o}}Object.defineProperty(exports,`createThumbnailHelper`,{enumerable:!0,get:function(){return a}}),Object.defineProperty(exports,`getThumbnail`,{enumerable:!0,get:function(){return i}}),Object.defineProperty(exports,`imageServiceLoader`,{enumerable:!0,get:function(){return n}});