const e=require(`./chunk-DEHCWMz8.cjs`),t=require(`./batch-actions-X7z9ogvf.cjs`),n=e.__toESM(require(`@iiif/parser`)),r=(e,r)=>{let{entities:i,resource:a,mapping:o}=(0,n.normalize)(r);if(a.id===void 0)return[t.requestError({id:e,message:`ID is not defined in resource.`})];let s=[t.importEntities({entities:i}),t.addMappings({mapping:o})];return a.id!==e&&(s.push(t.addMapping({id:e,type:a.type})),s.push(t.requestMismatch({requestId:e,actualId:a.id}))),s.push(t.requestComplete({id:e})),s},i=Number.isNaN||function(e){return typeof e==`number`&&e!==e};function a(e,t){return!!(e===t||i(e)&&i(t))}function o(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!a(e[n],t[n]))return!1;return!0}function s(e,t,r){let i=e.iiif.requests[t],a=e.iiif.mapping[t];if(!a||!e.iiif.entities[a][i.resourceUri])return;let o=e.iiif.entities[a][i.resourceUri];if(o&&o[n.HAS_PART]){let e=o[n.HAS_PART].find(e=>r?e[n.PART_OF]===r.id:e[n.PART_OF]===o.id);return(0,n.frameResource)(o,e)}return o}function c(e){return e&&typeof e.then==`function`}function l(e,n,{waitTimeout:i=30}={}){return(a,o,l)=>{let u=e.getStore(),d=u.getState(),f=d.iiif.requests[a];if(f){if(f.loadingState===t.RESOURCE_READY){let e=s(d,a);if(e)return e}switch(f.loadingState){case t.RESOURCE_ERROR:break;case t.RESOURCE_LOADING:return(async()=>{let e,n=!1;try{let r=await Promise.race([new Promise((r,i)=>{n||(e=u.subscribe(()=>{let e=u.getState();if(e.iiif.requests[a].loadingState===t.RESOURCE_ERROR){i();return}if(e.iiif.requests[a].loadingState===t.RESOURCE_READY){let t=s(e,a);t?r(t):i()}}))}),new Promise((e,t)=>setTimeout(()=>{n=!0,t()},i*60*1e3))]);if(e&&e(),r)return r}catch{e&&e()}})()}}e.dispatch(t.requestResource({id:a}));let p=n=>{if(!n)return;!n.id&&!n[`@id`]&&(n[`@type`]&&(n[`@id`]=a),n.id=a);let i=r(a,n);return e.dispatch(t.batchActions({actions:i})),s(u.getState(),a)};try{let r=n(a,o);return c(r)?(async()=>{try{let e=await r;return l&&(e=l(e)),p(e)}catch(n){throw e.dispatch(t.requestError({id:a,message:n.toString()})),n}})():p(l?l(r):r)}catch(n){throw e.dispatch(t.requestError({id:a,message:n.toString()})),n}}}Object.defineProperty(exports,`actionListFromResource`,{enumerable:!0,get:function(){return r}}),Object.defineProperty(exports,`areInputsEqual`,{enumerable:!0,get:function(){return o}}),Object.defineProperty(exports,`createFetchHelper`,{enumerable:!0,get:function(){return l}}),Object.defineProperty(exports,`resolveIfExists`,{enumerable:!0,get:function(){return s}});