import{_defineProperty as e,ensureArray as t}from"./remove-undefined-properties-DKmVdOaS.js";function n(e){return typeof e==`string`?!1:e&&!e.type&&`source`in e?(e.type=`SpecificResource`,!0):!!e&&e.type===`SpecificResource`}function r(...e){return t=>e.reduce((e,t)=>t(e),t)}const i=[`Collection`,`Manifest`,`Canvas`,`AnnotationPage`,`AnnotationCollection`,`Annotation`,`ContentResource`,`Range`,`Service`,`Selector`,`Agent`];function a(e,t){if(e==null)throw Error(`Null or undefined is not a valid entity.`);if(Array.isArray(e))throw Error(`Array is not a valid entity`);if(typeof e!=`object`){if(t)return t;throw Error(`${typeof e} is not a valid entity`)}if(typeof e.type==`string`){let t=i.indexOf(e.type);if(t!==-1)return i[t]}if(e.profile)return`Service`;throw Error(`Resource type is not known`)}var o=class i{constructor(t,n={}){e(this,`traversals`,void 0),e(this,`options`,void 0),e(this,`_traverseManifest`,r(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),e(this,`_traverseCanvas`,r(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),e(this,`_traverseAnnotationPage`,r(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),e(this,`_traverseRange`,r(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...t},this.options={allowUndefinedReturn:!1,...n}}static all(e){return new i({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],geoJson:[e],specificResource:[e],agent:[e]})}traverseDescriptive(e){return e.thumbnail&&=t(e.thumbnail).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.provider&&=e.provider.map(t=>this.traverseAgent(t,e)),e}traverseLinking(e){return e.seeAlso&&=t(e.seeAlso).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.service&&=t(e.service).map(e=>this.traverseService(e)),e.services&&=t(e.services).map(t=>this.traverseService(t,e)),e.logo&&=t(e.logo).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.homepage&&=t(e.homepage).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.partOf&&=e.partOf.map(t=>typeof t==`string`||!t.type?this.traverseType(t,{parent:e},this.traversals.contentResource):t.type===`Canvas`?this.traverseType(t,{parent:e},this.traversals.canvas):t.type===`AnnotationCollection`?this.traverseType(t,{parent:e},this.traversals.annotationCollection):t.type===`Collection`?this.traverseType(t,{parent:e},this.traversals.collection):this.traverseType(t,{parent:e},this.traversals.contentResource)),e.start&&(n(e.start)?e.start=this.traverseSpecificResource(e.start,`Canvas`,e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&=e.rendering.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.supplementary&&=e.supplementary.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>e.type===`Collection`?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&=this.traverseGeoJson(e.navPlace,e),e}traverseManifestItems(e){return e.items&&=e.items.map(e=>this.traverseCanvas(e)),e}traverseManifestStructures(e){return e.structures&&=e.structures.map(e=>this.traverseRange(e)),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return typeof e==`string`||!e||(e.annotations&&=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&=e.items.map(t=>this.traverseAnnotation(t,e)),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&=this.traverseContentResource(e.body,e),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&=this.traverseCanvas(e.placeholderCanvas),e.accompanyingCanvas&&=this.traverseCanvas(e.accompanyingCanvas),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(e){return typeof e==`string`||!e||e&&e.service&&(e.service=t(e.service||[]).map(t=>this.traverseService(t,e))),e}traverseContentResource(e,t){return e.type===`Choice`&&(e.items=e.items.map(t=>this.traverseContentResource(t,e))),n(e)?this.traverseSpecificResource(e,`ContentResource`):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:t},this.traversals.contentResource)}traverseSpecificResource(e,t,n){let r=e.source;return typeof e.source==`string`&&(r={id:e.source,type:t||`unknown`}),this.traverseType({...e,source:t===`Canvas`||r.type===`Canvas`?this.traverseType(r,{parent:n},this.traversals.canvas):t===`ContentResource`?this.traverseContentResource(r,{parent:n}):this.traverseUnknown(r,{parent:n,typeHint:t})},{parent:n},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&=e.items.map(t=>typeof t==`string`?this.traverseCanvas({id:t,type:`Canvas`},e):n(t)?this.traverseSpecificResource(t,`Canvas`,e):t.type===`Manifest`?this.traverseManifest(t,e):this.traverseRange(t,e)),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,n){return n.reduce((e,n)=>{let r=n(e,t);return r===void 0&&!this.options.allowUndefinedReturn?e:r},e)}traverseService(e,n){let r=Object.assign({},e);return r&&r.service&&(r.service=t(r.service).map(e=>this.traverseService(e))),this.traverseType(r,{parent:n},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:n}={}){let r=a(e,n);switch(r){case`Collection`:return this.traverseCollection(e,t);case`Manifest`:return this.traverseManifest(e,t);case`Canvas`:return this.traverseCanvas(e,t);case`AnnotationPage`:return this.traverseAnnotationPage(e,t);case`Annotation`:return this.traverseAnnotation(e,t);case`ContentResource`:return this.traverseContentResource(e,t);case`Range`:return this.traverseRange(e,t);case`Service`:return this.traverseService(e,t);case`Agent`:return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}};export{o as Traverse,a as identifyResource,n as isSpecificResource,i as types};
//# sourceMappingURL=traverse-BDmGe7EO.js.map