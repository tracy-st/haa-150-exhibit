import{IIIF_1_IMAGE_LEVEL_0 as e,IIIF_1_IMAGE_LEVEL_0_PROFILE as t,IIIF_1_IMAGE_LEVEL_1 as n,IIIF_1_IMAGE_LEVEL_1_PROFILE as r,IIIF_1_IMAGE_LEVEL_2 as i,IIIF_1_IMAGE_LEVEL_2_PROFILE as a,IIIF_2_IMAGE_LEVEL_0 as o,IIIF_2_IMAGE_LEVEL_0_NO_JSON as s,IIIF_2_IMAGE_LEVEL_0_PROFILE as c,IIIF_2_IMAGE_LEVEL_1 as l,IIIF_2_IMAGE_LEVEL_1_NO_JSON as u,IIIF_2_IMAGE_LEVEL_1_PROFILE as d,IIIF_2_IMAGE_LEVEL_2 as f,IIIF_2_IMAGE_LEVEL_2_NO_JSON as p,IIIF_2_IMAGE_LEVEL_2_PROFILE as m,IIIF_3_IMAGE_LEVEL_0 as ee,IIIF_3_IMAGE_LEVEL_1 as h,IIIF_3_IMAGE_LEVEL_2 as g,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0 as _,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1 as v,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2 as te,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0 as ne,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1 as y,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2 as re,STANFORD_IIIF_IMAGE_COMPLIANCE_0 as b,STANFORD_IIIF_IMAGE_COMPLIANCE_1 as x,STANFORD_IIIF_IMAGE_COMPLIANCE_2 as S,STANFORD_IIIF_IMAGE_CONFORMANCE_0 as C,STANFORD_IIIF_IMAGE_CONFORMANCE_1 as w,STANFORD_IIIF_IMAGE_CONFORMANCE_2 as ie,extraFeatures as T,imageServiceProfiles as E,level0 as D,level0Support as O,level1 as k,level1Support as A,level2 as j,level2Support as M,onlyLevel0 as N}from"./profiles-DU_UcLCg.js";function ae(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,``);return t.indexOf(`/`)===-1?t:t.split(`/`)[0]}function P(e){try{if(e===`full`)return{full:!0};if(e===`square`)return{square:!0};let t=e.startsWith(`pct:`),n=e.substr(t?4:0).split(`,`),r=n.map(e=>parseFloat(e));return{x:r[0],y:r[1],w:r[2],h:r[3],percent:t}}catch{throw Error(`Expected 'full', 'square' or 'x,y,w,h'. Found `+e)}}function F(e){let t={upscaled:!1,max:!1,confined:!1};if(e[0]===`^`&&(t.upscaled=!0,e=e.slice(1)),e===`max`||e===`full`)return t.max=!0,t.serialiseAsFull=e===`full`,t;if(e[0]===`!`&&(t.confined=!0,e=e.slice(1)),e[0]===`p`)return t.percentScale=parseFloat(e.slice(4)),t;let n=e.split(`,`).map(e=>e.trim());return n.length&&(n[0]!==``&&(t.width=parseInt(n[0],10)),n[1]!==``&&(t.height=parseInt(n[1],10))),t}function I(e){let t={angle:0};if(e[0]===`!`&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}function L(e,t=``){let n=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!n)throw Error(`Invalid or unknown input ${e}`);let r=n[2],i=n[3],a=n[4];if(a[0]===`/`&&(a=a.substring(1)),t.length>0){if(t[0]===`/`&&(t=t.substring(1)),t!==a.substring(0,t.length))throw Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substring(t.length)}return{scheme:r,server:i,path:a,prefix:t}}function R(e,t=``){let{path:n,scheme:r,server:i,prefix:a}=L(e,t),o=n.split(`/`).reverse(),[s,c,l,u,...d]=o,f=d.reverse().filter(Boolean).join(`/`);if(o.length===1||s===``)return{type:`base`,scheme:r,server:i,prefix:a,identifier:f};if(s===`info.json`){let[,...e]=o;return{type:`info`,scheme:r,server:i,prefix:a,identifier:e.reverse().filter(Boolean).join(`/`)}}if(r===void 0||i===void 0||n===void 0||u===void 0||l===void 0||c===void 0||s===void 0)throw Error(`Invalid image service URL`);let[p=``,m=``]=s.split(`.`);return{type:`image`,scheme:r,server:i,prefix:a,identifier:f,originalPath:n,region:P(u),size:F(l),rotation:I(c),quality:p,format:m}}function z(e){let t=M.indexOf(e)!==-1;if(t)return j;let n=A.indexOf(e)!==-1;return n?k:D}function B(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],n={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){if(typeof e==`string`&&(e=z(e)),!e)continue;if(e.formats)for(let t of e.formats)n.extraFormats.indexOf(t)===-1&&n.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)n.extraQualities.indexOf(t)===-1&&n.extraQualities.push(t);if(e.supports)for(let t of e.supports)n.extraFeatures.indexOf(t)===-1&&n.extraFeatures.push(t);if(e.maxHeight&&(n.maxHeight=e.maxHeight),e.maxWidth&&(n.maxWidth=e.maxWidth),e.maxArea&&(n.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)n.extraFormats.indexOf(t)===-1&&n.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)n.extraQualities.indexOf(t)===-1&&n.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)n.extraFeatures.indexOf(t)===-1&&n.extraFeatures.push(t);e.maxHeight&&(n.maxHeight=e.maxHeight),e.maxWidth&&(n.maxWidth=e.maxWidth),e.maxArea&&(n.maxArea=e.maxArea)}if(e.extraFormats)for(let t of e.extraFormats)n.extraFormats.indexOf(t)===-1&&n.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)n.extraFeatures.indexOf(t)===-1&&n.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)n.extraQualities.indexOf(t)===-1&&n.extraQualities.push(t);return n}function V(e){let t=Array.isArray(e.profile)?e.profile:[e.profile];for(let e of t)if(typeof e==`string`&&N.indexOf(e)!==-1)return!0;return!1}function H(e){if(e[`@id`])return e[`@id`];if(e.id)return e.id}function U(e){if(!e||!e.profile||!H(e))return!1;let t=Array.isArray(e.profile)?e.profile:[e.profile];for(let e of t)if(typeof e==`string`&&E.indexOf(e)!==-1)return!0;return!1}function W(e,t){if(!U(e))return[!1,`Not a valid image service`];t.extraFeatures=t.extraFeatures?t.extraFeatures:[];let n=B(e);if(t.exactSize){let n=!1;if(e.sizes)for(let r of e.sizes)r.width&&r.width===t.exactSize.width&&(T.indexOf(`sizeByW`)===-1?r.height&&r.height===t.exactSize.height&&(n=!0):n=!0),r.height&&r.height===t.exactSize.height&&(T.indexOf(`sizeByH`)===-1?r.width&&r.width===t.exactSize.width&&(n=!0):n=!0);n||(t.maxWidth=Math.max(t.maxWidth||0,t.exactSize.width||0)||void 0,t.maxHeight=Math.max(t.maxHeight||0,t.exactSize.height||0)||void 0,t.maxArea=Math.max(t.maxArea||0,(t.exactSize.width&&t.exactSize.height?t.exactSize.width*t.exactSize.height:t.maxArea)||0)||void 0,!t.exactSize.height&&t.exactSize.width?t.extraFeatures.indexOf(`sizeByW`)===-1&&t.extraFeatures.push(`sizeByW`):!t.exactSize.width&&t.exactSize.height&&t.extraFeatures.indexOf(`sizeByH`)===-1&&t.extraFeatures.push(`sizeByH`))}if(t.maxArea&&n.maxArea&&t.maxArea>n.maxArea)return[!1,`Max area is ${n.maxArea}`];if(t.maxWidth&&n.maxWidth&&t.maxWidth>n.maxWidth)return[!1,`Max width is ${n.maxWidth}`];if(t.maxHeight&&n.maxHeight&&t.maxHeight>n.maxHeight)return[!1,`Max height is ${n.maxHeight}`];if(t.extraFeatures){let e=[];for(let r of t.extraFeatures)n.extraFeatures.indexOf(r)===-1&&e.push(r);if(e.length)return[!1,`Missing features: ${e.join(`, `)}`]}if(t.extraFormats){let e=[];for(let r of t.extraFormats)n.extraFormats.indexOf(r)===-1&&e.push(r);if(e.length)return[!1,`Missing formats: ${e.join(`, `)}`]}if(t.extraQualities){let e=[];for(let r of t.extraQualities)n.extraQualities.indexOf(r)===-1&&e.push(r);if(e.length)return[!1,`Missing qualities: ${e.join(`, `)}`]}return[!0]}function G(e){if(!U(e))return!1;let t=Array.isArray(e.profile)?e.profile:[e.profile];for(let e of t)if(typeof e==`string`){if(A.indexOf(e)!==-1)return!0}else{let t=[...e.supports||[],...e.extraFeatures||[]];if(t.indexOf(`regionByPx`)!==-1&&(t.indexOf(`sizeByW`)!==-1||t.indexOf(`sizeByWh`)!==-1))return!0}return!1}function K(e,t){return W(e,{extraFormats:[t]})}function q(e,t){if(t.type!==`image`)return[!0];let n=[];if(t.rotation.mirror&&n.push(`mirroring`),t.region.percent&&n.push(`regionByPct`),t.region.square?n.push(`regionSquare`):t.region.full||n.push(`regionByPx`),t.rotation.angle){let e=t.rotation.angle%90;e?n.push(`rotationArbitrary`):n.push(`rotationBy90s`)}t.size.confined&&n.push(`sizeByConfinedWh`),!t.size.width&&t.size.height&&n.push(`sizeByH`),t.size.percentScale&&n.push(`sizeByPct`);let r=(e.sizes||[]).find(e=>e.width===t.size.width&&!t.size.height||e.height===t.size.height&&!t.size.width||e.height===t.size.height&&e.width===t.size.width);r?n.push(`sizeByWhListed`):(t.size.width&&!t.size.height&&n.push(`sizeByW`),t.size.width&&t.size.height&&n.push(`sizeByWh`)),t.size.upscaled&&n.push(`sizeUpscaling`);let[i,a]=W(e,{extraFeatures:n,extraQualities:[t.quality],extraFormats:[t.format],exactSize:t.size});return i?[!0]:[!1,a]}function J({x:e=0,y:t=0,w:n,h:r,full:i,square:a,percent:o}){if(i)return`full`;if(a)return`square`;if(n===void 0||r===void 0)throw Error(`RegionParameter: invalid region`);let s=`${e},${t},${n},${r}`;return o?`pct:${s}`:s}function Y({max:e,percentScale:t,upscaled:n,confined:r,width:i,height:a,serialiseAsFull:o,version:s}){let c=[];return n&&c.push(`^`),e?(c.push(o?`full`:`max`),c.join(``)):(r&&c.push(`!`),t&&c.push(`pct:${t}`),i&&c.push(`${i}`),c.push(`,`),a&&s===3&&c.push(`${a}`),c.join(``))}function X(e){return`${e.mirror?`!`:``}${(e.angle||0)%360}`}function Z(e,t){let n=e.prefix.startsWith(`/`)?e.prefix.substring(1):e.prefix,r=`${e.scheme}://${e.server}/${n?`${n}/`:``}${e.identifier}`;if(e.type===`base`)return r;if(e.type===`info`)return`${r}/info.json`;let{size:i}=e,{region:a,rotation:o,format:s,quality:c}=e;if(t){let e=t[`@context`]?Array.isArray(t[`@context`])?t[`@context`]:[t[`@context`]]:[],n=e.indexOf(`http://iiif.io/api/image/2/context.json`)!==-1,r=e.indexOf(`http://iiif.io/api/image/3/context.json`)!==-1;if((i.width===t.width&&!i.height||i.height===t.height&&!i.width||i.width===t.width&&i.height===t.height)&&(i={...i,max:!0}),n&&(i.max&&!i.serialiseAsFull&&(i={...i,serialiseAsFull:!0}),!i.max&&i.width&&i.height&&(i={...i,height:void 0}),i={...i,version:2}),r){if(i.max&&i.serialiseAsFull&&(i={...i,serialiseAsFull:!1}),i.width&&!i.height&&t.width&&t.height){let e=t.height/t.width;i={...i,height:Math.ceil(i.width*e)}}i={...i,version:3}}}return[r,J(a),Y(i),X(o),`${c}.${s}`].filter(Boolean).join(`/`)}function oe(e,t){return Z({...e,type:`info`},t)}function Q(e){return e.endsWith(`info.json`)?e:e.endsWith(`/`)?`${e}info.json`:`${e}/info.json`}function se(e){let t=R(Q(e.id));if(t.type!==`info`)throw Error(`Invalid service URL`);let n=B(e);return{identifier:t.identifier,originalPath:``,server:t.server,prefix:t.prefix,scheme:t.scheme,type:`image`,quality:n.extraQualities.indexOf(`default`)===-1?n.extraQualities[0]:`default`,region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:`jpg`,rotation:{angle:0}}}function ce(e,t,n){let r=n.length,i=[];for(let t=0;t<r;t++){let r=n[t];if(!r)continue;let a=r.width;i.push(e/a)}return i}function le(e,t,n){let r=n.length,i=[];for(let a=0;a<r;a++){let r=n[a];r&&i.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return i}function $(e,t){if(t&&t.profile){let n=t.profile;if(n){let t=Array.isArray(n)?n:[n];if(t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`))return!0;if(e===2){for(let e of t)if(M.includes(e))return!0}if(e===1){for(let e of t)if(A.includes(e))return!0}if(e===0){for(let e of t)if(N.includes(e))return!0}}}return!1}function ue(e){return U(e)?$(2,e)?2:$(1,e)?1:$(0,e)?0:null:null}function de(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],n=t.length,r=[];for(let e=0;e<n;e++)U(t[e])&&r.push(t[e]);return r}function fe(e){if(e[`@type`])return e[`@type`];if(e.type)return e.type}function pe(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,``);return t.indexOf(`/`)===-1?t:t.split(`/`)[0]}export{e as IIIF_1_IMAGE_LEVEL_0,t as IIIF_1_IMAGE_LEVEL_0_PROFILE,n as IIIF_1_IMAGE_LEVEL_1,r as IIIF_1_IMAGE_LEVEL_1_PROFILE,i as IIIF_1_IMAGE_LEVEL_2,a as IIIF_1_IMAGE_LEVEL_2_PROFILE,o as IIIF_2_IMAGE_LEVEL_0,s as IIIF_2_IMAGE_LEVEL_0_NO_JSON,c as IIIF_2_IMAGE_LEVEL_0_PROFILE,l as IIIF_2_IMAGE_LEVEL_1,u as IIIF_2_IMAGE_LEVEL_1_NO_JSON,d as IIIF_2_IMAGE_LEVEL_1_PROFILE,f as IIIF_2_IMAGE_LEVEL_2,p as IIIF_2_IMAGE_LEVEL_2_NO_JSON,m as IIIF_2_IMAGE_LEVEL_2_PROFILE,ee as IIIF_3_IMAGE_LEVEL_0,h as IIIF_3_IMAGE_LEVEL_1,g as IIIF_3_IMAGE_LEVEL_2,_ as STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,v as STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,te as STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,ne as STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,y as STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,re as STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,b as STANFORD_IIIF_IMAGE_COMPLIANCE_0,x as STANFORD_IIIF_IMAGE_COMPLIANCE_1,S as STANFORD_IIIF_IMAGE_COMPLIANCE_2,C as STANFORD_IIIF_IMAGE_CONFORMANCE_0,w as STANFORD_IIIF_IMAGE_CONFORMANCE_1,ie as STANFORD_IIIF_IMAGE_CONFORMANCE_2,Q as canonicalServiceUrl,B as combineProfiles,se as createImageServiceRequest,T as extraFeatures,ce as extractFixedSizeScales,le as fixedSizesFromScales,H as getId,ue as getImageServiceLevel,de as getImageServices,fe as getType,pe as identifyImageServer,E as imageServiceProfiles,oe as imageServiceRequestInfo,Z as imageServiceRequestToString,K as imageServiceSupportsFormat,q as imageServiceSupportsRequest,U as isImageService,$ as isImageServiceLevel,V as isLevel0,D as level0,O as level0Support,k as level1,A as level1Support,j as level2,M as level2Support,z as levelToProfile,N as onlyLevel0,ae as parseImageServerFromId,R as parseImageServiceRequest,L as parseImageServiceUrl,P as parseRegionParameter,I as parseRotationParameter,F as parseSizeParameter,J as regionParameterToString,X as rotationParameterToString,Y as sizeParameterToString,W as supports,G as supportsCustomSizes};
//# sourceMappingURL=image-3.js.map