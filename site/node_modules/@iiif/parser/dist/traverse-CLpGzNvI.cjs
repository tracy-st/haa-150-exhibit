const e=require(`./remove-undefined-properties-B6rYUrLL.cjs`);function t(e){return typeof e==`string`?!1:e&&!e.type&&`source`in e?(e.type=`SpecificResource`,!0):!!e&&e.type===`SpecificResource`}function n(...e){return t=>e.reduce((e,t)=>t(e),t)}var r=e.__toESM(e.require_defineProperty(),1);const i=[`Collection`,`Manifest`,`Canvas`,`AnnotationPage`,`AnnotationCollection`,`Annotation`,`ContentResource`,`Range`,`Service`,`Selector`,`Agent`];function a(e,t){if(e==null)throw Error(`Null or undefined is not a valid entity.`);if(Array.isArray(e))throw Error(`Array is not a valid entity`);if(typeof e!=`object`){if(t)return t;throw Error(`${typeof e} is not a valid entity`)}if(typeof e.type==`string`){let t=i.indexOf(e.type);if(t!==-1)return i[t]}if(e.profile)return`Service`;throw Error(`Resource type is not known`)}var o=class i{constructor(e,t={}){(0,r.default)(this,`traversals`,void 0),(0,r.default)(this,`options`,void 0),(0,r.default)(this,`_traverseManifest`,n(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,r.default)(this,`_traverseCanvas`,n(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,r.default)(this,`_traverseAnnotationPage`,n(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),(0,r.default)(this,`_traverseRange`,n(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new i({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],geoJson:[e],specificResource:[e],agent:[e]})}traverseDescriptive(t){return t.thumbnail&&=e.ensureArray(t.thumbnail).map(e=>this.traverseType(e,{parent:t},this.traversals.contentResource)),t.provider&&=t.provider.map(e=>this.traverseAgent(e,t)),t}traverseLinking(n){return n.seeAlso&&=e.ensureArray(n.seeAlso).map(e=>this.traverseType(e,{parent:n},this.traversals.contentResource)),n.service&&=e.ensureArray(n.service).map(e=>this.traverseService(e)),n.services&&=e.ensureArray(n.services).map(e=>this.traverseService(e,n)),n.logo&&=e.ensureArray(n.logo).map(e=>this.traverseType(e,{parent:n},this.traversals.contentResource)),n.homepage&&=e.ensureArray(n.homepage).map(e=>this.traverseType(e,{parent:n},this.traversals.contentResource)),n.partOf&&=n.partOf.map(e=>typeof e==`string`||!e.type?this.traverseType(e,{parent:n},this.traversals.contentResource):e.type===`Canvas`?this.traverseType(e,{parent:n},this.traversals.canvas):e.type===`AnnotationCollection`?this.traverseType(e,{parent:n},this.traversals.annotationCollection):e.type===`Collection`?this.traverseType(e,{parent:n},this.traversals.collection):this.traverseType(e,{parent:n},this.traversals.contentResource)),n.start&&(t(n.start)?n.start=this.traverseSpecificResource(n.start,`Canvas`,n):n.start=this.traverseType(n.start,{parent:n},this.traversals.canvas)),n.rendering&&=n.rendering.map(e=>this.traverseType(e,{parent:n},this.traversals.contentResource)),n.supplementary&&=n.supplementary.map(e=>this.traverseType(e,{parent:n},this.traversals.contentResource)),n}traverseCollectionItems(e){return e.items&&e.items.map(e=>e.type===`Collection`?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&=this.traverseGeoJson(e.navPlace,e),e}traverseManifestItems(e){return e.items&&=e.items.map(e=>this.traverseCanvas(e)),e}traverseManifestStructures(e){return e.structures&&=e.structures.map(e=>this.traverseRange(e)),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return typeof e==`string`||!e||(e.annotations&&=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&=e.items.map(t=>this.traverseAnnotation(t,e)),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&=this.traverseContentResource(e.body,e),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&=this.traverseCanvas(e.placeholderCanvas),e.accompanyingCanvas&&=this.traverseCanvas(e.accompanyingCanvas),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(t){return typeof t==`string`||!t||t&&t.service&&(t.service=e.ensureArray(t.service||[]).map(e=>this.traverseService(e,t))),t}traverseContentResource(e,n){return e.type===`Choice`&&(e.items=e.items.map(t=>this.traverseContentResource(t,e))),t(e)?this.traverseSpecificResource(e,`ContentResource`):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:n},this.traversals.contentResource)}traverseSpecificResource(e,t,n){let r=e.source;return typeof e.source==`string`&&(r={id:e.source,type:t||`unknown`}),this.traverseType({...e,source:t===`Canvas`||r.type===`Canvas`?this.traverseType(r,{parent:n},this.traversals.canvas):t===`ContentResource`?this.traverseContentResource(r,{parent:n}):this.traverseUnknown(r,{parent:n,typeHint:t})},{parent:n},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&=e.items.map(n=>typeof n==`string`?this.traverseCanvas({id:n,type:`Canvas`},e):t(n)?this.traverseSpecificResource(n,`Canvas`,e):n.type===`Manifest`?this.traverseManifest(n,e):this.traverseRange(n,e)),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,n){return n.reduce((e,n)=>{let r=n(e,t);return r===void 0&&!this.options.allowUndefinedReturn?e:r},e)}traverseService(t,n){let r=Object.assign({},t);return r&&r.service&&(r.service=e.ensureArray(r.service).map(e=>this.traverseService(e))),this.traverseType(r,{parent:n},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:n}={}){let r=a(e,n);switch(r){case`Collection`:return this.traverseCollection(e,t);case`Manifest`:return this.traverseManifest(e,t);case`Canvas`:return this.traverseCanvas(e,t);case`AnnotationPage`:return this.traverseAnnotationPage(e,t);case`Annotation`:return this.traverseAnnotation(e,t);case`ContentResource`:return this.traverseContentResource(e,t);case`Range`:return this.traverseRange(e,t);case`Service`:return this.traverseService(e,t);case`Agent`:return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}};Object.defineProperty(exports,`Traverse`,{enumerable:!0,get:function(){return o}}),Object.defineProperty(exports,`identifyResource`,{enumerable:!0,get:function(){return a}}),Object.defineProperty(exports,`isSpecificResource`,{enumerable:!0,get:function(){return t}}),Object.defineProperty(exports,`types`,{enumerable:!0,get:function(){return i}});