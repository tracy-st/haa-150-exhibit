"use strict";var tt=Object.defineProperty;var Ht=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var _t=Object.prototype.hasOwnProperty;var Xt=(i,t)=>{for(var s in t)tt(i,s,{get:t[s],enumerable:!0})},Yt=(i,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of Wt(t))!_t.call(i,e)&&e!==s&&tt(i,e,{get:()=>t[e],enumerable:!(n=Ht(t,e))||n.enumerable});return i};var Jt=i=>Yt(tt({},"__esModule",{value:!0}),i);var rn={};Xt(rn,{createHelper:()=>sn,createSvgHelpers:()=>tn});module.exports=Jt(rn);function nt(i){let t=i.points.length,s=!1,n=[];if(t>1){i.iedges=[];let e=i.points[t-1];for(let r=0;r<t;r++){let c=e;if(e=i.points[r],e.length===6){let d=e[2],m=e[3],g=e[4],y=e[5];n.push([r,[e[0]+d,e[1]+m],[e[0]+g,e[1]+y]]),s=!0}let o=[e[0]-c[0],e[1]-c[1]],p=o[0]*o[0]+o[1]*o[1];p>0?i.iedges.push([o[0]/p,o[1]/p]):i.iedges.push([0,0])}}else t===1?i.iedges=[[0,0]]:i.iedges=null;i.isBezier=s,i.bezierLines=n}function pt(i,t){let s=1/0,n=null,e=-1,r=i.points.length;if(r<=1)return[null,s,e];let c=i.points[r-1];for(let o=0;o<r;o++){let p=c;c=i.points[o];let d=p[0]-t[0],m=p[1]-t[1],g=d*d+m*m;g<s&&(n=p,s=g,e=o===0?r-1:o-1)}return[n,s,e]}function E(i){if(i.points.length>2){let t=Math.min(...i.points.map(r=>r[0])),s=Math.min(...i.points.map(r=>r[1])),n=Math.max(0,...i.points.map(r=>r[0])),e=Math.max(0,...i.points.map(r=>r[1]));i.boundingBox={x:t,y:s,width:n-t,height:e-s};return}i.boundingBox=null}function Qt(i){return i[0]*i[0]+i[1]*i[1]}function et(i,t){let s=1/0,n=null,e=-1,r=[],c=i.points.length;if(c<=1)return[null,s,r,e];if(i.iedges===null&&(nt(i),!i.iedges))return[null,s,r,e];let o=i.points[c-1];for(let p=0;p<c;p++){let d=o;o=i.points[p];let m=(t[0]-d[0])*i.iedges[p][0]+(t[1]-d[1])*i.iedges[p][1],g;m<=0?g=d:m<1?g=[(1-m)*d[0]+m*o[0],(1-m)*d[1]+m*o[1]]:g=o;let y=Qt([g[0]-t[0],g[1]-t[1]]);y<s&&(n=g,s=y,r=[d,o],e=p===0?c-1:p-1)}return[n,s,r,e]}var j={type:"move-bounding-box",label:"Move bounding box",isValid(i,t,s){let n=t.polygon.points.length,e=n===t.selectedPoints.length,r=t.polygon.boundingBox;if(n<1||!e||!r)return!1;let c=i[0],o=c[0],p=c[1];return o>=r.x&&o<=r.x+r.width&&p>=r.y&&p<=r.y+r.height},transition(i,t,s){let n=t.transitionOrigin,e=t.polygon.boundingBox,r=i[0],c=r[0]-n[0],o=r[1]-n[1];t.transitionPoints=t.polygon.points.map(p=>p.length===6?[p[0]+c,p[1]+o,p[2],p[3],p[4],p[5]]:[p[0]+c,p[1]+o]),e&&(t.transitionBoundingBox={x:e.x+c,y:e.y+o,width:e.width,height:e.height})},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,{points:n}}};var $={type:"move-shape",label:"Move shape",isValid(i,t,s){return s.Shift?!1:t.slowState.pointerInsideShape&&(!t.isOpen||t.line===null)},transition(i,t,s){j.transition(i,t,s)},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,{points:n}}};function dt(i,t){return Math.abs(i-t)}function k(i,t){let s=dt(i[0],t[0]),n=dt(i[1],t[1]);return Math.sqrt(Math.pow(s,2)+Math.pow(n,2))}function it(i,t){return[i[0]-t[0],i[1]-t[1]]}function Zt(i,t){return i[0]*t[0]+i[1]*t[1]}function ut(i){return i[0]*i[0]+i[1]*i[1]}function G(i,t){return ut(it(i,t))}function K(i,t){let s,n,e,r;var c=function(f,a,P,x,M){if(x<=P+1)return;let O=P,R=0,A=f*f;s=[a[P],a[x]],n=it(s[1],s[0]);let C=ut(n),I,V,z,T,v;for(let D=P+1;D<x;D++)I=it(a[D],s[0]),T=Zt(I,n),T<=0?v=G(a[D],s[0]):C<=T?v=G(a[D],s[1]):(z=T/C,V=[s[0][0]+z*n[0],s[0][1]+z*n[1]],v=G(a[D],V)),!(v<=R)&&(O=D,R=v);R>A&&(M[O]=1,c(f,a,P,O,M),c(f,a,O,x,M))};let o=i.length,p=[],d,m,g,y,w=t*t;for(e=[],r=[],e[0]=i[0],d=m=1,y=0;d<o;d++)G(i[d],i[y])<w||(e[m++]=i[d],y=d);for(y<o-1&&(e[m++]=i[o-1]),r[0]=r[m-1]=1,c(t,e,0,m-1,r),d=g=0;d<m;d++)r[d]&&(p[g++]=e[d]);return p}var ft={type:"move-point",label:"Move point",modifiers:{Shift:"Constrain to axis"},isValid(i,t,s){if(s.Alt)return!1;let n=s.proximity,[e,r]=i[0],c=t.polygon.points,o=t.selectedPoints;for(let p=0;p<c.length;p++){let d=c[p],m=d[0]-e,g=d[1]-r;if(m*m+g*g<n*n)return!0}return!1},start(i,t,s){if(t.selectedPoints.length<2){let[n,e,r]=pt(t.polygon,i[0]);return{selectedPoints:[r]}}if(t.slowState.closestPoint&&!t.selectedPoints.includes(t.slowState.closestPoint))return{selectedPoints:[t.slowState.closestPoint]}},transition(i,t,s){let n=t.transitionOrigin,[e,r]=i[0],c=t.polygon.points,o=t.selectedPoints;if(t.slowState.closestPoint){let g=t.slowState.closestPoint;o.indexOf(g)===-1&&(o=[g])}let p=[],d=e-n[0],m=r-n[1];s.Shift&&(Math.abs(d)>Math.abs(m)?m=0:d=0);for(let g=0;g<c.length;g++){let y=o.indexOf(g)!==-1,w=c[g];y?w.length===6?p.push([w[0]+d,w[1]+m,w[2],w[3],w[4],w[5]]):p.push([w[0]+d,w[1]+m]):p.push(w)}t.transitionPoints=p},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,{points:n}}};var mt=10,gt={type:"select-point",label:"Select point",trigger:{type:"click"},modifiers:{Shift:"Add to selection"},isValid(i,t,s){let n=-1;if(t.selectedPoints.length===1){let o=t.selectedPoints[0];o===0&&(n=t.polygon.points.length-1),o===t.polygon.points.length-1&&(n=0)}let[e,r]=i[0],c=t.polygon.points;for(let o=0;o<c.length;o++){let p=c[o],d=p[0]-e,m=p[1]-r;if(d*d+m*m<mt*mt)return n!==o}return!1},commit(i,t,s){let n=s.Shift?[...t.selectedPoints]:[],[e,r]=i[0],p=t.polygon.points.map((d,m)=>{let g=d[0]-e,y=d[1]-r;return[g*g+y*y,m]}).sort((d,m)=>d[0]-m[0])[0];if(t.line=null,!n.includes(p[1]))n.push(p[1]);else if(s.Shift)return{selectedPoints:n.filter(d=>d!==p[1])};return{selectedPoints:n}}};var H={type:"split-line",label:"Split line",isValid(i,t,s){return s.Meta||t.slowState.lineMode?!1:!!(t.closestLinePoint&&t.closestLineDistance<s.proximity)},transition(i,t,s){let n=t.transitionOrigin,[e,r]=i[0],c=t.polygon.points,o=[],p=e-n[0],d=r-n[1];for(let m=0;m<c.length;m++)if(o.push(c[m]),t.closestLineIndex===m){let g=t.closestLinePoint;o.push([g[0]+p,g[1]+d])}t.transitionPoints=o},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,{selectedPoints:[t.closestLineIndex+1],points:n}}};var ht={type:"add-open-point",label:"Add point",trigger:{type:"click"},isValid(i,t,s){if(!t.isOpen)return!1;if(t.polygon.points.length===0)return!0;if(t.selectedPoints.length!==1||t.polygon.points.length>=2&&t.slowState.lineMode)return!1;let n=t.selectedPoints[0];return n===0||n===t.polygon.points.length-1},commit(i,t,s){let n=t.line?t.line[1]:i[0],e=t.polygon.points;return e.length===0?{selectedPoints:[0],points:[i[0]]}:(s.Shift,t.selectedPoints[0]===0?{selectedPoints:t.slowState.lineMode?[]:[0],points:[n,...e]}:(t.line=null,{selectedPoints:t.slowState.lineMode?[]:[e.length],points:[...e,n]}))}};var W={type:"close-shape",label:"Close shape",trigger:{type:"click"},isValid(i,t,s){if(!t.isOpen||t.selectedPoints.length!==1||t.polygon.points.length<2||s.Meta)return!1;let n=t.selectedPoints[0];if(n===0){let e=t.polygon.points[t.polygon.points.length-1];return k(i[0],e)<s.proximity}if(n===t.polygon.points.length-1){let e=t.polygon.points[0];return k(i[0],e)<s.proximity}return!1},commit(i,t,s){let n=t.selectedPoints[0];if(t.line=null,n===0)return{selectedPoints:[],points:t.polygon.points.slice(0).reverse(),isOpen:!1};if(n===t.polygon.points.length-1)return{selectedPoints:[],isOpen:!1}}};var xt={type:"deselect-draw",label:"Deselect draw",trigger:{type:"key",key:"Escape"},isValid(i,t,s){return!0},commit(i,t,s){return{selectedPoints:[]}}};var Pt={type:"select-shape",label:"Select shape",trigger:{type:"click"},isValid(i,t,s){return $.isValid(i,t,s)},commit(i,t,s){return{selectedPoints:t.polygon.points.map((n,e)=>e)}}};var yt={type:"deselect-bounding-box",label:"Deselect bounding box",trigger:{type:"click"},isValid(i,t,s){return!t.isOpen&&t.selectedPoints.length>2&&t.selectedPoints.length===t.polygon.points.length},commit(i,t,s){return{selectedPoints:[]}}};var St={type:"bounding-box-corners",label:"Drag to resize",modifiers:{Shift:"Maintain aspect ratio",Alt:"Scale from center",Meta:"Rotate"},isValid(i,t,s){if(t.transitionDirection=null,t.transitionRotate=!1,t.isOpen||t.selectedPoints.length!==t.polygon.points.length||!t.polygon.boundingBox)return!1;let n=s.proximity*.5,e=s.proximity*3,r=i[0],c=t.polygon.boundingBox,o=c.x+n,p=c.x+c.width-n*2,d=c.y+n,m=c.y+c.height-n*2;if(r[0]>o&&r[0]<p&&r[1]>d&&r[1]<m)return!1;let g=[c.x+c.width,c.y+c.height],y=[c.x,c.y],w=[c.x+c.width,c.y],f=[c.x,c.y+c.height],a=["ne","nw","se","sw"],P=[k(i[0],w),k(i[0],y),k(i[0],g),k(i[0],f)],x=Math.min(...P);if(P[0]<e||P[1]<e||P[2]<e||P[3]<e){(x>s.proximity||s.Meta)&&(t.transitionRotate=!0);let M=P.indexOf(Math.min(...P));return t.transitionDirection=M!==-1?a[M]:null,!0}return!1},start(i,t,s){let n=i[0],e=t.polygon.boundingBox,r=[e.x+e.width,e.y+e.height],c=[e.x,e.y],o=[e.x+e.width,e.y],p=[e.x,e.y+e.height],d=["ne","nw","se","sw"],m=[k(i[0],o),k(i[0],c),k(i[0],r),k(i[0],p)],g=Math.min(...m),y=m.indexOf(g);t.transitionDirection=y!==-1?d[y]:null,g>s.proximity&&(t.transitionRotate=!0)},transition(i,t,s){let n=t.polygon.boundingBox,e=[n.x,n.y],r=t.transitionOrigin||i[0],[c,o]=i[0];if(s.Meta||t.transitionRotate){e=[n.x+n.width/2,n.y+n.height/2];let f=Math.atan2(r[1]-e[1],r[0]-e[0]),a=Math.atan2(o-e[1],c-e[0]),P=s.Shift,x=Math.PI/(s.Alt?4:12),M=a-f;P&&(M=Math.round(M/x)*x);let O=Math.cos(M),R=Math.sin(M),A=[];for(let I of t.polygon.points){let V=I[0]-e[0],z=I[1]-e[1],T=V*O-z*R,v=V*R+z*O,D=T+e[0],q=v+e[1];if(I.length===6){A.push([D,q,I[2],I[3],I[4],I[5]]);continue}A.push([D,q])}t.transitionPoints=A,E({points:A,iedges:null,boundingBox:null,isBezier:!1,bezierLines:[]}),t.transitionBoundingBox=t.polygon.boundingBox?{...t.polygon.boundingBox,rotation:M}:null;return}let p=0,d=0;switch(t.transitionDirection){case"se":{e=[n.x,n.y],p=c-r[0],d=o-r[1];break}case"sw":{e=[n.x+n.width,n.y],p=r[0]-c,d=o-r[1];break}case"ne":{e=[n.x,n.y+n.height],p=c-r[0],d=r[1]-o;break}case"nw":{e=[n.x+n.width,n.y+n.height],p=r[0]-c,d=r[1]-o;break}}if(s.Alt&&(e=[n.x+n.width/2,n.y+n.height/2],p*=2,d*=2),s.Shift){let f=n.width/n.height;Math.abs(n.width/p)>Math.abs(n.height/d)?d=p/f:p=d*f}let m=(n.width+p)/n.width,g=(n.height+d)/n.height,y=[];for(let f of t.polygon.points){let a=f[0]-e[0],P=f[1]-e[1],x=a*m,M=P*g,O=x+e[0],R=M+e[1];if(f.length===6){y.push([O,R,f[2],f[3],f[4],f[5]]);continue}y.push([O,R])}t.transitionPoints=y;let w={points:y,iedges:null,boundingBox:null,bezierLines:[],isBezier:!1};E(w),t.transitionBoundingBox=w.boundingBox},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,t.transitionRotate=!1,{points:n}}};var wt={type:"cut-line",label:"Add new point",trigger:{type:"click"},modifiers:{Shift:"Cut line"},isValid(i,t,s){return H.isValid(i,t,s)},commit(i,t,s){if(s.Shift&&!t.isOpen){let r=t.polygon.points,c=[],o=[],p=!1;for(let d=0;d<r.length;d++)p?o.push(r[d]):c.push(r[d]),t.closestLineIndex===d&&(p=!0);return{isOpen:!0,points:[...o,...c]}}let n=t.polygon.points,e=[];for(let r=0;r<n.length;r++)if(e.push(n[r]),t.closestLineIndex===r){let c=t.closestLinePoint;e.push(c)}return{points:e}}};var bt={type:"select-multiple-points",label:"Drag to select multiple points",isValid(i,t,s){return t.slowState.lineMode&&t.polygon.points.length>=2?!0:!t.line},transition(i,t,s){if(!t.transitionOrigin)return;let n=t.transitionOrigin[0],e=t.transitionOrigin[1],r=i[0][0],c=i[0][1],o=Math.min(n,r),p=Math.min(e,c),d=Math.abs(n-r),m=Math.abs(e-c);t.selectionBox={x:o,y:p,width:d,height:m}},commit(i,t,s){if(t.selectionBox){let n=[];s.Shift&&n.push(...t.selectedPoints);for(let e=0;e<t.polygon.points.length;e++){let r=t.polygon.points[e];r[0]>=t.selectionBox.x&&r[0]<=t.selectionBox.x+t.selectionBox.width&&r[1]>=t.selectionBox.y&&r[1]<=t.selectionBox.y+t.selectionBox.height&&n.push(e)}return{selectedPoints:n}}}};var Mt={type:"deselect-points",label:"Deselect points",trigger:{type:"click"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){return{selectedPoints:[]}}};var _=4,Bt={type:"nudge-right",label:"Nudge right",trigger:{type:"key",key:"ArrowRight"},modifiers:{Shift:"Nudge right more"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){let n=s.proximity*.3,e=t.polygon.points,r=t.selectedPoints;return{points:e.map((o,p)=>r.includes(p)?[o[0]+(s.Shift?_*n:1),o[1]]:o)}}},It={type:"nudge-left",label:"Nudge left",trigger:{type:"key",key:"ArrowLeft"},modifiers:{Shift:"Nudge left more"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){let n=s.proximity*.3,e=t.polygon.points,r=t.selectedPoints;return{points:e.map((o,p)=>r.includes(p)?[Math.max(0,o[0]-(s.Shift?_*n:1)),o[1]]:o)}}},At={type:"nudge-up",label:"Nudge up",trigger:{type:"key",key:"ArrowUp"},modifiers:{Shift:"Nudge up more"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){let n=s.proximity*.3,e=t.polygon.points,r=t.selectedPoints;return{points:e.map((o,p)=>{if(r.includes(p)){let d=o[0],m=Math.max(0,o[1]-(s.Shift?_*n:1));return o.length===6?[d,m,o[2],o[3],o[4],o[5]]:[d,m]}return o})}}},Lt={type:"nudge-down",label:"Nudge down",trigger:{type:"key",key:"ArrowDown"},modifiers:{Shift:"Nudge down more"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){let n=s.proximity*.3,e=t.polygon.points,r=t.selectedPoints;return{points:e.map((o,p)=>{let d=o[0],m=Math.max(0,o[1]-(s.Shift?_*n:1));return r.includes(p)?o.length===6?[d,m,o[2],o[3],o[4],o[5]]:[d,m]:o})}}};var kt={type:"delete-point",label:"Delete point",trigger:{type:"key",key:"Backspace"},isValid(i,t,s){return t.selectedPoints.length>0},commit(i,t,s){let e=t.polygon.points.filter((r,c)=>!t.selectedPoints.includes(c));return{isOpen:e.length<3,selectedPoints:[],points:e}}};var Ot={type:"draw-shape",label:"Draw shape",isValid(i,t,s){let n=s.Alt||t.slowState.drawMode;return!!(t.isOpen&&(t.line||t.polygon.points.length===0)&&n)},start(i,t,s){t.transitionDraw=[]},transition(i,t,s){t.transitionDraw.push(i[0])},commit(i,t,s){let n=K(t.transitionDraw,t.scale*3);return t.transitionDraw=[],t.selectedPoints[0]===0?{isOpen:!1,points:[...n,...t.polygon.points.slice(0).reverse()]}:{isOpen:!1,points:[...t.polygon.points,...n]}}};var Rt={type:"stamp-shape",label:"Stamp shape",modifiers:{Shift:"Maintain aspect ratio"},isValid(i,t,s){return t.slowState.selectedStamp!==null},start(i,t,s){let n=i[0];if(n&&t.slowState.selectedStamp){let e=t.slowState.selectedStamp,r=n[0],c=n[1],o=[],p=Math.min(...e.points.map(a=>a[0])),d=Math.min(...e.points.map(a=>a[1])),m=Math.max(...e.points.map(a=>a[0]))-p,g=Math.max(...e.points.map(a=>a[1]))-d,y=m/32;g/32>y&&(y=g/32);let w=[],f=0;for(let a of e.points)w.push(f),o.push([r+(a[0]-p)/y,c+(a[1]-d)/y]),f++;return t.transitionPoints=o,{isOpen:!1,selectedPoints:w,points:o}}},transition(i,t,s){if(!t.transitionOrigin)return;let n=t.polygon.boundingBox,e=[n.x,n.y],r=t.transitionOrigin||i[0],[c,o]=i[0],p=t.transitionOrigin[0],d=t.transitionOrigin[1],m=i[0][0],g=i[0][1],y=m-p-32,w=g-d-32;if(s.Shift){let M=n.width/n.height;Math.abs(n.width/y)>Math.abs(n.height/w)?w=y/M:y=w*M}let f=(n.width+y)/n.width,a=(n.height+w)/n.height,P=[];for(let M of t.polygon.points){let O=M[0]-e[0],R=M[1]-e[1],A=O*f,C=R*a,I=A+e[0],V=C+e[1];if(M.length===6){P.push([I,V,M[2],M[3],M[4],M[5]]);continue}P.push([I,V])}t.transitionPoints=P;let x={points:P,iedges:null,boundingBox:null,bezierLines:[],isBezier:!1};E(x),t.transitionBoundingBox=x.boundingBox},commit(i,t,s){return{isOpen:!1,points:t.transitionPoints}}};var Tt={type:"close-shape-line",label:"Close shape line",trigger:{type:"click"},isValid(i,t,s){return!t.isOpen||t.polygon.points.length<3||!t.closestLinePoint||t.closestLineDistance>=s.proximity?!1:(t.closestLineIndex===0||t.closestLineIndex===t.polygon.points.length-2,!0)},commit(i,t,s){return W.commit(i,t,s)}};var Dt={type:"stamp-fixed-size-shape",label:"Stamp fixed size shape",trigger:{type:"click"},isValid(i,t,s){return t.slowState.selectedStamp!==null},commit(i,t,s){let n=i[0],e=t.slowState.selectedStamp;if(!n||!e)return;let r=n[0],c=n[1],o=[],p=Math.min(...e.points.map(a=>a[0])),d=Math.min(...e.points.map(a=>a[1])),m=Math.max(...e.points.map(a=>a[0]))-p,g=Math.max(...e.points.map(a=>a[1]))-d,y=4*s.proximity,w=m/y;g/y>w&&(w=g/y),r-=m/w/2,c-=g/w/2;let f=0;for(let a of e.points)o.push([r+(a[0]-p)/w,c+(a[1]-d)/w]),f++;return{isOpen:!1,points:o}}};var Vt={type:"move-line",label:"Move line",isValid(i,t,s){return t.slowState.lineMode?!!(t.closestLinePoint&&t.closestLineDistance<s.proximity):!1},transition(i,t){let s=t.transitionOrigin,n=t.polygon.boundingBox,e=i[0],r=e[0]-s[0],c=e[1]-s[1];t.transitionPoints=t.polygon.points.map(o=>o.length===6?[o[0]+r,o[1]+c,o[2],o[3],o[4],o[5]]:[o[0]+r,o[1]+c])},commit(i,t,s){let n=t.transitionPoints;return t.transitionPoints=null,t.transitionBoundingBox=null,{points:n}}};var Ct={type:"close-line-box",label:"Close Line Box",trigger:{type:"click"},isValid(i,t,s){return t.slowState.lineBoxMode===!0&&t.polygon.points.length===2&&t.lineBox!==null},commit(i,t,s){return t.lineBox?{isOpen:!1,points:t.lineBox}:{}}};function tn(i={}){let t=i.proximityThreshold||10,s=i.closestLinePointFill||{selected:"#fff",unselected:"rgba(255, 255, 255, .5)"},n=i.closestLinePointStroke||{selected:"#000",unselected:"rgba(0, 0, 0, .5)"};function e(f,a,P){f&&a.transitionBoundingBox&&P.transitioning&&(f.setAttribute("x",""+a.transitionBoundingBox.x),f.setAttribute("y",""+a.transitionBoundingBox.y),f.setAttribute("width",""+a.transitionBoundingBox.width),f.setAttribute("height",""+a.transitionBoundingBox.height))}function r(f,a,P){f&&a.polygon.boundingBox&&P.showBoundingBox&&(f.setAttribute("x",""+a.polygon.boundingBox.x),f.setAttribute("y",""+a.polygon.boundingBox.y),f.setAttribute("width",""+a.polygon.boundingBox.width),f.setAttribute("height",""+a.polygon.boundingBox.height))}function c(f,a,P){if(f&&a.polygon.boundingBox&&P.showBoundingBox){let x=a.transitionBoundingBox||a.polygon.boundingBox;x.rotation?(f.style.transformOrigin=`${x.x+x.width/2}px ${x.y+x.height/2}px`,f.style.transform=`rotate(${Math.round(100*x.rotation*(180/Math.PI))/100}deg)`):f.style.transform="",f.setAttribute("points",[[x.x,x.y],[x.x+x.width,x.y],[x.x+x.width,x.y+x.height],[x.x,x.y+x.height]].map(M=>M.join(",")).join(" "))}}function o(f,a,P){f&&a.transitionPoints&&P.transitioning&&f.setAttribute("points",a.transitionPoints.map(x=>x.join(",")).join(" "))}function p(f,a,P){f&&a.closestLinePoint&&P.hasClosestLine&&(f.setAttribute("cx",""+a.closestLinePoint[0]),f.setAttribute("cy",""+a.closestLinePoint[1]),f.setAttribute("fill",a.closestLineDistance<t?s.selected:s.unselected),f.setAttribute("stroke",a.closestLineDistance<t?n.selected:n.unselected))}function d(f,a,P){f&&a.closestLinePoint&&P.hasClosestLine&&f.setAttribute("transform",`translate(${a.closestLinePoint[0]}, ${a.closestLinePoint[1]})`)}function m(f,a,P){f&&a.selectionBox&&P.transitionIntentType==="select-multiple-points"&&(f.setAttribute("x",""+a.selectionBox.x),f.setAttribute("y",""+a.selectionBox.y),f.setAttribute("width",""+a.selectionBox.width),f.setAttribute("height",""+a.selectionBox.height))}function g(f,a,P){if(f&&a.pointer&&a.selectedPoints.length)if(P.actionIntentType==="close-shape"||P.actionIntentType==="close-shape-line"){let x=a.polygon.points[0],M=a.polygon.points[a.polygon.points.length-1];x&&M&&f.setAttribute("points",`${x.join(",")} ${M.join(",")}`)}else if(a.line)f.setAttribute("points",`${a.line[0].join(",")} ${a.line[1].join(",")}`);else{let x=a.polygon.points[a.selectedPoints[0]];x&&x.length&&f.setAttribute("points",`${a.pointer[0]},${a.pointer[1]} ${x.join(",")}`)}}function y(f,a,P,x=3){f&&a.transitionDraw.length&&f.setAttribute("points",K(a.transitionDraw,x*3).map(M=>M.join(",")).join(" "))}function w(f,a){f&&a.lineBox&&f.setAttribute("points",a.lineBox.map(P=>P.join(",")).join(" "))}return{updateTransitionBoundingBox:e,updateClosestLinePointTransform:d,updateBoundingBoxPolygon:c,updateBoundingBox:r,updateTransitionShape:o,updateClosestLinePoint:p,updateSelectBox:m,updatePointLine:g,updateDrawPreview:y,updateLineBox:w}}var nn=typeof window<"u"?window.requestAnimationFrame:i=>setTimeout(i,16),en=typeof window<"u"?window.cancelAnimationFrame:i=>clearTimeout(i),st=[Rt,St,ft,Vt,H,$,j,Ot,bt],on=st.length,ot=[Ct,Dt,W,gt,Tt,wt,ht,Pt,yt,Mt],Y=[xt,Bt,It,At,Lt,kt],U={};st.forEach(i=>{U[i.type]=i});ot.forEach(i=>{U[i.type]=i});Y.forEach(i=>{U[i.type]=i});var X=20;function sn(i,t){let s={shapeId:i?.id||null,noShape:i===null,transitioning:!1,actionIntentType:null,transitionIntentType:null,selectedPoints:[],hasClosestLine:!1,modifiers:{Alt:!1,Shift:!1,Meta:!1,proximity:X},showBoundingBox:!1,currentModifiers:{},validIntentKeys:{},pointerInsideShape:!1,closestPoint:null,transitionModifiers:null,selectedStamp:null,lineMode:!1,lineBoxMode:!1,drawMode:!1,bezierLines:[]},n={isOpen:i?i.open:!1,polygon:{points:i?.points||[],iedges:null,boundingBox:null,isBezier:null,bezierLines:[]},scale:1,selectedPoints:[],pointer:null,line:null,lineBox:null,transitionPoints:null,transitionOrigin:null,transitionBoundingBox:null,closestLinePoint:null,closestLineDistance:0,closestLineIndex:-1,transitionRotate:!1,transitionDirection:null,transitionBezierLine:null,selectionBox:null,slowState:s,transitionDraw:[]},e={startTime:0,time:0,shouldUpdate:!1,nextSlowState:null,renderFunc:()=>{},setStateFunc:()=>{},animationFrame:0,actionIntent:null,transitionIntent:null,undoStack:[],undoStackPointer:-1},r={isPressed:!1,isClicking:!1,lastPress:null,pressTimeout:0,noTransition:!1};function c(l){nt(l),l.isBezier&&o({bezierLines:l.bezierLines}),E(l),e.shouldUpdate=!0}c(n.polygon);function o(l){let u=Object.keys(l);if(u.length===0)return;let S=e.nextSlowState||n.slowState,h=!1;if(u.length===1&&u[0]==="validIntentKeys"&&S.validIntentKeys){let b=Object.keys(S.validIntentKeys),B=Object.keys(l.validIntentKeys||{});if(b.length===B.length){for(let L of b)S.validIntentKeys[L]!==l.validIntentKeys[L]&&(h=!0);if(!h)return}}if(!(u.length===1&&u.includes("hasClosestLine")&&l.hasClosestLine===S.hasClosestLine)){if(e.nextSlowState){e.nextSlowState={...e.nextSlowState,...l};return}e.nextSlowState={...n.slowState,...l}}}function p(l,u=!1){e.time+=l,d(),m(),x(),P(),a(),M(),R(),O(),e.renderFunc(n,n.slowState,l),!u&&(e.animationFrame=nn(p))}function d(){if(e.shouldUpdate&&(t({id:n.slowState.shapeId||void 0,open:n.isOpen,points:n.polygon.points}),e.shouldUpdate=!1),e.nextSlowState&&e.nextSlowState!==n.slowState){let l=Object.keys(n.slowState),u={},S=!1;for(let h of l){let b=n.slowState[h],B=e.nextSlowState[h];b!==B?(S=!0,u[h]=B):u[h]=b}S&&(n.slowState=u,e.nextSlowState=null,e.setStateFunc(n.slowState))}}function m(){n.slowState.showBoundingBox?(n.slowState.noShape||n.selectedPoints.length===0||n.selectedPoints.length!==n.polygon.points.length)&&o({showBoundingBox:!1}):!n.slowState.noShape&&n.polygon.points.length&&n.selectedPoints.length===n.polygon.points.length&&o({showBoundingBox:!0})}function g(l){n.selectedPoints=l.selectedPoints,o({selectedPoints:l.selectedPoints}),n.polygon.points=l.points,n.polygon.boundingBox=null,n.polygon.iedges=null,n.polygon.isBezier=null,c(n.polygon),o({closestPoint:null}),(l.isOpen===!0||l.isOpen===!1)&&(n.isOpen=l.isOpen,e.shouldUpdate=!0)}function y(){if(e.undoStackPointer===-1)return;e.undoStackPointer--;let l=e.undoStack[e.undoStackPointer];g(l)}function w(){if(e.undoStackPointer===e.undoStack.length-1)return;e.undoStackPointer++;let l=e.undoStack[e.undoStackPointer];g(l)}function f(l){e.undoStackPointer++,e.undoStack[e.undoStackPointer]=l,e.undoStack.length>15&&(e.undoStack.shift(),e.undoStackPointer--)}function a(){if(!n.pointer||n.slowState.noShape){o({pointerInsideShape:!1});return}let[l,u]=n.pointer,S=n.polygon.points,h=n.polygon.boundingBox;if(!h){o({pointerInsideShape:!1});return}if(l<h.x||l>h.x+h.width||u<h.y||u>h.height+h.y){o({pointerInsideShape:!1});return}let b=!1;for(let B=0,L=S.length-1;B<S.length;L=B++)S[B][1]>u!=S[L][1]>u&&l<(S[L][0]-S[B][0])*(u-S[B][1])/(S[L][1]-S[B][1])+S[B][0]&&(b=!b);o({pointerInsideShape:b})}function P(){if(n.slowState.noShape||!n.pointer||n.slowState.transitioning||!n.polygon.points||n.polygon.points.length===0)return;let[l,u]=n.pointer,S=n.polygon.points.map((h,b)=>{let B=h[0]-l,L=h[1]-u;return[B*B+L*L,b]}).sort((h,b)=>h[0]-b[0]);S.length&&o({closestPoint:S[0][1]})}function x(){if(!n.pointer||n.slowState.transitioning)return;if(n.slowState.noShape){n.closestLineIndex=-1,n.closestLinePoint=null,n.closestLineDistance=0;return}let[l,u,S,h]=et(n.polygon,n.pointer),b=rt()*rt();u<b&&(!n.isOpen||n.slowState.lineMode||n.polygon.points.length-1!==h)?(n.closestLinePoint=l,n.closestLineDistance=Math.sqrt(u),n.closestLineIndex=h,o({hasClosestLine:!0})):(n.closestLinePoint=null,n.closestLineDistance=0,n.closestLineIndex=-1,o({hasClosestLine:!1}))}function M(){if(!n.pointer||n.slowState.transitioning||n.slowState.noShape)return;let l=!1;for(let h=0;h<on;h++){let b=st[h];if(b.isValid(r.isPressed?[r.lastPress]:[n.pointer],n,A())){if(e.transitionIntent===b){l=!0;break}o({transitionIntentType:b.type}),e.transitionIntent=b,l=!0;break}}l||e.transitionIntent&&(e.transitionIntent=null,o({transitionIntentType:null}));let u=!1;for(let h=0;h<ot.length;h++){let b=ot[h];if(I(b)){if(e.actionIntent===b){u=!0;break}o({actionIntentType:b.type}),e.actionIntent=b,u=!0;break}}u||e.actionIntent&&(e.actionIntent=null,o({actionIntentType:null}));let S={};for(let h=0;h<Y.length;h++){let b=Y[h];b.trigger.type==="key"&&I(b)&&(S[b.trigger.key]=b.label)}o({validIntentKeys:S})}function O(){let l=n.pointer;if(n.lineBox=null,!l||z()||n.polygon.points.length!==2)return;let[u,S]=l,[h,b]=n.polygon.points[0],[B,L]=n.polygon.points[1],[N,J,lt,at]=et(n.polygon,l);if(!N)return;let F=u-N[0],ct=S-N[1],Q=[h,b],Z=[B,L],Gt=[Z[0]+F,Z[1]+ct],Kt=[Q[0]+F,Q[1]+ct];n.lineBox=[Q,Z,Gt,Kt]}function R(){let l=n.pointer;if(!l||!z()||n.slowState.noShape)return;let u=n.selectedPoints[0];if(n.line=[n.polygon.points[u],l],n.slowState.modifiers.Shift){let S=0;if(n.polygon.points.length>1){let F=n.selectedPoints[0];F===0?S=Math.atan2(n.polygon.points[1][1]-n.polygon.points[0][1],n.polygon.points[1][0]-n.polygon.points[0][0]):S=Math.atan2(n.polygon.points[F-1][1]-n.polygon.points[F][1],n.polygon.points[F-1][0]-n.polygon.points[F][0])}let h=l[0]-n.polygon.points[u][0],b=l[1]-n.polygon.points[u][1],B=Math.atan2(b,h),L=Math.PI/4,N=Math.round((B-S)/L)*L+S,J=k(n.polygon.points[u],l),lt=Math.cos(N)*J+n.polygon.points[u][0],at=Math.sin(N)*J+n.polygon.points[u][1];n.line[1]=[lt,at]}}function A(){return n.slowState.modifiers}function C(l){let u=l.commit([r.lastPress],n,A());u&&(u.selectedPoints&&(n.selectedPoints=u.selectedPoints,o({selectedPoints:u.selectedPoints})),u.points&&(n.polygon.points=u.points,n.polygon.boundingBox=null,n.polygon.iedges=null,n.polygon.isBezier=null,n.transitionBoundingBox=null,c(n.polygon),o({closestPoint:null,selectedStamp:null})),(u.isOpen===!0||u.isOpen===!1)&&(n.isOpen=u.isOpen,e.shouldUpdate=!0),f({isOpen:n.isOpen,points:n.polygon.points,selectedPoints:n.selectedPoints})),o({transitionModifiers:null})}function I(l){return l.isValid(n.pointer?[n.pointer]:[],n,A())}function V(l){l==="Delete"&&(l="Backspace");for(let u of Y)if(!(u.trigger.type!=="key"||u.trigger.key!==l)&&I(u))return C(u),!0}function z(){let l=n.polygon.points,u=n.pointer;if(!n.isOpen||!l.length||n.selectedPoints.length!==1||!u)return!1;let S=n.selectedPoints[0],h=S===0,b=S===l.length-1;return h||b}let T={reset(){o({modifiers:{Alt:!1,Shift:!1,Meta:!1,proximity:X}})},getForType(l){let u={};if(!l)return u;let S=U[l];return!S||!S.modifiers?u:S.modifiers},set(l){l!=="Shift"&&l!=="Alt"&&l!=="Meta"||o({modifiers:{...e.nextSlowState?.modifiers||n.slowState.modifiers,[l]:!0}})},unset(l){l!=="Shift"&&l!=="Alt"&&l!=="Meta"||o({modifiers:{...e.nextSlowState?.modifiers||n.slowState.modifiers,[l]:!1}})}},v={set(l){o({selectedStamp:l})},clear(){o({selectedStamp:null})},square(){o({selectedStamp:{id:"square",open:!1,points:[[0,0],[0,100],[100,100],[100,0]]}})},triangle(){o({selectedStamp:{id:"triangle",open:!1,points:[[50,0],[0,100],[100,100]]}})},pentagon(){o({selectedStamp:{id:"pentagon",open:!1,points:[[0,0],[0,100],[100,100],[100,0],[50,-50]]}})},hexagon(){o({selectedStamp:{id:"hexagon",open:!1,points:[[0,0],[0,100],[50,150],[100,100],[100,0],[50,-50]]}})}},D={down(l){return l=="Shift"||l=="Alt"||l=="Meta"?(T.set(l),!0):l==="Control"?(T.set("Meta"),!0):l==="z"&&n.slowState.modifiers.Meta?(n.slowState.modifiers.Shift?w():y(),!0):V(l)},up(l){if(l==="Control"){T.unset("Meta");return}l!=="Shift"&&l!=="Alt"&&l!=="Meta"||T.unset(l)}};function q(l){n.scale=l,o({modifiers:{...e.nextSlowState?.modifiers||n.slowState.modifiers,proximity:l*X}})}function rt(){return X*n.scale}let zt={set:l=>{e.renderFunc=l},start:(l,u)=>{e.startTime=performance.now(),e.time=0,l&&(e.renderFunc=l),u&&(u(n.slowState),e.setStateFunc=u),p(0)},stop:()=>{e.animationFrame&&(en(e.animationFrame),e.animationFrame=0)},step:(l=16)=>{p(l)}};function vt(l){let u=l[0];if(!(!u||!u[0]&&u[0]!==0||!u[1]&&u[1]!==0)&&!(Number.isNaN(u[0])||Number.isNaN(u[1]))){if(n.pointer=u||null,n.slowState.transitioning)e.transitionIntent&&e.transitionIntent.transition(l,n,A());else if(r.isPressed&&!r.noTransition&&(!r.isClicking||k(r.lastPress,n.pointer)>10))if(clearTimeout(r.pressTimeout),r.isClicking=!1,e.transitionIntent){if(n.transitionOrigin=r.lastPress,o({transitioning:!0}),e.transitionIntent.start){let h=e.transitionIntent.start([r.lastPress],n,A());h&&(h.selectedPoints&&(n.selectedPoints=h.selectedPoints,o({selectedPoints:h.selectedPoints})),(h.isOpen===!0||h.isOpen===!1)&&(n.isOpen=h.isOpen,e.shouldUpdate=!0),h.points&&(n.polygon.points=h.points,n.polygon.boundingBox=null,n.polygon.iedges=null,c(n.polygon),o({closestPoint:null})))}o({transitionModifiers:e.transitionIntent.modifiers||null}),e.transitionIntent.transition([r.lastPress],n,A())}else r.noTransition=!0}}function Ft(){n.pointer=null,n.slowState.transitioning||(r.isPressed=!1,r.isClicking=!1,r.lastPress=null,o({transitionIntentType:null,actionIntentType:null}),e.transitionIntent=null,e.actionIntent=null)}function Et(){r.isClicking=!0,r.isPressed=!0,r.lastPress=n.pointer,r.pressTimeout=setTimeout(()=>{r.isPressed&&(r.isClicking=!1)},250)}function Nt(){n.slowState.transitioning?(o({transitioning:!1}),e.transitionIntent&&C(e.transitionIntent),e.transitionIntent=null,o({transitionIntentType:null})):r.isClicking&&(e.actionIntent&&C(e.actionIntent),e.actionIntent=null,o({actionIntentType:null})),r.isPressed=!1,r.isClicking=!1,r.lastPress=null,r.noTransition=!1,clearTimeout(r.pressTimeout)}function Ut(l){n.polygon.points=l?.points||[],n.polygon.boundingBox=null,n.polygon.iedges=null,n.isOpen=l?.open||!1,c(n.polygon),e.nextSlowState=null,e.undoStack=[],e.undoStackPointer=-1,n.lineBox=null,n.line=null,r.pressTimeout&&clearTimeout(r.pressTimeout),o({noShape:l===null,shapeId:l?.id||null,transitioning:!1,actionIntentType:null,transitionIntentType:null,selectedPoints:[],hasClosestLine:!1,modifiers:{Alt:!1,Shift:!1,Meta:!1,proximity:n.slowState.modifiers.proximity},showBoundingBox:!1,currentModifiers:{},validIntentKeys:{},selectedStamp:null,drawMode:!1,closestPoint:null,pointerInsideShape:!1,lineBoxMode:!1,lineMode:!1}),d()}function qt(l){if(!l)return"";let u=U[l];return!u||!u.modifiers?u.label||"":n.slowState.modifiers.Shift&&u.modifiers.Shift?u.modifiers.Shift:n.slowState.modifiers.Alt&&u.modifiers.Alt?u.modifiers.Alt:n.slowState.modifiers.Meta&&u.modifiers.Meta?u.modifiers.Meta:u.label}function jt(){n.slowState.lineMode?o({lineMode:!1,lineBoxMode:!1,drawMode:!1}):o({lineMode:!0,lineBoxMode:!1,drawMode:!1})}function $t(){n.slowState.lineBoxMode?o({lineMode:!1,lineBoxMode:!1,drawMode:!1}):o({lineBoxMode:!0,lineMode:!0,drawMode:!1})}return{draw:{enable(){o({drawMode:!0,lineMode:!1,lineBoxMode:!1})},disable(){o({drawMode:!1})},toggle(){o({drawMode:!n.slowState.drawMode,lineMode:!1,lineBoxMode:!1})}},state:n,modifiers:T,stamps:v,key:D,setScale:q,clock:zt,pointer:vt,blur:Ft,pointerDown:Et,pointerUp:Nt,setShape:Ut,modes:{toggleLineBoxMode:$t,toggleLineMode:jt,enableLineMode(){o({lineMode:!0,lineBoxMode:!1,drawMode:!1})},disableLineMode(){o({lineMode:!1,lineBoxMode:!1,drawMode:!1})},enableLineBoxMode(){o({lineMode:!0,lineBoxMode:!0,drawMode:!1})},disableLineBoxMode(){o({lineMode:!1,lineBoxMode:!1,drawMode:!1})}},label:qt}}0&&(module.exports={createHelper,createSvgHelpers});
