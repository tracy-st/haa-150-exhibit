import {
  t
} from "./chunk-WCXO2MPA.js";

// node_modules/@iiif/helpers/dist/events-D3fWQ70H.js
function t2(t18 = t) {
  return { addEventListener(e11, n15, r16, i16) {
    if (e11) return t18.setMetaValue([e11.id, `eventManager`, n15], (e12) => {
      let t19 = e12 || [];
      for (let e13 of t19) if (e13.callback === r16) return t19;
      return [...t19, { callback: r16, scope: i16 }];
    }), r16;
  }, removeEventListener(e11, n15, r16) {
    e11 && t18.setMetaValue([e11.id, `eventManager`, n15], (e12) => (e12 || []).filter((e13) => e13.callback !== r16));
  }, getListenersAsProps(e11, n15) {
    let r16 = typeof e11 == `string` ? { id: e11 } : e11;
    if (!r16 || !r16.id) return {};
    let i16 = t18.getResourceMeta(r16.id, `eventManager`), a15 = {};
    if (i16 && r16) for (let e12 of Object.keys(i16)) a15[e12] = (a16) => {
      let o14 = t18.get(r16);
      for (let { callback: t19, scope: r17 } of i16[e12] || []) (!r17 || n15 && r17.indexOf(n15) !== -1) && t19(a16, o14);
    };
    return a15;
  } };
}

// node_modules/@iiif/helpers/dist/styles-DH_xEJTp.js
function t3(t18 = t) {
  return { applyStyles(e11, n15, r16) {
    let i16 = typeof e11 == `string` ? e11 : e11.id;
    return t18.setMetaValue([i16, `styles`, n15], r16);
  }, getAppliedStyles(e11) {
    let n15 = typeof e11 == `string` ? e11 : e11.id;
    return t18.getResourceMeta(n15, `styles`);
  } };
}

// node_modules/@iiif/helpers/dist/defineProperty-C901nNqu.js
function e(t18) {
  "@babel/helpers - typeof";
  return e = typeof Symbol == `function` && typeof Symbol.iterator == `symbol` ? function(e11) {
    return typeof e11;
  } : function(e11) {
    return e11 && typeof Symbol == `function` && e11.constructor === Symbol && e11 !== Symbol.prototype ? `symbol` : typeof e11;
  }, e(t18);
}
function t4(t18, n15) {
  if (e(t18) != `object` || !t18) return t18;
  var r16 = t18[Symbol.toPrimitive];
  if (r16 !== void 0) {
    var i16 = r16.call(t18, n15 || `default`);
    if (e(i16) != `object`) return i16;
    throw TypeError(`@@toPrimitive must return a primitive value.`);
  }
  return (n15 === `string` ? String : Number)(t18);
}
function n(n15) {
  var r16 = t4(n15, `string`);
  return e(r16) == `symbol` ? r16 : r16 + ``;
}
function r(e11, t18, r16) {
  return (t18 = n(t18)) in e11 ? Object.defineProperty(e11, t18, { value: r16, enumerable: true, configurable: true, writable: true }) : e11[t18] = r16, e11;
}

// node_modules/@iiif/helpers/dist/vanilla-CQtPfF5u.js
var e2 = (e11) => {
  let t18, n15 = /* @__PURE__ */ new Set(), r16 = (e12, r17) => {
    let i17 = typeof e12 == `function` ? e12(t18) : e12;
    if (!Object.is(i17, t18)) {
      let e13 = t18;
      t18 = r17 ?? (typeof i17 != `object` || !i17) ? i17 : Object.assign({}, t18, i17), n15.forEach((n16) => n16(t18, e13));
    }
  }, i16 = () => t18, a15 = () => l8, o14 = (e12) => (n15.add(e12), () => n15.delete(e12)), s10 = () => {
    (import.meta.env ? import.meta.env.MODE : void 0) !== `production` && console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."), n15.clear();
  }, c8 = { setState: r16, getState: i16, getInitialState: a15, subscribe: o14, destroy: s10 }, l8 = t18 = e11(r16, i16, c8);
  return c8;
};
var t5 = (t18) => t18 ? e2(t18) : e2;

// node_modules/@iiif/helpers/dist/mitt-BnbXAJlg.js
function e3(e11) {
  return { all: e11 || (e11 = /* @__PURE__ */ new Map()), on: function(t18, n15) {
    var r16 = e11.get(t18);
    r16 ? r16.push(n15) : e11.set(t18, [n15]);
  }, off: function(t18, n15) {
    var r16 = e11.get(t18);
    r16 && (n15 ? r16.splice(r16.indexOf(n15) >>> 0, 1) : e11.set(t18, []));
  }, emit: function(t18, n15) {
    var r16 = e11.get(t18);
    r16 && r16.slice().map(function(e12) {
      e12(n15);
    }), (r16 = e11.get(`*`)) && r16.slice().map(function(e12) {
      e12(t18, n15);
    });
  } };
}

// node_modules/@iiif/parser/dist/profiles-DU_UcLCg.js
var e4 = `http://library.stanford.edu/iiif/image-api/compliance.html#level0`;
var t6 = `http://library.stanford.edu/iiif/image-api/compliance.html#level1`;
var n2 = `http://library.stanford.edu/iiif/image-api/compliance.html#level2`;
var r2 = `http://library.stanford.edu/iiif/image-api/conformance.html#level0`;
var i = `http://library.stanford.edu/iiif/image-api/conformance.html#level1`;
var a = `http://library.stanford.edu/iiif/image-api/conformance.html#level2`;
var o = `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0`;
var s = `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1`;
var c = `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2`;
var l = `http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0`;
var u = `http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1`;
var d = `http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2`;
var f = `http://iiif.io/api/image/1/level0.json`;
var p = `http://iiif.io/api/image/1/profiles/level0.json`;
var m = `http://iiif.io/api/image/1/level1.json`;
var h = `http://iiif.io/api/image/1/profiles/level1.json`;
var g = `http://iiif.io/api/image/1/level2.json`;
var _ = `http://iiif.io/api/image/1/profiles/level2.json`;
var v = `http://iiif.io/api/image/2/level0.json`;
var y = `http://iiif.io/api/image/2/profiles/level0.json`;
var b = `http://iiif.io/api/image/2/level1.json`;
var x = `http://iiif.io/api/image/2/profiles/level1.json`;
var S = `http://iiif.io/api/image/2/level2.json`;
var C = `http://iiif.io/api/image/2/profiles/level2.json`;
var w = `level0`;
var T = `level1`;
var E = `level2`;
var D = `http://iiif.io/api/image/2/level0`;
var O = `http://iiif.io/api/image/2/level1`;
var k = `http://iiif.io/api/image/2/level2`;
var A = [k, n2, a, c, d, g, _, S, C, E];
var j = [...A, O, t6, i, s, u, m, h, b, x, T];
var M = [D, O, k, e4, t6, n2, r2, i, a, o, s, c, l, u, d, f, p, m, h, g, _, v, y, b, x, S, C, w, T, E];
var N = M;
var P = [D, e4, r2, o, l, f, p, v, y, w];
var F = { extraFormats: [`jpg`], extraQualities: [`default`], extraFeatures: [`sizeByWhListed`] };
var I = { extraFormats: [`jpg`], extraQualities: [`default`], extraFeatures: [`baseUriRedirect`, `cors`, `jsonldMediaType`, `regionByPx`, `regionSquare`, `sizeByWhListed`, `sizeByH`, `sizeByW`, `sizeByWh`] };
var L = { extraFormats: [`jpg`, `png`], extraQualities: [`default`], extraFeatures: [`baseUriRedirect`, `cors`, `jsonldMediaType`, `regionByPct`, `regionByPx`, `regionSquare`, `rotationBy90s`, `sizeByWhListed`, `sizeByConfinedWh`, `sizeByH`, `sizeByPct`, `sizeByW`, `sizeByWh`] };

// node_modules/@iiif/parser/dist/image-3.js
function P2(e11) {
  try {
    if (e11 === `full`) return { full: true };
    if (e11 === `square`) return { square: true };
    let t18 = e11.startsWith(`pct:`), n15 = e11.substr(t18 ? 4 : 0).split(`,`), r16 = n15.map((e12) => parseFloat(e12));
    return { x: r16[0], y: r16[1], w: r16[2], h: r16[3], percent: t18 };
  } catch {
    throw Error(`Expected 'full', 'square' or 'x,y,w,h'. Found ` + e11);
  }
}
function F2(e11) {
  let t18 = { upscaled: false, max: false, confined: false };
  if (e11[0] === `^` && (t18.upscaled = true, e11 = e11.slice(1)), e11 === `max` || e11 === `full`) return t18.max = true, t18.serialiseAsFull = e11 === `full`, t18;
  if (e11[0] === `!` && (t18.confined = true, e11 = e11.slice(1)), e11[0] === `p`) return t18.percentScale = parseFloat(e11.slice(4)), t18;
  let n15 = e11.split(`,`).map((e12) => e12.trim());
  return n15.length && (n15[0] !== `` && (t18.width = parseInt(n15[0], 10)), n15[1] !== `` && (t18.height = parseInt(n15[1], 10))), t18;
}
function I2(e11) {
  let t18 = { angle: 0 };
  if (e11[0] === `!` && (t18.mirror = true, e11 = e11.substr(1)), t18.angle = parseFloat(e11) % 360, Number.isNaN(t18.angle)) throw Error(`Invalid rotation ${e11}`);
  return t18;
}
function L2(e11, t18 = ``) {
  let n15 = e11.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);
  if (!n15) throw Error(`Invalid or unknown input ${e11}`);
  let r16 = n15[2], i16 = n15[3], a15 = n15[4];
  if (a15[0] === `/` && (a15 = a15.substring(1)), t18.length > 0) {
    if (t18[0] === `/` && (t18 = t18.substring(1)), t18 !== a15.substring(0, t18.length)) throw Error(`Path does not start with prefix (path: ${a15}, prefix: ${t18})`);
    a15 = a15.substring(t18.length);
  }
  return { scheme: r16, server: i16, path: a15, prefix: t18 };
}
function R2(e11, t18 = ``) {
  let { path: n15, scheme: r16, server: i16, prefix: a15 } = L2(e11, t18), o14 = n15.split(`/`).reverse(), [s10, c8, l8, u7, ...d7] = o14, f7 = d7.reverse().filter(Boolean).join(`/`);
  if (o14.length === 1 || s10 === ``) return { type: `base`, scheme: r16, server: i16, prefix: a15, identifier: f7 };
  if (s10 === `info.json`) {
    let [, ...e12] = o14;
    return { type: `info`, scheme: r16, server: i16, prefix: a15, identifier: e12.reverse().filter(Boolean).join(`/`) };
  }
  if (r16 === void 0 || i16 === void 0 || n15 === void 0 || u7 === void 0 || l8 === void 0 || c8 === void 0 || s10 === void 0) throw Error(`Invalid image service URL`);
  let [p6 = ``, m6 = ``] = s10.split(`.`);
  return { type: `image`, scheme: r16, server: i16, prefix: a15, identifier: f7, originalPath: n15, region: P2(u7), size: F2(l8), rotation: I2(c8), quality: p6, format: m6 };
}
function z(e11) {
  let t18 = A.indexOf(e11) !== -1;
  if (t18) return L;
  let n15 = j.indexOf(e11) !== -1;
  return n15 ? I : F;
}
function B(e11) {
  let t18 = e11 ? Array.isArray(e11.profile) ? e11.profile : [e11.profile] : [], n15 = { extraQualities: [], extraFormats: [], extraFeatures: [] };
  for (let e12 of t18) {
    if (typeof e12 == `string` && (e12 = z(e12)), !e12) continue;
    if (e12.formats) for (let t19 of e12.formats) n15.extraFormats.indexOf(t19) === -1 && n15.extraFormats.push(t19);
    if (e12.qualities) for (let t19 of e12.qualities) n15.extraQualities.indexOf(t19) === -1 && n15.extraQualities.push(t19);
    if (e12.supports) for (let t19 of e12.supports) n15.extraFeatures.indexOf(t19) === -1 && n15.extraFeatures.push(t19);
    if (e12.maxHeight && (n15.maxHeight = e12.maxHeight), e12.maxWidth && (n15.maxWidth = e12.maxWidth), e12.maxArea && (n15.maxArea = e12.maxArea), e12.extraFormats) for (let t19 of e12.extraFormats) n15.extraFormats.indexOf(t19) === -1 && n15.extraFormats.push(t19);
    if (e12.extraQualities) for (let t19 of e12.extraQualities) n15.extraQualities.indexOf(t19) === -1 && n15.extraQualities.push(t19);
    if (e12.extraFeatures) for (let t19 of e12.extraFeatures) n15.extraFeatures.indexOf(t19) === -1 && n15.extraFeatures.push(t19);
    e12.maxHeight && (n15.maxHeight = e12.maxHeight), e12.maxWidth && (n15.maxWidth = e12.maxWidth), e12.maxArea && (n15.maxArea = e12.maxArea);
  }
  if (e11.extraFormats) for (let t19 of e11.extraFormats) n15.extraFormats.indexOf(t19) === -1 && n15.extraFormats.push(t19);
  if (e11.extraFeatures) for (let t19 of e11.extraFeatures) n15.extraFeatures.indexOf(t19) === -1 && n15.extraFeatures.push(t19);
  if (e11.extraQualities) for (let t19 of e11.extraQualities) n15.extraQualities.indexOf(t19) === -1 && n15.extraQualities.push(t19);
  return n15;
}
function V(e11) {
  let t18 = Array.isArray(e11.profile) ? e11.profile : [e11.profile];
  for (let e12 of t18) if (typeof e12 == `string` && P.indexOf(e12) !== -1) return true;
  return false;
}
function H(e11) {
  if (e11[`@id`]) return e11[`@id`];
  if (e11.id) return e11.id;
}
function U(e11) {
  if (!e11 || !e11.profile || !H(e11)) return false;
  let t18 = Array.isArray(e11.profile) ? e11.profile : [e11.profile];
  for (let e12 of t18) if (typeof e12 == `string` && M.indexOf(e12) !== -1) return true;
  return false;
}
function G(e11) {
  if (!U(e11)) return false;
  let t18 = Array.isArray(e11.profile) ? e11.profile : [e11.profile];
  for (let e12 of t18) if (typeof e12 == `string`) {
    if (j.indexOf(e12) !== -1) return true;
  } else {
    let t19 = [...e12.supports || [], ...e12.extraFeatures || []];
    if (t19.indexOf(`regionByPx`) !== -1 && (t19.indexOf(`sizeByW`) !== -1 || t19.indexOf(`sizeByWh`) !== -1)) return true;
  }
  return false;
}
function J({ x: e11 = 0, y: t18 = 0, w: n15, h: r16, full: i16, square: a15, percent: o14 }) {
  if (i16) return `full`;
  if (a15) return `square`;
  if (n15 === void 0 || r16 === void 0) throw Error(`RegionParameter: invalid region`);
  let s10 = `${e11},${t18},${n15},${r16}`;
  return o14 ? `pct:${s10}` : s10;
}
function Y({ max: e11, percentScale: t18, upscaled: n15, confined: r16, width: i16, height: a15, serialiseAsFull: o14, version: s10 }) {
  let c8 = [];
  return n15 && c8.push(`^`), e11 ? (c8.push(o14 ? `full` : `max`), c8.join(``)) : (r16 && c8.push(`!`), t18 && c8.push(`pct:${t18}`), i16 && c8.push(`${i16}`), c8.push(`,`), a15 && s10 === 3 && c8.push(`${a15}`), c8.join(``));
}
function X(e11) {
  return `${e11.mirror ? `!` : ``}${(e11.angle || 0) % 360}`;
}
function Z(e11, t18) {
  let n15 = e11.prefix.startsWith(`/`) ? e11.prefix.substring(1) : e11.prefix, r16 = `${e11.scheme}://${e11.server}/${n15 ? `${n15}/` : ``}${e11.identifier}`;
  if (e11.type === `base`) return r16;
  if (e11.type === `info`) return `${r16}/info.json`;
  let { size: i16 } = e11, { region: a15, rotation: o14, format: s10, quality: c8 } = e11;
  if (t18) {
    let e12 = t18[`@context`] ? Array.isArray(t18[`@context`]) ? t18[`@context`] : [t18[`@context`]] : [], n16 = e12.indexOf(`http://iiif.io/api/image/2/context.json`) !== -1, r17 = e12.indexOf(`http://iiif.io/api/image/3/context.json`) !== -1;
    if ((i16.width === t18.width && !i16.height || i16.height === t18.height && !i16.width || i16.width === t18.width && i16.height === t18.height) && (i16 = { ...i16, max: true }), n16 && (i16.max && !i16.serialiseAsFull && (i16 = { ...i16, serialiseAsFull: true }), !i16.max && i16.width && i16.height && (i16 = { ...i16, height: void 0 }), i16 = { ...i16, version: 2 }), r17) {
      if (i16.max && i16.serialiseAsFull && (i16 = { ...i16, serialiseAsFull: false }), i16.width && !i16.height && t18.width && t18.height) {
        let e13 = t18.height / t18.width;
        i16 = { ...i16, height: Math.ceil(i16.width * e13) };
      }
      i16 = { ...i16, version: 3 };
    }
  }
  return [r16, J(a15), Y(i16), X(o14), `${c8}.${s10}`].filter(Boolean).join(`/`);
}
function Q(e11) {
  return e11.endsWith(`info.json`) ? e11 : e11.endsWith(`/`) ? `${e11}info.json` : `${e11}/info.json`;
}
function se(e11) {
  let t18 = R2(Q(e11.id));
  if (t18.type !== `info`) throw Error(`Invalid service URL`);
  let n15 = B(e11);
  return { identifier: t18.identifier, originalPath: ``, server: t18.server, prefix: t18.prefix, scheme: t18.scheme, type: `image`, quality: n15.extraQualities.indexOf(`default`) === -1 ? n15.extraQualities[0] : `default`, region: { full: true }, size: { max: true, upscaled: false, confined: false }, format: `jpg`, rotation: { angle: 0 } };
}
function ce(e11, t18, n15) {
  let r16 = n15.length, i16 = [];
  for (let t19 = 0; t19 < r16; t19++) {
    let r17 = n15[t19];
    if (!r17) continue;
    let a15 = r17.width;
    i16.push(e11 / a15);
  }
  return i16;
}
function le(e11, t18, n15) {
  let r16 = n15.length, i16 = [];
  for (let a15 = 0; a15 < r16; a15++) {
    let r17 = n15[a15];
    r17 && i16.push({ width: Math.floor(e11 / r17), height: Math.floor(t18 / r17) });
  }
  return i16;
}
function $(e11, t18) {
  if (t18 && t18.profile) {
    let n15 = t18.profile;
    if (n15) {
      let t19 = Array.isArray(n15) ? n15 : [n15];
      if (t19.includes(`level${e11}`) || t19.includes(`http://iiif.io/api/image/2/level${e11}.json`) || t19.includes(`http://iiif.io/api/image/1/level${e11}.json`) || t19.includes(`http://iiif.io/api/image/1/profiles/level${e11}.json`)) return true;
      if (e11 === 2) {
        for (let e12 of t19) if (A.includes(e12)) return true;
      }
      if (e11 === 1) {
        for (let e12 of t19) if (j.includes(e12)) return true;
      }
      if (e11 === 0) {
        for (let e12 of t19) if (P.includes(e12)) return true;
      }
    }
  }
  return false;
}
function ue(e11) {
  return U(e11) ? $(2, e11) ? 2 : $(1, e11) ? 1 : $(0, e11) ? 0 : null : null;
}
function de(e11) {
  let t18 = e11.service ? Array.isArray(e11.service) ? e11.service : [e11.service] : [], n15 = t18.length, r16 = [];
  for (let e12 = 0; e12 < n15; e12++) U(t18[e12]) && r16.push(t18[e12]);
  return r16;
}
function fe(e11) {
  if (e11[`@type`]) return e11[`@type`];
  if (e11.type) return e11.type;
}

// node_modules/@iiif/helpers/dist/image-service-BvY9CGnV.js
function h2(e11) {
  let t18 = e11.replace(/(https?:\/\/)?(www.)?/i, ``);
  return t18.indexOf(`/`) === -1 ? t18 : t18.split(`/`)[0];
}
function g2(e11, t18, n15) {
  let r16 = e11 > t18 ? e11 : t18, i16 = n15.length, a15 = [];
  for (let e12 = 0; e12 < i16; e12++) {
    let t19 = n15[e12];
    if (!t19 || t19.scaleFactors.length === 0) continue;
    let i17 = t19.scaleFactors[0];
    if (!i17) continue;
    let o14 = r16 / i17, s10 = [i17];
    for (; o14 >= t19.width; ) i17 *= 2, s10.push(i17), o14 /= 2;
    a15.push({ ...t19, scaleFactors: s10 });
  }
  return a15;
}
function _2(e11, t18, n15) {
  let a15 = se({ "@context": e11.version === 3 ? `http://iiif.io/api/image/3/context.json` : `http://iiif.io/api/image/2/context.json`, id: Q(H(e11)), profile: e11.level === null || e11.level === void 0 ? `level0` : `level${e11.level}`, type: e11.version === 3 ? `ImageService3` : `ImageService2` });
  if (a15.type !== `image`) throw Error(`Invalid service`);
  a15.size.max = false, a15.size.width = t18, a15.size.height = n15;
  let o14 = Z(a15);
  return { id: o14, type: `fixed`, width: t18, height: n15 || e11.height / (e11.width || 1) * t18, unsafe: e11.width > t18 };
}
function v2(e11, t18, n15) {
  let r16 = e11.width ? e11.width : e11.maxWidth;
  return n15.height <= e11.maxHeight && n15.width <= e11.maxWidth && n15.height >= e11.minHeight && n15.width >= e11.minWidth && (!t18 || Math.abs(n15.width - r16) < Math.abs(t18.width - r16));
}
function y2(e11, t18) {
  let n15 = [], r16 = Object.assign({ unsafeImageService: false, atAnyCost: true, fallback: true, minHeight: 64, minWidth: 64, maxHeight: 1 / 0, maxWidth: 1 / 0, returnAllOptions: false, preferFixedSize: false, allowUnsafe: false, explain: false, height: 0, width: 0 }, e11), i16 = (e12, t19 = 0) => r16.explain ? n15.push(Array(t19).fill(0).map((e13) => `    `).join(``) + e12().trim()) : void 0, a15 = [], o14 = [], s10 = null;
  i16(() => `Using configuration: ${JSON.stringify(r16, null, 2)}`);
  let c8 = (e12, t19) => {
    if (i16(() => `Swapping choice`, 3), v2(r16, t19, e12)) {
      if (r16.preferFixedSize && e12.unsafe) {
        i16(() => `We found an image that was marked as unsafe, but it was the best size. (${e12.id})`, 4), o14.push(e12);
        return;
      }
      r16.returnAllOptions && t19 && o14.push(t19), i16(() => `We found a new image that was the best size. (${e12.id})`, 4), s10 = e12;
    } else r16.returnAllOptions && o14.push(e12);
  };
  i16(() => `The input shows we have ${t18.length} list(s) of candidates to choose from.`);
  let l8 = t18.length;
  for (let e12 = 0; e12 < l8; e12++) {
    let n16 = t18[e12]();
    i16(() => `Candidate group ${e12}: ${JSON.stringify(n16, null, 2)}`, 1);
    let o15 = n16.length;
    i16(() => `Checking candidate list number ${e12} and found ${o15} potential ways of creating image(s)`, 1);
    for (let e13 = 0; e13 < o15; e13++) {
      let t19 = n16[e13];
      if (i16(() => `-> Checking candidate ${e13}`, 1), t19.type === `unknown` && r16.atAnyCost && (i16(() => `We've found an unknown image type, adding this to the "last resort" list`, 2), a15.push(t19)), t19.type === `fixed` && (t19.unsafe ? (i16(() => `We've found an unsafe fixed image type, adding this to the "last resort" list`, 2), a15.push(t19)) : (i16(() => `We've found a fixed size image, checking if it matches the request`, 2), c8(t19, s10))), t19.type === `fixed-service`) if (r16.unsafeImageService) {
        i16(() => `Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)`, 2);
        let e14 = _2(t19, r16.width, r16.height);
        c8(e14, s10);
      } else {
        i16(() => `Checking for an image from the tile source 3`, 2);
        let e14 = _2(t19, t19.width, t19.height);
        c8(e14, s10);
      }
      if (t19.type === `variable` && t19.maxWidth) {
        let e14 = _2({ id: t19.id, type: `fixed-service`, width: t19.maxWidth, height: t19.maxWidth, level: t19.level, version: t19.version }, t19.maxWidth);
        c8(e14, s10);
      }
    }
    if (s10 && !r16.returnAllOptions) {
      if (s10.unsafe || r16.allowUnsafe) continue;
      i16(() => `We found a match in choice list number ${e12}, no searching any more`);
      break;
    }
  }
  return r16.atAnyCost && o14.length === 0 ? (i16(() => s10 ? `We found an image! ${s10.id} of type ${s10.type}` : `We found no images, but "atAnyCost" is set, so returning that`), { best: s10 || a15[0] || null, fallback: a15.slice(1), log: n15 }) : r16.returnAllOptions ? (i16(() => `Returning all options that we have found`), { best: (r16.atAnyCost ? s10 || o14[0] || a15[0] : s10 || o14[0]) || null, fallback: [...o14, ...a15], log: n15 }) : (i16(() => `Returning the best image that we found, and a fallback`), { best: s10 || o14[0] || null, fallback: s10 ? o14 : o14.slice(1), log: n15 });
}
function b2(e11) {
  let t18 = e11[`@context`] ? Array.isArray(e11[`@context`]) ? e11[`@context`] : [e11[`@context`]] : [];
  return t18.indexOf(`http://iiif.io/api/image/3/context.json`) !== -1;
}
function x2(e11) {
  return U(e11) ? (e11 && e11.sizes ? e11.sizes : []).map((t18) => ({ id: H(e11), type: `fixed-service`, height: t18.height, width: t18.width, level: ue(e11), version: b2(e11) ? 3 : 2 })) : [];
}
function S2(e11) {
  if (!G(e11)) return [];
  let t18 = [], n15 = Array.isArray(e11.profile) ? e11.profile : [e11.profile], r16 = n15.length;
  for (let t19 = 0; t19 < r16; t19++) {
    let r17 = n15[t19];
    if (r17 && typeof r17 != `string` && (r17.maxHeight || r17.maxWidth)) return [{ id: H(e11), type: `variable`, minWidth: 0, minHeight: 0, maxHeight: r17.maxHeight || r17.maxWidth, maxWidth: r17.maxWidth || r17.maxHeight, level: ue(e11), version: e11[`@context`] === `http://iiif.io/api/image/3/context.json` ? 3 : 2 }];
  }
  if (e11.tiles) {
    let n16 = e11.tiles.length;
    for (let r17 = 0; r17 < n16; r17++) {
      let n17 = e11.tiles[r17];
      n17 && (n17.height || n17.width) && t18.push({ id: H(e11), type: `variable`, minHeight: 0, minWidth: 0, maxHeight: n17.height || n17.width, maxWidth: n17.width, level: ue(e11), version: b2(e11) ? 3 : 2 });
    }
  }
  return t18;
}
function C2(e11) {
  let t18 = [], n15 = e11.length;
  for (let r16 = 0; r16 < n15; r16++) {
    let n16 = e11[r16];
    if (!n16) continue;
    let i16 = x2(n16);
    i16.length && t18.push(...i16);
    let a15 = S2(n16);
    a15.length && t18.push(...a15);
  }
  return t18;
}
function w2(e11) {
  let t18 = /^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/, n15 = e11.match(t18);
  if (n15 && n15[4] && n15[5]) {
    let t19 = n15[1], r16 = parseInt(n15[4], 10), i16 = parseInt(n15[5], 10), a15 = n15[7];
    if ((t19 === `max` || t19 === `full`) && r16 && i16 && a15) return { type: `fixed`, id: e11, height: i16, width: r16 };
  }
  return { type: `unknown`, id: e11 };
}
function T2(e11) {
  if (typeof e11 == `string`) return w2(e11);
  let t18 = fe(e11);
  if (t18 !== `Image` && t18 !== `sc:Image`) return null;
  let n15 = e11, r16 = H(n15);
  return r16 ? r16 && n15.width && n15.height ? { id: r16, type: `fixed`, width: n15.width, height: n15.height, unsafe: true } : w2(r16) : null;
}
function E2(e11, t18 = true, n15) {
  let r16 = [], i16 = T2(e11);
  if (i16 === null) return r16;
  let a15 = e11;
  if (r16.push(i16), t18 && a15 && a15.width && a15.height) {
    let e12 = [], t19 = de(a15);
    for (let r17 of t19) {
      let t20 = { id: H(r17), width: a15.width, height: a15.height };
      if (n15.canLoadSync(t20)) {
        let r18 = n15.loadServiceSync(t20);
        r18 && (r18.height || (r18.height = a15.height), r18.width || (r18.width = a15.width), e12.push(...C2([r18])));
      }
    }
    if (e12.length) return r16.push(...e12), r16;
  }
  return a15.service && r16.push(...C2(a15.service)), r16;
}
function D2(e11, t18) {
  if (e11.length !== t18.length) return false;
  if (e11.length === 0 && t18.length === 0) return true;
  let n15 = e11.length, r16 = true;
  for (let i17 = 0; i17 < n15; i17++) {
    let n16 = e11[i17], a15 = t18[i17];
    if (n16.width !== a15.width || n16.height !== a15.height) {
      r16 = false;
      break;
    }
  }
  if (r16) return true;
  let i16 = 0;
  for (let r17 = 0; r17 < n15; r17++) for (let a15 = 0; a15 < n15; a15++) if (e11[r17].width === t18[a15].width && e11[r17].height === t18[a15].height) {
    i16++;
    break;
  }
  return i16 === n15;
}
var O2 = class {
  constructor(t18 = {}) {
    r(this, `config`, { verificationsRequired: 1, approximateServices: false, enableFetching: true, disableThrottling: false }), r(this, `fetchingCount`, 0), r(this, `imageServices`, {}), r(this, `knownImageServers`, {}), this.config = Object.assign(this.config, t18);
  }
  setConfig(e11) {
    Object.assign(this.config, e11);
  }
  sample(e11, t18, n15 = true) {
    let i16 = h2(H(e11)), o14 = Q(H(e11)), c8 = this.knownImageServers[i16];
    return this.imageServices[o14] = Object.assign(e11, { real: true }), !c8 && e11.tiles && !V(e11) ? (this.knownImageServers[i16] = { verifications: 0, malformed: false, root: i16, preLoaded: n15, sampledId: H(e11), verified: false, server: null, result: { context: e11[`@context`] || [], sampledProfile: e11.profile, resourceServiceRatio: t18 && e11.height ? t18.height / e11.height : 1, sampledSizes: e11.sizes || [], sizeRatios: ce(e11.width, e11.height, e11.sizes || []), sampledTiles: e11.tiles || [] } }, true) : this.verify(e11);
  }
  preLoad(e11, t18 = true) {
    this.knownImageServers[e11.root] = e11, t18 && (this.knownImageServers[e11.root].malformed = false, this.knownImageServers[e11.root].verifications = this.config.verificationsRequired);
  }
  predict(e11, t18 = false, n15 = false) {
    let i16 = e11 == null ? void 0 : e11.source, a15 = h2(H(e11)), c8 = this.knownImageServers[a15], l8 = Q(H(e11));
    return this.imageServices[l8] ? this.imageServices[l8] || null : !this.config.approximateServices || !c8 || !c8.result || !((i16 == null ? void 0 : i16.height) || e11.height) || !((i16 == null ? void 0 : i16.width) || e11.width) || !n15 && (c8.malformed || c8.verifications < this.config.verificationsRequired) || e11.source && V(e11.source) ? null : (this.imageServices[l8] || (this.imageServices[l8] = { "@context": c8.result.context, "@id": H(e11), id: H(e11), protocol: `http://iiif.io/api/image`, tiles: (i16 == null ? void 0 : i16.tiles) || g2(e11.width, e11.height, c8.result.sampledTiles), sizes: (i16 == null ? void 0 : i16.sizes) || le(Math.round(e11.width / c8.result.resourceServiceRatio), Math.round(e11.height / c8.result.resourceServiceRatio), c8.result.sizeRatios), profile: (i16 == null ? void 0 : i16.profile) || c8.result.sampledProfile, height: (i16 == null ? void 0 : i16.height) || e11.height, width: (i16 == null ? void 0 : i16.width) || e11.width, real: false }), this.imageServices[l8] || null);
  }
  async getThumbnailFromResource(e11, t18, n15 = true, r16 = []) {
    let i16 = e11 ? await this.getImageCandidates(e11, n15) : [];
    return y2(t18, [() => r16, () => i16]);
  }
  async getImageCandidates(e11, t18 = true) {
    let n15 = e11;
    if (t18 && n15 && n15.height && n15.width) {
      let e12 = de(n15);
      for (let t19 of e12) {
        let e13 = { id: H(t19), width: t19.width ? t19.width : n15.width, height: t19.height ? t19.height : n15.height, source: t19 };
        await this.loadService(e13);
      }
    }
    return E2(e11, t18, this);
  }
  async verify(e11) {
    let t18 = this.predict(e11, false, true), n15 = await this.fetchService(H(e11));
    if (!t18) return false;
    let r16 = t18.height === n15.height && t18.width === n15.width && t18[`@context`] === n15[`@context`] && D2(t18.sizes || [], n15.sizes || []);
    if (r16) {
      let t19 = h2(H(e11)), n16 = this.knownImageServers[t19];
      n16 && (n16.verifications += 1, n16.verifications >= this.config.verificationsRequired && (n16.verified = true));
    }
    return r16;
  }
  canLoadSync(e11) {
    let t18 = typeof e11 == `string` ? e11 : H(e11), n15 = Q(t18);
    if (this.imageServices[n15]) return true;
    let i16 = this.knownImageServers[h2(t18)];
    return !!(i16 && !i16.malformed && i16.verifications >= this.config.verificationsRequired);
  }
  async markAsMalformed(e11) {
    return this.knownImageServers[h2(H(e11))].malformed = true, this.loadService(e11, true);
  }
  async fetchService(e11, t18 = false) {
    let n15 = Q(e11), i16 = this.imageServices[n15];
    if (i16 && (!t18 || i16.real)) return i16;
    if (!this.config.enableFetching) throw Error(`Fetching is not enabled`);
    let a15 = await this.fetch(n15).then((e12) => e12.json());
    return !a15.id && a15[`@id`] && (a15.id = a15[`@id`]), a15.id !== e11 && (a15.id = e11, a15["@id"] && (a15["@id"] = e11)), this.imageServices[n15] = Object.assign(a15, { real: true }), this.imageServices[n15];
  }
  async fetch(e11, t18) {
    return fetch(e11, t18);
  }
  async loadService(e11, t18 = false) {
    if (!this.config.disableThrottling) {
      let e12 = true;
      for (; e12; ) if (this.fetchingCount >= this.config.verificationsRequired) await new Promise((e13) => setTimeout(e13, 500));
      else {
        e12 = false;
        break;
      }
    }
    let n15 = this.knownImageServers[h2(H(e11))];
    if (n15 && !n15.malformed && !t18) {
      await n15.result;
      let t19 = this.loadServiceSync(e11);
      if (t19) return t19;
    }
    this.fetchingCount++;
    let r16 = await this.fetchService(H(e11), t18);
    return this.fetchingCount--, r16.real && this.sample(r16, e11), r16;
  }
  loadServiceSync(e11) {
    let t18 = Q(H(e11));
    return this.imageServices[t18] ? this.imageServices[t18] : this.config.approximateServices ? this.predict(e11) : null;
  }
};
function k2(e11 = {}) {
  let r16 = e11.events || e3(), i16 = e11.loader || new O2(), a15 = t5((e12, t18) => ({ loaded: {}, loadServiceSync: (n15, a16, o14) => {
    let c8 = n15.id || n15[`@id`], l8 = t18().loaded[c8];
    if (l8 && l8.status === `done`) return l8.service;
    if (l8 && l8.status === `loading`) return null;
    if (l8 && l8.status === `error`) throw Error(`Failed to load image service`);
    let u7 = { id: H(n15), width: n15.width || (a16 == null ? void 0 : a16.width) || 0, height: n15.height || (a16 == null ? void 0 : a16.height) || 0, source: n15 }, d7 = i16.loadServiceSync(u7);
    return d7 ? (e12((e13) => ({ loaded: { ...e13.loaded, [c8]: { status: `done`, service: d7, real: true } } })), r16.emit(`image-service.loaded`, { id: c8, service: d7 })) : o14 && t18().loadService(n15, a16).then(() => {
    }), d7;
  }, loadService: async (n15, a16) => {
    let o14 = n15.id || n15[`@id`], c8 = t18().loaded[o14];
    if (c8 && c8.status === `done`) return c8.service;
    if (c8 && c8.status === `loading`) return new Promise((e13, t19) => {
      let i17 = (t20) => {
        t20.id === o14 && (r16.off(`image-service.loaded`, i17), e13(t20.service || n15));
      };
      r16.on(`image-service.loaded`, i17);
    });
    if (c8 && c8.status === `error` && !(a16 == null ? void 0 : a16.force)) throw Error(`Failed to load image service`);
    r16.emit(`image-service.loading`, { id: o14 });
    try {
      let t19 = { id: H(n15), width: n15.width || 0, height: n15.height || 0, source: n15 }, c9 = await i16.loadService(t19, a16 == null ? void 0 : a16.force);
      return e12((e13) => ({ loaded: { ...e13.loaded, [o14]: { status: `done`, service: c9, real: c9.real } } })), r16.emit(`image-service.loaded`, { id: o14, service: c9 }), c9;
    } catch (e13) {
      throw r16.emit(`image-service.error`, { id: o14, error: e13 }), e13;
    }
  } }));
  return { store: a15, events: r16 };
}
var A2 = k2();
function j2(e11) {
  if (!e11.width || !e11.height) return null;
  if (e11.tiles) {
    let t18 = e11.tiles.sort((e12, t19) => Math.max(...t19.scaleFactors) - Math.max(...e12.scaleFactors)), n15 = t18.length;
    for (let r16 = 0; r16 < n15; r16++) {
      let n16 = t18[r16];
      if (!n16) continue;
      let i16 = n16.width;
      if (!i16) continue;
      let a15 = n16.scaleFactors.length, o14 = n16.scaleFactors.sort();
      for (let t19 = 0; t19 < a15; t19++) {
        let n17 = o14[t19];
        if (n17 && e11.width / n17 <= i16 && e11.height / n17 <= i16) return { id: H(e11), type: `fixed-service`, width: e11.width / n17 | 0, height: e11.height / n17 | 0, level: ue(e11), version: b2(e11) ? 3 : 2 };
      }
    }
  }
  return null;
}

// node_modules/@iiif/helpers/dist/thumbnail-B4K88W9F.js
var r3 = new O2();
var i2 = /* @__PURE__ */ new Map();
function a2(t18, { vault: n15 = t, dereference: r16 = false, ...a15 } = {}) {
  let s10 = i2.get(n15);
  return s10 || (s10 = o2(n15), i2.set(n15, s10)), s10.getBestThumbnailAtSize(t18, a15, r16);
}
function o2(t18 = t, i16 = {}) {
  let a15 = i16.imageServiceLoader || r3;
  async function o14(e11, r16, i17 = false, s10 = [], c8) {
    let l8 = () => a15.getThumbnailFromResource(void 0, r16, i17, s10);
    if (!e11) return await a15.getThumbnailFromResource(void 0, r16, i17, s10);
    if (typeof e11 == `string`) {
      let t19 = T2(e11);
      return t19 && s10.push(t19), await a15.getThumbnailFromResource(void 0, r16, i17, s10);
    }
    let u7 = t18.get(e11, { skipSelfReturn: false });
    if (typeof u7 == `string`) return { best: T2(u7), fallback: [], log: [] };
    if (!u7) return await l8();
    let d7 = async (e12) => {
      if (e12 && e12.thumbnail && e12.thumbnail.length) {
        let n15 = t18.get(e12.thumbnail[0]), r17 = await a15.getImageCandidates(n15, i17);
        r17 && r17.length && s10.push(...r17);
      }
    };
    switch (await d7(u7), u7.type) {
      case `Annotation`: {
        let e12 = Array.isArray(u7.body) ? u7.body : [u7.body], n15 = t18.get(e12[0]);
        return c8 && !n15.width && (n15.width = c8.width, n15.height = c8.height), await a15.getThumbnailFromResource(n15, r16, i17, s10);
      }
      case `Canvas`: {
        let e12 = u7;
        return o14(e12.items[0], r16, i17, s10, { width: e12.width, height: e12.height });
      }
      case `AnnotationPage`: {
        let e12 = u7;
        return o14(e12.items[0], r16, i17, s10, c8);
      }
      case `Choice`: {
        let e12 = u7;
        return !e12.items || e12.items[0] ? await l8() : o14(e12.items[0], r16, i17, s10, c8);
      }
      case `Collection`: {
        let e12 = u7, t19 = e12.items[0];
        return t19 ? o14(t19, r16, i17, s10, c8) : await l8();
      }
      case `Manifest`: {
        let e12 = u7, t19 = e12.items[0];
        return t19 ? o14(t19, r16, i17, s10, c8) : await l8();
      }
      case `SpecificResource`:
      case `Image`:
      case `Dataset`:
      case `Sound`:
      case `Text`:
      case `TextualBody`:
      case `Video`:
        return c8 && !u7.width && (u7.width = c8.width, u7.height = c8.height), a15.getThumbnailFromResource(u7, r16, i17, s10);
    }
    return await l8();
  }
  return { getBestThumbnailAtSize: o14 };
}

// node_modules/@iiif/parser/dist/remove-undefined-properties-DKmVdOaS.js
function e5(t18) {
  "@babel/helpers - typeof";
  return e5 = typeof Symbol == `function` && typeof Symbol.iterator == `symbol` ? function(e11) {
    return typeof e11;
  } : function(e11) {
    return e11 && typeof Symbol == `function` && e11.constructor === Symbol && e11 !== Symbol.prototype ? `symbol` : typeof e11;
  }, e5(t18);
}
function t7(t18, n15) {
  if (e5(t18) != `object` || !t18) return t18;
  var r16 = t18[Symbol.toPrimitive];
  if (r16 !== void 0) {
    var i16 = r16.call(t18, n15 || `default`);
    if (e5(i16) != `object`) return i16;
    throw TypeError(`@@toPrimitive must return a primitive value.`);
  }
  return (n15 === `string` ? String : Number)(t18);
}
function n3(n15) {
  var r16 = t7(n15, `string`);
  return e5(r16) == `symbol` ? r16 : r16 + ``;
}
function r4(e11, t18, r16) {
  return (t18 = n3(t18)) in e11 ? Object.defineProperty(e11, t18, { value: r16, enumerable: true, configurable: true, writable: true }) : e11[t18] = r16, e11;
}
function i3(e11) {
  return Array.isArray(e11) ? e11 : e11 ? [e11] : [];
}
function a3(e11) {
  for (let t18 in e11) (e11[t18] === void 0 || e11[t18] === null) && delete e11[t18];
  return e11;
}

// node_modules/@iiif/parser/dist/traverse-BDmGe7EO.js
function n4(e11) {
  return typeof e11 == `string` ? false : e11 && !e11.type && `source` in e11 ? (e11.type = `SpecificResource`, true) : !!e11 && e11.type === `SpecificResource`;
}
function r5(...e11) {
  return (t18) => e11.reduce((e12, t19) => t19(e12), t18);
}
var i4 = [`Collection`, `Manifest`, `Canvas`, `AnnotationPage`, `AnnotationCollection`, `Annotation`, `ContentResource`, `Range`, `Service`, `Selector`, `Agent`];
function a4(e11, t18) {
  if (e11 == null) throw Error(`Null or undefined is not a valid entity.`);
  if (Array.isArray(e11)) throw Error(`Array is not a valid entity`);
  if (typeof e11 != `object`) {
    if (t18) return t18;
    throw Error(`${typeof e11} is not a valid entity`);
  }
  if (typeof e11.type == `string`) {
    let t19 = i4.indexOf(e11.type);
    if (t19 !== -1) return i4[t19];
  }
  if (e11.profile) return `Service`;
  throw Error(`Resource type is not known`);
}
var o3 = class i5 {
  constructor(t18, n15 = {}) {
    r4(this, `traversals`, void 0), r4(this, `options`, void 0), r4(this, `_traverseManifest`, r5(this.traverseManifestItems.bind(this), this.traverseNavPlace.bind(this), this.traverseLinking.bind(this), this.traverseDescriptive.bind(this), this.traverseLinkedCanvases.bind(this), this.traverseManifestStructures.bind(this), this.traverseInlineAnnotationPages.bind(this))), r4(this, `_traverseCanvas`, r5(this.traverseCanvasItems.bind(this), this.traverseLinking.bind(this), this.traverseDescriptive.bind(this), this.traverseLinkedCanvases.bind(this), this.traverseInlineAnnotationPages.bind(this))), r4(this, `_traverseAnnotationPage`, r5(this.traverseAnnotationPageItems.bind(this), this.traverseLinking.bind(this), this.traverseDescriptive.bind(this))), r4(this, `_traverseRange`, r5(this.traverseRangeRanges.bind(this), this.traverseLinking.bind(this), this.traverseDescriptive.bind(this), this.traverseLinkedCanvases.bind(this))), this.traversals = { collection: [], manifest: [], canvas: [], annotationCollection: [], annotationPage: [], annotation: [], contentResource: [], choice: [], range: [], service: [], agent: [], specificResource: [], geoJson: [], ...t18 }, this.options = { allowUndefinedReturn: false, ...n15 };
  }
  static all(e11) {
    return new i5({ collection: [e11], manifest: [e11], canvas: [e11], annotationCollection: [e11], annotationPage: [e11], annotation: [e11], contentResource: [e11], choice: [e11], range: [e11], service: [e11], geoJson: [e11], specificResource: [e11], agent: [e11] });
  }
  traverseDescriptive(e11) {
    return e11.thumbnail && (e11.thumbnail = i3(e11.thumbnail).map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.provider && (e11.provider = e11.provider.map((t18) => this.traverseAgent(t18, e11))), e11;
  }
  traverseLinking(e11) {
    return e11.seeAlso && (e11.seeAlso = i3(e11.seeAlso).map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.service && (e11.service = i3(e11.service).map((e12) => this.traverseService(e12))), e11.services && (e11.services = i3(e11.services).map((t18) => this.traverseService(t18, e11))), e11.logo && (e11.logo = i3(e11.logo).map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.homepage && (e11.homepage = i3(e11.homepage).map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.partOf && (e11.partOf = e11.partOf.map((t18) => typeof t18 == `string` || !t18.type ? this.traverseType(t18, { parent: e11 }, this.traversals.contentResource) : t18.type === `Canvas` ? this.traverseType(t18, { parent: e11 }, this.traversals.canvas) : t18.type === `AnnotationCollection` ? this.traverseType(t18, { parent: e11 }, this.traversals.annotationCollection) : t18.type === `Collection` ? this.traverseType(t18, { parent: e11 }, this.traversals.collection) : this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.start && (n4(e11.start) ? e11.start = this.traverseSpecificResource(e11.start, `Canvas`, e11) : e11.start = this.traverseType(e11.start, { parent: e11 }, this.traversals.canvas)), e11.rendering && (e11.rendering = e11.rendering.map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11.supplementary && (e11.supplementary = e11.supplementary.map((t18) => this.traverseType(t18, { parent: e11 }, this.traversals.contentResource))), e11;
  }
  traverseCollectionItems(e11) {
    return e11.items && e11.items.map((e12) => e12.type === `Collection` ? this.traverseCollection(e12) : this.traverseManifest(e12)), e11;
  }
  traverseCollection(e11, t18) {
    return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e11)))))), { parent: t18 }, this.traversals.collection);
  }
  traverseGeoJson(e11, t18) {
    return this.traverseType(e11, { parent: t18 }, this.traversals.geoJson);
  }
  traverseNavPlace(e11) {
    return e11.navPlace && (e11.navPlace = this.traverseGeoJson(e11.navPlace, e11)), e11;
  }
  traverseManifestItems(e11) {
    return e11.items && (e11.items = e11.items.map((e12) => this.traverseCanvas(e12))), e11;
  }
  traverseManifestStructures(e11) {
    return e11.structures && (e11.structures = e11.structures.map((e12) => this.traverseRange(e12))), e11;
  }
  traverseManifest(e11, t18) {
    return this.traverseType(this._traverseManifest(e11), { parent: t18 }, this.traversals.manifest);
  }
  traverseCanvasItems(e11) {
    return e11.items = (e11.items || []).map((t18) => this.traverseAnnotationPage(t18, e11)), e11;
  }
  traverseInlineAnnotationPages(e11) {
    return typeof e11 == `string` || !e11 || e11.annotations && (e11.annotations = e11.annotations.map((t18) => this.traverseAnnotationPage(t18, e11))), e11;
  }
  traverseCanvas(e11, t18) {
    return this.traverseType(this._traverseCanvas(e11), { parent: t18 }, this.traversals.canvas);
  }
  traverseAnnotationPageItems(e11) {
    return e11.items && (e11.items = e11.items.map((t18) => this.traverseAnnotation(t18, e11))), e11;
  }
  traverseAnnotationPage(e11, t18) {
    return this.traverseType(this._traverseAnnotationPage(e11), { parent: t18 }, this.traversals.annotationPage);
  }
  traverseAnnotationBody(e11) {
    return Array.isArray(e11.body) ? e11.body = e11.body.map((t18) => this.traverseContentResource(t18, e11)) : e11.body && (e11.body = this.traverseContentResource(e11.body, e11)), e11;
  }
  traverseLinkedCanvases(e11) {
    return e11.placeholderCanvas && (e11.placeholderCanvas = this.traverseCanvas(e11.placeholderCanvas)), e11.accompanyingCanvas && (e11.accompanyingCanvas = this.traverseCanvas(e11.accompanyingCanvas)), e11;
  }
  traverseAnnotation(e11, t18) {
    return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e11))), { parent: t18 }, this.traversals.annotation);
  }
  traverseContentResourceLinking(e11) {
    return typeof e11 == `string` || !e11 || e11 && e11.service && (e11.service = i3(e11.service || []).map((t18) => this.traverseService(t18, e11))), e11;
  }
  traverseContentResource(e11, t18) {
    return e11.type === `Choice` && (e11.items = e11.items.map((t19) => this.traverseContentResource(t19, e11))), n4(e11) ? this.traverseSpecificResource(e11, `ContentResource`) : this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e11)), { parent: t18 }, this.traversals.contentResource);
  }
  traverseSpecificResource(e11, t18, n15) {
    let r16 = e11.source;
    return typeof e11.source == `string` && (r16 = { id: e11.source, type: t18 || `unknown` }), this.traverseType({ ...e11, source: t18 === `Canvas` || r16.type === `Canvas` ? this.traverseType(r16, { parent: n15 }, this.traversals.canvas) : t18 === `ContentResource` ? this.traverseContentResource(r16, { parent: n15 }) : this.traverseUnknown(r16, { parent: n15, typeHint: t18 }) }, { parent: n15 }, this.traversals.specificResource);
  }
  traverseRangeRanges(e11) {
    return e11.items && (e11.items = e11.items.map((t18) => typeof t18 == `string` ? this.traverseCanvas({ id: t18, type: `Canvas` }, e11) : n4(t18) ? this.traverseSpecificResource(t18, `Canvas`, e11) : t18.type === `Manifest` ? this.traverseManifest(t18, e11) : this.traverseRange(t18, e11))), e11;
  }
  traverseRange(e11, t18) {
    return this.traverseType(this._traverseRange(e11), { parent: t18 }, this.traversals.range);
  }
  traverseAgent(e11, t18) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(e11)), { parent: t18 }, this.traversals.agent);
  }
  traverseType(e11, t18, n15) {
    return n15.reduce((e12, n16) => {
      let r16 = n16(e12, t18);
      return r16 === void 0 && !this.options.allowUndefinedReturn ? e12 : r16;
    }, e11);
  }
  traverseService(e11, n15) {
    let r16 = Object.assign({}, e11);
    return r16 && r16.service && (r16.service = i3(r16.service).map((e12) => this.traverseService(e12))), this.traverseType(r16, { parent: n15 }, this.traversals.service);
  }
  traverseUnknown(e11, { parent: t18, typeHint: n15 } = {}) {
    let r16 = a4(e11, n15);
    switch (r16) {
      case `Collection`:
        return this.traverseCollection(e11, t18);
      case `Manifest`:
        return this.traverseManifest(e11, t18);
      case `Canvas`:
        return this.traverseCanvas(e11, t18);
      case `AnnotationPage`:
        return this.traverseAnnotationPage(e11, t18);
      case `Annotation`:
        return this.traverseAnnotation(e11, t18);
      case `ContentResource`:
        return this.traverseContentResource(e11, t18);
      case `Range`:
        return this.traverseRange(e11, t18);
      case `Service`:
        return this.traverseService(e11, t18);
      case `Agent`:
        return this.traverseAgent(e11, t18);
      default:
        throw Error(`Unknown or unsupported resource type of ${r16}`);
    }
  }
};

// node_modules/@iiif/parser/dist/upgrader-BEInozLY.js
var a5 = [`sc:Collection`, `sc:Manifest`, `sc:Canvas`, `sc:AnnotationList`, `oa:Annotation`, `sc:Range`, `sc:Layer`, `sc:Sequence`, `oa:Choice`, `Service`, `ContentResource`];
function o4(e11) {
  if (e11 == null) throw Error(`Null or undefined is not a valid entity.`);
  if (Array.isArray(e11)) throw Error(`Array is not a valid entity`);
  if (typeof e11 != `object`) throw Error(`${typeof e11} is not a valid entity`);
  if (typeof e11[`@type`] == `string`) {
    let t18 = a5.indexOf(e11[`@type`]);
    if (t18 !== -1) return a5[t18];
  }
  if (e11.profile) return `Service`;
  if (e11.format || e11[`@type`]) return `ContentResource`;
  throw Error(`Resource type is not known`);
}
var s2 = class t8 {
  constructor(t18, n15 = {}) {
    r4(this, `traversals`, void 0), r4(this, `options`, void 0), this.traversals = { collection: [], manifest: [], canvas: [], annotationList: [], sequence: [], annotation: [], contentResource: [], choice: [], range: [], service: [], layer: [], ...t18 }, this.options = { convertPropsToArray: true, mergeMemberProperties: true, allowUndefinedReturn: false, ...n15 };
  }
  static all(e11) {
    return new t8({ collection: [e11], manifest: [e11], canvas: [e11], annotationList: [e11], sequence: [e11], annotation: [e11], contentResource: [e11], choice: [e11], range: [e11], service: [e11], layer: [e11] });
  }
  traverseCollection(e11) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e11))), this.traversals.collection);
  }
  traverseCollectionItems(e11) {
    if (this.options.mergeMemberProperties) {
      let t18 = [...(e11.manifests || []).map((e12) => typeof e12 == `string` ? { "@id": e12, "@type": `sc:Manifest` } : e12), ...(e11.collections || []).map((e12) => typeof e12 == `string` ? { "@id": e12, "@type": `sc:Collection` } : e12), ...e11.members || []], n15 = [], r16 = t18.filter((e12) => n15.includes(e12[`@id`]) ? false : (n15.push(e12[`@id`]), true));
      delete e11.collections, delete e11.manifests, e11.members = r16;
    }
    return e11.manifests && (e11.manifests = e11.manifests.map((e12) => this.traverseManifest(typeof e12 == `string` ? { "@id": e12, "@type": `sc:Manifest` } : e12))), e11.collections && (e11.collections = e11.collections.map((e12) => this.traverseCollection(typeof e12 == `string` ? { "@id": e12, "@type": `sc:Collection` } : e12))), e11.members && (e11.members = e11.members.map((e12) => typeof e12 == `string` ? e12 : e12[`@type`] === `sc:Collection` ? this.traverseCollection(e12) : e12[`@type`] === `sc:Manifest` ? this.traverseManifest(e12) : this.traverseUnknown(e12))), e11;
  }
  traverseManifest(e11) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e11))), this.traversals.manifest);
  }
  traverseManifestItems(e11) {
    return e11.sequences && (e11.sequences = e11.sequences.map((e12) => this.traverseSequence(e12))), e11.structures && (e11.structures = e11.structures.map((e12) => this.traverseRange(e12))), e11;
  }
  traverseSequence(e11) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e11))), this.traversals.sequence);
  }
  traverseSequenceItems(e11) {
    return e11.canvases && (e11.canvases = e11.canvases.map((e12) => this.traverseCanvas(e12))), e11;
  }
  traverseCanvas(e11) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e11))), this.traversals.canvas);
  }
  traverseCanvasItems(e11) {
    return e11.images && (e11.images = e11.images.map((e12) => this.traverseAnnotation(e12))), e11.otherContent && (e11.otherContent = e11.otherContent.map((e12) => this.traverseAnnotationList(e12))), e11;
  }
  traverseRange(e11) {
    return e11[`@type`] !== `sc:Range` && (e11[`@type`] = `sc:Range`), this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e11))), this.traversals.range);
  }
  traverseRangeItems(e11) {
    if (this.options.mergeMemberProperties) {
      let t18 = [...(e11.ranges || []).map((e12) => typeof e12 == `string` ? { "@id": e12, "@type": `sc:Range` } : e12), ...(e11.canvases || []).map((e12) => typeof e12 == `string` ? { "@id": e12, "@type": `sc:Canvas` } : e12), ...e11.members || []];
      delete e11.ranges, delete e11.canvases, e11.members = t18.length ? t18.map((e12) => this.traverseUnknown(e12)) : void 0;
    }
    return e11;
  }
  traverseAnnotationList(e11) {
    let t18 = typeof e11 == `string` ? { "@id": e11, "@type": `sc:AnnotationList` } : e11;
    return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t18)), this.traversals.annotationList);
  }
  traverseAnnotationListItems(e11) {
    return e11.resources && (e11.resources = e11.resources.map((e12) => this.traverseAnnotation(e12))), e11;
  }
  traverseAnnotation(e11) {
    return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e11))), this.traversals.annotation);
  }
  traverseAnnotationItems(e11) {
    return e11.resource && (Array.isArray(e11.resource) ? e11.resource = e11.resource.map((e12) => this.traverseContentResource(e12)) : e11.resource = this.traverseContentResource(e11.resource)), e11.on, e11;
  }
  traverseLayer(e11) {
    return this.traverseType(this.traverseLinking(this.traverseLayerItems(e11)), this.traversals.layer);
  }
  traverseLayerItems(e11) {
    return e11.otherContent && (e11.otherContent = e11.otherContent.map((e12) => this.traverseAnnotationList(e12))), e11;
  }
  traverseChoice(e11) {
    return this.traverseType(this.traverseChoiceItems(e11), this.traversals.choice);
  }
  traverseChoiceItems(e11) {
    return e11.default && e11.default !== `rdf:nil` && (e11.default = this.traverseContentResource(e11.default)), e11.item && e11.item !== `rdf:nil` && (e11.item = e11.item.map((e12) => this.traverseContentResource(e12))), e11;
  }
  traverseService(e11) {
    return this.traverseType(this.traverseLinking(e11), this.traversals.service);
  }
  traverseContentResource(e11) {
    return e11[`@type`] === `oa:Choice` ? this.traverseChoice(e11) : this.traverseType(this.traverseDescriptive(this.traverseLinking(e11)), this.traversals.contentResource);
  }
  traverseUnknown(e11) {
    if (!e11[`@type`] || typeof e11 == `string`) return e11;
    switch (o4(e11)) {
      case `sc:Collection`:
        return this.traverseCollection(e11);
      case `sc:Manifest`:
        return this.traverseManifest(e11);
      case `sc:Canvas`:
        return this.traverseCanvas(e11);
      case `sc:Sequence`:
        return this.traverseSequence(e11);
      case `sc:Range`:
        return this.traverseRange(e11);
      case `oa:Annotation`:
        return this.traverseAnnotation(e11);
      case `sc:AnnotationList`:
        return this.traverseAnnotationList(e11);
      case `sc:Layer`:
        return this.traverseLayer(e11);
      case `Service`:
        return this.traverseService(e11);
      case `oa:Choice`:
        return this.traverseChoice(e11);
      case `ContentResource`:
        return this.traverseContentResource(e11);
    }
    return e11.profile ? this.traverseService(e11) : e11;
  }
  traverseImageResource(e11) {
    let t18 = Array.isArray(e11), n15 = Array.isArray(e11) ? e11 : [e11], r16 = [];
    for (let e12 of n15) typeof e12 == `string` ? r16.push(this.traverseContentResource({ "@id": e12, "@type": `dctypes:Image` })) : r16.push(this.traverseContentResource(e12));
    return !t18 && !this.options.convertPropsToArray ? r16[0] : r16;
  }
  traverseDescriptive(e11) {
    return e11.thumbnail && (e11.thumbnail = this.traverseImageResource(e11.thumbnail)), e11.logo && (e11.logo = this.traverseImageResource(e11.logo)), e11;
  }
  traverseOneOrMoreServices(e11) {
    let t18 = Array.isArray(e11), n15 = Array.isArray(e11) ? e11 : [e11], r16 = [];
    for (let e12 of n15) r16.push(this.traverseService(e12));
    return !t18 && !this.options.convertPropsToArray ? r16[0] : r16;
  }
  traverseLinking(e11) {
    return e11.related && (e11.related = this.traverseOneOrManyType(e11.related, this.traversals.contentResource)), e11.rendering && (e11.rendering = this.traverseOneOrManyType(e11.rendering, this.traversals.contentResource)), e11.service && (e11.service = this.traverseOneOrMoreServices(e11.service)), e11.seeAlso && (e11.seeAlso = this.traverseOneOrManyType(e11.seeAlso, this.traversals.contentResource)), e11.within && (typeof e11.within == `string` || (e11.within = this.traverseOneOrManyType(e11.within, this.traversals.contentResource))), e11.startCanvas && (typeof e11.startCanvas == `string` ? e11.startCanvas = this.traverseType({ "@id": e11.startCanvas, "@type": `sc:Canvas` }, this.traversals.canvas) : e11.startCanvas && this.traverseType(e11.startCanvas, this.traversals.canvas)), e11.contentLayer && (typeof e11.contentLayer == `string` ? e11.contentLayer = this.traverseLayer({ "@id": e11.contentLayer, "@type": `sc:Layer` }) : e11.contentLayer = this.traverseLayer(e11.contentLayer)), e11;
  }
  traverseOneOrManyType(e11, t18) {
    if (!Array.isArray(e11)) if (this.options.convertPropsToArray) e11 = [e11];
    else return this.traverseType(e11, t18);
    return e11.map((e12) => this.traverseType(e12, t18));
  }
  traverseType(e11, t18) {
    return t18.reduce((e12, t19) => {
      let n15 = t19(e12);
      return n15 === void 0 && !this.options.allowUndefinedReturn ? e12 : n15;
    }, e11);
  }
};
var c2 = [`http://iiif.io/api/image/2/level1`, `http://iiif.io/api/image/2/level2`, `http://library.stanford.edu/iiif/image-api/compliance.html#level1`, `http://library.stanford.edu/iiif/image-api/compliance.html#level2`, `http://library.stanford.edu/iiif/image-api/conformance.html#level1`, `http://library.stanford.edu/iiif/image-api/conformance.html#level2`, `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1`, `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2`, `http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1`, `http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2`, `http://iiif.io/api/image/1/level1.json`, `http://iiif.io/api/image/1/profiles/level1.json`, `http://iiif.io/api/image/1/level2.json`, `http://iiif.io/api/image/1/profiles/level2.json`, `http://iiif.io/api/image/2/level1.json`, `http://iiif.io/api/image/2/profiles/level1.json`, `http://iiif.io/api/image/2/level2.json`, `http://iiif.io/api/image/2/profiles/level2.json`, `level1`, `level2`];
var l2 = { attributionLabel: `Attribution`, lang: `none`, providerId: `http://example.org/provider`, providerName: `` };
function u2(e11) {
  if (typeof e11 == `string`) return [e11];
  if (!e11) return [];
  let t18 = Array.isArray(e11) ? e11 : [e11], n15 = [];
  for (let e12 of t18) {
    if (typeof e12 == `string`) {
      n15.push(e12);
      continue;
    }
    n15.push({ "@language": e12[`@language`] || e12.language, "@value": e12[`@value`] || e12.value });
  }
  return n15;
}
function d2(e11, t18 = `none`) {
  if (!e11) return { none: [``] };
  let n15 = u2(e11), r16 = {};
  for (let e12 of n15) {
    if (typeof e12 == `string`) {
      r16[t18] = r16[t18] ? r16[t18] : [], r16[t18].push(e12 || ``);
      continue;
    }
    if (!e12[`@language`]) {
      r16[t18] = r16[t18] ? r16[t18] : [], r16[t18].push(e12[`@value`] || ``);
      continue;
    }
    let n16 = e12[`@language`];
    r16[n16] = r16[n16] ? r16[n16] : [], r16[n16].push(e12[`@value`] || ``);
  }
  return Object.keys(r16).length === 0 ? { none: [``] } : r16;
}
function f2(e11) {
  if (Array.isArray(e11)) return f2(e11.find((e12) => typeof e12 == `string`));
  if (A.indexOf(e11) !== -1) return `level2`;
  if (c2.indexOf(e11) !== -1) return `level1`;
  if (N.indexOf(e11) !== -1) return `level0`;
  if (typeof e11 == `string`) return e11;
}
function p2(e11) {
  let t18 = Array.isArray(e11) ? e11 : [e11];
  for (let e12 of t18) switch (e12) {
    case `http://iiif.io/api/image/2/context.json`:
    case `http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2`:
      return `ImageService2`;
    case `http://iiif.io/api/image/1/context.json`:
    case `http://library.stanford.edu/iiif/image-api/1.1/context.json`:
      return `ImageService1`;
    case `http://iiif.io/api/annex/openannotation/context.json`:
      return `ImageApiSelector`;
  }
}
function m2(e11) {
  switch (e11) {
    case `http://iiif.io/api/image/2/level0.json`:
    case `http://iiif.io/api/image/2/level1.json`:
    case `http://iiif.io/api/image/2/level2.json`:
      return `ImageService2`;
    case `http://iiif.io/api/auth/1/kiosk`:
    case `http://iiif.io/api/auth/1/login`:
    case `http://iiif.io/api/auth/1/clickthrough`:
    case `http://iiif.io/api/auth/1/external`:
    case `http://iiif.io/api/auth/0/kiosk`:
    case `http://iiif.io/api/auth/0/login`:
    case `http://iiif.io/api/auth/0/clickthrough`:
    case `http://iiif.io/api/auth/0/external`:
      return `AuthCookieService1`;
    case `http://iiif.io/api/auth/1/token`:
    case `http://iiif.io/api/auth/0/token`:
      return `AuthTokenService1`;
    case `http://iiif.io/api/auth/1/logout`:
    case `http://iiif.io/api/auth/0/logout`:
      return `AuthLogoutService1`;
    case `http://iiif.io/api/search/1/search`:
    case `http://iiif.io/api/search/0/search`:
      return `SearchService1`;
    case `http://iiif.io/api/search/1/autocomplete`:
    case `http://iiif.io/api/search/0/autocomplete`:
      return `AutoCompleteService1`;
  }
}
function h3(e11) {
  for (let t18 of [`sc`, `oa`, `dcterms`, `dctypes`, `iiif`]) if (e11.startsWith(`${t18}:`)) return e11.slice(t18.length + 1);
  return e11;
}
var g3 = [`Collection`, `Manifest`, `Annotation`, `AnnotationPage`, `Range`, `Service`];
function _3(e11) {
  let t18 = e11[`@id`] || e11.id, n15 = e11[`@type`] || e11.type, r16 = e11.profile || void 0, i16 = e11[`@context`] || void 0;
  if (r16) {
    let e12 = m2(r16);
    if (e12) return e12;
  }
  if (i16) {
    let e12 = p2(i16);
    if (e12) return e12;
  }
  if (n15) {
    if (Array.isArray(n15)) {
      if (n15.indexOf(`oa:CssStylesheet`) !== -1) return `CssStylesheet`;
      if (n15.indexOf(`cnt:ContentAsText`) !== -1) return `TextualBody`;
      n15 = n15[0];
    }
    for (let e12 of [`sc`, `oa`, `dcterms`, `dctypes`, `iiif`]) if (n15.startsWith(`${e12}:`)) {
      n15 = n15.slice(e12.length + 1);
      break;
    }
    switch (n15) {
      case `Layer`:
        return `AnnotationCollection`;
      case `AnnotationList`:
        return `AnnotationPage`;
      case `cnt:ContentAsText`:
        return `TextualBody`;
    }
  }
  if (n15 && g3.indexOf(n15) !== -1) return n15;
  if (e11.format) {
    if (e11.format.startsWith(`image/`)) return `Image`;
    if (e11.format.startsWith(`text/`) || e11.format === `application/pdf`) return `Text`;
    if (e11.format.startsWith(`application/`)) return `Dataset`;
  }
  return t18 && (t18.endsWith(`.jpg`) || t18.endsWith(`.png`) || t18.endsWith(`.jpeg`)) ? `Image` : n15 || `unknown`;
}
var v3 = /http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;
function y3(e11) {
  let t18 = e11.match(v3);
  return t18 ? t18[0] : e11;
}
function b3(e11, t18 = `Rights/License`, n15 = `none`) {
  let r16 = null, i16 = [], a15 = Array.isArray(e11) ? e11 : [e11];
  for (let e12 of a15) {
    let a16 = e12 ? y3(e12) : void 0;
    if (a16 && (a16.indexOf(`creativecommons.org`) !== -1 || a16.indexOf(`rightsstatements.org`) !== -1)) {
      r16 = a16.startsWith(`https://`) ? `http://${a16.slice(8)}` : a16;
      continue;
    }
    a16 && i16.push({ label: { [n15]: [t18] }, value: { [n15]: [a16] } });
  }
  return [r16, i16];
}
var x3 = [`http://iiif.io/api/presentation/2/context.json`, `http://iiif.io/api/image/2/context.json`, `http://iiif.io/api/image/1/context.json`, `http://library.stanford.edu/iiif/image-api/1.1/context.json`, `http://iiif.io/api/search/1/context.json`, `http://iiif.io/api/search/0/context.json`, `http://iiif.io/api/auth/1/context.json`, `http://iiif.io/api/auth/0/context.json`, `http://iiif.io/api/annex/openannotation/context.json`];
function S3(e11) {
  if (e11) {
    let t18 = Array.isArray(e11) ? e11 : [e11], n15 = [];
    for (let e12 of t18) {
      if (e12 === `http://iiif.io/api/presentation/2/context.json` && n15.push(`http://iiif.io/api/presentation/3/context.json`), x3.indexOf(e12) !== -1) continue;
      n15.push(e12);
    }
    if (t18.length) return n15.length === 1 ? n15[0] : n15;
  }
}
function C3(e11) {
  return e11 ? e11.map((e12) => ({ label: d2(e12.label), value: d2(e12.value) })) : [];
}
var w3 = 0;
function T3(e11, t18) {
  let n15 = encodeURI(e11.id || e11[`@id`] || ``).trim();
  return n15 && t18 ? `${n15}/${t18}` : n15 || (w3++, `http://example.org/${e11[`@type`]}${t18 ? `/${t18}` : ``}/${w3}`);
}
function E3(e11) {
  let t18 = [...e11.behavior || []];
  e11.viewingHint && t18.push(e11.viewingHint);
  let n15;
  return Array.isArray(e11.motivation) ? n15 = e11.motivation.map(h3) : e11.motivation && (n15 = h3(e11.motivation)), { "@context": e11[`@context`] ? S3(e11[`@context`]) : void 0, id: (e11[`@id`] || T3(e11)).trim(), type: _3(e11), behavior: t18.length ? t18 : void 0, height: e11.height ? e11.height : void 0, width: e11.width ? e11.width : void 0, motivation: n15, viewingDirection: e11.viewingDirection, profile: e11.profile, format: e11.format ? e11.format : void 0, duration: void 0, timeMode: void 0 };
}
function D3(e11) {
  let [t18, n15] = b3(e11.license), r16 = [...e11.metadata ? C3(e11.metadata) : [], ...n15];
  return { rights: t18, metadata: r16.length ? r16 : void 0, label: e11.label ? d2(e11.label) : void 0, requiredStatement: e11.attribution ? { label: d2(l2.attributionLabel), value: d2(e11.attribution) } : void 0, navDate: e11.navDate, summary: e11.description ? d2(e11.description) : void 0, thumbnail: O3(e11.thumbnail) };
}
function O3(e11) {
  if (e11) {
    let t18 = Array.isArray(e11) ? e11 : [e11];
    return t18.map((e12) => typeof e12 == `string` ? { id: e12, type: `Image` } : (e12.type === `unknown` && (e12.type = `Image`), e12));
  }
  return e11;
}
function k3(e11) {
  if (!e11.within) return;
  let t18 = Array.isArray(e11.within) ? e11.within : [e11.within], n15 = [];
  for (let r16 of t18) if (typeof r16 == `string`) {
    if (r16) switch (e11[`@type`]) {
      case `sc:Manifest`:
        n15.push({ id: r16, type: `Collection` });
        break;
    }
  } else r16[`@id`] && n15.push({ id: r16[`@id`], type: _3(r16) });
  return n15.length ? n15 : void 0;
}
function A3(e11) {
  let n15 = e11.related ? Array.isArray(e11.related) ? e11.related : [e11.related] : [], r16 = e11.contentLayer;
  return { provider: e11.logo || n15.length ? [{ id: l2.providerId, type: `Agent`, homepage: n15.length ? [n15[0]] : void 0, logo: e11.logo ? Array.isArray(e11.logo) ? e11.logo : [e11.logo] : void 0, label: d2(l2.providerName) }] : void 0, partOf: k3(e11), rendering: e11.rendering, seeAlso: e11.seeAlso, start: e11.startCanvas, service: e11.service ? i3(e11.service) : void 0, supplementary: r16 ? [r16] : void 0 };
}
function j3(e11) {
  return { chars: e11.chars, format: e11.format ? e11.format : void 0, language: e11.language };
}
function M2(e11, t18) {
  return e11 ? typeof e11 == `string` ? { id: e11, type: t18 } : typeof (e11 == null ? void 0 : e11[`@id`]) == `string` ? { id: e11[`@id`], type: t18 } : typeof e11.id == `string` ? { id: e11.id, type: t18 } : null : null;
}
function N2(e11) {
  let t18 = {};
  if (e11.first) {
    let n15 = M2(e11.first, `Collection`);
    n15 && (t18.first = n15);
  }
  if ((e11.total || e11.total === 0) && (t18.total = e11.total), e11.prev) {
    let n15 = M2(e11.prev, `Collection`);
    n15 && (t18.prev = n15);
  }
  if (e11.next) {
    let n15 = M2(e11.next, `Collection`);
    n15 && (t18.next = n15);
  }
  return t18;
}
function P3(e11) {
  let t18 = [];
  for (let n15 of e11) {
    let e12 = { ...n15 };
    e12.items && e12.items.length === 0 && delete e12.items, t18.push(e12);
  }
  return t18;
}
function F3(e11) {
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11), ...N2(e11), items: P3(e11.members) });
}
function I3(e11) {
  let t18 = [], r16 = [], i16, a15;
  for (let n15 of e11.sequences || []) n15.canvases.length && t18.push(...n15.canvases), n15.behavior && r16.push(...n15.behavior), n15.viewingDirection && (a15 = n15.viewingDirection), n15.startCanvas && (i16 = n15.startCanvas);
  let o14 = E3(e11);
  return r16.length && (o14.behavior ? o14.behavior.push(...r16) : o14.behavior = r16), a3({ ...o14, ...D3(e11), ...A3(e11), viewingDirection: a15, start: i16, items: t18, structures: L3(e11.structures) });
}
function L3(e11) {
  if (!e11) return e11;
  let t18 = /* @__PURE__ */ new Map();
  for (let n16 of e11) t18.set(n16.id, n16);
  let n15 = [];
  for (let r16 of e11) if (r16.items) {
    let e12 = r16.items.map((e13) => typeof e13 == `string` ? (n15.push(e13), t18.get(e13) || e13) : e13 && e13.id ? (n15.push(e13.id), t18.get(e13.id) || e13) : e13);
    r16.items = e12;
  }
  return e11.filter((e12) => n15.indexOf(e12.id) === -1);
}
function R3(e11) {
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11), annotations: e11.otherContent && e11.otherContent.length ? e11.otherContent : void 0, items: e11.images && e11.images.length ? [{ id: T3(e11, `annotation-page`), type: `AnnotationPage`, items: e11.images }] : void 0 });
}
function z2(e11) {
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11), items: e11.resources && e11.resources.length ? e11.resources : void 0 });
}
function B2(e11) {
  return !e11.canvases || e11.canvases.length === 0 ? { canvases: [], behavior: [] } : { canvases: e11.canvases, behavior: e11.viewingHint ? [e11.viewingHint] : [], viewingDirection: e11.viewingDirection, startCanvas: e11.startCanvas };
}
function V2(e11) {
  function t18(e12) {
    if (Array.isArray(e12)) {
      if (e12.length > 1) return { type: `List`, items: e12.map(t18) };
      e12 = e12[0];
    }
    if (typeof e12 == `string`) return encodeURI(e12).trim();
    if (`@type` in e12) {
      let t19;
      if (typeof e12.full == `string`) t19 = e12.full;
      else if (e12.full[`@type`] === `dctypes:Image`) t19 = { id: e12.full[`@id`], type: `Image` };
      else if (e12.full[`@type`] === `sc:Canvas`) t19 = { id: e12.full[`@id`], type: `Canvas` };
      else throw Error(`Unsupported source type on annotation: ${e12.full[`@type`]}`);
      return { type: `SpecificResource`, source: t19, selector: X2(e12.selector) };
    } else return encodeURI(e12[`@id`]).trim();
  }
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11), target: t18(e11.on), body: Array.isArray(e11.resource) ? e11.resource.map(H2) : H2(e11.resource) });
}
function H2(e11) {
  return e11.type === `Choice` ? e11 : U2(e11);
}
function U2(e11) {
  let t18 = e11;
  return a3({ ...E3(t18), ...D3(t18), ...A3(t18), ...j3(t18) });
}
function W(e11) {
  let t18 = [];
  return e11.default && e11.default !== `rdf:nil` && t18.push(e11.default), e11.item && e11.item !== `rdf:nil` && t18.push(...e11.item), a3({ ...E3(e11), ...D3(e11), items: t18 });
}
function G2(e11) {
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11), items: e11.members });
}
function K(e11) {
  let { "@id": t18, "@type": r16, "@context": i16, profile: a15, ...o14 } = e11, s10 = {};
  return t18 && (s10[`@id`] = t18), s10[`@type`] = _3(e11), s10[`@type`] === `unknown` && (i16 && i16.length && (s10[`@context`] = i16), s10[`@type`] = `Service`), a15 && (s10.profile = f2(a15)), a3({ ...s10, ...o14 });
}
function q(e11) {
  return a3({ ...E3(e11), ...D3(e11), ...A3(e11) });
}
var J2 = new s2({ collection: [F3], manifest: [I3], canvas: [R3], annotationList: [z2], sequence: [B2], annotation: [V2], contentResource: [U2], choice: [W], range: [G2], service: [K], layer: [q] });
function Y2(e11) {
  return e11 && e11[`@context`] && (e11[`@context`] === `http://iiif.io/api/presentation/2/context.json` || e11[`@context`].indexOf(`http://iiif.io/api/presentation/2/context.json`) !== -1 || e11[`@context`] === `http://www.shared-canvas.org/ns/context.json`) || e11[`@context`] === `http://iiif.io/api/image/2/context.json` || e11[`@id`] && e11[`@type`] === `sc:Collection` || e11[`@id`] && e11[`@type`] === `sc:Manifest` ? (e11["@context"] || (e11["@context"] = `http://iiif.io/api/presentation/2/context.json`), J2.traverseUnknown(e11)) : e11;
}
function X2(e11) {
  let t18 = (Array.isArray(e11[`@type`]) && e11[`@type`].includes(`oa:SvgSelector`) || e11[`@type`] == `oa:SvgSelector`) && (`chars` in e11 || `value` in e11);
  if (t18) return { type: `SvgSelector`, value: `chars` in e11 ? e11.chars : e11.value };
  if (e11[`@type`] === `oa:FragmentSelector`) return { type: `FragmentSelector`, value: e11.value };
  if (e11[`@type`] === `oa:Choice`) return [X2(e11.default), ...(Array.isArray(e11.item) ? e11.item : [e11.item]).map(X2)];
  if (e11[`@type`] == `iiif:ImageApiSelector`) return { type: `ImageApiSelector`, region: `region` in e11 ? e11.region : void 0, rotation: `rotation` in e11 ? e11.rotation : void 0 };
  throw Error(`Unsupported selector type: ${e11[`@type`]}`);
}

// node_modules/@iiif/parser/dist/presentation-3-DKf1Nh0x.js
function r6(e11, n15) {
  let i16 = n15 || `unknown`;
  if (!e11) return;
  if (typeof e11 == `string`) return { id: e11, type: i16 };
  if (n4(e11)) return r6(e11.source, n15);
  let a15 = i16 && i16 !== `unknown` ? i16 : e11.type || e11[`@type`], o14 = e11.id || e11[`@id`];
  if (a15 && a15.indexOf(`:`) !== -1 && (a15 = a15.split(`:`).pop()), o14 && a15) return { id: o14, type: a15 };
}
var i6 = {};
var a6 = `iiif-parser:hasPart`;
var o5 = `iiif-parser:partOf`;
var s3 = `iiif-parser:isExternal`;
var c3 = `__$UNSET$__`;
var l3 = `__$UNWRAP$__`;
var u3 = [];
Object.freeze(u3), Object.freeze(i6);
function d3(e11) {
  if (e11 === i6 || Object.keys(e11).length === 0) return true;
  for (let t18 in e11) return false;
  return true;
}
function f3(e11, t18) {
  if (t18 && t18[`@explicit`]) {
    let n15 = {}, r16 = Object.keys(t18);
    for (let i16 of r16) {
      if (i16 === o5 || i16 === `@explicit`) continue;
      d3(t18[i16]) ? n15[i16] = e11[i16] : n15[i16] = t18[i16];
    }
    return n15;
  }
  return e11;
}
function p3(e11, t18, n15) {
  let i16 = r6(t18);
  if (!i16) return [void 0, void 0];
  let s10 = e11.requests[i16.id], c8 = i16.type || e11.mapping[i16.id];
  if (!c8 || s10 && s10.resourceUri && (!e11.entities[c8] || !e11.entities[c8][s10.resourceUri])) return [void 0, void 0];
  let l8 = e11.entities[c8][s10 ? s10.resourceUri : i16.id];
  if (i16.type && !l8) return p3(e11, { id: i16.id }, n15);
  if (l8 && l8[a6]) {
    let e12 = l8[a6].find((e13) => n15 ? e13[o5] === n15.id : e13[o5] === l8.id), t19 = f3(l8, e12);
    return [t19, l8];
  }
  return [l8, l8];
}
var m3 = { id: `https://iiif-parser/annotation-page`, type: `AnnotationPage`, behavior: u3, label: null, thumbnail: u3, summary: null, requiredStatement: null, metadata: u3, rights: null, provider: u3, items: u3, seeAlso: u3, homepage: u3, rendering: u3, service: u3 };
var h4 = { id: `https://iiif-parser/empty-canvas`, type: `Canvas`, label: null, behavior: u3, thumbnail: u3, accompanyingCanvas: null, placeholderCanvas: null, summary: null, requiredStatement: null, metadata: u3, rights: null, navDate: null, provider: u3, items: u3, annotations: u3, seeAlso: u3, homepage: u3, partOf: u3, rendering: u3, service: u3, duration: 0, height: 0, width: 0 };
var g4 = { id: `https://iiif-parser/empty-collection`, type: `Collection`, label: null, viewingDirection: `left-to-right`, behavior: u3, thumbnail: u3, accompanyingCanvas: null, placeholderCanvas: null, summary: null, requiredStatement: null, metadata: u3, rights: null, navDate: null, provider: u3, items: u3, annotations: u3, seeAlso: u3, homepage: u3, partOf: u3, rendering: u3, service: u3, services: u3 };
var _4 = { id: `https://iiif-parser/empty-manifest`, type: `Manifest`, annotations: u3, behavior: u3, homepage: u3, items: u3, label: null, metadata: u3, navDate: null, provider: u3, partOf: u3, accompanyingCanvas: null, placeholderCanvas: null, rendering: u3, requiredStatement: null, rights: null, seeAlso: u3, service: u3, services: u3, start: null, structures: u3, summary: null, thumbnail: u3, viewingDirection: `left-to-right` };
var v4 = { id: `https://iiif-parser/empty-canvas`, type: `Range`, label: null, behavior: u3, thumbnail: u3, accompanyingCanvas: null, placeholderCanvas: null, summary: null, requiredStatement: null, metadata: u3, rights: null, navDate: null, provider: u3, items: u3, annotations: u3, seeAlso: u3, homepage: u3, partOf: u3, rendering: u3, service: u3, start: null, supplementary: null, viewingDirection: `left-to-right` };
var y4 = { id: `https://iiif-parser/empty-agent`, type: `Agent`, label: {}, logo: u3, seeAlso: u3, homepage: u3 };
var b4 = { id: `https://iiif-parser/empty-service`, type: `UnknownService` };
function x4(e11, t18 = {}) {
  if (Array.isArray(e11)) return x4(e11[0]);
  if (typeof e11 == `string`) {
    let [n15, r16] = e11.split(`#`);
    return r16 ? { type: `SpecificResource`, source: { id: n15, type: t18.typeHint || `Unknown` }, selector: { type: `FragmentSelector`, value: r16 } } : { type: `SpecificResource`, source: { id: n15, type: t18.typeMap && t18.typeMap[n15] || t18.typeHint || `Unknown` } };
  }
  if (e11.type === `Choice` || e11.type === `List` || e11.type === `Composite` || e11.type === `Independents`) return x4(e11.items[0]);
  if (!e11.type && `source` in e11 && (e11.type = `SpecificResource`), e11.type === `SpecificResource`) {
    e11.source.type === `Canvas` && e11.source.partOf && typeof e11.source.partOf == `string` && (e11.source.partOf = [{ id: e11.source.partOf, type: `Manifest` }]);
    let n15 = typeof e11.source == `string` ? e11.source : e11.source.id;
    if (n15 == null ? void 0 : n15.includes(`#`)) {
      let r16 = x4(n15, t18);
      r16 && (e11.selector = r16.selector, e11.source = r16.source);
    }
    return e11.selector ? { ...e11, type: `SpecificResource`, source: e11.source, selector: e11.selector } : { ...e11, type: `SpecificResource`, source: e11.source };
  }
  if (e11.id) {
    e11.type === `Canvas` && e11.partOf && typeof e11.partOf == `string` && (e11.partOf = [{ id: e11.partOf, type: `Manifest` }]);
    let [t19, n15] = e11.id.split(`#`);
    return n15 ? { type: `SpecificResource`, source: { ...e11, id: t19 }, selector: { type: `FragmentSelector`, value: n15 } } : { type: `SpecificResource`, source: { ...e11, id: t19 } };
  }
  return { type: `SpecificResource`, source: e11 };
}
function C4() {
  return { Collection: {}, Manifest: {}, Canvas: {}, AnnotationPage: {}, AnnotationCollection: {}, Annotation: {}, ContentResource: {}, Range: {}, Service: {}, Selector: {}, Agent: {} };
}
function w4(e11, t18) {
  if (typeof e11 == `string`) return { id: e11, type: t18 };
  if (!e11.id) throw Error(`Invalid resource does not have an ID (${JSON.stringify(e11)}, ${t18})`);
  return e11;
}
function T4(e11, t18) {
  return (n15, r16) => {
    let i16 = e11[n15] ? e11[n15] : {};
    return (e12, a15) => {
      let o14 = w4(e12, r16 || n15);
      return o14 && o14.id && n15 ? (i16[o14.id] = i16[o14.id] ? D4(i16[o14.id], o14, { parent: a15.parent, isTopLevel: t18.id === o14.id }) : D4({ id: o14.id, type: o14.type }, o14, { parent: a15.parent, isTopLevel: t18.id === o14.id }), { id: o14.id, type: n15 === `ContentResource` ? n15 : o14.type }) : o14;
    };
  };
}
function E4(e11, t18, n15) {
  if (!t18) return e11;
  if (Array.isArray(e11)) {
    if (!Array.isArray(t18)) throw Error(`Cannot merge array with non-array`);
    let n16 = [...e11];
    for (let r16 of t18) {
      if (r16[`@id`] && !r16.id && (r16.id = r16[`@id`]), r16[`@type`] && !r16.type && (r16.type = r16[`@type`]), r16 == null) continue;
      if (Array.isArray(r16)) n16.push(r16);
      else if (typeof r16 == `object` && r16.id && r16.type) {
        let e12 = n16.findIndex((e13) => e13.id === r16.id && e13.type === r16.type);
        e12 >= 0 && (n16[e12] = E4(n16[e12], r16));
      } else e11.indexOf(r16) === -1 && n16.push(r16);
    }
    return n16;
  } else if (typeof e11 == `object`) {
    if (Array.isArray(t18) || typeof t18 != `object`) throw Error(`Cannot merge object with non-object`);
    let r16 = { ...e11 }, s10 = [], c8 = [], l8 = Object.keys(e11).filter((e12) => e12 !== a6 && e12 !== `id` && e12 !== `type`), d7 = {}, f7 = {};
    for (let [e12, n16] of Object.entries(t18)) {
      if (e12 === a6 || e12 === `id` || e12 === `type`) continue;
      let t19 = r16[e12];
      t19 === n16 ? c8.push(e12) : t19 === u3 || !t19 ? (s10.push(e12), r16[e12] = n16) : (t19 && n16 && (d7[e12] = t19, f7[e12] = n16), r16[e12] = E4(t19, n16), r16[e12] === d7[e12] && (c8.push(e12), delete d7[e12]));
    }
    if (n15 && (n15.parent && n15.parent.id || n15.isTopLevel)) {
      let t19 = [], u7 = {};
      if (n15.parent ? u7[o5] = n15.parent.id : n15.isTopLevel && (u7[o5] = e11.id), r16[a6] && r16[a6].length) {
        let e12 = !(r16[a6] || []).find((e13) => e13[`@explicit`]), n16 = s10.length > 0 || c8.length !== l8.length;
        if (e12 && n16) for (let e13 of r16[a6]) {
          let n17 = { ...e13 }, r17 = Object.keys(d7);
          if (n17) {
            n17[`@explicit`] = true;
            for (let e14 of l8) e14 !== a6 && (n17[e14] = i6);
            for (let e14 of r17) n17[e14] = d7[e14];
          }
          t19.push(n17);
        }
        else t19.push(...r16[a6]);
        if (n16) {
          let e13 = Object.keys(f7);
          u7[`@explicit`] = true;
          for (let e14 of s10) u7[e14] = i6;
          for (let e14 of c8) u7[e14] = i6;
          for (let t20 of e13) u7[t20] = f7[t20];
        }
      }
      u7.id = r16.id, u7.type = r16.type, t19.push(u7), r16[a6] = t19;
    }
    return r16;
  } else if (e11) return e11;
  return t18;
}
function D4(e11, t18, n15) {
  if (typeof e11 == `string`) return e11;
  if (t18.id !== e11.id || t18.type !== e11.type) {
    if (t18.type === `ImageService3`) return t18;
    if (e11.type === `ImageService3`) return e11;
    throw Error(`Can only merge entities with identical identifiers and type! ${t18.type}(${t18.id}) => ${e11.type}(${e11.id})`);
  }
  return E4({ ...e11 }, t18, n15);
}
function O4(e11) {
  return (t18, n15) => (r16) => {
    let { id: i16, type: a15 } = w4(r16, n15 || t18);
    if (i16 === void 0) throw Error(`Found invalid entity without an ID.`);
    return t18 === `ContentResource` || t18 === `Service` ? e11[i16] = t18 : e11[i16] = a15, r16;
  };
}
function te(e11) {
  let t18 = Object.assign({}, e11);
  if (t18[`@id`] && (t18.id = t18[`@id`]), t18[`@type`] && (t18.type = t18[`@type`]), t18.service) {
    let e12 = [];
    t18.service = Array.isArray(t18.service) ? t18.service : [t18.service];
    for (let n15 of t18.service) e12.push({ id: n15[`@id`] || n15.id, type: n15[`@type`] || n15.type });
    t18.service = e12;
  }
  return Object.assign({}, b4, t18);
}
function ne(e11) {
  return (t18) => {
    e11.Service = e11.Service ? e11.Service : {};
    let n15 = t18.id || t18[`@id`], r16 = te(t18);
    return r16 && r16.id && (e11.Service[r16.id] ? e11.Service[n15] = D4(e11.Service[n15], r16) : e11.Service[n15] = r16), t18;
  };
}
function re(e11) {
  let t18 = JSON.stringify(e11), n15 = 5381, r16 = t18.length;
  for (; r16; ) n15 = n15 * 33 ^ t18.charCodeAt(--r16);
  let i16 = n15 >>> 0, a15 = i16.toString(16);
  return a15.length % 2 ? `0` + a15 : a15;
}
function k4(e11) {
  return (t18) => typeof t18 == `string` ? { id: t18, type: e11 } : t18.id ? t18.type ? t18 : { type: e11, ...t18 } : { id: `vault://${re(t18)}`, type: e11, ...t18 };
}
function A4(e11) {
  return (t18) => ({ ...e11, ...t18 });
}
function j4(e11) {
  return Array.isArray(e11) ? e11 : [e11];
}
function M3(e11) {
  return e11.body && (e11.body = j4(e11.body)), e11.seeAlso && (e11.seeAlso = j4(e11.seeAlso)), e11.audience && (e11.audience = j4(e11.audience)), e11.accessibility && (e11.accessibility = j4(e11.accessibility)), e11.motivation && (e11.motivation = j4(e11.motivation)), e11;
}
function N3(e11, { typeHint: n15, partOfTypeHint: r16 } = {}) {
  if (typeof e11 == `string` && (e11 = { id: e11, type: n15 || `unknown` }), n4(e11)) return typeof e11.source == `string` && (e11.source = { id: e11.source, type: n15 || `unknown` }), e11.source.type === `Canvas` && e11.source.partOf && typeof e11.source.partOf == `string` && (e11.source.partOf = [{ id: e11.source.partOf, type: r16 || `Manifest` }]), e11;
  let i16;
  if ((e11.id || ``).indexOf(`#`) !== -1) {
    let [t18, n16] = (e11.id || ``).split(`#`);
    e11.id = t18, n16 && (i16 = { type: `FragmentSelector`, value: n16 });
  }
  return { type: `SpecificResource`, source: e11, selector: i16 };
}
function P4(e11) {
  let t18 = Object.assign({}, e11);
  return e11 && e11.items && (t18.items = e11.items.map((e12) => typeof e12 == `string` || e12.type === `Canvas` ? N3(e12) : e12)), t18;
}
function ie(e11) {
  let t18 = Object.assign({}, e11);
  return t18.start ? (t18.start = N3(t18.start, { typeHint: `Canvas` }), t18) : e11;
}
function ae(e11) {
  let t18 = Object.assign({}, e11);
  return t18.target ? (t18.target = x4(t18.target, { typeHint: `Canvas` }), t18) : e11;
}
function F4(e11) {
  return e11;
}
function I4(e11) {
  return e11.items === void 0 && (e11[s3] = true), e11;
}
function L4(t18) {
  let r16 = Y2(t18), i16 = C4(), a15 = {}, o14 = T4(i16, r16), s10 = O4(a15), c8 = new o3({ collection: [I4, A4(g4), s10(`Collection`), o14(`Collection`)], manifest: [I4, A4(_4), ie, s10(`Manifest`), o14(`Manifest`)], canvas: [A4(h4), s10(`Canvas`), o14(`Canvas`)], annotationPage: [I4, k4(`AnnotationPage`), A4(m3), s10(`AnnotationPage`), o14(`AnnotationPage`)], annotation: [k4(`Annotation`), M3, ae, s10(`Annotation`), o14(`Annotation`)], contentResource: [k4(`ContentResource`), s10(`ContentResource`), o14(`ContentResource`)], range: [A4(v4), P4, s10(`Range`, `Canvas`), o14(`Range`, `Canvas`)], agent: [A4(y4), s10(`Agent`), o14(`Agent`)], specificResource: [F4], service: [ne(i16)] }), l8 = c8.traverseUnknown(r16);
  return { entities: i16, resource: l8, mapping: a15 };
}
function R4(e11) {
  let t18 = {};
  for (let [n15, r16] of e11) {
    if (n15 === l3 && r16 !== c3) return r16;
    r16 !== c3 && r16 != null && (t18[n15] = r16);
  }
  return t18;
}
function oe(e11, t18, n15) {
  if (!t18.type || !t18.id) throw Error(`Unknown entity`);
  if (!n15[t18.type]) throw Error(`Serializer not found for ${t18.type}`);
  function r16(i16, a15, o14 = 0) {
    let s10 = n15[i16.type];
    if (!s10) return c3;
    if (o14 > 20) throw Error(`Circular reference: ` + i16.id + ` ` + i16.type);
    let [l8, u7] = p3(e11, i16.type ? i16 : i16.id, a15) || (i16.id && i16.type ? i16 : null);
    if (!l8) return c3;
    let d7 = s10(l8, e11, { parent: a15, isTopLevel: t18.id === i16.id, fullResource: u7 }), f7 = d7.next();
    for (; !f7.done; ) {
      let e12 = f7.value, t19 = c3;
      if (e12) if (Array.isArray(e12)) {
        let n16 = [];
        for (let t20 of e12) n16.push(r16(t20, i16, o14 + 1));
        t19 = n16;
      } else t19 = r16(e12, i16, o14 + 1);
      f7 = d7.next(t19);
    }
    return f7.value === c3 ? c3 : R4(f7.value);
  }
  return r16(t18);
}
function z3(e11, { allowSourceString: t18 = true, allowString: n15 = false, allowedStringType: r16 } = {}) {
  let i16 = (e12) => {
    if (t18 && e12 && e12.source && typeof e12.source != `string`) {
      let t19 = Object.keys(e12.source);
      if (e12.source.id && e12.source.type && t19.length === 2) return { ...e12, source: e12.source.id };
    }
    return e12;
  };
  if (e11) {
    if (e11.source && e11.source.partOf) return i16(e11);
    let t19 = Object.keys(e11);
    if (t19.length === 2 && e11.type && e11.source || t19.length === 3 && e11.type && e11.source && t19.indexOf(`selector`) !== -1 && !e11.selector) return n15 && (!r16 || r16 === e11.source.type) ? e11.source.id : e11.source.type === `ContentResource` ? { type: `SpecificResource`, source: e11.source.id } : e11.source;
    if (e11.selector && !Array.isArray(e11.selector) && typeof e11.selector != `string` && e11.selector.type === `FragmentSelector`) {
      let t20 = `${e11.source.id}#${e11.selector.value}`;
      return n15 ? t20 : { id: t20, type: e11.source.type };
    }
  }
  return i16(e11);
}
function B3(e11) {
  if (!e11) return;
  let t18 = Object.keys(e11);
  if (t18.length !== 0) {
    if (t18.length === 1) {
      let n15 = t18[0];
      if (!n15) return ``;
      let r16 = (e11[n15] || []).join(``);
      return n15 === `@none` || n15 === `none` || n15 === `en` ? r16 : { "@language": n15, "@value": r16 };
    }
    return t18.map((t19) => ({ "@language": t19, "@value": (e11[t19] || []).join(``) }));
  }
}
function V3(e11) {
  return Array.isArray(e11) ? e11.map((e12) => V3(e12)) : typeof e11 == `string` ? e11 : e11.type && e11.type === `Canvas` ? e11.id : e11;
}
function H3(e11, t18 = false) {
  if (e11) return e11.length > 1 && !t18 ? e11 : e11[0] || void 0;
}
function U3(e11) {
  if (e11) {
    if (typeof e11 == `string`) return { "@id": e11 };
    if (`@id` in e11) {
      let t18 = { ...e11 };
      return delete t18[`@type`], t18;
    }
    return { "@context": `http://iiif.io/api/image/2/context.json`, "@id": e11.id, profile: `http://iiif.io/api/image/2/profiles/${e11.profile}.json` };
  }
}
function W2(e11, t18) {
  return [[`@id`, e11.id], [`@type`, t18], [`format`, e11.format], [`height`, e11.height], [`width`, e11.width], [`viewingDirection`, e11.viewingDirection === `left-to-right` ? void 0 : e11.viewingDirection], [`license`, e11.license ? e11.license : void 0]];
}
function* G3(e11) {
  let t18 = e11.provider ? yield e11.provider[0] : void 0;
  return [[`label`, B3(e11.label)], [`metadata`, e11.metadata && e11.metadata.length ? e11.metadata.map((e12) => ({ label: B3(e12.label) || ``, value: B3(e12.value) || `` })) : void 0], [`description`, B3(e11.summary)], [`thumbnail`, H3(yield e11.thumbnail)], [`navDate`, e11.navDate], [`logo`, t18 ? H3(t18.logo) : void 0], [`homepage`, t18 ? t18.homepage : void 0], [`attribution`, e11.requiredStatement ? B3(e11.requiredStatement.value) : void 0]];
}
function* K2(e11) {
  let t18 = e11.start && e11.start.type && e11.start.type === `SpecificResource` ? z3(e11.start) : e11.start;
  return [[`seeAlso`, H3(yield e11.seeAlso)], [`service`, H3((e11.service || []).map(U3))], [`rendering`, H3(yield e11.rendering)], [`startCanvas`, t18 ? t18.id : void 0]];
}
function se2(e11) {
  return e11.type === `SpecificResource`;
}
function ce2(e11) {
  return e11 && e11.type === `FragmentSelector`;
}
function le2(e11) {
  if (e11 && se2(e11)) {
    let t18 = e11.id, n15 = e11.selector ? Array.isArray(e11.selector) ? e11.selector[0] : e11.selector : void 0;
    return ce2(n15) && (t18 += `#` + n15.value), t18;
  }
  return e11 == null ? void 0 : e11.id;
}
var ue2 = { Manifest: function* (e11, t18, { isTopLevel: n15 }) {
  return [...n15 ? [[`@context`, `http://iiif.io/api/presentation/2/context.json`]] : [], ...W2(e11, `sc:Manifest`), ...yield* G3(e11), ...yield* K2(e11), [`sequences`, [{ "@id": `${e11.id}/sequence0`, "@type": `sc:Sequence`, canvases: yield e11.items }]], [`structures`, yield e11.structures]];
}, Canvas: function* (e11) {
  let t18 = yield e11.items, n15 = t18[0];
  return [...W2(e11, `sc:Canvas`), ...yield* G3(e11), ...yield* K2(e11), [`images`, n15 ? [n15.resources] : void 0], [`annotations`, e11.annotations && e11.annotations.length ? H3(yield e11.annotations) : void 0]];
}, AnnotationPage: function* (e11) {
  return [...W2(e11, `sc:AnnotationList`), ...yield* G3(e11), [`resources`, e11.items && e11.items.length ? H3(yield e11.items) : void 0]];
}, Annotation: function* (e11) {
  return [[`@id`, e11.id], [`@type`, `oa:Annotation`], [`motivation`, `sc:painting`], [`on`, V3(e11.target)], [`resource`, H3(yield e11.body, true)]];
}, ContentResource: function* (e11) {
  switch (e11.type) {
    case `Image`:
      return [...W2(e11, `dctypes:Image`), ...yield* G3(e11), ...yield* K2(e11)];
    case `Text`:
    case `Dataset`:
    default:
      return [...W2(e11, void 0), ...yield* G3(e11)];
  }
}, AnnotationCollection: function* (e11) {
  return [[`@id`, e11.id], [`@type`, `sc:Layer`], [`label`, B3(e11.label)]];
}, Collection: function* (e11) {
  return [...W2(e11, `sc:Collection`), ...yield* G3(e11), ...yield* K2(e11), [`members`, yield* e11.items]];
}, Range: function* (e11) {
  let t18 = [], n15 = [];
  if (e11.items) for (let r16 of e11.items) {
    let i16 = r16.type === `SpecificResource` ? r16.source : r16;
    if (i16) {
      let a15 = yield i16;
      t18.push({ "@id": le2(r16), "@type": i16.type, label: a15 ? a15.label : void 0, within: e11.id }), i16.type === `Canvas` && n15.push(i16.id);
    }
  }
  return [...W2(e11, `sc:Range`), ...yield* G3(e11), ...yield* K2(e11), [`canvases`, n15.length === t18.length ? n15 : void 0], [`members`, n15.length === t18.length ? void 0 : t18]];
} };
function q2(e11) {
  var _a;
  return [[`id`, ((_a = e11.id) == null ? void 0 : _a.startsWith(`vault://`)) ? void 0 : e11.id], [`type`, e11.type], [`format`, e11.format], [`profile`, e11.profile], [`height`, e11.height || void 0], [`width`, e11.width || void 0], [`duration`, e11.duration || void 0], [`viewingDirection`, e11.viewingDirection === `left-to-right` ? void 0 : e11.viewingDirection], [`behavior`, e11.behavior && e11.behavior.length ? e11.behavior : void 0], [`timeMode`, e11.timeMode], [`motivation`, Array.isArray(e11.motivation) ? e11.motivation[0] : e11.motivation], [a6, c3]];
}
function J3(e11) {
  if (e11 === c3 || !e11 || e11.length === 0) return;
  let t18 = e11.filter((e12) => e12 !== c3);
  if (t18.length !== 0) return t18;
}
function Y3(e11) {
  if (e11 && e11.type && e11.type === `ImageService2`) {
    let { id: t18, type: n15, profile: r16, ...i16 } = e11, a15 = typeof r16 == `string` ? r16 : Array.isArray(r16) ? r16.find((e12) => typeof e12 == `string`) : ``;
    return { "@id": t18, "@type": n15, profile: a15 ? a15.startsWith(`http`) ? a15 : `http://iiif.io/api/image/2/${a15}.json` : `http://iiif.io/api/image/2/level0.json`, ...i16 };
  }
  return e11;
}
function X3(e11) {
  if (Array.isArray(e11) || (e11 = e11 ? [e11] : []), !(!e11 || e11.length === 0)) return e11.map(Y3);
}
function* Z2(e11) {
  return [[`label`, e11.label], [`metadata`, J3(e11.metadata)], [`summary`, e11.summary], [`requiredStatement`, e11.requiredStatement], [`rights`, Array.isArray(e11.rights) ? e11.rights[0] || void 0 : e11.rights || void 0], [`navDate`, e11.navDate], [`language`, e11.language], [`thumbnail`, J3(yield e11.thumbnail)], [`placeholderCanvas`, yield e11.placeholderCanvas], [`accompanyingCanvas`, yield e11.accompanyingCanvas], [`provider`, J3(yield e11.provider)]];
}
function* Q2(e11, t18) {
  let n15 = [];
  for (let r16 of e11.partOf || []) {
    if (r16.type === `Manifest` && t18.type === `Manifest`) continue;
    n15.push(yield r16);
  }
  return [[`seeAlso`, J3(yield e11.seeAlso)], [`service`, J3(X3(e11.service))], [`services`, J3(X3(e11.services))], [`rendering`, J3(yield e11.rendering)], [`supplementary`, J3(yield e11.supplementary)], [`homepage`, J3(yield e11.homepage)], [`logo`, J3(yield e11.logo)], [`partOf`, J3(n15)], [`start`, e11.start ? z3(e11.start) : e11.start]];
}
var de2 = { Manifest: function* (e11, t18, { isTopLevel: n15 }) {
  if (!n15) return [...q2(e11), ...yield* Z2(e11), [`navPlace`, e11.navPlace]];
  let r16 = `http://iiif.io/api/presentation/3/context.json`;
  return (e11.navPlace || $2(e11)) && (r16 = [`http://iiif.io/api/presentation/3/context.json`, `http://iiif.io/api/extension/navplace/context.json`]), [[`@context`, e11[`@context`] ? e11[`@context`] : r16], ...q2(e11), ...yield* Z2(e11), ...yield* Q2(e11), [`items`, yield e11.items], [`structures`, J3(yield e11.structures)], [`annotations`, J3(yield e11.annotations)], [`navPlace`, e11.navPlace]];
}, Canvas: function* (e11, t18, { parent: n15 }) {
  return n15 && n15.type !== `Manifest` && n15.type !== `Canvas` ? [[`id`, e11.id]] : [...q2(e11), ...yield* Z2(e11), ...yield* Q2(e11, n15), [`items`, yield e11.items], [`annotations`, J3(yield e11.annotations)], [`navPlace`, e11.navPlace]];
}, Agent: function* (e11) {
  return [[`id`, e11.id], [`type`, `Agent`], [`label`, e11.label], ...yield* Q2(e11)];
}, AnnotationPage: function* (e11) {
  var _a;
  let t18 = Object.entries(e11).map(([e12, t19]) => [e12, Array.isArray(t19) ? J3(t19) : t19]).filter(([e12, t19]) => e12 !== `items` && e12 !== `id` && e12 !== a6 && e12 !== o5 && e12 !== s3), n15 = yield e11.items;
  return [[`id`, ((_a = e11.id) == null ? void 0 : _a.startsWith(`vault://`)) ? void 0 : e11.id], ...t18, ...yield* Q2(e11), [`items`, n15.length || e11[s3] === false ? n15 : c3]];
}, Service: function* (e11) {
  return [[l3, Y3(e11)]];
}, Annotation: function* (e11) {
  let n15 = Object.entries(e11).map(([e12, t18]) => e12 === `motivation` ? [e12, Array.isArray(t18) ? t18[0] : t18] : e12 === `target` ? [e12, z3(t18, { allowString: true, allowSourceString: true, allowedStringType: `Canvas` })] : [e12, Array.isArray(t18) ? J3(t18) : t18]).filter(([e12]) => e12 !== `body` && e12 !== a6 && e12 !== s3), r16;
  if (Array.isArray(e11.body)) {
    let n16 = [];
    for (let r17 of e11.body) if (r17 && n4(r17)) {
      let e12 = { ...r17 };
      r17.source.type === `Canvas` ? e12.source = r17.source : e12.source = yield r17.source, n16.push(z3(e12, { allowSourceString: true }));
    } else n16.push(yield r17);
    r16 = n16;
  } else e11.body && n4(e11.body) ? (r16 = { ...e11.body }, r16.source = yield e11.body.source) : r16 = yield e11.body;
  return [...n15, ...yield* Z2(e11), ...yield* Q2(e11), [`body`, r16.length === 1 ? r16[0] : r16]];
}, ContentResource: function* (e11) {
  return fe2([...q2(e11), ...yield* Z2(e11), ...yield* Q2(e11), [`annotations`, J3(yield e11.annotations)], [`items`, J3(yield e11.items)]], e11);
}, AnnotationCollection: function* (e11) {
  return [[`id`, e11.id], [`type`, `AnnotationCollection`], [`label`, e11.label]];
}, Collection: function* (e11, t18, { isTopLevel: n15 }) {
  if (n15) {
    let t19 = `http://iiif.io/api/presentation/3/context.json`;
    return (e11.navPlace || $2(e11)) && (t19 = [`http://iiif.io/api/extension/navplace/context.json`, `http://iiif.io/api/presentation/3/context.json`]), [[`@context`, t19], ...q2(e11), ...yield* Z2(e11), ...yield* Q2(e11), [`items`, J3(yield e11.items)], [`navPlace`, e11.navPlace]];
  }
  return [...q2(e11), ...yield* Z2(e11), [`navPlace`, e11.navPlace]];
}, Range: function* (e11) {
  let t18 = [];
  for (let n15 of e11.items) n15.type === `Range` ? t18.push(yield n15) : n15 && n15.type === `SpecificResource` ? t18.push(z3(n15)) : t18.push(n15);
  return [...q2(e11), ...yield* Z2(e11), ...yield* Q2(e11), [`items`, t18], [`annotations`, J3(yield e11.annotations)], [`navPlace`, e11.navPlace]];
} };
function fe2(e11, t18) {
  let n15 = Object.keys(t18), r16 = e11.map(([e12]) => e12);
  for (let i16 of n15) {
    if (i16 === a6 || i16 === s3) continue;
    r16.indexOf(i16) === -1 && t18[i16] !== void 0 && e11.push([i16, t18[i16]]);
  }
  return e11;
}
function $2(e11) {
  if (!e11.items || !Array.isArray(e11.items)) return false;
  for (let t18 of e11.items) if (t18.navPlace) return true;
  return false;
}

// node_modules/@iiif/helpers/dist/i18n-BypEYFdV.js
function t9(e11, t18, n15 = [], r16 = false, i16 = []) {
  if (i16.length && (t18 = t18.filter((e12) => i16.indexOf(e12) === -1)), !t18 || t18.length === 0) return;
  if (t18.length === 1) return t18[0];
  if (!e11) return t18.indexOf(`none`) === -1 ? t18[0] : `none`;
  if (t18.indexOf(e11) !== -1) return e11;
  let a15 = e11.indexOf(`-`) === -1 ? null : e11.slice(0, e11.indexOf(`-`));
  if (a15 && t18.indexOf(a15) !== -1) return a15;
  for (let e12 of n15) if (t18.indexOf(e12) !== -1) return e12;
  if (!r16 && e11) {
    let r17 = t18.map((e12) => e12.indexOf(`-`) === -1 ? null : e12.slice(0, e12.indexOf(`-`))), i17 = r17.indexOf(e11);
    if (i17 !== -1) return t18[i17];
    for (let e12 of n15) {
      let n16 = e12.indexOf(`-`) === -1 ? null : e12.slice(0, e12.indexOf(`-`)), r18 = n16 ? t18.indexOf(n16) : -1;
      if (r18 !== -1) return t18[r18];
    }
  }
  return t18.indexOf(`none`) === -1 ? t18.indexOf(`@none`) === -1 ? t18[0] : `@none` : `none`;
}
function n5(e11, r16, i16 = {}) {
  let { strictFallback: a15 = false, defaultText: o14 = ``, separator: s10 = `
`, fallbackLanguages: c8 = [], closest: l8, skipLanguages: u7 } = i16, d7 = Object.keys(e11 || {}), f7 = l8 ? r16 : t9(r16, d7, c8, a15, u7);
  if (!e11) return o14;
  if (typeof e11 == `string`) return e11;
  let p6 = f7 ? e11[f7] : void 0;
  if (p6 && f7) {
    if (typeof p6 == `string`) return p6;
    if (p6.length === 1 && p6[0] === ``) {
      let t18 = i16.skipLanguages || [];
      return n5(e11, r16, { ...i16, skipLanguages: [...t18, f7] });
    }
    return p6.join(s10);
  }
  return ``;
}
function r7(e11, t18 = {}) {
  return n5(e11, t18.language || (typeof navigator < `u` ? navigator.language : `en`), t18);
}
function i7(e11) {
  return !e11 || typeof e11 == `string` || Array.isArray(e11) ? [] : Object.keys(e11).filter((e12) => e12 !== `none`);
}
function a7(t18) {
  let n15 = /* @__PURE__ */ new Set(), r16 = o3.all((e11) => {
    if (`label` in e11) {
      let t19 = i7(e11.label);
      t19.forEach((e12) => n15.add(e12));
    }
    if (`summary` in e11) {
      let t19 = i7(e11.summary);
      t19.forEach((e12) => n15.add(e12));
    }
    if (`language` in e11 && typeof e11.language == `string` && n15.add(e11.language), `requiredStatement` in e11 && e11.requiredStatement && !Array.isArray(e11.requiredStatement)) {
      if (`label` in e11.requiredStatement) {
        let t19 = i7(e11.requiredStatement.label);
        t19.forEach((e12) => n15.add(e12));
      }
      if (`value` in e11.requiredStatement) {
        let t19 = i7(e11.requiredStatement.value);
        t19.forEach((e12) => n15.add(e12));
      }
    }
    `metadata` in e11 && Array.isArray(e11.metadata) && e11.metadata.forEach((e12) => {
      if (`label` in e12) {
        let t19 = i7(e12.label);
        t19.forEach((e13) => n15.add(e13));
      }
      if (`value` in e12) {
        let t19 = i7(e12.value);
        t19.forEach((e13) => n15.add(e13));
      }
    });
  });
  return r16.traverseUnknown(t18), Array.from(n15);
}
var o6 = s4();
function s4(e11 = {}) {
  return (t18, ...n15) => {
    let i16 = ``;
    for (let a15 = 0; a15 < t18.length; a15++) if (i16 += t18[a15], a15 < n15.length) {
      let t19 = n15[a15];
      if (t19 == null) continue;
      typeof t19 == `string` ? i16 += t19 : i16 += r7(t19, e11);
    }
    return i16;
  };
}

// node_modules/@iiif/helpers/dist/chunk-B1_aTGT8.js
var e6 = Object.create;
var t10 = Object.defineProperty;
var n6 = Object.getOwnPropertyDescriptor;
var r8 = Object.getOwnPropertyNames;
var i8 = Object.getPrototypeOf;
var a8 = Object.prototype.hasOwnProperty;
var o7 = (e11, t18) => () => (t18 || e11((t18 = { exports: {} }).exports, t18), t18.exports);
var c4 = (e11, i16, o14, s10) => {
  if (i16 && typeof i16 == `object` || typeof i16 == `function`) for (var c8 = r8(i16), l8 = 0, u7 = c8.length, d7; l8 < u7; l8++) d7 = c8[l8], !a8.call(e11, d7) && d7 !== o14 && t10(e11, d7, { get: ((e12) => i16[e12]).bind(null, d7), enumerable: !(s10 = n6(i16, d7)) || s10.enumerable });
  return e11;
};
var l4 = (n15, r16, a15) => (a15 = n15 == null ? {} : e6(i8(n15)), c4(r16 || !n15 || !n15.__esModule ? t10(a15, `default`, { value: n15, enumerable: true }) : a15, n15));

// node_modules/@iiif/helpers/dist/expand-target-C_i3AMeE.js
function r9(e11, t18, n15, r16 = 1) {
  return new c5(e11, t18, n15).subdivide(r16);
}
function i9(e11, t18, n15, r16, i16 = 1) {
  return new l5(new Float64Array([e11.x, e11.y, t18.x, t18.y, n15.x, n15.y, r16.x, r16.y])).subdivide(i16);
}
function a9(e11) {
  return e11.x * e11.x + e11.y * e11.y;
}
function o8(e11) {
  let t18 = 0.67;
  return e11 / (1 - t18 + (t18 ** 4 + 0.25 * e11 * e11) ** 0.25);
}
function s5(e11) {
  let t18 = 0.39;
  return e11 * (1 - t18 + Math.sqrt(t18 * t18 + 0.25 * e11 * e11));
}
var c5 = class {
  constructor(e11, t18, r16) {
    r(this, `start`, void 0), r(this, `control`, void 0), r(this, `end`, void 0), this.start = e11, this.control = t18, this.end = r16;
  }
  eval(e11) {
    let t18 = 1 - e11;
    return { x: this.start.x * t18 * t18 + 2 * this.control.x * t18 * e11 + this.end.x * e11 * e11, y: this.start.y * t18 * t18 + 2 * this.control.y * t18 * e11 + this.end.y * e11 * e11 };
  }
  mapToBasic() {
    let { x: e11, y: t18 } = this.start, { x: n15, y: r16 } = this.control, { x: i16, y: a15 } = this.end, o14 = 2 * n15 - e11 - i16, s10 = 2 * r16 - t18 - a15, c8 = (n15 - e11) * o14 + (r16 - t18) * s10, l8 = (i16 - n15) * o14 + (a15 - r16) * s10, u7 = (i16 - e11) * s10 - (a15 - t18) * o14, d7 = c8 / u7, f7 = l8 / u7, p6 = Math.abs(u7) / (Math.hypot(o14, s10) * Math.abs(f7 - d7));
    return { x0: e11, x2: i16, scale: p6, cross: u7 };
  }
  subdivide(e11) {
    let t18 = this.mapToBasic(), n15 = o8(t18.x0), r16 = o8(t18.x2), i16 = 0.5 * Math.abs(r16 - n15) * Math.sqrt(t18.scale / e11), a15 = Math.ceil(i16), c8 = s5(n15), l8 = s5(r16), u7 = [0];
    for (let e12 = 1; e12 < a15; e12++) {
      let t19 = s5(n15 + (r16 - n15) * e12 / a15), i17 = (t19 - c8) / (l8 - c8);
      u7.push(i17);
    }
    return u7.push(1), u7.map((e12) => this.eval(e12));
  }
};
var l5 = class e7 {
  constructor(e11) {
    r(this, `c`, void 0), this.c = e11;
  }
  weightsum(e11, t18, n15, r16) {
    let i16 = e11 * this.c[0] + t18 * this.c[2] + n15 * this.c[4] + r16 * this.c[6], a15 = e11 * this.c[1] + t18 * this.c[3] + n15 * this.c[5] + r16 * this.c[7];
    return { x: i16, y: a15 };
  }
  eval(e11) {
    let t18 = 1 - e11, n15 = t18 * t18 * t18, r16 = 3 * t18 * t18 * e11, i16 = 3 * t18 * e11 * e11, a15 = e11 * e11 * e11;
    return this.weightsum(n15, r16, i16, a15);
  }
  deriv(e11) {
    let t18 = 1 - e11, n15 = -3 * t18 * t18, r16 = 3 * e11 * e11, i16 = -6 * e11 * t18 - n15, a15 = 6 * e11 * t18 - r16;
    return this.weightsum(n15, i16, a15, r16);
  }
  midpoint_quadbez() {
    let e11 = this.weightsum(-0.25, 0.75, 0.75, -0.25);
    return new c5({ x: this.c[0], y: this.c[1] }, e11, { x: this.c[6], y: this.c[7] });
  }
  subsegment(t18, n15) {
    let r16 = new Float64Array(8), i16 = this.eval(t18), a15 = this.eval(n15);
    r16[0] = i16.x, r16[1] = i16.y;
    let o14 = (n15 - t18) / 3, s10 = this.deriv(t18);
    r16[2] = i16.x + o14 * s10.x, r16[3] = i16.y + o14 * s10.y;
    let c8 = this.deriv(n15);
    return r16[4] = a15.x - o14 * c8.x, r16[5] = a15.y - o14 * c8.y, r16[6] = a15.x, r16[7] = a15.y, new e7(r16);
  }
  subdivide(e11) {
    let t18 = 0.1 * e11, n15 = e11 - t18, r16 = Math.sqrt(n15), i16 = a9(this.weightsum(1, -3, 3, -1)), c8 = Math.ceil((i16 / (432 * t18 * t18)) ** (1 / 6)), l8 = [], u7 = 0;
    for (let e12 = 0; e12 < c8; e12++) {
      let t19 = e12 / c8, n16 = (e12 + 1) / c8, i17 = this.subsegment(t19, n16).midpoint_quadbez(), a15 = i17.mapToBasic(), s10 = o8(a15.x0), d8 = o8(a15.x2), f8 = Math.sqrt(a15.scale), p7 = Math.abs(d8 - s10) * f8;
      if (Math.sign(a15.x0) != Math.sign(a15.x2)) {
        let e13 = r16 / f8, t20 = r16 * Math.abs(d8 - s10) / o8(e13);
        p7 = Math.max(p7, t20);
      }
      l8.push({ quad: i17, a0: s10, a2: d8, val: p7 }), u7 += p7;
    }
    let d7 = 0.5 * u7 / r16, f7 = Math.ceil(d7), p6 = [{ x: this.c[0], y: this.c[1] }], m6 = 0, h8 = 0;
    for (let e12 = 1; e12 < f7; e12++) {
      let t19 = u7 * e12 / f7;
      for (; m6 + l8[h8].val < t19; ) m6 += l8[h8].val, h8++;
      let n16 = l8[h8].a0, r17 = l8[h8].a2, i17 = s5(n16), a15 = s5(r17), o14 = n16 + (r17 - n16) * (t19 - m6) / l8[h8].val, c9 = s5(o14), d8 = (c9 - i17) / (a15 - i17);
      p6.push(l8[h8].quad.eval(d8));
    }
    return p6.push({ x: this.c[6], y: this.c[7] }), p6;
  }
};
function u4(e11) {
  let t18 = {}, n15 = e11.replace(/\/\*[\s\S]*?\*\//g, ``).replace(/\s+/g, ` `).trim(), r16 = /([^{]+)\{([^}]+)\}/g, i16;
  for (; (i16 = r16.exec(n15)) !== null; ) {
    let e12 = i16[1].trim(), n16 = i16[2].trim(), r17 = e12.match(/\.([a-zA-Z0-9_-]+)/);
    if (!r17) continue;
    let a15 = r17[1], o14 = n16.split(`;`).filter((e13) => e13.trim()), s10 = {};
    for (let e13 of o14) {
      let [t19, n17] = e13.split(`:`).map((e14) => e14.trim());
      if (!t19 || !n17) continue;
      switch (t19) {
        case `background-color`:
          s10.backgroundColor = n17;
          break;
        case `opacity`:
          s10.opacity = parseFloat(n17);
          break;
        case `box-shadow`:
          s10.boxShadow = n17;
          break;
        case `border-color`:
          s10.borderColor = n17;
          break;
        case `border-width`:
          s10.borderWidth = n17;
          break;
        case `border-style`:
          s10.borderStyle = n17;
          break;
        case `outline-color`:
          s10.outlineColor = n17;
          break;
        case `outline-width`:
          s10.outlineWidth = n17;
          break;
        case `outline-offset`:
          s10.outlineOffset = n17;
          break;
        case `outline-style`:
          s10.outlineStyle = n17;
          break;
        case `border`:
          s10.border = n17;
          break;
        case `outline`:
          s10.outline = n17;
          break;
        case `background`:
          s10.background = n17;
          break;
      }
    }
    t18[a15] = s10;
  }
  return t18;
}
function d4(e11) {
  let t18 = {};
  return e11 ? (e11.fill && (t18.backgroundColor = e11.fill, e11.fillOpacity), e11.stroke && (t18.borderColor = e11.stroke), e11.strokeWidth && (t18.borderWidth = e11.strokeWidth), t18) : t18;
}
var f4 = /* @__PURE__ */ new Map();
function p4(e11, t18) {
  if (f4.has(e11)) return f4.get(e11);
  let n15 = u4(t18);
  return f4.set(e11, Object.fromEntries(Object.entries(n15).map(([e12, t19]) => [e12, t19]))), n15;
}
function m4(e11, t18, n15 = {}) {
  if (!e11 || !t18) return d4(n15 || {});
  let r16 = d4(n15 || {}), i16 = Object.entries(t18);
  for (let [t19, n16] of i16) {
    if (!n16) continue;
    let i17 = p4(t19, n16), a15 = Object.entries(i17);
    for (let [t20, n17] of a15) t20 === e11 && Object.assign(r16, n17);
  }
  return r16;
}
var h5 = /* @__PURE__ */ (function() {
  function e11(e12, t18) {
    var n15 = [], r16 = true, i16 = false, a15 = void 0;
    try {
      for (var o14 = e12[Symbol.iterator](), s10; !(r16 = (s10 = o14.next()).done) && (n15.push(s10.value), !(t18 && n15.length === t18)); r16 = true) ;
    } catch (e13) {
      i16 = true, a15 = e13;
    } finally {
      try {
        !r16 && o14.return && o14.return();
      } finally {
        if (i16) throw a15;
      }
    }
    return n15;
  }
  return function(t18, n15) {
    if (Array.isArray(t18)) return t18;
    if (Symbol.iterator in Object(t18)) return e11(t18, n15);
    throw TypeError(`Invalid attempt to destructure non-iterable instance`);
  };
})();
var g5 = Math.PI * 2;
var _5 = function(e11, t18, n15, r16, i16, a15, o14) {
  var s10 = e11.x, c8 = e11.y;
  s10 *= t18, c8 *= n15;
  var l8 = r16 * s10 - i16 * c8, u7 = i16 * s10 + r16 * c8;
  return { x: l8 + a15, y: u7 + o14 };
};
var v5 = function(e11, t18) {
  var n15 = t18 === 1.5707963267948966 ? 0.551915024494 : t18 === -1.5707963267948966 ? -0.551915024494 : 4 / 3 * Math.tan(t18 / 4), r16 = Math.cos(e11), i16 = Math.sin(e11), a15 = Math.cos(e11 + t18), o14 = Math.sin(e11 + t18);
  return [{ x: r16 - i16 * n15, y: i16 + r16 * n15 }, { x: a15 + o14 * n15, y: o14 - a15 * n15 }, { x: a15, y: o14 }];
};
var y5 = function(e11, t18, n15, r16) {
  var i16 = e11 * r16 - t18 * n15 < 0 ? -1 : 1, a15 = e11 * n15 + t18 * r16;
  return a15 > 1 && (a15 = 1), a15 < -1 && (a15 = -1), i16 * Math.acos(a15);
};
var b5 = function(e11, t18, n15, r16, i16, a15, o14, s10, c8, l8, u7, d7) {
  var f7 = i16 ** 2, p6 = a15 ** 2, m6 = u7 ** 2, h8 = d7 ** 2, _9 = f7 * p6 - f7 * h8 - p6 * m6;
  _9 < 0 && (_9 = 0), _9 /= f7 * h8 + p6 * m6, _9 = Math.sqrt(_9) * (o14 === s10 ? -1 : 1);
  var v9 = _9 * i16 / a15 * d7, b9 = _9 * -a15 / i16 * u7, x9 = l8 * v9 - c8 * b9 + (e11 + n15) / 2, S8 = c8 * v9 + l8 * b9 + (t18 + r16) / 2, C8 = (u7 - v9) / i16, w8 = (d7 - b9) / a15, T8 = (-u7 - v9) / i16, E8 = (-d7 - b9) / a15, D8 = y5(1, 0, C8, w8), O7 = y5(C8, w8, T8, E8);
  return s10 === 0 && O7 > 0 && (O7 -= g5), s10 === 1 && O7 < 0 && (O7 += g5), [x9, S8, D8, O7];
};
var x5 = function(e11) {
  var t18 = e11.px, n15 = e11.py, r16 = e11.cx, i16 = e11.cy, a15 = e11.rx, o14 = e11.ry, s10 = e11.xAxisRotation, c8 = s10 === void 0 ? 0 : s10, l8 = e11.largeArcFlag, u7 = l8 === void 0 ? 0 : l8, d7 = e11.sweepFlag, f7 = d7 === void 0 ? 0 : d7, p6 = [];
  if (a15 === 0 || o14 === 0) return [];
  var m6 = Math.sin(c8 * g5 / 360), y9 = Math.cos(c8 * g5 / 360), x9 = y9 * (t18 - r16) / 2 + m6 * (n15 - i16) / 2, S8 = -m6 * (t18 - r16) / 2 + y9 * (n15 - i16) / 2;
  if (x9 === 0 && S8 === 0) return [];
  a15 = Math.abs(a15), o14 = Math.abs(o14);
  var C8 = x9 ** 2 / a15 ** 2 + S8 ** 2 / o14 ** 2;
  C8 > 1 && (a15 *= Math.sqrt(C8), o14 *= Math.sqrt(C8));
  var w8 = b5(t18, n15, r16, i16, a15, o14, u7, f7, m6, y9, x9, S8), T8 = h5(w8, 4), E8 = T8[0], D8 = T8[1], O7 = T8[2], k7 = T8[3], A7 = Math.abs(k7) / (g5 / 4);
  Math.abs(1 - A7) < 1e-7 && (A7 = 1);
  var j8 = Math.max(Math.ceil(A7), 1);
  k7 /= j8;
  for (var M7 = 0; M7 < j8; M7++) p6.push(v5(O7, k7)), O7 += k7;
  return p6.map(function(e12) {
    var t19 = _5(e12[0], a15, o14, y9, m6, E8, D8), n16 = t19.x, r17 = t19.y, i17 = _5(e12[1], a15, o14, y9, m6, E8, D8), s11 = i17.x, c9 = i17.y, l9 = _5(e12[2], a15, o14, y9, m6, E8, D8), u8 = l9.x, d8 = l9.y;
    return { x1: n16, y1: r17, x2: s11, y2: c9, x: u8, y: d8 };
  });
};
var S5 = x5;
var C5 = o7(((exports, t18) => {
  t18.exports = i16;
  var n15 = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 }, r16 = /([astvzqmhlc])([^astvzqmhlc]*)/gi;
  function i16(e11) {
    var t19 = [];
    return e11.replace(r16, function(e12, r17, i17) {
      var a16 = r17.toLowerCase();
      for (i17 = o14(i17), a16 == `m` && i17.length > 2 && (t19.push([r17].concat(i17.splice(0, 2))), a16 = `l`, r17 = r17 == `m` ? `l` : `L`); ; ) {
        if (i17.length == n15[a16]) return i17.unshift(r17), t19.push(i17);
        if (i17.length < n15[a16]) throw Error(`malformed path data`);
        t19.push([r17].concat(i17.splice(0, n15[a16])));
      }
    }), t19;
  }
  var a15 = /-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;
  function o14(e11) {
    var t19 = e11.match(a15);
    return t19 ? t19.map(Number) : [];
  }
}));
var w5 = o7(((exports, t18) => {
  t18.exports = n15;
  function n15(e11) {
    var t19 = 0, n16 = 0, r16 = 0, i16 = 0;
    return e11.map(function(e12) {
      e12 = e12.slice();
      var a15 = e12[0], o14 = a15.toUpperCase();
      if (a15 != o14) switch (e12[0] = o14, a15) {
        case `a`:
          e12[6] += r16, e12[7] += i16;
          break;
        case `v`:
          e12[1] += i16;
          break;
        case `h`:
          e12[1] += r16;
          break;
        default:
          for (var s10 = 1; s10 < e12.length; ) e12[s10++] += r16, e12[s10++] += i16;
      }
      switch (o14) {
        case `Z`:
          r16 = t19, i16 = n16;
          break;
        case `H`:
          r16 = e12[1];
          break;
        case `V`:
          i16 = e12[1];
          break;
        case `M`:
          r16 = t19 = e12[1], i16 = n16 = e12[2];
          break;
        default:
          r16 = e12[e12.length - 2], i16 = e12[e12.length - 1];
      }
      return e12;
    });
  }
}));
var T5 = l4(C5(), 1);
var E5 = l4(w5(), 1);
function D5(e11) {
  let t18 = (0, T5.default)(e11), n15 = (0, E5.default)(t18), r16, i16 = 0, a15 = 0, o14 = 0, s10 = 0, c8, l8, u7 = 0, d7 = 0, f7 = [];
  for (let e12 = 0; e12 < n15.length; e12++) {
    let t19 = n15[e12], p6 = t19[0];
    switch (p6) {
      case `M`:
        i16 = t19[1], a15 = t19[2];
        break;
      case `H`:
        t19 = [`L`, t19[1], a15];
        break;
      case `V`:
        t19 = [`L`, i16, t19[1]];
        break;
      case `S`:
        {
          let e13 = u7, n16 = d7;
          (r16 === `C` || r16 == `S`) && (e13 += e13 - o14, n16 += n16 - s10), t19 = [`C`, e13, n16, t19[1], t19[2], t19[3], t19[4]];
        }
        break;
      case `T`:
        r16 === `Q` || r16 == `T` ? (c8 = u7 * 2 - c8, l8 = d7 * 2 - l8) : (c8 = u7, l8 = d7), t19 = [`Q`, c8, l8, t19[1], t19[2]];
        break;
      case `Q`:
        c8 = t19[1], l8 = t19[2];
        break;
      case `A`:
        {
          let e13 = S5({ px: u7, py: d7, cx: t19[6], cy: t19[7], rx: t19[1], ry: t19[2], xAxisRotation: t19[3], largeArcFlag: t19[4], sweepFlag: t19[5] });
          if (!e13.length) continue;
          for (let [n16, r17] of e13.entries()) t19 = [`C`, r17.x1, r17.y1, r17.x2, r17.y2, r17.x, r17.y], n16 < e13.length - 1 && f7.push(t19);
          t19 = t19;
        }
        break;
      case `Z`:
        t19 = [`L`, i16, a15];
        break;
    }
    r16 = p6, u7 = t19[t19.length - 2], d7 = t19[t19.length - 1], [`C`, `Q`, `A`].indexOf(p6) > -1 ? (o14 = t19[t19.length - 4], s10 = t19[t19.length - 3]) : (o14 = u7, s10 = d7), f7.push(t19);
  }
  return f7;
}
var O5 = /&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?)/;
var k5 = /&?(t=)(npt:)?([0-9]+(\.[0-9]+)?)?(,([0-9]+(\.[0-9]+)?))?/;
var A5 = /^rgba\((\d+),(\d+),(\d+),([0-9.]+)\)$/;
function j5(e11, { domParser: t18, svgPreprocessor: n15, iiifRenderingHints: r16, loadedStylesheets: i16 } = {}, { styleClass: a15 } = {}) {
  if (Array.isArray(e11)) return L5(e11.reduce((e12, i17) => {
    let { selector: o14, selectors: s10, iiifRenderingHints: c8 } = j5(i17, { domParser: t18, svgPreprocessor: n15, iiifRenderingHints: r16 }, { styleClass: a15 });
    return o14 && (e12.selector ? (!e12.selector.temporal && o14.temporal && (e12.selector.temporal = o14.temporal), !e12.selector.spatial && o14.spatial && (e12.selector.spatial = o14.spatial), !e12.selector.svg && o14.svg && (e12.selector.svg = o14.svg), !e12.selector.svgShape && o14.svgShape && (e12.selector.svgShape = o14.svgShape)) : e12.selector = o14, e12.selectors.push(...s10)), c8 && (e12.iiifRenderingHints = e12.iiifRenderingHints || { type: `ImageApiSelector` }, Object.assign(e12.iiifRenderingHints, c8)), e12;
  }, { selector: null, selectors: [], iiifRenderingHints: r16 }));
  if (!e11) return L5({ selector: null, selectors: [], iiifRenderingHints: r16 });
  if (typeof e11 == `string`) {
    let [i17, o14] = e11.split(`#`);
    return o14 ? j5({ type: `FragmentSelector`, value: o14 }, { svgPreprocessor: n15, iiifRenderingHints: r16, domParser: t18 }, { styleClass: a15 }) : L5({ selector: null, selectors: [], iiifRenderingHints: r16 });
  }
  if (e11.type) {
    if (e11.type === `PointSelector` && (e11.t || e11.t === 0)) {
      let t19 = { type: `TemporalSelector`, temporal: { startTime: e11.t } };
      return L5({ selector: t19, selectors: [t19], iiifRenderingHints: r16 });
    }
    if (e11.type === `PointSelector` && e11.x && e11.y) {
      let t19 = { type: `PointSelector`, spatial: { x: e11.x, y: e11.y } };
      return L5({ selector: t19, selectors: [t19], iiifRenderingHints: r16 });
    }
  }
  if (I5(e11)) {
    let i17 = [];
    if (e11.region) {
      let o14 = j5({ type: `FragmentSelector`, value: `xywh=` + e11.region }, { domParser: t18, svgPreprocessor: n15, iiifRenderingHints: r16 }, { styleClass: a15 });
      i17.push(...o14.selectors);
    }
    return L5({ selector: i17[0], selectors: i17, iiifRenderingHints: r16 ? { ...r16, ...e11 } : e11 });
  }
  if (e11.type === `FragmentSelector`) {
    let t19 = O5.exec(e11.value);
    if (t19) {
      let n17 = { type: `BoxSelector`, spatial: { unit: t19[2] === `percent:` || t19[2] === `pct:` ? `percent` : `pixel`, x: Number.parseFloat(t19[3]), y: Number.parseFloat(t19[4]), width: Number.parseFloat(t19[5]), height: Number.parseFloat(t19[6]) }, boxStyle: m4(a15, i16) }, o14 = e11.value.match(k5);
      return o14 && (n17 = { type: `TemporalBoxSelector`, spatial: n17.spatial, temporal: { startTime: o14[3] ? Number.parseFloat(o14[3]) : 0, endTime: o14[6] ? Number.parseFloat(o14[6]) : void 0 }, boxStyle: m4(a15, i16) }), L5({ selector: n17, selectors: [n17], iiifRenderingHints: r16 });
    }
    let n16 = e11.value.match(k5);
    if (n16) {
      let e12 = { type: `TemporalSelector`, temporal: { startTime: n16[3] ? Number.parseFloat(n16[3]) : 0, endTime: n16[6] ? Number.parseFloat(n16[6]) : void 0 } };
      return L5({ selector: e12, selectors: [e12], iiifRenderingHints: r16 });
    }
    return L5({ selector: null, selectors: [], iiifRenderingHints: r16 });
  }
  if (e11.type === `SvgSelector` && `value` in e11) {
    t18 || (typeof window < `u` ? t18 = new window.DOMParser() : console.warn("No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized."));
    let o14 = [], s10, c8, l8 = (n15 == null ? void 0 : n15(e11.value)) ?? e11.value, u7;
    if (t18) {
      let n16 = t18.parseFromString(e11.value, `image/svg+xml`).querySelector(`svg`);
      if (!n16) return console.warn(`Illegal SVG selector: ${e11.value}`), L5({ selector: null, selectors: [], iiifRenderingHints: r16 });
      let i17 = N4(n16);
      i17 && (o14 = i17.points, u7 = i17.shapeType, s10 = [Math.min(...o14.map((e12) => e12[0])), Math.min(...o14.map((e12) => e12[1])), Math.max(...o14.map((e12) => e12[0])), Math.max(...o14.map((e12) => e12[1]))], { style: c8, svg: l8 } = F5(i17.element) ?? { svg: l8 });
    }
    let d7 = { type: `SvgSelector`, svg: l8, svgShape: u7, style: c8, boxStyle: m4(a15, i16, c8), points: o14.length ? o14 : void 0, spatial: s10 ? { unit: `pixel`, x: s10[0], y: s10[1], width: s10[2] - s10[0], height: s10[3] - s10[1] } : void 0 };
    return L5({ selector: d7, selectors: [d7], iiifRenderingHints: r16 });
  }
  return L5({ selector: null, selectors: [], iiifRenderingHints: r16 });
}
function M4(e11) {
  let t18 = e11.map((e12) => e12[0]).reduce((e12, t19) => (e12[t19] += 1, e12), { C: 0, Q: 0, L: 0, M: 0 }), n15 = new Set(e11.map((e12) => e12[0]));
  if (t18.C > 0 || t18.Q > 0) return `path`;
  if (t18.L > 0 && (n15.size === 1 || n15.size === 2 && n15.has(`M`))) {
    if (t18.L === 4) return `rect`;
    let n16 = e11.slice(-1)[0];
    return e11[0][0] === `M` && n16[0] === `L` && n16[1] == e11[0][1] && n16[2] === e11[0][2] || n16[1] === 0 && n16[2] === 0 ? `polygon` : `polyline`;
  }
  return `path`;
}
function N4(e11) {
  var _a;
  for (let t18 of Array.from(e11.children)) switch (t18 == null ? void 0 : t18.tagName.toLowerCase()) {
    case `g`:
      {
        let e12 = N4(t18);
        if (e12) return e12;
      }
      continue;
    case `path`: {
      let e12 = t18.getAttribute(`d`);
      if (!e12) continue;
      let n15 = D5(e12);
      return { element: t18, points: P5(n15), shapeType: M4(n15) };
    }
    case `circle`: {
      let e12 = Number.parseFloat(t18.getAttribute(`cx`) ?? `0`), n15 = Number.parseFloat(t18.getAttribute(`cy`) ?? `0`), r16 = Number.parseFloat(t18.getAttribute(`r`) ?? `0`);
      if (!r16) continue;
      let i16 = [];
      for (let t19 = 0; t19 <= 360; t19 += 12) {
        let a15 = t19 * Math.PI / 180;
        i16.push([e12 + r16 * Math.cos(a15), n15 + r16 * Math.sin(a15)]);
      }
      return { element: t18, points: i16, shapeType: `circle` };
    }
    case `ellipse`: {
      let e12 = Number.parseFloat(t18.getAttribute(`cx`) ?? `0`), n15 = Number.parseFloat(t18.getAttribute(`cy`) ?? `0`), r16 = Number.parseFloat(t18.getAttribute(`rx`) ?? `0`), i16 = Number.parseFloat(t18.getAttribute(`ry`) ?? `0`);
      if (!r16 && !i16) continue;
      let a15 = [];
      for (let t19 = 0; t19 <= 360; t19 += 12) {
        let o14 = Math.tan(t19 / 360 * Math.PI), s10 = r16 * (1 - o14 ** 2) / (1 + o14 ** 2), c8 = i16 * 2 * o14 / (1 + o14 ** 2);
        a15.push([e12 + s10, n15 + c8]);
      }
      return { element: t18, points: a15, shapeType: `ellipse` };
    }
    case `line`: {
      let e12 = Number.parseFloat(t18.getAttribute(`x0`) ?? `0`), n15 = Number.parseFloat(t18.getAttribute(`y0`) ?? `0`), r16 = Number.parseFloat(t18.getAttribute(`x1`) ?? `0`), i16 = Number.parseFloat(t18.getAttribute(`y1`) ?? `0`);
      if (e12 === r16 && n15 === i16) continue;
      return { element: t18, points: [[e12, n15], [r16, i16]], shapeType: `polyline` };
    }
    case `polygon`:
    case `polyline`: {
      let e12 = ((_a = t18.getAttribute(`points`)) == null ? void 0 : _a.split(` `).map((e13) => e13.split(`,`).map(Number.parseFloat))) ?? [];
      if (!e12.length) continue;
      let n15 = `polyline`;
      return t18.tagName.toLowerCase() === `polygon` && (e12.push(e12[0]), n15 = `polygon`), { element: t18, points: e12, shapeType: n15 };
    }
    case `rect`: {
      let e12 = Number.parseFloat(t18.getAttribute(`x`) ?? `0`), n15 = Number.parseFloat(t18.getAttribute(`y`) ?? `0`), r16 = Number.parseFloat(t18.getAttribute(`width`) ?? `0`), i16 = Number.parseFloat(t18.getAttribute(`height`) ?? `0`);
      if (!r16 || !i16) continue;
      return { element: t18, points: [[e12, n15], [e12 + r16, n15], [e12 + r16, n15 + i16], [e12, n15 + i16], [e12, n15]], shapeType: `rect` };
    }
    default:
      continue;
  }
  return null;
}
function P5(e11) {
  let t18 = [];
  for (let n15 = 0; n15 < e11.length; n15++) {
    let a15 = t18[t18.length - 1] ?? [0, 0], o14 = e11[n15];
    switch (o14[0]) {
      case `M`:
      case `L`:
        t18.push([o14[1], o14[2]]);
        continue;
      case `C`:
        t18.push(...i9({ x: a15[0], y: a15[1] }, { x: o14[1], y: o14[2] }, { x: o14[3], y: o14[4] }, { x: o14[5], y: o14[6] }).map((e12) => [e12.x, e12.y]).slice(1));
        continue;
      case `Q`:
        t18.push(...r9({ x: a15[0], y: a15[1] }, { x: o14[1], y: o14[2] }, { x: o14[3], y: o14[4] }).map((e12) => [e12.x, e12.y]).slice(1));
        continue;
    }
  }
  return t18;
}
function F5(e11) {
  let t18 = {};
  if (e11.hasAttribute(`fill`) ? (t18.fill = e11.getAttribute(`fill`), e11.removeAttribute(`fill`)) : e11.style && e11.style.fill && (t18.fill = e11.style.fill), t18.fill) {
    let e12 = A5.exec(t18.fill);
    e12 && (t18.fillOpacity = Number.parseFloat(e12[4]), t18.fill = `rgb(${e12[1]}, ${e12[2]}, ${e12[3]})`);
  }
  if (e11.hasAttribute(`fill-opacity`) ? (t18.fillOpacity = Number.parseFloat(e11.getAttribute(`fill-opacity`)), e11.removeAttribute(`fill-opacity`)) : e11.style && e11.style.fillOpacity && (t18.fillOpacity = Number.parseFloat(e11.style.fillOpacity)), e11.hasAttribute(`stroke`) ? (t18.stroke = e11.getAttribute(`stroke`), e11.removeAttribute(`stroke`)) : e11.style && e11.style.stroke && (t18.stroke = e11.style.stroke), t18.stroke) {
    let e12 = A5.exec(t18.stroke);
    e12 && (t18.strokeOpacity = Number.parseFloat(e12[4]), t18.stroke = `rgb(${e12[1]}, ${e12[2]}, ${e12[3]})`);
  }
  e11.hasAttribute(`stroke-opacity`) ? (t18.strokeOpacity = Number.parseFloat(e11.getAttribute(`stroke-opacity`)), e11.removeAttribute(`stroke-opacity`)) : e11.style && e11.style.strokeOpacity && (t18.strokeOpacity = Number.parseFloat(e11.style.strokeOpacity)), e11.hasAttribute(`stroke-width`) ? (t18.strokeWidth = e11.getAttribute(`stroke-width`), e11.removeAttribute(`stroke-width`)) : e11.style && e11.style.strokeWidth && (t18.strokeWidth = e11.style.strokeWidth), e11.hasAttribute(`stroke-dasharray`) ? (t18.strokeDasharray = e11.getAttribute(`stroke-dasharray`), e11.removeAttribute(`stroke-dasharray`)) : e11.style && e11.style.strokeDasharray && (t18.strokeDasharray = e11.style.strokeDasharray);
  let n15 = e11;
  for (; n15.tagName.toLowerCase() !== `svg`; ) if (n15 = n15.parentElement, n15 === null) throw Error(`Could not find root SVG element`);
  return { svg: n15.outerHTML, style: Object.keys(t18).length > 0 ? t18 : void 0 };
}
function I5(e11) {
  if (!e11) return false;
  let t18 = e11.type || e11[`@type`];
  return t18 === `iiif:ImageApiSelector` || t18 === `ImageApiSelector`;
}
function L5(e11) {
  if (e11.iiifRenderingHints) {
    let t18 = e11.iiifRenderingHints;
    if (t18.rotation) {
      let n15 = R5(`${t18.rotation}`);
      if (n15) if (e11.selectors.length) for (let t19 of e11.selectors) t19.rotation = n15;
      else e11.selectors.push({ type: `RotationSelector`, rotation: n15 });
    }
  } else delete e11.iiifRenderingHints;
  return e11;
}
function R5(e11) {
  let t18 = Number.parseFloat(e11);
  return t18 && e11.startsWith(`!`) && (t18 = 360 - t18), t18 && (t18 %= 360), t18 === t18 && t18 || 0;
}
function z4(e11, t18 = {}) {
  if (Array.isArray(e11)) return z4(e11[0]);
  if (typeof e11 == `string`) {
    let [n15, r16] = e11.split(`#`);
    return r16 ? z4({ type: `SpecificResource`, source: { id: n15, type: t18.typeMap && t18.typeMap[n15] || t18.defaultType || `Canvas` }, selector: { type: `FragmentSelector`, value: r16 } }, t18) : { type: `SpecificResource`, source: { id: n15, type: t18.typeMap && t18.typeMap[n15] || t18.defaultType || `Canvas` }, selector: null, selectors: [] };
  }
  if (e11.type === `Choice` || e11.type === `List` || e11.type === `Composite` || e11.type === `Independents`) return z4(e11.items[0], t18);
  if (!e11.type && `source` in e11 && (e11.type = `SpecificResource`), e11.type === `SpecificResource`) {
    e11.source.type === `Canvas` && e11.source.partOf && typeof e11.source.partOf == `string` && (e11.source.partOf = [{ id: e11.source.partOf, type: `Manifest` }]);
    let n15 = e11.styleClass || t18.styleClass, r16 = { selector: null, selectors: [] };
    if (typeof e11.source == `string` && e11.source.includes(`#`)) {
      let i17 = z4(e11.source, { ...t18, styleClass: n15 });
      e11.source = i17.source, r16 = { selector: i17.selector, selectors: i17.selectors };
    }
    let { selector: i16, selectors: a15 } = e11.selector ? j5(e11.selector, t18, { styleClass: n15 }) : r16;
    return { type: `SpecificResource`, source: e11.source, selector: i16, selectors: a15 };
  }
  if (e11.id) {
    e11.type === `Canvas` && e11.partOf && typeof e11.partOf == `string` && (e11.partOf = [{ id: e11.partOf, type: `Manifest` }]);
    let [n15, r16] = e11.id.split(`#`);
    return r16 ? z4({ type: `SpecificResource`, source: { ...e11, id: n15 }, selector: { type: `FragmentSelector`, value: r16 } }, t18) : { type: `SpecificResource`, source: { ...e11, id: n15 }, selector: null, selectors: [] };
  }
  return { type: `SpecificResource`, source: e11, selector: null, selectors: [] };
}

// node_modules/@iiif/helpers/dist/content-state-DHk1Ajip.js
function t11(e11, n15 = false) {
  if (typeof e11 == `string`) {
    if (e11.startsWith(`{`)) try {
      let n16 = JSON.parse(e11);
      return t11(n16);
    } catch {
      return [false, { reason: `Invalid JSON` }];
    }
    return [true];
  }
  if (Array.isArray(e11)) {
    for (let n16 of e11) {
      let [e12, r16] = t11(n16);
      if (!e12 && r16) return [e12, r16];
    }
    return [true];
  }
  return e11.type === `Annotation` ? [true] : n15 && e11.type === `Canvas` && !e11.partOf ? [false, { reason: `Canvas without partOf cannot be loaded` }] : [true];
}
function n7(e11) {
  return i10(typeof e11 == `string` ? e11 : JSON.stringify(e11));
}
function r10(e11, t18) {
  if (e11 = e11.trim(), e11[0] === `{`) return t18 ? Promise.resolve(JSON.parse(e11)) : JSON.parse(e11);
  if (e11.startsWith(`http`)) {
    if (!t18) throw Error(`Cannot fetch remote fetch with async=false in parseContentState`);
    return fetch(e11).then((e12) => e12.json());
  }
  return r10(a10(e11), t18);
}
function i10(e11) {
  let t18 = encodeURIComponent(e11), n15 = typeof btoa > `u` ? Buffer.from(t18, `utf-8`).toString(`base64`) : btoa(t18), r16 = n15.replace(/\+/g, `-`).replace(/\//g, `_`);
  return r16.replace(/=/g, ``);
}
function a10(e11) {
  let t18 = o9(e11), n15 = t18.replace(/-/g, `+`).replace(/_/g, `/`), r16 = typeof atob > `u` ? Buffer.from(n15, `base64`).toString(`utf-8`) : atob(n15);
  return decodeURIComponent(r16).trim();
}
function o9(e11) {
  let t18 = e11.length % 4;
  if (t18 === 1) throw Error(`InvalidLengthError: Input base64url string is the wrong length to determine padding`);
  return e11 + (t18 ? `====`.slice(0, 4 - t18) : ``);
}
function s6(t18) {
  if (!t18) throw Error(`Content state is empty`);
  Array.isArray(t18) || (t18 = [t18]);
  let n15 = `vault://virtual-annotation/` + (/* @__PURE__ */ new Date()).getTime(), r16 = [`contentState`], i16 = [];
  for (let a15 of t18) {
    if (typeof a15 == `string`) throw Error(`Content state is a [String] type and cannot be inferred`);
    if (a15.type === `Annotation`) {
      if (n15 = a15.id, Array.isArray(a15.motivation)) for (let e11 of a15.motivation) r16.indexOf(e11) === -1 && r16.push(e11);
      if (Array.isArray(a15.target)) for (let t20 of a15.target) {
        let n16 = z4(t20);
        i16.push(n16);
      }
      else {
        let t20 = z4(a15.target);
        i16.push(t20);
      }
      continue;
    }
    let t19 = z4(a15);
    i16.push(t19);
  }
  return { id: n15, type: `Annotation`, motivation: [`contentState`, ...t18.motivation || []], target: i16, extensions: {} };
}

// node_modules/@iiif/helpers/dist/ranges-CDE4cufJ.js
function n8(e11) {
  let t18 = JSON.stringify(e11), n15 = 5381, r16 = t18.length;
  for (; r16; ) n15 = n15 * 33 ^ t18.charCodeAt(--r16);
  let i16 = n15 >>> 0, a15 = i16.toString(16);
  return a15.length % 2 ? `0` + a15 : a15;
}
function r11(t18 = t) {
  return { findFirstCanvasFromRange: (e11) => i11(t18, e11), findAllCanvasesInRange: (e11) => o10(t18, e11), findManifestSelectedRange: (e11, n15) => s7(t18, e11, n15), findSelectedRange: (e11, n15) => c6(t18, e11, n15), rangesToTableOfContentsTree: (e11, n15, r16 = {}) => l6(t18, e11, n15, r16), rangeToTableOfContentsTree: (e11, n15 = {}) => u5(t18, e11, [], n15), isContiguous: (e11, n15, r16 = {}) => f5(t18, e11, n15, r16) };
}
function i11(e11, t18) {
  var _a;
  for (let n15 of t18.items) {
    if (typeof n15 == `string`) return { id: n15, type: `Canvas` };
    if (n15.type === `Canvas`) return n15;
    if (n15.type === `SpecificResource` && ((_a = n15.source) == null ? void 0 : _a.type) === `Canvas`) return n15.source;
    if (n15.type === `Range`) {
      let t19 = i11(e11, e11.get(n15));
      if (t19) return t19;
    }
  }
  return null;
}
function a11(e11, t18) {
  var _a;
  for (let n15 of t18.items) {
    if (typeof n15 == `string`) return { type: `SpecificResource`, source: { id: n15, type: `Canvas` } };
    if (n15.type === `Canvas`) return { type: `SpecificResource`, source: n15 };
    if (n15.type === `SpecificResource` && ((_a = n15.source) == null ? void 0 : _a.type) === `Canvas`) return n15;
    if (n15.type === `Range`) {
      let t19 = a11(e11, e11.get(n15));
      if (t19) return t19;
    }
  }
  return null;
}
function o10(e11, t18) {
  var _a;
  let n15 = [];
  for (let r16 of t18.items) if (r16.type === `SpecificResource` && ((_a = r16.source) == null ? void 0 : _a.type) === `Canvas` && (r16.source.id.indexOf(`#`) === -1 ? n15.push(r16.source) : n15.push({ id: r16.source.id.split(`#`)[0], type: `Canvas` })), r16.type === `Range` && n15.push(...o10(e11, e11.get(r16))), r16.type === `SpecificResource`) {
    let e12 = typeof r16.source == `string` ? r16.source : r16.source.id;
    n15.push({ id: e12, type: `Canvas` });
  }
  return n15;
}
function s7(e11, t18, n15) {
  for (let r16 of t18.structures) {
    let t19 = c6(e11, e11.get(r16), n15);
    if (t19) return t19;
  }
  return null;
}
function c6(e11, t18, n15) {
  var _a, _b, _c;
  for (let r16 of t18.items) {
    let i16 = (_b = (_a = r16 == null ? void 0 : r16.source) == null ? void 0 : _a.id) == null ? void 0 : _b.split(`#`)[0];
    if (r16.type === `SpecificResource` && r16.source === n15 || r16.type === `SpecificResource` && ((_c = r16.source) == null ? void 0 : _c.type) === `Canvas` && n15 === i16) return t18;
    if (r16.type === `Range`) {
      let t19 = c6(e11, e11.get(r16), n15);
      if (t19) return t19;
    }
  }
  return null;
}
function l6(e11, t18, r16, i16 = {}) {
  if (t18.length === 0) return null;
  let a15 = e11.get(t18);
  if (a15.length === 1) return u5(e11, a15[0], [], i16);
  let o14 = { id: `vault://virtual-root/${n8(a15)}`, type: `Range`, label: r16 || { en: [`Table of Contents`] }, items: a15 };
  return u5(e11, o14, [], i16);
}
function u5(e11, r16, i16 = [], o14 = {}) {
  var _a;
  if (!r16) return null;
  let s10 = e11.get(r16, { skipSelfReturn: false }), c8 = { id: s10.id, type: `Range`, label: s10.label, untitled: !s10.label, isCanvasLeaf: false, isRangeLeaf: false, isVirtual: s10.id.startsWith(`vault://virtual-root/`), items: [] };
  if (i16.indexOf(c8.id) !== -1 && (c8.id = `vault://${n8(s10)}`), s10.behavior && s10.behavior.includes(`no-nav`)) if (o14.showNoNav) c8.isNoNav = true;
  else return null;
  if (!s10.items) return c8;
  for (let r17 of s10.items) {
    if (typeof r17 == `string`) {
      let t18 = e11.get({ id: r17, type: `Canvas` }, { skipSelfReturn: false }), a15 = { id: r17, type: `Canvas`, isCanvasLeaf: true, isRangeLeaf: false, isNoNav: s10.behavior && s10.behavior.includes(`no-nav`), label: t18.label || { none: [`Untitled`] }, untitled: !t18.label, resource: { type: `SpecificResource`, source: { id: r17, type: `Canvas` } } };
      i16.indexOf(a15.id) !== -1 && (a15.id = `vault://${n8(r17)}`), i16.push(a15.id), c8.items.push(a15);
      continue;
    }
    if (r17.type === `SpecificResource` && ((_a = r17.source) == null ? void 0 : _a.type) === `Canvas`) {
      let a15 = e11.get(r17.source), o15 = z3(r17);
      if (!a15) continue;
      let s11 = { id: o15.type === `Canvas` ? o15.id : r17.source.id, type: `Canvas`, isCanvasLeaf: true, isRangeLeaf: false, label: a15.label || { none: [`Untitled`] }, untitled: !a15.label, resource: r17 };
      i16.indexOf(s11.id) !== -1 && (s11.id = `vault://${n8(r17)}`), i16.push(s11.id), c8.items.push(s11);
      continue;
    }
    if (r17.type === `Canvas`) {
      let e12 = { id: r17.id, type: `Canvas`, label: r17.label, isCanvasLeaf: true, isRangeLeaf: false, resource: { type: `SpecificResource`, source: r17 } };
      i16.indexOf(e12.id) !== -1 && (e12.id = `vault://${n8(r17)}`), i16.push(e12.id), c8.items.push(e12);
      continue;
    }
    if (r17.type === `Range`) {
      let t18 = u5(e11, r17, i16, o14);
      t18 && c8.items.push(t18);
    }
  }
  return c8.firstCanvas = a11(e11, s10), c8.isRangeLeaf = c8.items ? c8.items.filter((e12) => e12.type === `Range`).length === 0 : true, c8;
}
function d5(e11, t18, n15 = []) {
  let r16 = e11.get(t18), i16 = [], a15 = r16.id ? [...n15, r16.id] : n15;
  if (!r16.items) return i16;
  for (let t19 of r16.items) if (typeof t19 == `string`) i16.push({ canvas: { id: t19, type: `Canvas` }, path: a15 });
  else if (t19.type === `SpecificResource`) {
    let e12 = t19.source;
    (e12 == null ? void 0 : e12.type) === `Canvas` && i16.push({ canvas: e12, path: a15 });
  } else t19.type === `Range` && i16.push(...d5(e11, t19, a15));
  return i16;
}
function f5(e11, t18, n15, r16 = {}) {
  let i16 = n15.map((t19) => e11.get(t19, { skipSelfReturn: false })), a15 = e11.get(t18), o14 = i16.map((e12) => e12.id), s10 = d5(e11, a15), c8 = { isContiguous: true, startIndex: -1, endIndex: -1, gaps: [], invalidRanges: [], invalidCanvases: [], reason: null };
  if (s10.length === 0) return r16.detail ? [true, c8] : [true, null];
  let l8 = s10.map(({ canvas: e12 }) => o14.indexOf(e12.id)), u7 = true, f7 = -1, p6 = /* @__PURE__ */ new Map(), m6 = (e12, t19) => {
    p6.has(e12) || p6.set(e12, []);
    let n16 = p6.get(e12);
    n16.includes(t19) || n16.push(t19);
  };
  for (let e12 = 0; e12 < l8.length; e12++) {
    let t19 = l8[e12], n16 = s10[e12], i17 = n16.path[n16.path.length - 1];
    if (t19 === -1) {
      u7 = false, i17 && m6(i17, `Canvas not found`), c8.invalidCanvases.push(n16.canvas.id);
      continue;
    }
    if (e12 > 0 && f7 !== -1) if (t19 <= f7) u7 = false, i17 && m6(i17, `Canvas out of order`);
    else {
      let e13 = t19 - f7;
      e13 > 1 && (r16.allowGaps || (u7 = false), r16.detail && c8.gaps.push({ startIndex: f7, endIndex: t19, canvasIds: o14.slice(f7 + 1, t19) })), f7 = t19;
    }
    else f7 = t19;
  }
  if (!r16.allowSubset) if (s10.length !== o14.length) u7 = false;
  else {
    let e12 = o14.every((e13) => s10.some((t19) => t19.canvas.id === e13));
    e12 || (u7 = false);
  }
  if (!r16.detail) return [u7, null];
  let h8 = Array.from(p6.keys());
  h8.length > 0 && (c8.invalidRanges = h8.map((e12) => ({ id: e12, reasons: p6.get(e12) || [] })));
  let g9 = { ...c8, isContiguous: u7 }, _9 = l8.filter((e12) => e12 !== -1);
  return _9.length > 0 && (g9.startIndex = _9[0], g9.endIndex = _9[_9.length - 1]), [u7, g9];
}

// node_modules/@iiif/helpers/dist/sequences-DtbSBPtk.js
function n9(t18 = t) {
  return { getVisibleCanvasesFromCanvasId: (e11, n15, i16 = false) => r12(t18, e11, n15, i16), getManifestSequence: (e11, n15 = {}) => i12(t18, e11, n15) };
}
function r12(t18 = t, n15, r16, a15 = false) {
  let o14 = n15.behavior || [], s10 = r16 ? t18.get(r16) : null;
  if (!s10) return [];
  let c8 = s10.behavior || [], l8 = a15 ? false : o14.includes(`paged`), u7 = l8 ? false : o14.includes(`continuous`), d7 = l8 || u7 ? false : o14.includes(`individuals`), f7 = c8.includes(`facing-pages`), p6 = c8.includes(`non-paged`);
  if (f7 || p6 || d7 || a15) return [{ id: s10.id, type: `Canvas` }];
  let [m6, h8] = i12(t18, n15);
  if (u7) return m6;
  let g9 = m6.findIndex((e11) => e11.id === r16);
  if (g9 === -1) return [];
  for (let e11 of h8) if (e11.includes(g9)) return e11.map((e12) => m6[e12]);
  return [{ id: s10.id, type: `Canvas` }];
}
function i12(n15 = t, r16, { disablePaging: i16, skipNonPaged: a15 } = {}) {
  let o14 = r16.behavior || [], s10 = o14.includes(`paged`), c8 = s10 ? false : o14.includes(`continuous`), l8 = s10 || c8 ? false : o14.includes(`individuals`), u7 = r16.type === `Manifest` ? r16.items : o10(n15, r16);
  if (c8) return [u7, [u7.map((e11, t18) => t18)]];
  if (l8 || !s10 || i16) return [u7, u7.map((e11, t18) => [t18])];
  let d7 = [], f7 = [], p6 = () => {
    f7.length && (d7.push([...f7]), f7 = []);
  }, m6 = 0, h8 = false;
  for (let e11 = 0; e11 < u7.length; e11++) {
    let t18 = n15.get(u7[e11]), r17 = t18.behavior || [];
    if (r17.includes(`non-paged`)) {
      e11 === m6 && m6++, a15 || (p6(), d7.push([e11]), p6());
      continue;
    }
    if (e11 === m6 || r17.includes(`facing-pages`)) {
      f7.length && (h8 = true), p6(), d7.push([e11]), p6();
      continue;
    }
    if (f7.push(e11), h8) {
      p6(), h8 = false;
      continue;
    }
    f7.length > 1 && p6();
  }
  return f7.length && p6(), [u7, d7];
}

// node_modules/@iiif/helpers/dist/batch-actions-BILnVnlf.js
var e8 = function(e11) {
  return function() {
    let t18 = { type: e11, getType: () => e11, toString: () => e11 };
    return (e12, n15) => ({ ...t18, ...e12 !== void 0 && { payload: e12 }, ...n15 !== void 0 && { meta: n15 } });
  };
};
var t12 = `@iiif/IMPORT_ENTITIES`;
var n10 = `@iiif/MODIFY_ENTITY_FIELD`;
var r13 = `@iiif/REORDER_ENTITY_FIELD`;
var i13 = `@iiif/MOVE_ENTITY`;
var a12 = `@iiif/MOVE_ENTITIES`;
var o11 = `@iiif/ADD_REFERENCE`;
var s8 = `@iiif/UPDATE_REFERENCE`;
var c7 = `@iiif/REMOVE_REFERENCE`;
var l7 = `@iiif/ADD_METADATA`;
var u6 = `@iiif/REMOVE_METADATA`;
var d6 = `@iiif/UPDATE_METADATA`;
var f6 = `@iiif/REORDER_METADATA`;
var p5 = e8(t12)();
var m5 = e8(n10)();
var h6 = e8(r13)();
var g6 = e8(i13)();
var _6 = e8(a12)();
var v6 = e8(o11)();
var y6 = e8(c7)();
var b6 = e8(s8)();
var x6 = e8(l7)();
var S6 = e8(d6)();
var C6 = e8(u6)();
var w6 = e8(f6)();
var T6 = { importEntities: p5, modifyEntityField: m5, reorderEntityField: h6, addReference: v6, removeReference: y6, updateReference: b6, addMetadata: x6, removeMetadata: C6, updateMetadata: S6, reorderMetadata: w6, moveEntity: g6, moveEntities: _6 };
var E6 = `@iiif/ADD_MAPPING`;
var D6 = `@iiif/ADD_MAPPINGS`;
var O6 = e8(E6)();
var k6 = e8(D6)();
var j6 = `RESOURCE_ERROR`;
var M5 = `RESOURCE_LOADING`;
var N5 = `RESOURCE_READY`;
var P6 = `@iiif/REQUEST_RESOURCE`;
var F6 = `@iiif/REQUEST_ERROR`;
var I6 = `@iiif/REQUEST_MISMATCH`;
var L6 = `@iiif/REQUEST_COMPLETE`;
var R6 = `@iiif/REQUEST_OFFLINE_RESOURCE`;
var z5 = e8(P6)();
var B4 = e8(F6)();
var V4 = e8(I6)();
var H4 = e8(L6)();
var U4 = e8(R6)();
var G4 = `@iiif/BATCH`;
var K3 = `@iiif/BATCH_IMPORT`;
var q3 = e8(G4)();
var J4 = e8(K3)();

// node_modules/@iiif/helpers/dist/meta-actions-D2Y8oeA0.js
var t13 = `@iiif/SET_META_VALUE`;
var n11 = `@iiif/SET_META_VALUE_DYNAMIC`;
var r14 = `@iiif/UNSET_META_VALUE`;
var i14 = e8(t13)();
var a13 = e8(n11)();
var o12 = e8(r14)();
var s9 = { setMetaValue: i14, setMetaValueDynamic: a13, unsetMetaValue: o12 };

// node_modules/@iiif/helpers/dist/create-fetch-helper-Ty--oKG3.js
var h7 = (e11, t18) => {
  let { entities: n15, resource: a15, mapping: u7 } = L4(t18);
  if (a15.id === void 0) return [B4({ id: e11, message: `ID is not defined in resource.` })];
  let d7 = [p5({ entities: n15 }), k6({ mapping: u7 })];
  return a15.id !== e11 && (d7.push(O6({ id: e11, type: a15.type })), d7.push(V4({ requestId: e11, actualId: a15.id }))), d7.push(H4({ id: e11 })), d7;
};
var g7 = Number.isNaN || function(e11) {
  return typeof e11 == `number` && e11 !== e11;
};
function _7(e11, t18) {
  return !!(e11 === t18 || g7(e11) && g7(t18));
}
function v7(e11, t18) {
  if (!Array.isArray(e11) || !Array.isArray(t18)) return e11 === t18;
  if (e11.length !== t18.length) return false;
  for (let n15 = 0; n15 < e11.length; n15++) if (!_7(e11[n15], t18[n15])) return false;
  return true;
}
function y7(e11, t18, n15) {
  let r16 = e11.iiif.requests[t18], i16 = e11.iiif.mapping[t18];
  if (!i16 || !e11.iiif.entities[i16][r16.resourceUri]) return;
  let a15 = e11.iiif.entities[i16][r16.resourceUri];
  if (a15 && a15[a6]) {
    let e12 = a15[a6].find((e13) => n15 ? e13[o5] === n15.id : e13[o5] === a15.id);
    return f3(a15, e12);
  }
  return a15;
}
function b7(e11) {
  return e11 && typeof e11.then == `function`;
}
function x7(r16, i16, { waitTimeout: o14 = 30 } = {}) {
  return (s10, l8, d7) => {
    let f7 = r16.getStore(), p6 = f7.getState(), m6 = p6.iiif.requests[s10];
    if (m6) {
      if (m6.loadingState === N5) {
        let e11 = y7(p6, s10);
        if (e11) return e11;
      }
      switch (m6.loadingState) {
        case j6:
          break;
        case M5:
          return (async () => {
            let t18, r17 = false;
            try {
              let i17 = await Promise.race([new Promise((i18, a15) => {
                r17 || (t18 = f7.subscribe(() => {
                  let t19 = f7.getState();
                  if (t19.iiif.requests[s10].loadingState === j6) {
                    a15();
                    return;
                  }
                  if (t19.iiif.requests[s10].loadingState === N5) {
                    let e11 = y7(t19, s10);
                    e11 ? i18(e11) : a15();
                  }
                }));
              }), new Promise((e11, t19) => setTimeout(() => {
                r17 = true, t19();
              }, o14 * 60 * 1e3))]);
              if (t18 && t18(), i17) return i17;
            } catch {
              t18 && t18();
            }
          })();
      }
    }
    r16.dispatch(z5({ id: s10 }));
    let g9 = (e11) => {
      if (!e11) return;
      !e11.id && !e11[`@id`] && (e11[`@type`] && (e11[`@id`] = s10), e11.id = s10);
      let t18 = h7(s10, e11);
      return r16.dispatch(q3({ actions: t18 })), y7(f7.getState(), s10);
    };
    try {
      let e11 = i16(s10, l8);
      return b7(e11) ? (async () => {
        try {
          let t18 = await e11;
          return d7 && (t18 = d7(t18)), g9(t18);
        } catch (e12) {
          throw r16.dispatch(B4({ id: s10, message: e12.toString() })), e12;
        }
      })() : g9(d7 ? d7(e11) : e11);
    } catch (e11) {
      throw r16.dispatch(B4({ id: s10, message: e11.toString() })), e11;
    }
  };
}

// node_modules/@iiif/helpers/dist/get-default-entities-CMS8y0ZA.js
function e9() {
  return { Collection: {}, Manifest: {}, Canvas: {}, AnnotationPage: {}, AnnotationCollection: {}, Annotation: {}, ContentResource: {}, Range: {}, Service: {}, Selector: {}, Agent: {} };
}

// node_modules/@iiif/helpers/dist/store-B7swNE6p.js
var A6 = (e11, t18) => (n15, r16, i16) => (i16.dispatch = (t19) => (n15((n16) => e11(n16, t19), false, t19), t19), i16.dispatchFromDevtools = true, { dispatch: (...e12) => i16.dispatch(...e12), ...t18 });
var j7 = A6;
var M6 = /* @__PURE__ */ new Map();
var N6 = (e11) => {
  let t18 = M6.get(e11);
  return t18 ? Object.fromEntries(Object.entries(t18.stores).map(([e12, t19]) => [e12, t19.getState()])) : {};
};
var P7 = (e11, t18, n15) => {
  if (e11 === void 0) return { type: `untracked`, connection: t18.connect(n15) };
  let r16 = M6.get(n15.name);
  if (r16) return { type: `tracked`, store: e11, ...r16 };
  let i16 = { connection: t18.connect(n15), stores: {} };
  return M6.set(n15.name, i16), { type: `tracked`, store: e11, ...i16 };
};
var F7 = (e11, t18 = {}) => (n15, r16, i16) => {
  let { enabled: a15, anonymousActionType: o14, store: s10, ...c8 } = t18, l8;
  try {
    l8 = (a15 ?? (import.meta.env ? import.meta.env.MODE : void 0) !== `production`) && window.__REDUX_DEVTOOLS_EXTENSION__;
  } catch {
  }
  if (!l8) return (import.meta.env ? import.meta.env.MODE : void 0) !== `production` && a15 && console.warn(`[zustand devtools middleware] Please install/enable Redux devtools extension`), e11(n15, r16, i16);
  let { connection: u7, ...d7 } = P7(s10, l8, c8), f7 = true;
  i16.setState = (e12, t19, a16) => {
    let l9 = n15(e12, t19);
    if (!f7) return l9;
    let d8 = a16 === void 0 ? { type: o14 || `anonymous` } : typeof a16 == `string` ? { type: a16 } : a16;
    return s10 === void 0 ? (u7 == null ? void 0 : u7.send(d8, r16()), l9) : (u7 == null ? void 0 : u7.send({ ...d8, type: `${s10}/${d8.type}` }, { ...N6(c8.name), [s10]: i16.getState() }), l9);
  };
  let p6 = (...e12) => {
    let t19 = f7;
    f7 = false, n15(...e12), f7 = t19;
  }, m6 = e11(i16.setState, r16, i16);
  if (d7.type === `untracked` ? u7 == null ? void 0 : u7.init(m6) : (d7.stores[d7.store] = i16, u7 == null ? void 0 : u7.init(Object.fromEntries(Object.entries(d7.stores).map(([e12, t19]) => [e12, e12 === d7.store ? m6 : t19.getState()])))), i16.dispatchFromDevtools && typeof i16.dispatch == `function`) {
    let e12 = false, t19 = i16.dispatch;
    i16.dispatch = (...n16) => {
      (import.meta.env ? import.meta.env.MODE : void 0) !== `production` && n16[0].type === `__setState` && !e12 && (console.warn(`[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.`), e12 = true), t19(...n16);
    };
  }
  return u7.subscribe((e12) => {
    var _a;
    var t19;
    switch (e12.type) {
      case `ACTION`:
        if (typeof e12.payload != `string`) {
          console.error(`[zustand devtools middleware] Unsupported action format`);
          return;
        }
        return L7(e12.payload, (e13) => {
          if (e13.type === `__setState`) {
            if (s10 === void 0) {
              p6(e13.state);
              return;
            }
            Object.keys(e13.state).length !== 1 && console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);
            let t20 = e13.state[s10];
            if (t20 == null) return;
            JSON.stringify(i16.getState()) !== JSON.stringify(t20) && p6(t20);
            return;
          }
          i16.dispatchFromDevtools && typeof i16.dispatch == `function` && i16.dispatch(e13);
        });
      case `DISPATCH`:
        switch (e12.payload.type) {
          case `RESET`:
            return p6(m6), s10 === void 0 ? u7 == null ? void 0 : u7.init(i16.getState()) : u7 == null ? void 0 : u7.init(N6(c8.name));
          case `COMMIT`:
            if (s10 === void 0) {
              u7 == null ? void 0 : u7.init(i16.getState());
              return;
            }
            return u7 == null ? void 0 : u7.init(N6(c8.name));
          case `ROLLBACK`:
            return L7(e12.state, (e13) => {
              if (s10 === void 0) {
                p6(e13), u7 == null ? void 0 : u7.init(i16.getState());
                return;
              }
              p6(e13[s10]), u7 == null ? void 0 : u7.init(N6(c8.name));
            });
          case `JUMP_TO_STATE`:
          case `JUMP_TO_ACTION`:
            return L7(e12.state, (e13) => {
              if (s10 === void 0) {
                p6(e13);
                return;
              }
              JSON.stringify(i16.getState()) !== JSON.stringify(e13[s10]) && p6(e13[s10]);
            });
          case `IMPORT_STATE`: {
            let { nextLiftedState: n16 } = e12.payload, r17 = (_a = t19 = n16.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;
            if (!r17) return;
            p6(s10 === void 0 ? r17 : r17[s10]), u7 == null ? void 0 : u7.send(null, n16);
            return;
          }
          case `PAUSE_RECORDING`:
            return f7 = !f7;
        }
        return;
    }
  }), m6;
};
var I7 = F7;
var L7 = (e11, t18) => {
  let n15;
  try {
    n15 = JSON.parse(e11);
  } catch (e12) {
    console.error(`[zustand devtools middleware] Could not parse the received json`, e12);
  }
  n15 !== void 0 && t18(n15);
};
var R7 = (e11) => (t18, n15, r16) => {
  let i16 = r16.subscribe;
  r16.subscribe = (e12, t19, n16) => {
    let a16 = e12;
    if (t19) {
      let i17 = (n16 == null ? void 0 : n16.equalityFn) || Object.is, o14 = e12(r16.getState());
      a16 = (n17) => {
        let r17 = e12(n17);
        if (!i17(o14, r17)) {
          let e13 = o14;
          t19(o14 = r17, e13);
        }
      }, (n16 == null ? void 0 : n16.fireImmediately) && t19(o14, o14);
    }
    return i16(a16);
  };
  let a15 = e11(t18, n15, r16);
  return a15;
};
var z6 = R7;
var B5 = (e11 = {}, r16) => {
  switch (r16.type) {
    case E6:
      return { ...e11, [r16.payload.id]: r16.payload.type };
    case D6:
      return { ...e11, ...r16.payload.mapping };
    default:
      return e11;
  }
};
function V5(e11, t18, n15, r16) {
  return !(!e11[n15] || !e11[n15][t18] || !e11[n15][t18][r16] || !Array.isArray(e11[n15][t18][r16]));
}
function H5(e11, t18) {
  let n15 = {}, r16 = [];
  for (let [i16, a15] of Object.entries(e11 || {})) {
    r16.push(i16);
    let e12 = (t18 || {})[i16];
    if (!e12 || e12.length === 0) {
      n15[i16] = a15;
      continue;
    }
    n15[i16] = e12;
  }
  for (let [e12, i16] of Object.entries(t18 || {})) {
    if (r16.indexOf(e12) !== -1) continue;
    n15[e12] = i16;
  }
  return n15;
}
function U5(e11) {
  return e11.payload || {};
}
function W3(e11, t18, n15) {
  if (!e11[t18] || !Array.isArray(e11[t18])) return null;
  let r16 = n15.index === void 0 ? e11[t18].findIndex((e12) => {
    var _a;
    return e12 ? ((_a = r6(e12)) == null ? void 0 : _a.id) === n15.id : false;
  }) : n15.index;
  return r16 === -1 ? null : { entity: e11[t18][r16], index: r16 };
}
function G5(e11, t18) {
  var _a;
  if (!(!(t18 == null ? void 0 : t18.id) || !(t18 == null ? void 0 : t18.type))) return (_a = e11[t18.type]) == null ? void 0 : _a[t18.id];
}
function K4(e11, t18) {
  return e11 === void 0 ? t18 : e11;
}
var q4 = (e11 = e9(), t18) => {
  var _a;
  let n15 = (n16, r16) => ({ ...e11, [U5(t18).type]: { ...e11[U5(t18).type], [U5(t18).id]: { ...n16, ...r16 } } });
  switch (t18.type) {
    case n10: {
      if (!e11[U5(t18).type] || !e11[U5(t18).type][U5(t18).id]) return e11;
      let r16 = e11[U5(t18).type][U5(t18).id];
      return typeof r16 == `string` ? e11 : n15(r16, { [U5(t18).key]: U5(t18).value });
    }
    case r13: {
      if (!V5(e11, U5(t18).id, U5(t18).type, U5(t18).key)) return e11;
      let r16 = e11[U5(t18).type][U5(t18).id];
      if (typeof r16 == `string`) return e11;
      let i16 = Array.from(r16[U5(t18).key]), [a15] = i16.splice(U5(t18).startIndex, 1);
      return i16.splice(U5(t18).endIndex, 0, a15), n15(r16, { [U5(t18).key]: i16 });
    }
    case a12: {
      let n16 = U5(t18).subjects, r16 = U5(t18).from, i16 = U5(t18).to || r16, a15 = G5(e11, r16), o14 = (i16 == null ? void 0 : i16.key) || r16.key;
      if (!V5(e11, r16.id, r16.type, r16.key) || !V5(e11, i16.id, i16.type, i16.key)) return e11;
      let s10 = [], c8 = [];
      if (n16.type === `slice`) {
        let e12 = n16.startIndex, t19 = n16.length;
        s10 = Array.from(a15[r16.key]), c8 = s10.splice(e12, t19);
      } else {
        let e12 = Array.from(a15[r16.key]);
        for (let t19 of n16.items) {
          let n17 = W3(a15, r16.key, t19);
          n17 && (c8.push(n17.entity), e12[n17.index] = null), s10 = e12.filter((e13) => e13 !== null);
        }
      }
      let l8 = { ...a15, [r16.key]: s10 }, u7 = { ...e11, [r16.type]: { ...e11[r16.type], [r16.id]: l8 } }, d7 = G5(u7, i16);
      if (!d7) return e11;
      let f7 = (i16 == null ? void 0 : i16.index) === void 0 ? d7[o14].length : i16.index, p6 = Array.from(d7[i16.key]);
      p6.splice(f7, 0, ...c8);
      let m6 = { ...d7, [o14]: p6 }, h8 = { ...u7, [i16.type]: { ...u7[i16.type], [i16.id]: m6 } };
      return h8;
    }
    case i13:
      return q4(e11, { type: a12, payload: { subjects: { type: `list`, items: [U5(t18).subject] }, from: U5(t18).from, to: U5(t18).to } });
    case t12: {
      let n16 = Object.keys(U5(t18).entities), r16 = { ...e11 };
      for (let i16 of n16) {
        let n17 = U5(t18).entities[i16], a15 = { ...e11[i16] || {} }, o14 = false, s10 = Object.keys(n17 || {}) || [];
        if (n17 && s10) {
          for (let t19 of s10) o14 = true, a15[t19] = e11[i16][t19] ? H5(e11[i16][t19], n17[t19]) : n17[t19];
          o14 && (r16[i16] = a15);
        }
      }
      return r16;
    }
    case o11: {
      if (!V5(e11, U5(t18).id, U5(t18).type, U5(t18).key)) return e11;
      let r16 = e11[U5(t18).type][U5(t18).id], i16 = Array.from(r16[U5(t18).key]);
      return i16.splice(K4(U5(t18).index, i16.length + 1), 0, U5(t18).reference), n15(r16, { [U5(t18).key]: i16 });
    }
    case s8:
    case c7: {
      if (!V5(e11, U5(t18).id, U5(t18).type, U5(t18).key)) return e11;
      let r16 = e11[U5(t18).type][U5(t18).id], i16 = Array.from(r16[U5(t18).key]), a15 = K4(U5(t18).index, i16.findIndex((e12) => e12 && e12.id === U5(t18).reference.id));
      return a15 === -1 || ((_a = i16[a15]) == null ? void 0 : _a.id) !== U5(t18).reference.id ? e11 : (t18.type === s8 ? i16.splice(a15, 1, U5(t18).reference) : i16.splice(a15, 1), n15(r16, { [U5(t18).key]: i16 }));
    }
    case l7: {
      let r16 = e11[U5(t18).type][U5(t18).id];
      if (!r16) return e11;
      let i16 = Array.from(r16.metadata || []), a15 = U5(t18);
      return i16.splice(K4(t18.payload.beforeIndex, i16.length + 1), 0, { label: a15.label, value: a15.label }), n15(r16, { metadata: i16 });
    }
    case f6: {
      let r16 = e11[U5(t18).type][U5(t18).id];
      if (typeof r16 == `string` || !r16) return e11;
      let i16 = Array.from(r16.metadata || []), [a15] = i16.splice(U5(t18).startIndex, 1);
      return i16.splice(U5(t18).endIndex, 0, a15), n15(r16, { metadata: i16 });
    }
    case d6:
    case u6: {
      let r16 = e11[U5(t18).type][U5(t18).id], i16 = Array.from(r16.metadata || []), a15 = U5(t18).atIndex;
      return a15 === void 0 || a15 === -1 || !i16[a15] ? e11 : (t18.type === d6 ? i16.splice(a15, 1, { label: U5(t18).label, value: U5(t18).value }) : i16.splice(a15, 1), n15(r16, { metadata: i16 }));
    }
    default:
      return e11;
  }
};
var J5 = (e11 = {}, t18) => {
  switch (t18.type) {
    case P6:
    case R6:
      return { ...e11, [t18.payload.id]: { requestUri: t18.payload.id, loadingState: M5, uriMismatch: false, resourceUri: t18.payload.id } };
    case I6:
      return { ...e11, [t18.payload.requestId]: { ...e11[t18.payload.requestId] || {}, uriMismatch: true, resourceUri: t18.payload.actualId }, [t18.payload.actualId]: { requestUri: t18.payload.requestId, loadingState: e11[t18.payload.requestId].loadingState, uriMismatch: true, resourceUri: t18.payload.actualId } };
    case F6:
      return { ...e11, [t18.payload.id]: { ...e11[t18.payload.id] || {}, loadingState: j6, error: t18.payload.message } };
    case L6:
      return { ...e11, [t18.payload.id]: { ...e11[t18.payload.id] || {}, loadingState: N5, error: void 0 } };
  }
  return e11;
};
var Y4 = (e11 = {}, t18) => {
  let { id: n15, updateValue: r16, value: i16, meta: a15, key: o14 } = t18 && t18.payload || {};
  switch (t18.type) {
    case t13:
      return { ...e11, [n15]: { ...e11[n15] || {}, [a15]: { ...e11[n15] && e11[n15][a15] || {}, [o14]: i16 } } };
    case n11:
      return { ...e11, [n15]: { ...e11[n15] || {}, [a15]: { ...e11[n15] && e11[n15][a15] || {}, [o14]: e11[n15] && e11[n15][a15] ? r16(e11[n15][a15][o14]) : r16(void 0) } } };
    case r14:
      return e11[n15] && e11[n15][a15] && e11[n15][a15][o14] ? { ...e11, [n15]: { ...e11[n15] || {}, [a15]: { ...e11[n15] && e11[n15][a15] || {}, [o14]: void 0 } } } : e11;
    default:
      return e11;
  }
};
function X4(e11 = {}) {
  let t18 = Object.keys(e11);
  return function(n15 = {}, r16) {
    let i16 = false, a15 = {};
    for (let o14 = 0; o14 < t18.length; o14++) {
      let s10 = t18[o14];
      a15[s10] = e11[s10](n15[s10], r16), i16 || (i16 = a15[s10] !== n15[s10]);
    }
    return i16 ? a15 : n15;
  };
}
function Z3(e11) {
  return (t18, n15) => n15 && n15.type === G4 ? n15.payload.actions.reduce(e11, t18) : n15 && n15.type === K3 ? { ...t18, iiif: { ...t18.iiif, ...n15.payload.state } } : e11(t18, n15);
}
var Q3 = X4({ mapping: B5, entities: q4, requests: J5, meta: Y4 });
function $3() {
  return { iiif: { entities: e9(), meta: {}, mapping: {}, requests: {} } };
}
function ee2(t18 = {}) {
  let { enableDevtools: n15 = false, iiifStoreName: r16 = `iiif`, defaultState: i16 = $3(), customReducers: a15 = {} } = t18, o14 = Z3(X4({ [r16]: Q3, ...a15 })), s10 = !!(typeof window < `u` && window.__REDUX_DEVTOOLS_EXTENSION__), c8 = s10 ? I7 : (e11, t19) => e11;
  return t5(z6(c8(j7(o14, i16), { enabled: n15 })));
}

// node_modules/@iiif/helpers/dist/get-global-B_SFHmwc.js
function g8(e11, t18, n15, r16 = true) {
  t18[y8] = t18[y8] || [], t18[y8].push(e11);
  let i16 = /* @__PURE__ */ new Map();
  Object.defineProperty(t18, e11, { enumerable: r16, get() {
    if (t18[_8][e11] === void 0) return;
    let r17 = t18[_8][e11];
    if (!r17) return r17;
    let a15 = n15.get(t18[_8][e11], { parent: this.id ? { id: this.id, type: this.type } : void 0 });
    return i16.has(a15) || (i16.clear(), i16.set(a15, w7(a15, n15))), i16.get(a15);
  }, set(r17) {
    let i17 = t18[_8][e11];
    i17 !== r17 && (this[v8] ? n15.modifyEntityField({ id: this.id, type: this.type }, e11, C7(r17)) : this[_8][e11] = r17);
  } });
}
var _8 = Symbol.for(`_refs_`);
var v8 = Symbol.for(`_reactive_`);
var y8 = Symbol.for(`_defined_`);
var b8 = Symbol.for(`_parent_`);
function x8(e11, t18 = false, n15) {
  let r16 = { id: ``, type: `unknown`, [y8]: [], [_8]: {}, [b8]: n15 || null, [v8]: null, is(e12) {
    return typeof e12 == `string` ? this.id === e12 : e12.id ? e12.id === this.id : false;
  }, reactive() {
    if (!this[v8]) return this[v8] = this.subscribe(() => this.refresh(), true), () => {
      this.unreactive();
    };
  }, refresh() {
    if (this.id) {
      let e12 = this.unwrap();
      for (let t19 of Object.keys(e12 || {})) this[y8].includes(t19) ? this[_8][t19] = e12[t19] : this[t19] = e12[t19];
    }
  }, unreactive() {
    this[v8] && (this[v8](), this[v8] = null);
  }, unwrap() {
    if (!this.id) throw Error(`Invalid object`);
    let t19 = this[b8];
    return e11.get(this.id, { parent: t19 ? { id: t19, type: `unknown` } : void 0 });
  }, toPresentation3() {
    return e11.toPresentation3(this.unwrap());
  }, toPresentation2() {
    return e11.toPresentation2(this.unwrap());
  }, valueOf() {
    return this.unwrap();
  }, toJSON() {
    let e12 = this;
    return { ...e12, items: e12.items, annotations: e12.annotations, structures: e12.structures, seeAlso: e12.seeAlso, service: e12.service, services: e12.services, rendering: e12.rendering, partOf: e12.partOf, start: e12.start, supplementary: e12.supplementary, homepage: e12.homepage, thumbnail: e12.thumbnail, placeholderCanvas: e12.placeholderCanvas, accompanyingCanvas: e12.accompanyingCanvas, provider: e12.provider };
  }, subscribe(t19, n16 = true) {
    return e11.subscribe(() => this.id ? e11.get(this.id) : null, t19, n16);
  } };
  return g8(`items`, r16, e11), g8(`annotations`, r16, e11), g8(`structures`, r16, e11), g8(`seeAlso`, r16, e11), g8(`rendering`, r16, e11), g8(`partOf`, r16, e11), g8(`start`, r16, e11, false), g8(`supplementary`, r16, e11), g8(`homepage`, r16, e11), g8(`thumbnail`, r16, e11), g8(`placeholderCanvas`, r16, e11, false), g8(`accompanyingCanvas`, r16, e11, false), g8(`provider`, r16, e11), g8(`body`, r16, e11), g8(`logo`, r16, e11), r16;
}
function S7(e11) {
  return !!e11[y8];
}
function C7(e11) {
  return Array.isArray(e11) ? e11.map((e12) => C7(e12)) : !e11 || !e11.type ? e11 : { id: e11.id, type: e11.type };
}
function w7(e11, t18, n15 = false, r16) {
  if (Array.isArray(e11)) return e11.map((e12) => w7(e12, t18, n15));
  if (!e11 || !e11.type || !e11.id) return e11;
  let i16 = x8(t18, n15), a15 = Object.create(i16), o14 = Object.assign(a15, e11);
  return n15 && o14.reactive(), o14;
}
function T7(e11) {
  switch (e11) {
    case `Image`:
    case `Video`:
    case `Sound`:
    case `Dataset`:
    case `Text`:
    case `Composite`:
    case `List`:
    case `Independents`:
    case `Audience`:
      return `ContentResource`;
    case `ImageService1`:
    case `ImageService2`:
    case `ImageService3`:
      return `Service`;
  }
  return e11;
}
var E7 = class {
  constructor(n15, r16) {
    r(this, `options`, void 0), r(this, `store`, void 0), r(this, `emitter`, void 0), r(this, `isBatching`, false), r(this, `batchQueue`, []), r(this, `remoteFetcher`, void 0), r(this, `staticFetcher`, void 0), r(this, `defaultFetcher`, (e11) => fetch(e11).then((e12) => {
      if (e12.status === 200) return e12.json();
      {
        let t18 = Error(`${e12.status} ${e12.statusText}`);
        throw t18.name = `HTTPError`, t18;
      }
    })), this.options = Object.assign({ reducers: {}, customFetcher: this.defaultFetcher, enableDevtools: true }, n15 || {}), this.store = r16 || ee2({ customReducers: this.options.reducers, defaultState: this.options.defaultState, enableDevtools: this.options.enableDevtools }), this.emitter = e3(), this.remoteFetcher = x7(this, this.options.customFetcher), this.staticFetcher = x7(this, (e11, t18) => t18);
  }
  batch(e11) {
    this.isBatching = true;
    try {
      e11(this), this.isBatching = false, this.dispatch(q3({ actions: this.batchQueue }));
    } catch (e12) {
      throw this.batchQueue = [], this.isBatching = false, e12;
    }
    this.batchQueue = [];
  }
  async asyncBatch(e11) {
    this.isBatching = true;
    try {
      await e11(this), this.isBatching = false, this.dispatch(q3({ actions: this.batchQueue }));
    } catch (e12) {
      throw this.batchQueue = [], this.isBatching = false, e12;
    }
    this.batchQueue = [];
  }
  modifyEntityField(e11, t18, n15) {
    this.dispatch(T6.modifyEntityField({ id: e11.id, type: e11.type, key: t18, value: n15 }));
  }
  dispatch(e11) {
    if (this.isBatching) this.batchQueue.push(e11);
    else {
      if (e11.type === G4) {
        for (let t20 of e11.payload.actions) this.emitter.emit(t20.type, { action: t20, state: this.store.getState() });
        this.store.dispatch(e11);
        let t19 = this.getState();
        for (let n15 of e11.payload.actions) this.emitter.emit(`after:${n15.type}`, { action: n15, state: t19 });
        return;
      }
      this.emitter.emit(e11.type, { action: e11, state: this.store.getState() }), this.store.dispatch(e11);
      let t18 = this.store.getState();
      this.emitter.emit(`after:${e11.type}`, { action: e11, state: t18 });
      return;
    }
  }
  on(e11, t18) {
    return this.emitter.on(e11, t18), () => {
      this.emitter.off(e11, t18);
    };
  }
  serialize(e11, t18) {
    return oe(this.getState().iiif, e11, t18);
  }
  toPresentation2(e11) {
    return this.serialize(e11, ue2);
  }
  toPresentation3(e11) {
    return this.serialize(e11, de2);
  }
  hydrate(e11, t18, n15 = {}) {
    return this.get(e11, t18, { ...n15, skipSelfReturn: false });
  }
  get(e11, t18, n15 = {}) {
    typeof t18 != `string` && (n15 = t18 || {}, t18 = void 0);
    let { skipSelfReturn: r16 = true } = n15 || {}, i16 = n15.parent ? typeof n15.parent == `string` ? n15.parent : n15.parent.id : void 0;
    if (Array.isArray(e11)) return e11.map((e12) => this.get(e12, n15));
    let a15 = this.getState();
    if (n4(e11) && !n15.preserveSpecificResources && (e11 = e11.source), typeof e11 == `string`) {
      let n16 = T7(t18 || a15.iiif.mapping[e11]);
      if (!n16) return r16 ? null : { id: e11, type: `unknown` };
      e11 = { id: e11, type: n16 };
    }
    if (e11 && e11.partOf && !i16 && !n15.skipPartOfCheck) {
      let t19 = Array.isArray(e11.partOf) ? e11.partOf[0] : e11.partOf;
      t19 && (typeof t19 == `string` && (i16 = t19), typeof t19.id == `string` && (i16 = t19.id));
    }
    let o14 = T7(t18 || (e11 == null ? void 0 : e11.type)), s10 = e11 == null ? void 0 : e11.id, c8 = a15.iiif.entities[o14];
    if (!c8) {
      let t19 = a15.iiif.requests[s10];
      return t19 && t19.resourceUri !== s10 ? this.get(t19.resourceUri, n15) : r16 ? null : e11;
    }
    let p6 = c8[e11.id];
    if (p6 && p6[a6]) {
      let e12 = p6[a6].find((e13) => i16 ? e13[o5] === i16 : e13[o5] === p6.id);
      return f3(p6, e12);
    }
    return c8[e11.id] || (r16 ? null : e11);
  }
  select(e11) {
    return e11(this.getState());
  }
  getStore() {
    return this.store;
  }
  getState() {
    return this.store.getState();
  }
  deep(e11, t18) {
    if (e11 === void 0) return this.get(t18, { skipSelfReturn: false });
    if (typeof e11 == `function`) try {
      let n16 = e11(this.get(t18, { skipSelfReturn: false })), r16 = (e12) => this.deep(e12, n16);
      return r16.size = Array.isArray(n16) ? n16.length : 1, r16;
    } catch {
      let e12 = (e13) => this.deep(e13, void 0);
      return e12.size = 0, e12;
    }
    let n15 = (t19) => this.deep(t19, e11);
    return n15.size = Array.isArray(e11) ? e11.length : 1, n15;
  }
  loadManifest(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return this.load(r16, t18, n15);
  }
  loadCollection(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return this.load(r16, t18, n15);
  }
  load(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return t18 ? Promise.resolve(this.staticFetcher(r16, t18, n15)) : Promise.resolve(this.remoteFetcher(r16, {}, n15));
  }
  loadSync(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return this.staticFetcher(r16, t18, n15);
  }
  loadManifestSync(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return this.loadSync(r16, t18, n15);
  }
  loadCollectionSync(e11, t18, n15) {
    let r16 = typeof e11 == `string` ? e11 : e11.id;
    return this.loadSync(r16, t18, n15);
  }
  areInputsEqual(e11, t18) {
    return v7(e11, t18);
  }
  subscribe(e11, t18, n15) {
    return n15 === void 0 && (t18 === void 0 || t18 === false || t18 === true) && (n15 = t18, t18 = e11, e11 = (e12) => e12), this.store.subscribe(e11, (e12) => t18(e12, this), { equalityFn: v7, fireImmediately: !n15 });
  }
  async ensureLoaded(e11) {
    let t18 = typeof e11 == `string` ? e11 : e11.id;
    this.requestStatus(t18) || await this.load(t18);
  }
  requestStatus(e11) {
    return this.select((t18) => t18.iiif.requests[e11]);
  }
  getPaginationState(e11) {
    let t18 = typeof e11 == `string` ? e11 : e11.id;
    if (!t18) return null;
    let n15 = this.getResourceMeta(t18, `@vault/pagination`);
    if (n15 == null ? void 0 : n15.state) return n15.state;
    let r16 = this.get(e11);
    if (r16.first) {
      let e12 = { currentPage: null, currentPageIndex: null, isFetching: false, isFullyLoaded: false, next: r16.first, page: 1, pages: [], previous: null, totalItems: r16.total, currentLength: 0 };
      return this.setMetaValue([t18, `@vault/pagination`, `state`], e12), e12;
    }
    return null;
  }
  async loadNextPage(e11, t18) {
    var _a;
    let n15 = typeof e11 == `string` ? e11 : e11.id;
    if (!n15) return [null, null];
    let r16 = this.getPaginationState(e11);
    if (!r16 || r16.isFullyLoaded || !r16.next) return [null, null];
    if (r16.isFetching) return [r16, null];
    let i16 = typeof r16.next == `string` ? r16.next : r16.next.id, a15 = r16.currentPage, o14 = { ...r16, isFetching: true };
    this.setMetaValue([n15, `@vault/pagination`, `state`], o14);
    let s10;
    try {
      s10 = await this.loadCollection(i16, t18, (e12) => {
        let { id: t19, "@id": n16, ...r17 } = e12 || {};
        return n16 ? { "@id": i16, ...r17 } : { id: i16, ...r17 };
      });
    } catch (e12) {
      let t19 = { ...r16, isFetching: false, error: e12 };
      return this.setMetaValue([n15, `@vault/pagination`, `state`], t19), [t19, null];
    }
    if (!s10) {
      let e12 = { ...r16, isFetching: false, error: Error(`Collection not found`) };
      return this.setMetaValue([n15, `@vault/pagination`, `state`], e12), [e12, null];
    }
    let c8 = this.get(n15), l8 = [...c8.items || [], ...s10.items || []].map((e12) => ({ id: e12.id, type: e12.type }));
    this.modifyEntityField({ id: n15, type: `Collection` }, `items`, l8);
    let u7 = this.getPaginationState(e11);
    if (!u7) throw Error(`Pagination state not found`);
    let d7 = { ...u7, isFetching: false, error: null, currentPage: s10.id, next: ((_a = s10.next) == null ? void 0 : _a.id) || null, currentPageIndex: u7.pages.length, currentLength: l8.length, pages: [...u7.pages, { id: s10.id, type: `Collection`, startIndex: c8.items.length, pageLength: s10.items.length, order: typeof u7.currentPageIndex == `number` ? u7.currentPageIndex + 1 : 0 }], isFullyLoaded: !s10.next, previous: a15, page: u7.pages.length + 1 };
    return this.setMetaValue([n15, `@vault/pagination`, `state`], d7), [d7, s10];
  }
  getResourceMeta(e11, t18) {
    let n15 = this.getState().iiif.meta[e11];
    if (n15) return t18 ? n15[t18] : n15;
  }
  getObject(e11, t18, n15 = {}) {
    let { reactive: r16, ...i16 } = n15;
    return w7(this.get(e11, t18, i16), this, r16);
  }
  async loadObject(e11, t18) {
    return w7(await this.load(e11, t18), this);
  }
  async loadManifestObject(e11, t18) {
    return w7(await this.loadManifest(e11, t18), this);
  }
  async loadCollectionObject(e11, t18) {
    return w7(await this.loadCollection(e11, t18), this);
  }
  wrapObject(e11) {
    return w7(this.get(e11, { skipSelfReturn: false }), this);
  }
  isWrapped(e11) {
    return S7(e11);
  }
  setMetaValue([e11, t18, n15], r16) {
    this.dispatch(typeof r16 == `function` ? s9.setMetaValueDynamic({ id: e11, meta: t18, key: n15, updateValue: r16 }) : s9.setMetaValue({ id: e11, meta: t18, key: n15, value: r16 }));
  }
};
function D7() {
  return typeof self < `u` ? self : typeof window < `u` ? window : typeof global < `u` ? global : {};
}

// node_modules/@iiif/helpers/dist/vault-pEbK3Lfv.js
function n12(n15) {
  let r16 = D7();
  try {
    let e11 = r16.IIIF_VAULT;
    if (e11) return e11;
  } catch {
  }
  let i16 = new E7(n15);
  try {
    r16.IIIF_VAULT = i16;
  } catch {
  }
  return i16;
}

// node_modules/@iiif/parser/dist/upgrader.js
var t14 = Y2;

// node_modules/@iiif/helpers/dist/fetch-Baxw0iE2.js
function t15(t18, n15) {
  return fetch(t18, n15).then((e11) => e11.json()).then(t14);
}

// node_modules/@iiif/helpers/dist/search1-Cj6esplu.js
var t16 = (e11) => e11.id || e11[`@id`];
function n13(e11) {
  return !e11 || !e11.service ? null : e11 ? e11.service.find((e12) => e12.profile === `SearchService1` || e12.profile === `http://iiif.io/api/search/1/search`) : null;
}
function r15(e11) {
  if (!e11 || !e11.service) return;
  let t18 = Array.isArray(e11.service) ? e11.service : [e11.service];
  return t18.find((e12) => e12.profile === `http://iiif.io/api/search/0/autocomplete` || e12.profile === `http://iiif.io/api/search/1/autocomplete` || e12.profile === `AutoCompleteService1`);
}
var i15 = (n15, i16) => {
  let o14 = (i16 == null ? void 0 : i16.fetcher) || a14, s10 = n15 ? r15(n15) : void 0, c8 = s10 ? t16(s10) : void 0, l8 = null;
  return t5((e11, n16) => ({ results: [], lastQuery: {}, hasAutocomplete: !!s10, endpoint: c8, loading: false, error: false, errorMessage: ``, ignored: [], setSearchService(n17) {
    let i17 = r15(n17);
    i17 && e11({ endpoint: t16(i17), hasAutocomplete: true, results: [], loading: false, lastQuery: null, error: false, errorMessage: `` });
  }, clearSearch() {
    e11({ results: [], loading: false, lastQuery: null });
  }, async search(t18, r16 = {}) {
    let i17 = n16().endpoint;
    if (n16().hasAutocomplete === false) return;
    l8 && !l8.signal.aborted && l8.abort(), l8 = new AbortController();
    let a15 = new URLSearchParams();
    a15.set(`q`, t18), r16.motivation && a15.set(`motivation`, r16.motivation), r16.date && a15.set(`date`, r16.date), r16.user && a15.set(`user`, r16.user);
    let s11 = true;
    if ((!t18 || t18.length < 3) && !r16.motivation && !r16.date && !r16.user && (s11 = false), e11({ loading: s11, lastQuery: { q: t18, motivation: r16.motivation, date: r16.date, user: r16.user } }), s11) return o14(`${i17}?${a15.toString()}`, { signal: l8.signal, headers: { "Content-Type": `application/json`, Accept: `application/json`, ...r16.headers || {} } }).then(async ([t19, n17]) => {
      (l8 == null ? void 0 : l8.signal.aborted) || e11(t19 ? { loading: false, ignored: t19.ignored || [], results: t19.terms, error: false, errorMessage: `` } : { results: [], error: true, errorMessage: n17 || void 0 });
    });
  } }));
};
function a14(e11, { signal: t18, headers: n15 }) {
  return fetch(e11, { signal: t18, headers: { "Content-Type": `application/json`, Accept: `application/json`, ...n15 || {} } }).then(async (e12) => e12.ok ? [await e12.json(), null] : [null, e12.statusText]);
}
var o13 = (n15, i16) => {
  let o14 = (i16 == null ? void 0 : i16.fetcher) || a14, s10;
  s10 = typeof n15 == `string` ? { "@context": `http://iiif.io/api/search/1/context.json`, profile: `http://iiif.io/api/search/1/search`, "@id": n15, id: n15, service: [] } : n15;
  let c8 = null;
  return t5((e11, n16) => ({ endpoint: s10 ? t16(s10) : void 0, service: s10, resources: [], hits: [], lastQuery: {}, loading: false, error: false, highlight: { results: null, hit: null }, hitIndex: -1, hasSearch: !!s10, hasAutocomplete: s10 ? !!r15(s10) : false, errorMessage: ``, async search(t18, r16 = {}) {
    let i17 = n16().endpoint;
    if (!i17) throw Error(`No search service found.`);
    c8 && !c8.signal.aborted && c8.abort(), c8 = new AbortController();
    let a15 = new URLSearchParams();
    t18.q && a15.set(`q`, t18.q), t18.motivation && a15.set(`motivation`, t18.motivation), t18.date && a15.set(`date`, t18.date), t18.user && a15.set(`user`, t18.user), e11({ lastQuery: t18, loading: true });
    let s11 = await o14(`${i17}?${a15.toString()}`, { signal: c8.signal, headers: r16.headers }).then(([t19, n17]) => {
      (c8 == null ? void 0 : c8.signal.aborted) || e11(t19 ? { resources: (t19.resources || []).map((e12) => (e12.search && !e12.url && (e12.url = e12.search), e12)), hits: t19.hits || (t19.resources || []).map((e12) => ({ "@type": `search:Hit`, after: ``, annotations: [e12[`@id`]], before: ``, match: e12.resource.chars })), error: false, errorMessage: ``, loading: false } : { loading: false, resources: [], error: true, errorMessage: n17 || void 0 });
    });
    return s11;
  }, setSearchService(n17) {
    e11({ service: n17, endpoint: n17 ? t16(n17) : void 0, hasSearch: !!n17, hasAutocomplete: n17 ? !!r15(n17) : false, loading: false, resources: [], error: false, errorMessage: ``, highlight: { results: null, hit: null } });
  }, clearSearch() {
    e11({ resources: [], error: false, errorMessage: `` });
  }, highlightHit(t18) {
    let r16 = n16(), i17 = r16.hits[t18];
    if (!i17) return;
    let a15 = r16.resources.filter((e12) => i17.annotations.includes(e12[`@id`]));
    e11({ hitIndex: t18, highlight: { results: a15, hit: i17 } });
  }, nextHit() {
    let e12 = n16(), t18 = e12.hitIndex + 1;
    t18 >= e12.hits.length || e12.highlightHit(t18);
  }, previousHit() {
    let e12 = n16(), t18 = e12.hitIndex - 1;
    t18 < 0 || e12.highlightHit(t18);
  } }));
};

// node_modules/@iiif/helpers/dist/nav-date-MeCEyVQD.js
function e10(e11, t18, n15) {
  let r16 = n15 || `century`, i16 = [], a15 = [], o14 = e11.get(t18);
  if (!o14.items) return i16;
  for (let e12 of o14.items) if (e12.navDate) {
    let t19 = new Date(e12.navDate), n16 = t19.getFullYear(), s10 = t19.getMonth(), c8 = t19.getDate(), l8 = Math.floor(n16 / 10) * 10, u7 = Math.floor(n16 / 100) * 100, d7 = a15.find((e13) => e13.yearStart === u7);
    d7 ? d7.count++ : (d7 = { id: `${o14.id}/century/${u7}`, label: { en: [`${u7} - ${u7 + 99}`] }, type: `century`, yearStart: u7, yearEnd: u7 + 99, count: 1, items: [] }, r16 === `century` && i16.push(d7), a15.push(d7));
    let f7 = d7.items.find((e13) => e13.yearStart === l8);
    f7 ? f7.count++ : (f7 = { id: `${o14.id}/decade/${l8}`, label: { en: [`${l8} - ${l8 + 9}`] }, type: `decade`, yearStart: l8, yearEnd: l8 + 9, count: 1, items: [] }, d7.items.push(f7), r16 === `decade` && i16.push(f7));
    let p6 = f7.items.find((e13) => e13.year === n16);
    p6 ? p6.count++ : (p6 = { id: `${o14.id}/year/${n16}`, label: { en: [`${n16}`] }, type: `year`, year: n16, count: 1, items: [] }, f7.items.push(p6), r16 === `year` && i16.push(p6));
    let m6 = p6.items.find((e13) => e13.month === s10);
    m6 ? m6.count++ : (m6 = { id: `${o14.id}/month/${n16}/${s10 + 1}`, label: { en: [r16 === `month` ? `${t19.toLocaleString(`default`, { month: `long` })} ${n16}` : `${t19.toLocaleString(`default`, { month: `long` })}`] }, type: `month`, month: s10, count: 1, items: [] }, p6.items.push(m6), r16 === `month` && i16.push(m6));
    let h8 = m6.items.find((e13) => e13.day === c8);
    h8 ? h8.count++ : (h8 = { id: `${o14.id}/day/${n16}/${s10 + 1}/${c8}`, label: { en: [`${t19.toDateString()}`] }, type: `day`, day: c8, count: 1, items: [] }, m6.items.push(h8), r16 === `day` && i16.push(h8)), h8.items.push({ id: e12.id, type: e12.type, label: e12.label || { en: [`${n16}-${s10 + 1}-${c8}`] }, navDate: e12.navDate });
  }
  if (!n15) {
    let e12 = i16;
    for (; e12.length === 1; ) e12 = e12[0].items;
    return e12;
  }
  return i16;
}

export {
  t2 as t,
  t3 as t2,
  H,
  Z,
  se,
  $,
  de,
  h2 as h,
  g2 as g,
  _2 as _,
  v2 as v,
  y2 as y,
  b2 as b,
  x2 as x,
  S2 as S,
  C2 as C,
  w2 as w,
  T2 as T,
  E2 as E,
  D2 as D,
  O2 as O,
  k2 as k,
  A2 as A,
  j2 as j,
  r3 as r,
  a2 as a,
  o2 as o,
  t9 as t3,
  n5 as n,
  r7 as r2,
  a7 as a2,
  o6 as o2,
  s4 as s,
  j5 as j2,
  I5 as I,
  R5 as R,
  z4 as z,
  t11 as t4,
  n7 as n2,
  r10 as r3,
  i10 as i,
  a10 as a3,
  s6 as s2,
  r11 as r4,
  i11 as i2,
  a11 as a4,
  o10 as o3,
  s7 as s3,
  c6 as c,
  l6 as l,
  u5 as u,
  f5 as f,
  n9 as n3,
  r12 as r5,
  i12 as i3,
  T6 as T2,
  E7 as E2,
  n12 as n4,
  t15 as t5,
  n13 as n5,
  r15 as r6,
  i15 as i4,
  o13 as o4,
  e10 as e
};
//# sourceMappingURL=chunk-JVEBHM4B.js.map
